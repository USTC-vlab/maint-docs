# 容器内网

容器内网使用 VXLAN 实现，在所有计算服务器上均使用 ens1f1 界面连接，创建命令为

```shell
ip link add vxlan0 type vxlan id 10 group 239.1.1.1 dstport 0 dev ens1f1
```

[RFC 7348](https://tools.ietf.org/html/rfc7348) 指出 VXLAN 接收端口为 UDP 4789，因此该端口必须在 ens1f1 上开放。实际上由于 ens1f0 和 ens1f1 这两个界面没有外部接入，故不设防。

## IP 地址分配

容器内网 IP 段为 172.31.0.0/16，目前使用情况：

- 172.31.0.1 为内网网关，运行在 CT 100 上，该容器同时连接校园网，对外 IP 为 202.38.75.252，提供所有学生机的校园网访问以及 SSH 接入（均为 NAT）
- 172.31.0.2 为 web 服务器，即 CT 101，对外 IP 为 202.38.75.226，也是域名 `vlab.ustc.edu.cn` 指向的地址
- 172.31.0.0/22 保留，用于实验等内部用途
- 172.31.0.0 和 172.31.255.255 不是单播地址，无法使用
- 172.31.4.0 - 172.31.255.254 分配给学生机使用

另外还有一段 172.30.0.0/24 用于主机接入等内部用途，目前分配情况如下：

- 172.30.0.1 = CT 100
- 172.30.0.2 = CT 101
- 172.30.0.3 = CT 102
- 172.30.0.101 - 172.30.0.108 为主机接入
