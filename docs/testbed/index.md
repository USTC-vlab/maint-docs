# 测试环境

我们的测试环境运行在单机 pv0 上，没有使用集群配置。

## 与生产环境的比较

测试环境主要用于开发和测试，各方面配置都与生产环境接近，例如：

- 相同的 CT 100（gateway）和 CT 101（web）
- 相同的网络架构
  - 同样的 bond / vmbr0 / vmbr1
  - 同样采用 VXLAN 作为容器内网（但是没有多机，一些防火墙规则可能不起作用）
  - 同样的 IP 地址分配（如测试和生产的 gateway 对内都是 172.31.0.1）

同时测试环境也用于踩坑，所以在新软件或新版操作系统发布时甚至发布前，我们也会更积极地升级，例如：

- pv0 在 2021 年 7 月重装，我们直接采用了 Proxmox VE 7 的 iso 镜像安装，而当时的生产环境还都在运行 PVE 6.4
- gateway0 和 web0 使用 Proxmox 提供的 Debian 10.10 (buster) 镜像创建，但创建后立刻升级到了 Debian 11.0 (bullseye)

## 与生产环境的联系

### 登录

为了方便复制和传输数据，部分生产环境的主机和虚拟机可以直接 SSH 登录部分测试环境（当然也就可以 rsync 了）：

- root@pv1 通过 SSH 可以直接访问 pv0
- root@web 通过 SSH 可以直接访问 web0

以上两个访问都是直接添加的 `~/.ssh/authorized_keys`。

!!! warning

    出于安全考虑，**不要**在测试环境中配置生产环境的登录权限（添加公钥等）。

### 配置

测试环境和生产环境共用同一套 Nginx 配置文件方便调试，但测试环境的 /etc/nginx 仓库中的 deploy key 没有写入权限，请自行 `git pull` 后再 `git push`。

其他配置暂时没有共享。
