{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u8fdc\u7a0b\u6559\u5b66\u4e91\u684c\u9762\u5e73\u53f0 \u00b6 \u6ce8\u610f \u672c\u6587\u6863\u662f\u5e73\u53f0\u7684\u7ef4\u62a4\u6587\u6863\uff0c\u5185\u5bb9\u4ec5\u5bf9\u7ef4\u62a4\u5de5\u4f5c\u6709\u7528\uff0c\u7528\u6237\u8bf7\u770b \u7528\u6237\u6587\u6863 \u3002 \u672c\u6587\u6863\u4e0d\u662f\u6559\u5b66\u6587\u6863\uff0c\u7ef4\u62a4\u8005\u5e94\u5f53\u5177\u5907\u4e00\u5b9a\u7684 Linux \u670d\u52a1\u5668\u64cd\u4f5c\u7ecf\u9a8c\u3002\u5982\u5bf9\u5185\u5bb9\u7406\u89e3\u6709\u95ee\u9898\uff0c\u8bf7\u81ea\u884c Google \u3002 Linux \u5165\u95e8\u53ef\u4ee5\u53c2\u8003\u6821 Linux \u7528\u6237\u534f\u4f1a\u7684 Linux 101 \u8bfe\u7a0b\u8bb2\u4e49 \u6216\u5176\u4ed6 \u5728\u7ebf\u6559\u7a0b \u3002 When in doubt, ask. \u6587\u6863\u7f3a\u5931 \u4ee5\u4e0b\u5185\u5bb9\u7f3a\u4e4f\u5bf9\u5e94\u7684\u7ef4\u62a4\u6587\u6863\uff1a Django \u524d\u7aef VNC \u7f51\u5173 SSH \u7f51\u5173 noVNC \u7f51\u9875 Grafana \u9762\u677f\u53ca\u5176\u540e\u7aef \u8d44\u6e90 \u00b6 GitHub \u8ba8\u8bba\u5217\u8868 Telegram \u5f00\u53d1\u5c0f\u7ec4\u8ba8\u8bba\u7fa4","title":"\u9996\u9875"},{"location":"#_1","text":"\u6ce8\u610f \u672c\u6587\u6863\u662f\u5e73\u53f0\u7684\u7ef4\u62a4\u6587\u6863\uff0c\u5185\u5bb9\u4ec5\u5bf9\u7ef4\u62a4\u5de5\u4f5c\u6709\u7528\uff0c\u7528\u6237\u8bf7\u770b \u7528\u6237\u6587\u6863 \u3002 \u672c\u6587\u6863\u4e0d\u662f\u6559\u5b66\u6587\u6863\uff0c\u7ef4\u62a4\u8005\u5e94\u5f53\u5177\u5907\u4e00\u5b9a\u7684 Linux \u670d\u52a1\u5668\u64cd\u4f5c\u7ecf\u9a8c\u3002\u5982\u5bf9\u5185\u5bb9\u7406\u89e3\u6709\u95ee\u9898\uff0c\u8bf7\u81ea\u884c Google \u3002 Linux \u5165\u95e8\u53ef\u4ee5\u53c2\u8003\u6821 Linux \u7528\u6237\u534f\u4f1a\u7684 Linux 101 \u8bfe\u7a0b\u8bb2\u4e49 \u6216\u5176\u4ed6 \u5728\u7ebf\u6559\u7a0b \u3002 When in doubt, ask. \u6587\u6863\u7f3a\u5931 \u4ee5\u4e0b\u5185\u5bb9\u7f3a\u4e4f\u5bf9\u5e94\u7684\u7ef4\u62a4\u6587\u6863\uff1a Django \u524d\u7aef VNC \u7f51\u5173 SSH \u7f51\u5173 noVNC \u7f51\u9875 Grafana \u9762\u677f\u53ca\u5176\u540e\u7aef","title":"\u8fdc\u7a0b\u6559\u5b66\u4e91\u684c\u9762\u5e73\u53f0"},{"location":"#resources","text":"GitHub \u8ba8\u8bba\u5217\u8868 Telegram \u5f00\u53d1\u5c0f\u7ec4\u8ba8\u8bba\u7fa4","title":"\u8d44\u6e90"},{"location":"changelog/","text":"\u66f4\u65b0\u8bb0\u5f55 \u00b6 \u8bb0\u5f55\u6211\u4eec\u4e0a\u7ebf\u90e8\u7f72\u65b0\u529f\u80fd\uff08\u6216 bug fix \u7b49\uff09\u7684\u5386\u53f2\u3002 \u7f16\u5199\u65f6\u8bf7\u6309\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f\uff0c\u5373\u6700\u65b0\u7684\u65e5\u671f\u5728\u6700\u4e0a\u9762\u3002\u6709\u4e13\u95e8\u7684\u5de5\u4f5c\u8bb0\u5f55\u9875\u9762\u7684\u8bf7\u628a\u65f6\u95f4\u94fe\u63a5\u5230\u5bf9\u5e94\u7684\u9875\u9762\u3002 Note \u672c\u9875\u9762\u4e8e 2020 \u5e74 9 \u6708\u521d\u521b\u5efa\uff0c\u56e0\u6b64 2020 \u5e74 8 \u6708\u53ca\u4ee5\u524d\u7684\u66f4\u65b0\u8bb0\u5f55\u662f\u4e0d\u5b8c\u6574\u7684\u3002\u5c3d\u7ba1\u7f16\u8005\u5df2\u4ece\u8ba8\u8bba\u7fa4\u7684\u804a\u5929\u8bb0\u5f55\u7b49\u5730\u5c3d\u53ef\u80fd\u6062\u590d\uff08\u8865\u5199\uff09\u51fa\u4e86\u4e00\u4e9b\uff0c\u4f46\u8bb8\u591a\u7ec6\u8282\u4ecd\u7136\u96be\u4ee5\u4fdd\u8bc1\u5b8c\u6574\u6027\u53ca\u51c6\u786e\u6027\u3002 \u66f4\u65b0\u8bb0\u5f55 \u00b6 2021 \u5e74 \u00b6 4 \u6708 11 \u65e5 \u901a\u8fc7 Vlab Software \u63d0\u4f9b\u4e86 RISC-V \u7684 GCC \u5de5\u5177\u94fe\uff0c\u4ee5\u53ca RARS \u6a21\u62df\u5668\uff08\u5df2\u7f16\u5199 .desktop \u6587\u4ef6\u4f7f\u7528 Vlab Software \u63d0\u4f9b\u7684 JDK 14 \u8fd0\u884c\uff09 3 \u6708 30 \u65e5 \u901a\u8fc7 Vlab Software \u63d0\u4f9b\u4e86 Xilinx Vivado 2016.3 \u7248\u672c\uff0c\u4e3a 2019.1 \u7248\u672c\u7684\u517c\u5bb9\u6027\u95ee\u9898\u63d0\u4f9b\u4e00\u4e2a\u5907\u9009\u9879\u3002 2020 \u5e74 \u00b6 11 \u6708 18 \u65e5 \u5904\u7406\u4e86 CT 100 \u76f8\u5173\u7684\u95ee\u9898\u3002 11 \u6708 14 \u65e5 Vivado \u4eff\u771f\u7684\u62a5\u9519\u5df2\u7ecf\u5728\u955c\u50cf\u4e2d\u4fee\u590d\uff0c\u65b0\u521b\u5efa\u7684\u865a\u62df\u673a\uff08ID \u5927\u4e8e 2266\uff09\u4e0d\u518d\u53d7\u6b64\u5f71\u54cd\u3002 \u5728\u7ebf VSCode \u7f16\u7a0b\u5e73\u53f0\u5f00\u653e\u6d4b\u8bd5\u3002 10 \u6708 29 \u65e5 \u7528\u6237\u53ef\u4ee5\u9009\u62e9\u5173\u95ed VNC \u767b\u5f55\u65f6\u663e\u793a\u7684\u52a0\u5165 QQ \u7fa4\u7684\u901a\u77e5\u3002 9 \u6708 8 \u65e5 \u5b8c\u6210\u4e86\u5728\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u5b9e\u9a8c\u8f6f\u4ef6\u7684\u8bbe\u8ba1\uff08\u955c\u50cf 01 \u5df2\u7ecf\u66ff\u6362\u4e3a\u65b0\u7248\u672c\uff09\uff0c\u8fd9\u53ef\u4ee5\u51cf\u5c11\u76f8\u540c\u7684\u5b9e\u9a8c\u8f6f\u4ef6\u91cd\u590d\u5b58\u50a8\u7684\u95ee\u9898\uff0c\u5e76\u4e14\u5c06\u8f6f\u4ef6\u653e\u7f6e\u5728 SSD \u4e0a\uff0c\u4e5f\u9884\u671f\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\u540c\u65f6\uff0c\u65b0\u521b\u5efa\u7684\u5bb9\u5668\u4e5f\u652f\u6301\u5d4c\u5957\u5bb9\u5668\u4e86\u3002 9 \u6708 5 \u65e5 \u865a\u62df\u673a\u7ba1\u7406\u754c\u9762\u7684 \u684c\u9762\u8fde\u63a5 \u529f\u80fd\u73b0\u5728\u53ef\u4ee5\u81ea\u52a8\u8fde\u63a5\u5bf9\u5e94\u865a\u62df\u673a\uff08\u4f7f\u7528 URL parameters \u4f20\u9012\u4fe1\u606f\uff09 9 \u6708 3 \u65e5 SSH \u7edf\u4e00\u767b\u5f55\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002\u9884\u8ba1\u5c06\u5728\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u5173\u95ed\u65e7\u7684\u767b\u5f55\u65b9\u5f0f\uff08\u7aef\u53e3\u8f6c\u53d1\uff09\uff0c\u5177\u4f53\u65f6\u95f4\u5f85\u5b9a 8 \u6708 4 \u65e5 \u57fa\u4e8e Grafana + InfluxDB / MySQL \u7684\u7528\u91cf\u6570\u636e\u7edf\u8ba1\u9875\u9762 8 \u6708 1 \u65e5 \u5149\u7ea4\u7f51\u7edc\uff08ens1f0\u3001ens1f1\uff09\u7684 MTU \u73b0\u5728\u662f 1550 \u5b57\u8282\u4e86 \u4fee\u590d\u4e86 pv8 \u7684\u5149\u7ea4\u7f51\u7edc noVNC \u652f\u6301\u57fa\u4e8e\u6d4f\u89c8\u5668 cookie \u7684\u4e00\u952e\u767b\u5f55\uff0c\u51cf\u5c11\u91cd\u590d\u8f93\u5165\u7528\u6237\u540d\u5bc6\u7801\u7684\u9ebb\u70e6 \u914d\u7f6e\u5e76\u6253\u5305\u597d\u4e86 Ubuntu 20.04 \u7684\u955c\u50cf\uff0c\u6682\u65f6\u4ee5\u7f16\u53f7 99 \u63d0\u4f9b 3 \u6708 31 \u65e5 \u5411 pv0 \u52a0\u88c5\u4e86 32 GB \u5185\u5b58\uff0c\u5411 pv2~pv8 \u52a0\u88c5\u4e86 64 GB \u5185\u5b58\uff0c\u5411 pv2~pv5 \u52a0\u88c5\u4e86 Netronome Agilio \u7cfb\u5217\u7f51\u5361 3 \u6708 25 \u65e5 2019 \u5e74\u79cb\u5b63\u5b66\u671f\u63d0\u4f9b\u670d\u52a1\u7684\u5355\u53f0\u670d\u52a1\u5668\u5df2\u683c\u5f0f\u5316\u91cd\u88c5\u4e3a Proxmox VE 6.1 \u64cd\u4f5c\u7cfb\u7edf 2 \u6708 \u5185\u7f51\u7f51\u5173\uff08CT 100\uff09 \u521d\u6b65\u914d\u7f6e\u5b8c\u6210 Web \u670d\u52a1\u5668\uff08CT 101\uff09 \u5207\u6362\u5230\u65b0\u7684\u96c6\u7fa4\u4e2d\u7684\u5bb9\u5668\u4e0a\uff0c2019 \u5e74\u79cb\u5b63\u7684\u65e7\u673a\u5668\u6682\u65f6\u95f2\u7f6e pdlan \u4f7f\u7528 C++ \u7f16\u5199\u7684 VNC \u7f51\u5173\u6d4b\u8bd5\u5b8c\u6210 \u7f51\u9875\u865a\u62df\u673a\u7ba1\u7406\u5668\uff08Django\uff09\u9002\u914d\u4e86 Proxmox VE API\uff0c\u5220\u9664\u4e86 LXC / LXD \u76f8\u5173\u7684\u4ee3\u7801 \u4fee\u6539\u4e86\u5f00\u6e90\u8f6f\u4ef6 noVNC\uff0c\u63d0\u4f9b\u4e86\u6d4f\u89c8\u5668\u767b\u5f55\u865a\u62df\u673a\u7684\u65b9\u5f0f \u91cd\u65b0\u6253\u5305\u4e86\u51e0\u4e2a\u65b0\u955c\u50cf\uff0c\u4f9b\u7528\u6237\u5728\u521b\u5efa\u865a\u62df\u673a\u65f6\u9009\u62e9 \u7ecf\u8fc7\u591a\u756a\u6d4b\u8bd5\uff0c\u9009\u5b9a\u4e86 LightDM + TigerVNC\uff0c\u517c\u5bb9\u6027\u6700\u597d\u4e14\u6700\u5bb9\u6613\u914d\u7f6e \u6d4b\u8bd5\u4e86 fcitx \u4e0e ibus\uff0c\u914d\u7f6e\u597d\u4e86\u4e2d\u6587\u8f93\u5165\u6cd5 \u901a\u8fc7\u955c\u50cf\u5185\u7f6e SSH CA \u7684\u65b9\u5f0f\u5b9e\u73b0\u5bb9\u5668\u5185\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c \u66f4\u65b0\u4e86\u7528\u6237\u6587\u6863\u9879\u76ee\uff0c\u66f4\u5bb9\u6613\u7f16\u5199\u3001\u9605\u8bfb\u4f53\u9a8c\u66f4\u597d\uff0c\u5e76\u4e14\u66f4\u65b0\u4e86\u6587\u6863\u5185\u5bb9 \u521b\u5efa\u4e86\u7ef4\u62a4\u8005\u6587\u6863\uff08\u5373\u672c\u6587\u6863\uff09 \u2026\u2026\u8fd8\u6709\u66f4\u591a\uff08\u5f53\u524d\u4e00\u4ee3\u7684 vlab \u57fa\u672c\u90fd\u5728\u8fd9\u4e2a\u6708\u914d\u7f6e\u90e8\u7f72\u5b8c\u6210\uff0c\u65f6\u95f4\u201c\u4e45\u8fdc\u201d\u96be\u4ee5\u4ed4\u7ec6\u8003\u8bc1\uff09 2019 \u5e74 \u00b6 9 \u6708 \u521d\u7248 vlab \u5b9e\u9a8c\u5e73\u53f0\u5728\u300a\u6570\u5b57\u7535\u8def\u5b9e\u9a8c\u300b\u8bfe\u7a0b\u9009\u5b9a\u7684 30 \u4eba\u5de6\u53f3\u4e2d\u8fdb\u884c\u6d4b\u8bd5","title":"\u66f4\u65b0\u5386\u53f2"},{"location":"changelog/#_1","text":"\u8bb0\u5f55\u6211\u4eec\u4e0a\u7ebf\u90e8\u7f72\u65b0\u529f\u80fd\uff08\u6216 bug fix \u7b49\uff09\u7684\u5386\u53f2\u3002 \u7f16\u5199\u65f6\u8bf7\u6309\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f\uff0c\u5373\u6700\u65b0\u7684\u65e5\u671f\u5728\u6700\u4e0a\u9762\u3002\u6709\u4e13\u95e8\u7684\u5de5\u4f5c\u8bb0\u5f55\u9875\u9762\u7684\u8bf7\u628a\u65f6\u95f4\u94fe\u63a5\u5230\u5bf9\u5e94\u7684\u9875\u9762\u3002 Note \u672c\u9875\u9762\u4e8e 2020 \u5e74 9 \u6708\u521d\u521b\u5efa\uff0c\u56e0\u6b64 2020 \u5e74 8 \u6708\u53ca\u4ee5\u524d\u7684\u66f4\u65b0\u8bb0\u5f55\u662f\u4e0d\u5b8c\u6574\u7684\u3002\u5c3d\u7ba1\u7f16\u8005\u5df2\u4ece\u8ba8\u8bba\u7fa4\u7684\u804a\u5929\u8bb0\u5f55\u7b49\u5730\u5c3d\u53ef\u80fd\u6062\u590d\uff08\u8865\u5199\uff09\u51fa\u4e86\u4e00\u4e9b\uff0c\u4f46\u8bb8\u591a\u7ec6\u8282\u4ecd\u7136\u96be\u4ee5\u4fdd\u8bc1\u5b8c\u6574\u6027\u53ca\u51c6\u786e\u6027\u3002","title":"\u66f4\u65b0\u8bb0\u5f55"},{"location":"changelog/#_2","text":"","title":"\u66f4\u65b0\u8bb0\u5f55"},{"location":"changelog/#2021","text":"4 \u6708 11 \u65e5 \u901a\u8fc7 Vlab Software \u63d0\u4f9b\u4e86 RISC-V \u7684 GCC \u5de5\u5177\u94fe\uff0c\u4ee5\u53ca RARS \u6a21\u62df\u5668\uff08\u5df2\u7f16\u5199 .desktop \u6587\u4ef6\u4f7f\u7528 Vlab Software \u63d0\u4f9b\u7684 JDK 14 \u8fd0\u884c\uff09 3 \u6708 30 \u65e5 \u901a\u8fc7 Vlab Software \u63d0\u4f9b\u4e86 Xilinx Vivado 2016.3 \u7248\u672c\uff0c\u4e3a 2019.1 \u7248\u672c\u7684\u517c\u5bb9\u6027\u95ee\u9898\u63d0\u4f9b\u4e00\u4e2a\u5907\u9009\u9879\u3002","title":"2021 \u5e74"},{"location":"changelog/#2020","text":"11 \u6708 18 \u65e5 \u5904\u7406\u4e86 CT 100 \u76f8\u5173\u7684\u95ee\u9898\u3002 11 \u6708 14 \u65e5 Vivado \u4eff\u771f\u7684\u62a5\u9519\u5df2\u7ecf\u5728\u955c\u50cf\u4e2d\u4fee\u590d\uff0c\u65b0\u521b\u5efa\u7684\u865a\u62df\u673a\uff08ID \u5927\u4e8e 2266\uff09\u4e0d\u518d\u53d7\u6b64\u5f71\u54cd\u3002 \u5728\u7ebf VSCode \u7f16\u7a0b\u5e73\u53f0\u5f00\u653e\u6d4b\u8bd5\u3002 10 \u6708 29 \u65e5 \u7528\u6237\u53ef\u4ee5\u9009\u62e9\u5173\u95ed VNC \u767b\u5f55\u65f6\u663e\u793a\u7684\u52a0\u5165 QQ \u7fa4\u7684\u901a\u77e5\u3002 9 \u6708 8 \u65e5 \u5b8c\u6210\u4e86\u5728\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u5b9e\u9a8c\u8f6f\u4ef6\u7684\u8bbe\u8ba1\uff08\u955c\u50cf 01 \u5df2\u7ecf\u66ff\u6362\u4e3a\u65b0\u7248\u672c\uff09\uff0c\u8fd9\u53ef\u4ee5\u51cf\u5c11\u76f8\u540c\u7684\u5b9e\u9a8c\u8f6f\u4ef6\u91cd\u590d\u5b58\u50a8\u7684\u95ee\u9898\uff0c\u5e76\u4e14\u5c06\u8f6f\u4ef6\u653e\u7f6e\u5728 SSD \u4e0a\uff0c\u4e5f\u9884\u671f\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\u540c\u65f6\uff0c\u65b0\u521b\u5efa\u7684\u5bb9\u5668\u4e5f\u652f\u6301\u5d4c\u5957\u5bb9\u5668\u4e86\u3002 9 \u6708 5 \u65e5 \u865a\u62df\u673a\u7ba1\u7406\u754c\u9762\u7684 \u684c\u9762\u8fde\u63a5 \u529f\u80fd\u73b0\u5728\u53ef\u4ee5\u81ea\u52a8\u8fde\u63a5\u5bf9\u5e94\u865a\u62df\u673a\uff08\u4f7f\u7528 URL parameters \u4f20\u9012\u4fe1\u606f\uff09 9 \u6708 3 \u65e5 SSH \u7edf\u4e00\u767b\u5f55\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002\u9884\u8ba1\u5c06\u5728\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u5173\u95ed\u65e7\u7684\u767b\u5f55\u65b9\u5f0f\uff08\u7aef\u53e3\u8f6c\u53d1\uff09\uff0c\u5177\u4f53\u65f6\u95f4\u5f85\u5b9a 8 \u6708 4 \u65e5 \u57fa\u4e8e Grafana + InfluxDB / MySQL \u7684\u7528\u91cf\u6570\u636e\u7edf\u8ba1\u9875\u9762 8 \u6708 1 \u65e5 \u5149\u7ea4\u7f51\u7edc\uff08ens1f0\u3001ens1f1\uff09\u7684 MTU \u73b0\u5728\u662f 1550 \u5b57\u8282\u4e86 \u4fee\u590d\u4e86 pv8 \u7684\u5149\u7ea4\u7f51\u7edc noVNC \u652f\u6301\u57fa\u4e8e\u6d4f\u89c8\u5668 cookie \u7684\u4e00\u952e\u767b\u5f55\uff0c\u51cf\u5c11\u91cd\u590d\u8f93\u5165\u7528\u6237\u540d\u5bc6\u7801\u7684\u9ebb\u70e6 \u914d\u7f6e\u5e76\u6253\u5305\u597d\u4e86 Ubuntu 20.04 \u7684\u955c\u50cf\uff0c\u6682\u65f6\u4ee5\u7f16\u53f7 99 \u63d0\u4f9b 3 \u6708 31 \u65e5 \u5411 pv0 \u52a0\u88c5\u4e86 32 GB \u5185\u5b58\uff0c\u5411 pv2~pv8 \u52a0\u88c5\u4e86 64 GB \u5185\u5b58\uff0c\u5411 pv2~pv5 \u52a0\u88c5\u4e86 Netronome Agilio \u7cfb\u5217\u7f51\u5361 3 \u6708 25 \u65e5 2019 \u5e74\u79cb\u5b63\u5b66\u671f\u63d0\u4f9b\u670d\u52a1\u7684\u5355\u53f0\u670d\u52a1\u5668\u5df2\u683c\u5f0f\u5316\u91cd\u88c5\u4e3a Proxmox VE 6.1 \u64cd\u4f5c\u7cfb\u7edf 2 \u6708 \u5185\u7f51\u7f51\u5173\uff08CT 100\uff09 \u521d\u6b65\u914d\u7f6e\u5b8c\u6210 Web \u670d\u52a1\u5668\uff08CT 101\uff09 \u5207\u6362\u5230\u65b0\u7684\u96c6\u7fa4\u4e2d\u7684\u5bb9\u5668\u4e0a\uff0c2019 \u5e74\u79cb\u5b63\u7684\u65e7\u673a\u5668\u6682\u65f6\u95f2\u7f6e pdlan \u4f7f\u7528 C++ \u7f16\u5199\u7684 VNC \u7f51\u5173\u6d4b\u8bd5\u5b8c\u6210 \u7f51\u9875\u865a\u62df\u673a\u7ba1\u7406\u5668\uff08Django\uff09\u9002\u914d\u4e86 Proxmox VE API\uff0c\u5220\u9664\u4e86 LXC / LXD \u76f8\u5173\u7684\u4ee3\u7801 \u4fee\u6539\u4e86\u5f00\u6e90\u8f6f\u4ef6 noVNC\uff0c\u63d0\u4f9b\u4e86\u6d4f\u89c8\u5668\u767b\u5f55\u865a\u62df\u673a\u7684\u65b9\u5f0f \u91cd\u65b0\u6253\u5305\u4e86\u51e0\u4e2a\u65b0\u955c\u50cf\uff0c\u4f9b\u7528\u6237\u5728\u521b\u5efa\u865a\u62df\u673a\u65f6\u9009\u62e9 \u7ecf\u8fc7\u591a\u756a\u6d4b\u8bd5\uff0c\u9009\u5b9a\u4e86 LightDM + TigerVNC\uff0c\u517c\u5bb9\u6027\u6700\u597d\u4e14\u6700\u5bb9\u6613\u914d\u7f6e \u6d4b\u8bd5\u4e86 fcitx \u4e0e ibus\uff0c\u914d\u7f6e\u597d\u4e86\u4e2d\u6587\u8f93\u5165\u6cd5 \u901a\u8fc7\u955c\u50cf\u5185\u7f6e SSH CA \u7684\u65b9\u5f0f\u5b9e\u73b0\u5bb9\u5668\u5185\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c \u66f4\u65b0\u4e86\u7528\u6237\u6587\u6863\u9879\u76ee\uff0c\u66f4\u5bb9\u6613\u7f16\u5199\u3001\u9605\u8bfb\u4f53\u9a8c\u66f4\u597d\uff0c\u5e76\u4e14\u66f4\u65b0\u4e86\u6587\u6863\u5185\u5bb9 \u521b\u5efa\u4e86\u7ef4\u62a4\u8005\u6587\u6863\uff08\u5373\u672c\u6587\u6863\uff09 \u2026\u2026\u8fd8\u6709\u66f4\u591a\uff08\u5f53\u524d\u4e00\u4ee3\u7684 vlab \u57fa\u672c\u90fd\u5728\u8fd9\u4e2a\u6708\u914d\u7f6e\u90e8\u7f72\u5b8c\u6210\uff0c\u65f6\u95f4\u201c\u4e45\u8fdc\u201d\u96be\u4ee5\u4ed4\u7ec6\u8003\u8bc1\uff09","title":"2020 \u5e74"},{"location":"changelog/#2019","text":"9 \u6708 \u521d\u7248 vlab \u5b9e\u9a8c\u5e73\u53f0\u5728\u300a\u6570\u5b57\u7535\u8def\u5b9e\u9a8c\u300b\u8bfe\u7a0b\u9009\u5b9a\u7684 30 \u4eba\u5de6\u53f3\u4e2d\u8fdb\u884c\u6d4b\u8bd5","title":"2019 \u5e74"},{"location":"overview/","text":"Vlab \u7b2c\u4e8c\u4ee3\u670d\u52a1\u5668\u96c6\u7fa4 \u00b6 \u8ba1\u7b97\u670d\u52a1\u5668 \u00b6 \u7b2c\u4e8c\u4ee3 Vlab \u7684\u8ba1\u7b97\u670d\u52a1\u5668\u5171\u6709 10 \u53f0\uff0c\u5176\u4e2d 8 \u53f0\u4e3a\u666e\u901a\u670d\u52a1\u5668\uff0c2 \u53f0\u4e3a GPU \u670d\u52a1\u5668\uff0c\u53e6\u6709\u4e00\u53f0\u5b58\u50a8\u670d\u52a1\u5668\u3002 \u666e\u901a\u8ba1\u7b97\u670d\u52a1\u5668 \u00b6 8 \u53f0\u666e\u901a\u8ba1\u7b97\u670d\u52a1\u5668\u5206\u522b\u547d\u540d\u4e3a pv1 \u5230 pv8\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u5305\u542b\u53cc\u8def Intel Xeon Scalable Silver 4110 \u5904\u7406\u5668\uff08\u5171 16 \u6838\u5fc3\u300132 \u7ebf\u7a0b\uff09\uff0c\u9884\u88c5\u5185\u5b58 32 GB\uff082 x 16 GB DDR4 2400 ECC\uff09\uff0c\u786c\u76d8\u914d\u7f6e\u4e3a\u4e24\u5757 HPE SSD 480GB\uff08RAID 1\uff0c\u7cfb\u7edf\u76d8\uff0cswap\uff0c\u7f13\u5b58\u548c\u5c11\u91cf\u56fa\u5b9a\u5b58\u50a8\uff0c\u5982\u5bb9\u5668\u955c\u50cf\uff09\u548c\u4e09\u5757 2.4 TB 10K SAS \u786c\u76d8\uff08\u53d6\u51fa\u6765\u653e\u8fdb\u5b58\u50a8\u670d\u52a1\u5668\u7684\u989d\u5916\u786c\u76d8\u7b3c\uff09 \u6240\u6709\u670d\u52a1\u5668\u7684\u5185\u5b58\u5728\u8d2d\u5165\u65f6\u5747\u5347\u7ea7\u81f3 160 GB\uff082 x 16 GB + 4 x 32 GB\uff09\uff0c\u5176\u4e2d pv2 ~ pv8 \u7684\u5185\u5b58\u5728 2020 \u5e74 3 \u6708\u5e95\u518d\u6b21\u5347\u7ea7\u81f3 224 GB\uff082 x 16 GB + 6 x 32 GB\uff09\u3002 \u7f51\u7edc\u65b9\u9762\uff0c\u8fd9\u6b3e\u670d\u52a1\u5668\u81ea\u5e26\u4e00\u4e2a\u56db\u53e3\u5343\u5146\u7f51\u5361\uff08\u7cfb\u7edf\u5185\u540d\u79f0\u4e3a eno1 \u5230 eno4 \uff09\uff0c\u4e00\u4e2a\u767e\u5146\u53e3\u8fde\u63a5 HPE iLO 5\uff08\u5373 HPE \u7684 IPMI \u8fdc\u7a0b\u7ba1\u7406\u5361\uff09\u3002\u53e6\u5916\u6bcf\u53f0\u670d\u52a1\u5668\u6269\u5c55\u4e86\u4e24\u4e2a 10 Gbps \u7684\u5149\u7ea4\u63a5\u53e3\uff08\u5206\u522b\u4e3a ens1f0 \u548c ens1f1 \uff09\uff0c\u901a\u8fc7\u4e00\u4e2a\u5149\u4ea4\u6362\u673a\u5728\u6240\u6709\u8ba1\u7b97\u670d\u52a1\u5668\u548c\u5b58\u50a8\u670d\u52a1\u5668\u7684 iSCSI \u7aef\u53e3\u5b9e\u73b0\u4e00\u4e2a\u5185\u7f51\u4e92\u8054\u3002 \u7b2c\u4e00\u4ee3 Vlab \u7684\u552f\u4e00\u4e00\u53f0\u670d\u52a1\u5668\u5728\u91cd\u88c5\u540e\u6709\u9650\u63d0\u4f9b\u670d\u52a1\uff0c\u547d\u540d\u4e3a pv0\uff0c\u56e0\u6b64\u96c6\u7fa4\u5171\u6709 11 \u53f0\u8ba1\u7b97\u670d\u52a1\u5668\u3002\u4e0e 2019 \u5e74\u79cb\u5b63\u65f6\u76f8\u6bd4\uff0c\u5b83\u591a\u4e86 32 GB \u7684\u5185\u5b58\uff08NUMA \u4e0d\u5747\u8861\uff09\u548c\u4e00\u5757 Intel X520-DA2 \u5149\u7ea4\u5361\u7528\u4e8e\u63a5\u5165\u5149\u7ea4\u7f51\u7edc\uff08\u4f46\u662f\u6700\u540e\u6ca1\u63a5\u4e0a\uff0c\u76ee\u524d\u7528\u4e8e \u6d4b\u8bd5\u5e73\u53f0 \uff09\u3002 \u4e3b\u673a\u7684 IPMI \u5730\u5740\u4e3a 10.38.79.100 \u81f3 10.38.79.108\uff0c\u6700\u540e\u4e00\u4f4d\u6570\u5b57\u548c\u4e3b\u673a\u540d\u4e00\u81f4\uff0c\u8be6\u89c1 IP \u5730\u5740\u5217\u8868 \u3002 GPU \u8ba1\u7b97\u670d\u52a1\u5668 \u00b6 2 \u53f0 GPU \u670d\u52a1\u5668\uff0c\u547d\u540d\u4e3a pvg1 \u548c pvg2\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u5305\u542b\u53cc\u8def Intel Xeon Scalable Gold 5218 \u5904\u7406\u5668\uff08\u5171 32 \u6838\u5fc3\u300164 \u7ebf\u7a0b\uff09\uff0c\u5185\u5b58\u5bb9\u91cf\u4e3a 192 GB\uff08\u7ec4\u5408\u53ca NUMA \u60c5\u51b5\u672a\u77e5\uff09\u3002\u786c\u76d8\u914d\u7f6e\u4e3a\u4e00\u5757 HPE SSD 480GB\uff0c\u7f51\u5361\u914d\u7f6e\u4e0e CPU \u8ba1\u7b97\u670d\u52a1\u5668\u4e00\u81f4\u3002 \u5176\u4e2d pvg1 \u5b89\u88c5\u6709\u4e24\u5757 RTX 2070 Super GPU\uff08\u53ef\u80fd\u4e3a\u6280\u5609\uff09\uff0cpvg2 \u5b89\u88c5\u6709\u4e00\u5757 RTX 2070 Super GPU\uff08\u578b\u53f7\u672a\u77e5\uff09\u548c\u4e00\u5757 Quadro RTX 6000 GPU\u3002 \u4e3b\u673a\u7684 IPMI \u5730\u5740\u5206\u522b\u4e3a 10.38.79.181 \u548c 10.38.79.182\uff0c\u8be6\u89c1 IP \u5730\u5740\u5217\u8868 \u3002 \u64cd\u4f5c\u7cfb\u7edf \u00b6 \u8fd9\u6279\u670d\u52a1\u5668\u5168\u90e8\u5b89\u88c5 Proxmox VE 6.x \u7684\u7cfb\u7edf\uff0c\u57fa\u4e8e Debian 10\u3002\u672c\u5e73\u53f0\u4f7f\u7528 Proxmox VE \u7ba1\u7406\u5bb9\u5668\uff0c\u4ec5\u5728 GPU \u5b9e\u4f8b\u4f7f\u7528 KVM \u865a\u62df\u673a\u3002 \u5b58\u50a8\u670d\u52a1\u5668 \u00b6 \u5b58\u50a8\u670d\u52a1\u5668\u4e3a HPE MSA 1050\uff0c\u6709 24 \u4e2a 2.5 \u5bf8 SAS \u76d8\u4f4d\u548c\u4e24\u4e2a iSCSI \u63a7\u5236\u5668\u3002\u8d2d\u4e70\u65f6\u5e26\u6709 18 \u5757 1.2 TB \u7684\u786c\u76d8\uff0c\u540e\u6765\u90a2\u51ef\u8001\u5e08\u63d0\u4f9b\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u786c\u76d8\u7b3c\uff0c\u6269\u5c55\u4e86 24 \u4e2a\u76d8\u4f4d\uff0c\u6b63\u597d\u653e\u4e0b 8 \u53f0\u8ba1\u7b97\u670d\u52a1\u5668\u5404\u81ea\u5e26\u7684 3 \u5757\u673a\u68b0\u786c\u76d8\u3002 \u8be5\u5b58\u50a8\u670d\u52a1\u5668\u6709\u4e24\u4e2a\u63a7\u5236\u5668\uff0c\u6bcf\u4e2a\u63a7\u5236\u5668\u5404\u6709\u4e00\u4e2a\u4ee5\u592a\u7f51\u53e3\uff08\u7528\u4e8e\u7ba1\u7406\u754c\u9762\uff09\u548c\u4e24\u4e2a\u5149\u7ea4\u63a5\u53e3\uff0810 Gbps\uff0c\u7528\u4e8e\u6570\u636e\u4f20\u8f93\uff09\u3002\u76ee\u524d\u4e24\u4e2a\u63a7\u5236\u5668\u7684\u7ba1\u7406\u63a5\u53e3\u90fd\u63a5\u5165\u6821\u56ed\u7f51\uff0c\u5730\u5740\u5206\u522b\u4e3a 10.38.79.98 \u548c 10.38.79.99 \u3002 \u673a\u623f \u00b6 \u673a\u623f\u5728\u7535\u4e09\u697c 524\uff0c\u9664 pv0 \u4ee5\u5916\u7684\u6240\u6709\u8bbe\u5907\u90fd\u5728\u540c\u4e00\u4e2a\u673a\u67dc\u4e2d\uff0c\u4e0a\u9762\u8d34\u6709\u6807\u7b7e\u3002\u4ece\u4e0b\u5f80\u4e0a\u5206\u522b\u4e3a\uff1a \u5b58\u50a8\u670d\u52a1\u5668\u7684\u4e24\u4e2a\u786c\u76d8\u7b3c\uff08\u6807\u7b7e VLAB S0 \u548c VLAB S1 \uff09 \u516b\u53f0\u8ba1\u7b97\u670d\u52a1\u5668\uff0c\u4e3b\u673a\u540d\u4e3a pv1, pv2 \u5230 pv8\uff0c\u6807\u7b7e\u4e3a VLAB 1 \u5230 VLAB 8 \u673a\u623f\u7684\u7f51\u7ebf\u63a5\u53e3 \u673a\u67dc\u80cc\u540e\u6700\u4e0a\u65b9\u662f\u534e\u4e3a\u7684\u5149\u4ea4\u6362\u673a\uff0c\u53c2\u89c1 \u7f51\u7edc\u914d\u7f6e \u3002 pv0 \u5728\u4e0a\u8ff0\u673a\u67dc\u5de6\u4fa7\u7d27\u6328\u7684\u673a\u67dc\u6700\u4e0b\u65b9\u3002 \u5176\u4ed6\u8d44\u6e90 \u00b6 \u5b66\u6821\u5b98\u65b9\u57df\u540d vlab.ustc.edu.cn \u5c5e\u4e8e\u672c\u9879\u76ee\uff0c\u6307\u5411 A 202.38.75.226 \u53ca AAAA 2001:da8:d800:75::226\u3002\u53e6\u6709\u9759\u6001 IP \u5730\u5740 202.38.75.252 \u7528\u4f5c\u5b66\u751f\u673a\u7f51\u5173\uff0c\u6ca1\u6709\u57df\u540d\u3002\u5173\u4e8e IP \u5730\u5740\u8be6\u89c1 \u8fd9\u4e2a\u9875\u9762 \u3002","title":"\u6982\u89c8"},{"location":"overview/#vlab","text":"","title":"Vlab \u7b2c\u4e8c\u4ee3\u670d\u52a1\u5668\u96c6\u7fa4"},{"location":"overview/#compute-server","text":"\u7b2c\u4e8c\u4ee3 Vlab \u7684\u8ba1\u7b97\u670d\u52a1\u5668\u5171\u6709 10 \u53f0\uff0c\u5176\u4e2d 8 \u53f0\u4e3a\u666e\u901a\u670d\u52a1\u5668\uff0c2 \u53f0\u4e3a GPU \u670d\u52a1\u5668\uff0c\u53e6\u6709\u4e00\u53f0\u5b58\u50a8\u670d\u52a1\u5668\u3002","title":"\u8ba1\u7b97\u670d\u52a1\u5668"},{"location":"overview/#compute-server-cpu","text":"8 \u53f0\u666e\u901a\u8ba1\u7b97\u670d\u52a1\u5668\u5206\u522b\u547d\u540d\u4e3a pv1 \u5230 pv8\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u5305\u542b\u53cc\u8def Intel Xeon Scalable Silver 4110 \u5904\u7406\u5668\uff08\u5171 16 \u6838\u5fc3\u300132 \u7ebf\u7a0b\uff09\uff0c\u9884\u88c5\u5185\u5b58 32 GB\uff082 x 16 GB DDR4 2400 ECC\uff09\uff0c\u786c\u76d8\u914d\u7f6e\u4e3a\u4e24\u5757 HPE SSD 480GB\uff08RAID 1\uff0c\u7cfb\u7edf\u76d8\uff0cswap\uff0c\u7f13\u5b58\u548c\u5c11\u91cf\u56fa\u5b9a\u5b58\u50a8\uff0c\u5982\u5bb9\u5668\u955c\u50cf\uff09\u548c\u4e09\u5757 2.4 TB 10K SAS \u786c\u76d8\uff08\u53d6\u51fa\u6765\u653e\u8fdb\u5b58\u50a8\u670d\u52a1\u5668\u7684\u989d\u5916\u786c\u76d8\u7b3c\uff09 \u6240\u6709\u670d\u52a1\u5668\u7684\u5185\u5b58\u5728\u8d2d\u5165\u65f6\u5747\u5347\u7ea7\u81f3 160 GB\uff082 x 16 GB + 4 x 32 GB\uff09\uff0c\u5176\u4e2d pv2 ~ pv8 \u7684\u5185\u5b58\u5728 2020 \u5e74 3 \u6708\u5e95\u518d\u6b21\u5347\u7ea7\u81f3 224 GB\uff082 x 16 GB + 6 x 32 GB\uff09\u3002 \u7f51\u7edc\u65b9\u9762\uff0c\u8fd9\u6b3e\u670d\u52a1\u5668\u81ea\u5e26\u4e00\u4e2a\u56db\u53e3\u5343\u5146\u7f51\u5361\uff08\u7cfb\u7edf\u5185\u540d\u79f0\u4e3a eno1 \u5230 eno4 \uff09\uff0c\u4e00\u4e2a\u767e\u5146\u53e3\u8fde\u63a5 HPE iLO 5\uff08\u5373 HPE \u7684 IPMI \u8fdc\u7a0b\u7ba1\u7406\u5361\uff09\u3002\u53e6\u5916\u6bcf\u53f0\u670d\u52a1\u5668\u6269\u5c55\u4e86\u4e24\u4e2a 10 Gbps \u7684\u5149\u7ea4\u63a5\u53e3\uff08\u5206\u522b\u4e3a ens1f0 \u548c ens1f1 \uff09\uff0c\u901a\u8fc7\u4e00\u4e2a\u5149\u4ea4\u6362\u673a\u5728\u6240\u6709\u8ba1\u7b97\u670d\u52a1\u5668\u548c\u5b58\u50a8\u670d\u52a1\u5668\u7684 iSCSI \u7aef\u53e3\u5b9e\u73b0\u4e00\u4e2a\u5185\u7f51\u4e92\u8054\u3002 \u7b2c\u4e00\u4ee3 Vlab \u7684\u552f\u4e00\u4e00\u53f0\u670d\u52a1\u5668\u5728\u91cd\u88c5\u540e\u6709\u9650\u63d0\u4f9b\u670d\u52a1\uff0c\u547d\u540d\u4e3a pv0\uff0c\u56e0\u6b64\u96c6\u7fa4\u5171\u6709 11 \u53f0\u8ba1\u7b97\u670d\u52a1\u5668\u3002\u4e0e 2019 \u5e74\u79cb\u5b63\u65f6\u76f8\u6bd4\uff0c\u5b83\u591a\u4e86 32 GB \u7684\u5185\u5b58\uff08NUMA \u4e0d\u5747\u8861\uff09\u548c\u4e00\u5757 Intel X520-DA2 \u5149\u7ea4\u5361\u7528\u4e8e\u63a5\u5165\u5149\u7ea4\u7f51\u7edc\uff08\u4f46\u662f\u6700\u540e\u6ca1\u63a5\u4e0a\uff0c\u76ee\u524d\u7528\u4e8e \u6d4b\u8bd5\u5e73\u53f0 \uff09\u3002 \u4e3b\u673a\u7684 IPMI \u5730\u5740\u4e3a 10.38.79.100 \u81f3 10.38.79.108\uff0c\u6700\u540e\u4e00\u4f4d\u6570\u5b57\u548c\u4e3b\u673a\u540d\u4e00\u81f4\uff0c\u8be6\u89c1 IP \u5730\u5740\u5217\u8868 \u3002","title":"\u666e\u901a\u8ba1\u7b97\u670d\u52a1\u5668"},{"location":"overview/#compute-server-gpu","text":"2 \u53f0 GPU \u670d\u52a1\u5668\uff0c\u547d\u540d\u4e3a pvg1 \u548c pvg2\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u5305\u542b\u53cc\u8def Intel Xeon Scalable Gold 5218 \u5904\u7406\u5668\uff08\u5171 32 \u6838\u5fc3\u300164 \u7ebf\u7a0b\uff09\uff0c\u5185\u5b58\u5bb9\u91cf\u4e3a 192 GB\uff08\u7ec4\u5408\u53ca NUMA \u60c5\u51b5\u672a\u77e5\uff09\u3002\u786c\u76d8\u914d\u7f6e\u4e3a\u4e00\u5757 HPE SSD 480GB\uff0c\u7f51\u5361\u914d\u7f6e\u4e0e CPU \u8ba1\u7b97\u670d\u52a1\u5668\u4e00\u81f4\u3002 \u5176\u4e2d pvg1 \u5b89\u88c5\u6709\u4e24\u5757 RTX 2070 Super GPU\uff08\u53ef\u80fd\u4e3a\u6280\u5609\uff09\uff0cpvg2 \u5b89\u88c5\u6709\u4e00\u5757 RTX 2070 Super GPU\uff08\u578b\u53f7\u672a\u77e5\uff09\u548c\u4e00\u5757 Quadro RTX 6000 GPU\u3002 \u4e3b\u673a\u7684 IPMI \u5730\u5740\u5206\u522b\u4e3a 10.38.79.181 \u548c 10.38.79.182\uff0c\u8be6\u89c1 IP \u5730\u5740\u5217\u8868 \u3002","title":"GPU \u8ba1\u7b97\u670d\u52a1\u5668"},{"location":"overview/#operating-system","text":"\u8fd9\u6279\u670d\u52a1\u5668\u5168\u90e8\u5b89\u88c5 Proxmox VE 6.x \u7684\u7cfb\u7edf\uff0c\u57fa\u4e8e Debian 10\u3002\u672c\u5e73\u53f0\u4f7f\u7528 Proxmox VE \u7ba1\u7406\u5bb9\u5668\uff0c\u4ec5\u5728 GPU \u5b9e\u4f8b\u4f7f\u7528 KVM \u865a\u62df\u673a\u3002","title":"\u64cd\u4f5c\u7cfb\u7edf"},{"location":"overview/#storage-server","text":"\u5b58\u50a8\u670d\u52a1\u5668\u4e3a HPE MSA 1050\uff0c\u6709 24 \u4e2a 2.5 \u5bf8 SAS \u76d8\u4f4d\u548c\u4e24\u4e2a iSCSI \u63a7\u5236\u5668\u3002\u8d2d\u4e70\u65f6\u5e26\u6709 18 \u5757 1.2 TB \u7684\u786c\u76d8\uff0c\u540e\u6765\u90a2\u51ef\u8001\u5e08\u63d0\u4f9b\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u786c\u76d8\u7b3c\uff0c\u6269\u5c55\u4e86 24 \u4e2a\u76d8\u4f4d\uff0c\u6b63\u597d\u653e\u4e0b 8 \u53f0\u8ba1\u7b97\u670d\u52a1\u5668\u5404\u81ea\u5e26\u7684 3 \u5757\u673a\u68b0\u786c\u76d8\u3002 \u8be5\u5b58\u50a8\u670d\u52a1\u5668\u6709\u4e24\u4e2a\u63a7\u5236\u5668\uff0c\u6bcf\u4e2a\u63a7\u5236\u5668\u5404\u6709\u4e00\u4e2a\u4ee5\u592a\u7f51\u53e3\uff08\u7528\u4e8e\u7ba1\u7406\u754c\u9762\uff09\u548c\u4e24\u4e2a\u5149\u7ea4\u63a5\u53e3\uff0810 Gbps\uff0c\u7528\u4e8e\u6570\u636e\u4f20\u8f93\uff09\u3002\u76ee\u524d\u4e24\u4e2a\u63a7\u5236\u5668\u7684\u7ba1\u7406\u63a5\u53e3\u90fd\u63a5\u5165\u6821\u56ed\u7f51\uff0c\u5730\u5740\u5206\u522b\u4e3a 10.38.79.98 \u548c 10.38.79.99 \u3002","title":"\u5b58\u50a8\u670d\u52a1\u5668"},{"location":"overview/#location","text":"\u673a\u623f\u5728\u7535\u4e09\u697c 524\uff0c\u9664 pv0 \u4ee5\u5916\u7684\u6240\u6709\u8bbe\u5907\u90fd\u5728\u540c\u4e00\u4e2a\u673a\u67dc\u4e2d\uff0c\u4e0a\u9762\u8d34\u6709\u6807\u7b7e\u3002\u4ece\u4e0b\u5f80\u4e0a\u5206\u522b\u4e3a\uff1a \u5b58\u50a8\u670d\u52a1\u5668\u7684\u4e24\u4e2a\u786c\u76d8\u7b3c\uff08\u6807\u7b7e VLAB S0 \u548c VLAB S1 \uff09 \u516b\u53f0\u8ba1\u7b97\u670d\u52a1\u5668\uff0c\u4e3b\u673a\u540d\u4e3a pv1, pv2 \u5230 pv8\uff0c\u6807\u7b7e\u4e3a VLAB 1 \u5230 VLAB 8 \u673a\u623f\u7684\u7f51\u7ebf\u63a5\u53e3 \u673a\u67dc\u80cc\u540e\u6700\u4e0a\u65b9\u662f\u534e\u4e3a\u7684\u5149\u4ea4\u6362\u673a\uff0c\u53c2\u89c1 \u7f51\u7edc\u914d\u7f6e \u3002 pv0 \u5728\u4e0a\u8ff0\u673a\u67dc\u5de6\u4fa7\u7d27\u6328\u7684\u673a\u67dc\u6700\u4e0b\u65b9\u3002","title":"\u673a\u623f"},{"location":"overview/#resources","text":"\u5b66\u6821\u5b98\u65b9\u57df\u540d vlab.ustc.edu.cn \u5c5e\u4e8e\u672c\u9879\u76ee\uff0c\u6307\u5411 A 202.38.75.226 \u53ca AAAA 2001:da8:d800:75::226\u3002\u53e6\u6709\u9759\u6001 IP \u5730\u5740 202.38.75.252 \u7528\u4f5c\u5b66\u751f\u673a\u7f51\u5173\uff0c\u6ca1\u6709\u57df\u540d\u3002\u5173\u4e8e IP \u5730\u5740\u8be6\u89c1 \u8fd9\u4e2a\u9875\u9762 \u3002","title":"\u5176\u4ed6\u8d44\u6e90"},{"location":"ssh-ca/","text":"SSH \u8bc1\u4e66\u8ba4\u8bc1 \u00b6 \u6240\u6709 Proxmox VE \u4e3b\u673a\u53ca\u51e0\u4e2a\u7279\u6b8a\u5bb9\u5668\uff08 CT100 gateway \uff0c CT101 web \u548c\u5176\u4ed6 ID \u4e3a 1xx \u7684\u5bb9\u5668/\u865a\u62df\u673a\uff09\u7684 SSH \u767b\u5f55\u5747\u4f7f\u7528\u8bc1\u4e66\u3002 \u5173\u4e8e OpenSSH \u7684\u8bc1\u4e66\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u53ef\u4ee5\u53c2\u8003 iBug \u7684\u535a\u5ba2 \uff08\u82f1\u6587\uff09\u4ee5\u53ca\u6821 Linux \u7528\u6237\u534f\u4f1a\u7684 \u670d\u52a1\u5668\u7ef4\u62a4\u6587\u6863 \u3002 CA \u516c\u94a5\uff1a ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQD6KdAJzKLswXyjf4SipNL1dlK1Vq0KNOit/MTDLiamkqvHJDiKceLYmN97y3Chdx8ofXwW6sRUBJRrjmYq6M0JZSGc8roUtUnSai1P5q1kZQ59x1IhsduTg4WENSteSB6vIvpyoSmcIhi3v9UHgUsl4MsnHxffxx5BiyW7UHPY3MzzkRZL96A4QXUOFd9P+NED3zHmEZ9B2Q66+s2ep2FmNralK4XwRaVxBO2r9san8vYU5pH2TzYZLYxNZ/AFX3bLV5M+AmZytaSNLcuIzZHyqbYawvD+Lee00VB9A3JcaqsjDUCtHZ5gQsZMmqw2r7gj9lDqM6Fw6A8y5rWNJP3Q+FOEEYvzGnQ/SnzU0MpMvGpYWrm/uCJ8pFdbYTYkxAJ+VO0lJ5mAIN664cX0DQ3OyGH/xmCNWGGCfGfmvWqwMwD6Kzo06xcqzsoqaMxwgBuVyICE+VvVCf3pcX4HERDrZY0TMjZxaTc8Ws2xQHJbqekv6nIjQWUgH7LIjkYvycQkxXE2dWfDy/c2SRiKWuxW9n8Hymmfp3lbBHzlCa/LtHeuPIzmBUHUoGya0feWFjrbGnKcPs3etNqpvyIGngMaecTAsbrf5v+J1M0VLCfwzwLt13/G1BCb+BK22vYzMTusrR+6A68Fm6OWSFlBYp31uVLxPg0nqtiW8bi1FbD0hQ== sshd_config \u76f8\u5173\u914d\u7f6e\uff1a HostKey /etc/ssh/ssh_host_rsa_key HostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub AuthorizedKeysFile /dev/null # \u5c4f\u853d\u4e0d\u5e26\u8bc1\u4e66\u7684\u516c\u94a5\u8ba4\u8bc1 PermitRootLogin prohibit-password PasswordAuthentication no \u7528\u6237 CA \u00b6 \u7531\u4e8e Proxmox VE \u6ca1\u6709\u63d0\u4f9b\u76f4\u63a5\u5728\u5bb9\u5668\u5185\u6267\u884c\u547d\u4ee4\u7684 API\uff0c\u56e0\u6b64\u6211\u4eec\u901a\u8fc7\u5185\u5d4c SSH CA \u7684\u65b9\u5f0f\u81ea\u5df1\u9020\u4e2a\u8f6e\u5b50\u3002 \u51fa\u4e8e\u7ba1\u7406\u7684\u8003\u8651\uff0c\u7528\u6237 CA \u548c\u4e3b\u673a CA \u72ec\u7acb\u3002\u516c\u94a5\uff1a ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAH3ZHisQY0iMpUNDQNaxcnRSqDbauE8ih6/MrEENJZa7FHKINOPi+bunK1wEXPqlKfu8INEBWCf95+t86z+jXVxmQE176xenS92wiLvR4MZyCBfD5DXAB0mK5iV1eQug5P/cD8Pohr/3wywFbKgKzsix9unky9sJGr86RunSwJbAkMGlw== \u5c06 CA \u6dfb\u52a0\u81f3\u5bb9\u5668\u6216\u865a\u62df\u673a\u7684\u64cd\u4f5c\u4e0e\u4e0a\u9762\u7c7b\u4f3c\uff0c\u4f46\u662f\u4e0d\u9700\u8981\u5bf9\u4e3b\u673a\u516c\u94a5\u8fdb\u884c\u7b7e\u540d\uff0c\u56e0\u6b64\u53ea\u9700\u8981 \u5c06\u4ee5\u4e0a\u516c\u94a5\u4fdd\u5b58\u81f3\u67d0\u4e2a\u6587\u4ef6\uff0c\u5982 /etc/ssh/ssh_user_ca \u5728 sshd_config \u4e2d\u8ffd\u52a0\uff0c\u6216\u8005\u521b\u5efa /etc/ssh/sshd_config.d/vlab.conf \u5e76\u5199\u5165 TrustedUserCAKeys /etc/ssh/ssh_user_ca","title":"SSH \u8bc1\u4e66\u8ba4\u8bc1"},{"location":"ssh-ca/#ssh","text":"\u6240\u6709 Proxmox VE \u4e3b\u673a\u53ca\u51e0\u4e2a\u7279\u6b8a\u5bb9\u5668\uff08 CT100 gateway \uff0c CT101 web \u548c\u5176\u4ed6 ID \u4e3a 1xx \u7684\u5bb9\u5668/\u865a\u62df\u673a\uff09\u7684 SSH \u767b\u5f55\u5747\u4f7f\u7528\u8bc1\u4e66\u3002 \u5173\u4e8e OpenSSH \u7684\u8bc1\u4e66\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u53ef\u4ee5\u53c2\u8003 iBug \u7684\u535a\u5ba2 \uff08\u82f1\u6587\uff09\u4ee5\u53ca\u6821 Linux \u7528\u6237\u534f\u4f1a\u7684 \u670d\u52a1\u5668\u7ef4\u62a4\u6587\u6863 \u3002 CA \u516c\u94a5\uff1a ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQD6KdAJzKLswXyjf4SipNL1dlK1Vq0KNOit/MTDLiamkqvHJDiKceLYmN97y3Chdx8ofXwW6sRUBJRrjmYq6M0JZSGc8roUtUnSai1P5q1kZQ59x1IhsduTg4WENSteSB6vIvpyoSmcIhi3v9UHgUsl4MsnHxffxx5BiyW7UHPY3MzzkRZL96A4QXUOFd9P+NED3zHmEZ9B2Q66+s2ep2FmNralK4XwRaVxBO2r9san8vYU5pH2TzYZLYxNZ/AFX3bLV5M+AmZytaSNLcuIzZHyqbYawvD+Lee00VB9A3JcaqsjDUCtHZ5gQsZMmqw2r7gj9lDqM6Fw6A8y5rWNJP3Q+FOEEYvzGnQ/SnzU0MpMvGpYWrm/uCJ8pFdbYTYkxAJ+VO0lJ5mAIN664cX0DQ3OyGH/xmCNWGGCfGfmvWqwMwD6Kzo06xcqzsoqaMxwgBuVyICE+VvVCf3pcX4HERDrZY0TMjZxaTc8Ws2xQHJbqekv6nIjQWUgH7LIjkYvycQkxXE2dWfDy/c2SRiKWuxW9n8Hymmfp3lbBHzlCa/LtHeuPIzmBUHUoGya0feWFjrbGnKcPs3etNqpvyIGngMaecTAsbrf5v+J1M0VLCfwzwLt13/G1BCb+BK22vYzMTusrR+6A68Fm6OWSFlBYp31uVLxPg0nqtiW8bi1FbD0hQ== sshd_config \u76f8\u5173\u914d\u7f6e\uff1a HostKey /etc/ssh/ssh_host_rsa_key HostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub AuthorizedKeysFile /dev/null # \u5c4f\u853d\u4e0d\u5e26\u8bc1\u4e66\u7684\u516c\u94a5\u8ba4\u8bc1 PermitRootLogin prohibit-password PasswordAuthentication no","title":"SSH \u8bc1\u4e66\u8ba4\u8bc1"},{"location":"ssh-ca/#ca","text":"\u7531\u4e8e Proxmox VE \u6ca1\u6709\u63d0\u4f9b\u76f4\u63a5\u5728\u5bb9\u5668\u5185\u6267\u884c\u547d\u4ee4\u7684 API\uff0c\u56e0\u6b64\u6211\u4eec\u901a\u8fc7\u5185\u5d4c SSH CA \u7684\u65b9\u5f0f\u81ea\u5df1\u9020\u4e2a\u8f6e\u5b50\u3002 \u51fa\u4e8e\u7ba1\u7406\u7684\u8003\u8651\uff0c\u7528\u6237 CA \u548c\u4e3b\u673a CA \u72ec\u7acb\u3002\u516c\u94a5\uff1a ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAH3ZHisQY0iMpUNDQNaxcnRSqDbauE8ih6/MrEENJZa7FHKINOPi+bunK1wEXPqlKfu8INEBWCf95+t86z+jXVxmQE176xenS92wiLvR4MZyCBfD5DXAB0mK5iV1eQug5P/cD8Pohr/3wywFbKgKzsix9unky9sJGr86RunSwJbAkMGlw== \u5c06 CA \u6dfb\u52a0\u81f3\u5bb9\u5668\u6216\u865a\u62df\u673a\u7684\u64cd\u4f5c\u4e0e\u4e0a\u9762\u7c7b\u4f3c\uff0c\u4f46\u662f\u4e0d\u9700\u8981\u5bf9\u4e3b\u673a\u516c\u94a5\u8fdb\u884c\u7b7e\u540d\uff0c\u56e0\u6b64\u53ea\u9700\u8981 \u5c06\u4ee5\u4e0a\u516c\u94a5\u4fdd\u5b58\u81f3\u67d0\u4e2a\u6587\u4ef6\uff0c\u5982 /etc/ssh/ssh_user_ca \u5728 sshd_config \u4e2d\u8ffd\u52a0\uff0c\u6216\u8005\u521b\u5efa /etc/ssh/sshd_config.d/vlab.conf \u5e76\u5199\u5165 TrustedUserCAKeys /etc/ssh/ssh_user_ca","title":"\u7528\u6237 CA"},{"location":"traps/","text":"\u8e29\u5751\u8bb0\u5f55 \u00b6 Proxmox VE \u00b6 \u5728\u5411\u96c6\u7fa4\u6dfb\u52a0\u8282\u70b9\u65f6\uff0c\u9700\u8981\u4fdd\u8bc1\u96c6\u7fa4\u4e2d\u5df2\u6709\u7684\u8282\u70b9\u5168\u90e8\u5f00\u542f\u5e76\u6b63\u5e38\u8fde\u63a5 \u00b6 \u5426\u5219\uff0c\u672a\u5f00\u542f\u7684\u8282\u70b9\u7531\u4e8e\u6ca1\u6709\u6536\u5230\u66f4\u65b0\u901a\u77e5\uff0c\u53ef\u80fd\u5728\u52a0\u5165\u96c6\u7fa4\u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u5728\u51fa\u73b0\u9519\u8bef\u7684\u8282\u70b9\u4e0a\u7684\u75c7\u72b6\uff1a pvesr.service \u65e0\u6cd5\u8fd0\u884c\uff0c\u9519\u8bef\u4fe1\u606f\u5305\u542b \"error with cfs lock 'file-replication_cfg': no quorum!\" pvecm status \u663e\u793a \"Cannot initialize CMAP service\" corosync.service \u672a\u5728\u8fd0\u884c \u89e3\u51b3\u65b9\u6cd5\uff1a \u5173\u95ed pve-cluster.service \u6267\u884c pmxcfs -l \uff0c\u5c06\u96c6\u7fa4\u6587\u4ef6\u7cfb\u7edf\u4ee5 local mode \u542f\u52a8 \u4ece\u6b63\u5e38\u8fd0\u884c\u7684\u8282\u70b9\u4e0a\u590d\u5236 /etc/pve/corosync.conf \uff0c\u8986\u76d6\u9519\u8bef\u8282\u70b9\u7684\u76f8\u5e94\u6587\u4ef6 killall pmxcfs \u91cd\u542f pve-cluster.service \u548c corosync.service HA \u63d0\u793a service 'ct:100' in error state, must be disabled and fixed first \u00b6 \u9700\u8981\u5148 disable\uff1a ha-manager set ct:100 --state disabled \uff08 ct:100 \u66ff\u6362\u4e3a\u62a5\u9519\u63d0\u793a\u4e2d\u5bf9\u5e94\u7684\u540d\u5b57\uff09 Migrate \u63d0\u793a ERROR: migration aborted (duration 00:00:00): CT is locked (migrate) \u00b6 \u5bb9\u5668\uff1a pct unlock <ID \u53f7> \u865a\u62df\u673a\uff1a qm unlock <ID \u53f7> HA \u6ce8\u610f\u4e8b\u9879 \u8bf7\u52ff bind mount \u6216\u6302\u8f7d ISO\uff0c\u5426\u5219\u8282\u70b9\u4e0b\u7ebf\u65f6\u65e0\u6cd5\u8fdb\u884c migrate\u3002 LVM \u00b6 \u5f00\u673a\u663e\u793a Cannot process volume group pve \u7b49\u9519\u8bef\u4fe1\u606f \u00b6 \u8fd9\u4e00\u6b65\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a IPMI \u63d0\u4f9b\u7684\u90a3\u4e2a\u8fdc\u7a0b\u7ec8\u7aef\u7ecf\u5e38\u5361\u3002 \u539f\u56e0\u662f\u7cfb\u7edf\u4e2d\u6709 /dev/sda \u548c /dev/sdb \u4e24\u4e2a\u8bbe\u5907\uff0c\u5176\u4e2d\u4e00\u4e2a\u662f SSD\uff0c\u53e6\u4e00\u4e2a\u4e0d\u77e5\u9053\u662f\u54ea\u6765\u7684\uff08\u53ef\u80fd\u662f IPMI \u7684\u865a\u62df\u8bbe\u5907\uff0c\u901a\u8fc7 USB \u603b\u7ebf\u63a5\u5165\uff09\uff0c\u4e3a\u4e86\u4e0d\u8ba9 LVM \u6bcf\u6b21\u8fd0\u884c\u65f6\u90fd\u5410\u69fd\u4e00\u904d open /dev/sdX failed: no medium found \uff0c\u5c06\u62a5\u9519\u7684\u90a3\u4e2a\u8bbe\u5907\u5c4f\u853d\uff0c\u65b9\u6cd5\u662f\u5728 /etc/lvm/lvm.conf \u4e2d\u7684 global_filters \u4e2d\u52a0\u5165 \"r|/dev/disk/by-id/usb.*|\" \uff0c\u4f7f LVM \u626b\u63cf PV \u65f6\u5ffd\u7565\u8fd9\u4e2a\u8bbe\u5907\u53ca\u5176\u4ed6\u7ecf\u8fc7 USB \u603b\u7ebf\u8fde\u63a5\u7684\u8bbe\u5907\u3002 \u5751\u70b9 1\uff08\u5df2\u89e3\u51b3\uff09 \u66fe\u7ecf\u7684\u8fc7\u6ee4\u89c4\u5219\u662f r|/dev/sdb| \uff0c\u8fd9\u6837\u5c31\u628a\u4efb\u4f55\u6620\u5c04\u5230 sdb \u7684\u8bbe\u5907\u90fd\u5ffd\u7565\u4e86\uff0c\u4f46\u662f\u5728\u4e0d\u660e\u60c5\u51b5\u4e0b\u8fd9\u4e24\u4e2a\u8bbe\u5907\u4f1a\u4e92\u6362\uff0c\u5bfc\u81f4\u539f\u5148\u7684\u8fc7\u6ee4\u89c4\u5219\u628a\u771f\u6b63\u7684\u7cfb\u7edf\u76d8\u7ed9\u8fc7\u6ee4\u6389\u4e86\uff0c\u7559\u4e0b\u4e00\u4e2a\u7a7a\u8bbe\u5907\uff0c\u65e0\u6cd5\u5f00\u673a\u542f\u52a8\uff08rootfs \u5728 LV \u5377 pve/root \u4e0a\uff09 \u597d\u5728\u76ee\u524d\u6ca1\u6709\u53d1\u73b0\u7a7a\u8bbe\u5907\u4ece sdb \u53d8\u6210 sda \u7684\u60c5\u51b5\uff0c\u56e0\u6b64\u6bcf\u4e2a\u4e3b\u673a\u6700\u591a\u53ea\u9700\u8981\u5904\u7406\u4e00\u6b21\u5c31\u884c\uff08\u5176\u5b9e\u5230\u73b0\u5728\u4e00\u5171\u5c31\u53d1\u751f\u8fc7\u4e00\u6b21\uff09\u3002 \u5751\u70b9 2 LVM \u662f\u5f00\u673a\u542f\u52a8\u5fc5\u987b\u7684\u529f\u80fd\uff0c\u56e0\u6b64 LVM \u76f8\u5173\u7684\u5de5\u5177\uff08 lvm \u547d\u4ee4\uff09\u548c\u914d\u7f6e\u6587\u4ef6\uff08\u5373 /etc/lvm/lvm.conf \uff09\u4f1a\u6253\u5305\u8fdb initramfs \u91cc\uff0c\u8fd9\u65f6\u5019\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u5728\u7cfb\u7edf\u91cc\u548c initramfs \u91cc\u5c31\u6709\u72ec\u7acb\u7684\u4e24\u4efd\u4e86\uff0c\u8981\u4fee\u6539\u5f97\u628a\u4e24\u4efd\u90fd\u4fee\u6539\u6389\u3002 \u89e3\u51b3\u6b65\u9aa4 \u00b6 \u5f00\u673a\u5931\u8d25\uff0c\u8fdb\u5165 initramfs\uff0c\u8fd9\u91cc\u6709\u4e2a busybox \u548c lvm \u5de5\u5177 \u7f16\u8f91 /etc/lvm/lvm.conf \uff0c\u627e\u5230 global_filters \uff0c\u628a\u5176\u4e2d\u7684 r|/dev/sda| \u6362\u6210 r|/dev/sdb| \uff08\u6216\u8005\u53cd\u8fc7\u6765\u6539\uff0c\u53d6\u51b3\u4e8e\u539f\u5148\u5185\u5bb9\u662f\u4ec0\u4e48\u4ee5\u53ca\u524d\u9762\u62a5 no medium found \u7684\u662f\u54ea\u4e2a\u8bbe\u5907\uff09 lvm vgscan \uff0c\u8fd9\u65f6\u5019\u518d lvm vgs \u5e94\u8be5\u5c31\u80fd\u770b\u5230 pve \u8fd9\u4e2a VG \u4e86 lvm lvchange -ay pve/root \u6fc0\u6d3b rootfs \u5377\uff0c\u627e\u4e2a\u5730\u65b9\u6302\u8f7d\u8d77\u6765 chroot \u8fdb\u53bb\uff0c\u628a /etc/lvm/lvm.conf \u518d\u6539\u4e00\u904d \uff08\u548c\u7b2c 2 \u6b65\u76f8\u540c\uff09 update-initramfs -u -k all \u66f4\u65b0 initramfs\uff0c\u91cd\u542f \u5176\u5b9e\u7b2c 5 \u6b65\u4e0d\u4e00\u5b9a\u9700\u8981 chroot\uff0c\u4f46\u662f\u8fd9\u4e00\u6b65\u662f\u9700\u8981\u7684 CT 100 \u548c CT 101 \u65e0\u6cd5\u542f\u52a8 \u00b6 LVM \u5377\u4e0d\u80fd\u591a\u4e2a\u4e3b\u673a\u540c\u65f6\u4f7f\u7528\uff08active \u72b6\u6001\uff09\uff0c\u5982\u679c\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u4f1a\u5bfc\u81f4 LVM \u62d2\u7edd\u4f7f\u7528\u53d7\u5f71\u54cd\u7684\u5377\u3002 \u76ee\u524d\u6211\u4eec\u7684 VG user-data \u662f\u5171\u4eab\u7684\uff0c\u800c VG pve \u662f\u6bcf\u4e2a\u4e3b\u673a\u81ea\u5df1\u7684 SSD\uff08\u5373\u4e0e\u672c\u95ee\u9898\u65e0\u5173\uff09\u3002 Proxmox VE \u4f7f\u7528 LVM Proxmox VE \u5728\u542f\u52a8\u5bb9\u5668\u6216\u865a\u62df\u673a\u65f6\u4f1a\u5c1d\u8bd5\u5360\u7528\u76f8\u5173\u7684\u5377\uff08\u8bbe\u4e3a active\uff09\uff0c\u5e76\u5728\u5173\u95ed\u5bb9\u5668\u6216\u865a\u62df\u673a\u65f6\u53d6\u6d88 active \u72b6\u6001\uff0c\u56e0\u6b64\u6b63\u5e38\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u51fa\u73b0\u8de8\u4e3b\u673a\u5360\u7528\u7684\u60c5\u51b5\u3002 \u8be5\u5751\u70b9\u53ef\u80fd\u5df2\u4fee\u590d\uff0c\u5c1a\u672a\u6d4b\u8bd5 \u51fa\u4e8e\u4e0d\u660e\u539f\u56e0\uff0c\u624b\u52a8\u6302\u8f7d iSCSI \u8bbe\u5907\u4f1a\u5bfc\u81f4\u4e0a\u9762\u6240\u6709\u7684 LV \u90fd\u53d8\u6210 active\u3002 \u89e3\u51b3\u65b9\u6cd5 \uff1a\u6839\u636e Server Fault \u4e0a\u7684 \u8fd9\u4e2a\u56de\u7b54 \uff0c\u5728 /etc/lvm/lvm.conf \u4e2d\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a auto_activation_volume_list = [ \"pve\", \"data\" ] \u4fdd\u5b58\u540e LVM \u5c31\u4e0d\u4f1a\u5728\u68c0\u6d4b\u5230\u65b0 VG \u65f6\u81ea\u52a8\u542f\u7528\u5168\u90e8\u5377\u4e86\u3002\u53ef\u80fd\u9700\u8981\u66f4\u65b0 initramfs \u548c/\u6216\u91cd\u542f\u3002 \u89e3\u51b3\u6b65\u9aa4\uff1a \u5982\u679c\u53d7\u5f71\u54cd\u7684\u5377\u4e0d\u591a\uff0c\u53ef\u4ee5\u624b\u52a8 SSH \u8fdb\u5165\u6240\u6709\u4e3b\u673a\uff0c\u5168\u90e8\u6765\u4e00\u904d lvchange -an <vg/lv> \uff0c\u8fd9\u6837\u5c31\u5728\u5168\u90e8\u4e3b\u673a\u4e0a\u628a\u8fd9\u4e2a\u5377\u53d6\u6d88\u4e86 active \u72b6\u6001\uff0c\u7136\u540e\u5176\u4e2d\u4e00\u4e2a\u4e3b\u673a\u5c31\u53ef\u4ee5\u5f00\u59cb\u4f7f\u7528\u5b83\uff08\u542f\u52a8\u5bb9\u5668\uff09\u4e86\u3002 \u5982\u679c\u53d7\u5f71\u54cd\u7684\u5377\u5f88\u591a\uff08\u5e38\u89c1\u60c5\u51b5\uff09\uff0c\u8f83\u4e3a\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u628a\u6240\u6709\u865a\u62df\u673a\u5bb9\u5668\u90fd\u5173\u6389\uff0c\u7136\u540e vgchange -an <vg> \uff0c\u4e00\u6b21\u6027\u628a\u6574\u4e2a VG \u91cc\u7684\u5168\u90e8 LV \u53d6\u6d88 active \u72b6\u6001\uff08\u5f53\u7136\u6bcf\u4e2a\u4e3b\u673a\u90fd\u8981\u91cd\u590d\u4e00\u904d\uff09\uff0c\u7136\u540e\u4e00\u5207\u6062\u590d\u6b63\u5e38\u3002 \u53e6\u4e00\u79cd\u9ad8\u7ea7\u529e\u6cd5\u662f\u4f7f\u7528\u6587\u5b57\u5904\u7406\u6280\u5de7\uff0c\u89e3\u6790 lvs \u7684\u8f93\u51fa\u5e76\u5173\u95ed\u5168\u90e8 active \u4f46\u4e0d\u662f open \u7684\u5377\uff08\u5373 flags \u4e3a -wi-a----- \u7684\u5377\uff09\u3002\u53c2\u8003\u547d\u4ee4\u5982\u4e0b\uff1a lvs | awk '$2 == \"user-data\" && substr($3, 5, 1) == \"a\" { print $2 \"/\" $1 }' | xargs lvchange -an \u5bb9\u5668\u4ecd\u5728\uff08\u90e8\u5206\uff09\u8fd0\u884c\uff0c\u4f46\u662f rootfs \u672a\u5728 lvs \u4e2d\u663e\u793a \u00b6 \u75c7\u72b6\uff1a \u5bb9\u5668\u7684 rootfs \u795e\u79d8\u6d88\u5931\u3002 journalctl \u7684\u9519\u8bef\u65e5\u5fd7\u63d0\u793a ext4\uff08\u6216\u8005\u5176\u4ed6\u6587\u4ef6\u7cfb\u7edf\uff09\u8bfb\u5199\u5bb9\u5668 rootfs \u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u5bb9\u5668\u65e0\u6cd5\u6b63\u5e38\u64cd\u4f5c\u3002 \u8fd9\u4e2a\u95ee\u9898\u5f53\u65f6\u5728 CT100 \u4e0a\u51fa\u73b0\uff0c\u539f\u56e0\u4e3a\u5728\u540c\u5b66\u64cd\u4f5c\u6d4b\u8bd5\u8282\u70b9\u65f6\uff0c\u4f7f\u7528\u4e86\u548c\u6b63\u5f0f\u73af\u5883\u76f8\u540c\u7684 LVM \u5b58\u50a8\uff0c\u4f46\u662f\u672a\u52a0\u5165\u96c6\u7fa4\uff0c\u5bfc\u81f4\u9501\u5931\u6548\u3002 \u8fd9\u79cd\u60c5\u51b5\u662f\u6781\u5176\u5371\u9669\u7684\uff0c\u6700\u574f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u7834\u574f LVM \u7684\u5206\u533a\u8868\u3002 \u76ee\u524d\uff0c\u6d4b\u8bd5\u8282\u70b9\u5df2\u52a0\u5165\u96c6\u7fa4\uff0c\u5e76\u4e14\u5bf9\u91cd\u8981\u5bb9\u5668\u7684\u5907\u4efd\u6b63\u5728\u64cd\u4f5c\u4e2d\u3002 \u7f51\u7edc \u00b6 Proxmox VE 7 \u7f51\u7edc\u914d\u7f6e \u00b6 PVE 7 \u9ed8\u8ba4\u4f7f\u7528 ifupdown2\uff0c\u662f ifupdown \u7684\u4e00\u4e2a Python \u66ff\u4ee3\u54c1\uff0c\u914d\u7f6e\u6587\u4ef6 /etc/network/interfaces \u51e0\u4e4e \u517c\u5bb9\u3002 ifupdown2 \u7684 bond \u8bed\u6cd5\u6709\u4e00\u70b9\u4e0d\u4e00\u6837\uff08\u5e76\u4e14\u4f1a\u70b8\uff09\uff0c\u5c31\u662f bond \u7684 slave \u662f\u5199\u5728 bond \u8bbe\u5907\u4e0b\u7684\uff0c\u800c\u4e0d\u662f\u50cf ifupdown \u4e00\u6837\u5728 slave \u8bbe\u5907\u4e0b\u5199 bond-master \uff0c\u6240\u4ee5\u4ece ifupdown \u6362\u5230 ifupdown2 \u540e \u91cd\u542f\u524d\u52a1\u5fc5\u4fee\u6539\u914d\u7f6e \u3002\u5efa\u8bae\u4e0d\u8981\u7740\u6025\u5220\u6389 bond-master \uff0c\u56e0\u4e3a\u5c3d\u7ba1\u4e24\u79cd\u5199\u6cd5\u4e92\u4e0d\u517c\u5bb9\uff0c\u4f46\u662f\u5b83\u4eec\u4e5f\u4e92\u4e0d\u51b2\u7a81\uff08ifupdown / ifupdown2 \u4f1a\u4e92\u76f8\u65e0\u89c6\u53e6\u4e00\u79cd\u5199\u6cd5\uff09\u3002 \u5347\u7ea7 PVE 7 \u4e0d\u4e00\u5b9a\u4f1a\u81ea\u52a8\u66ff\u6362\u8f6f\u4ef6 \u5982\u679c\u66f4\u65b0\u5230 PVE 7 \u7684\u65f6\u5019\u6ca1\u6709\u81ea\u52a8\u5c06 ifupdown \u66ff\u6362\u4e3a ifupdown2\uff0c\u8bf7\u624b\u52a8\u66ff\u6362\u5e76\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\u3002 ifupdown \u7684\u8bed\u6cd5\uff1a auto eno1 iface eno1 inet manual bond-master bond0 auto eno2 iface eno2 inet manual bond-master bond0 auto bond0 iface bond0 inet manual bond-mode balance-alb bond-miimon 100 bond-downdelay 200 bond-updelay 200 ifupdown2 \u7684\u8bed\u6cd5\uff1a auto eno1 iface eno1 auto eno2 iface eno2 auto bond0 iface bond0 bond-slaves eno1 eno2 bond-mode balance-alb bond-miimon 100 bond-downdelay 200 bond-updelay 200 \u5173\u4e8e ifupdown2 \u7684 interfaces \u6587\u4ef6\uff0c\u5c24\u5176\u662f\u548c ifupdown \u7684\u533a\u522b\uff0c\u53ef\u4ee5\u770b \u8fd9\u4e2a\u9875\u9762 \u3002 \u6ce8\u610f\u4e0b\u5212\u7ebf ifupdown2 \u91cc\u4e0d\u518d\u4f7f\u7528\u4e0b\u5212\u7ebf\u4f5c\u4e3a key\uff0c\u6240\u6709 ifupdown \u91cc\u4f7f\u7528\u4e0b\u5212\u7ebf\u7684 key \u90fd\u88ab\u6362\u6210\u4e86\u51cf\u53f7\uff0c\u4f8b\u5982 bridge_ports \u5df2\u7ecf\u6362\u6210\u4e86 bridge-ports \u3002 ARP \u95ee\u9898 \u00b6 \u8be5\u95ee\u9898\u5df2\u4e8e 2020 \u5e74 7 \u6708 31 \u65e5\u89e3\u51b3\uff0c\u89c1\u4e0b \u9ed8\u8ba4\u60c5\u51b5\u4e0b Linux \u4f1a\u5bf9\u672c\u673a\u7684\u6240\u6709 IP \u5730\u5740\u5728\u6240\u6709\u754c\u9762\u4e0a\u54cd\u5e94 ARP \u8bf7\u6c42\uff08\u5f53\u7136 127.0.0.0/8 \u548c loopback \u662f\u9664\u5916\u7684\uff09\uff0c\u4f8b\u5982\u4e00\u4e2a\u4e3b\u673a\u62e5\u6709\u4e24\u4e2a\u754c\u9762 ifA \u548c ifB\uff0c\u5b83\u4eec\u5206\u522b\u5177\u6709 IP \u5730\u5740 ipA \u548c ipB\uff0c\u90a3\u4e48 Linux \u4f1a\u5728 ifA \u4e0a\u54cd\u5e94 who-has ipB \u7684\u8bf7\u6c42\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002 \u8fd9\u5728 2020 \u5e74\u4e0a\u534a\u5e74\u7814\u7a76 pv8 \u4e3a\u4ec0\u4e48\u8fde\u4e0d\u4e0a VXLAN \u7684\u65f6\u5019\u9020\u6210\u4e86\u5f88\u5927\u7684\u56f0\u60d1\uff0c\u56e0\u4e3a\u5b9e\u9645\u4e0a pv8 \u7684 ens1f1 \u754c\u9762\u662f\u574f\u7684\uff08\u53ef\u80fd\u662f\u5149\u7ea4\u6ca1\u63d2\u597d\u4e4b\u7c7b\u7684\uff09\uff0c\u7136\u540e\u7cfb\u7edf\u5728 ens1f0 \u754c\u9762\u4e0a\u54cd\u5e94\u4e86\u5b9e\u9645\u5c5e\u4e8e ens1f1 \u7684 IP \u5730\u5740\uff0c\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u770b\u8d77\u6765\u5c31\u50cf\u662f ens1f1 \u80fd\u8fde\u901a\u4f46 vxlan0 \u8fde\u4e0d\u901a\uff0c\u800c\u5b9e\u9645\u4e0a\u662f 10.0.0.28 \u88ab\u89e3\u6790\u5230\u4e86 pv8 \u7684 ens1f0 \u4e0a\uff0c\u6ca1\u6545\u969c\u5f53\u7136\u5c31\u80fd\u8fde\u901a\u4e86\u3002 iBug \u5907\u6ce8 \u8fd9\u4e2a\u5730\u65b9\u6211\u4e5f\u6ca1\u60f3\u5230\uff0c\u5176\u5b9e\u53ea\u8981\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u770b\u770b ARP \u7f13\u5b58\u8868\uff08 arp -a \uff09\u5c31\u80fd\u53d1\u73b0\u4e24\u4e2a IP \u89e3\u6790\u51fa\u6765\u7684 MAC \u4e00\u6837\u4e86 \u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u8bbe\u7f6e Linux \u53c2\u6570\u8ba9\u5176\u53ea\u5728\u201c\u6b63\u786e\u7684\u201d\u754c\u9762\u4e0a\u54cd\u5e94\uff0c\u8be6\u7ec6\u89e3\u91ca\u53c2\u89c1 Server Fault \u4e0a\u7684 \u8fd9\u4e2a\u56de\u7b54 \u3002\u6211\u4eec\u7684\u505a\u6cd5\u662f\u5411 /etc/sysctl.d/arp.conf \u91cc\u5199\u5165\u4e86\u5982\u4e0b\u5185\u5bb9\uff1a net.ipv4.conf.all.arp_ignore = 1 net.ipv4.conf.all.arp_announce = 2 VXLAN MTU \u00b6 \u8be5\u5751\u70b9\u5df2\u4e8e 2020 \u5e74 8 \u6708 1 \u65e5\u4fee\u590d \u5728 \u6b64\u6b21\u7ef4\u62a4\u5de5\u4f5c \u4e2d\uff0c\u4e0b\u5c42\u627f\u8f7d\u7f51\u5361 ens1f1 \u7684 MTU \u5df2\u88ab\u8c03\u6574\u4e3a 1550 \u5b57\u8282\uff0c\u4ece\u800c\u6b64\u540e\u7684 VXLAN \u7f51\u7edc\u90fd\u5177\u6709\u201c\u6b63\u5e38\u201d\u7684 1500 \u5b57\u8282\u7684\u8bbe\u7f6e\u3002 \u6ce8\u610f\u4ee5\u540e\u82e5\u6709\u65b0\u589e\u7684\u673a\u5668\u8fd8\u662f\u9700\u8981\u989d\u5916\u8bbe\u7f6e\u4e00\u904d\u7684\u3002 VXLAN \u662f\u4e00\u79cd overlay \u7f51\u7edc\u5b9e\u73b0\uff0c\u5c06\u5e27\u5305\u88c5\u5728 UDP \u5305\u4e2d\u4f20\u8f93\u3002\u7531\u4e8e\u4e00\u4e2a UDP \u5305\u5bf9\u5e94\u4e00\u4e2a\u5e27\uff0c\u56e0\u6b64 VXLAN \u7f51\u7edc\u7684 MTU \u4e3a\u4e0b\u5c42\u627f\u8f7d\u7f51\u7684 MTU \u51cf\u6389 50 \u5b57\u8282\uff08\u5404\u79cd\u5934\u4e4b\u7c7b\u7684\uff09\uff0c\u6240\u4ee5\u5728\u4e0b\u5c42\u7f51\u7edc\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\uff08MTU 1500\uff09\u7684\u60c5\u51b5\u4e0b VXLAN \u7f51\u7edc\u7684 MTU \u4e3a 1450\uff0c \u8fd9\u662f\u4e00\u4e2a\u975e\u6807\u51c6\u7684\u503c \uff0c\u800c\u4ece\u8be5 VXLAN \u7f51\u7edc\u4e2d\u6865\u63a5\u51fa\u6765\u7684\u754c\u9762\u5e76\u4e0d\u77e5\u9053\u5176\u7f51\u7edc\u7684\u771f\u5b9e MTU \u5c0f\u4e8e 1500\uff0c\u7ed3\u679c\u5c31\u662f\u4f20\u8f93\u7684\u5185\u5bb9\u7a0d\u5fae\u591a\u4e00\u70b9\uff08\u5355\u4e2a\u5e27\u8d85\u8fc7 1450 \u5b57\u8282\uff09\u7684\u65f6\u5019\u5c31\u4f1a\u88ab\u6574\u4e2a\u4e22\u6389\uff0c\u9020\u6210\u65e0\u6cd5\u8054\u7f51\u7684\u60c5\u51b5\u3002 \u89e3\u51b3\u65b9\u6cd5\u5012\u4e5f\u4e0d\u96be\uff0c\u5728\u7cfb\u7edf\u91cc\u8bbe\u7f6e\u7f51\u7edc\u7684 MTU \u4e3a 1450 \u5c31\u884c\u3002Proxmox VE \u521b\u5efa\u5bb9\u5668\u7684\u65f6\u5019\u53ef\u4ee5\u76f4\u63a5\u5728\u7f51\u7edc\u53c2\u6570\u4e2d\u6307\u5b9a mtu=1450 \uff0c\u4f46 KVM \u865a\u62df\u673a\u5c31\u5fc5\u987b\u6bcf\u4e2a\u865a\u62df\u673a\u8bbe\u7f6e\u4e86\uff0c\u8fd9\u5728 Windows \u4e0b \u5c24\u5176\u9ebb\u70e6 \u3002 \u6240\u4ee5\u6211\u4eec\u8ba1\u5212\u5728 2020 \u5e74\u6691\u5047\u628a\u8fd9\u4e2a\u95ee\u9898\u5f7b\u5e95\u89e3\u51b3\uff0c\u529e\u6cd5\u662f\u628a\u4e0b\u5c42\u627f\u8f7d\u7f51\u7684 MTU \u8c03\u5927 50 \u5b57\u8282\uff08\u53d8\u6210 1550 \u5b57\u8282\uff0c\u4fee\u6539 pv1 \u5230 pv8 \u7684 ens1f1 \u754c\u9762\uff09\uff0c\u8fd9\u6837 VXLAN \u5c31\u80fd\u62e5\u6709\u201c\u6b63\u5e38\u201d\u7684 1500 \u5b57\u8282\u7684 MTU \u4e86\uff0c\u80fd\u4e3a\u4ee5\u540e\u51cf\u5c11\u4e0d\u5c11\u9ebb\u70e6\u3002 \u865a\u62df\u673a \u00b6 systemd-logind \u542f\u52a8\u5931\u8d25 \u00b6 \u5c24\u5176\u662f\u5728\u5bb9\u5668\u4ece Debian buster \u5347\u7ea7\u5230 bullseye \u540e\u5bb9\u6613\u51fa\u73b0\u3002 \u75c7\u72b6\uff1a SSH \u767b\u5f55\u5df2\u8fde\u63a5\uff0c\u4f46\u957f\u65f6\u95f4\u4e0d\u5f39\u51fa shell\uff0c /var/log/auth.log \u663e\u793a pam_systemd(sshd:session): Failed to create session: Failed to activate service 'org.freedesktop.login1': timed out \uff0c systemctl status systemd-logind \u663e\u793a failed / code=226/NAMESPACE \u3002 \u539f\u56e0\uff1a Systemd \u4ece\u7248\u672c 242 \u5f00\u59cb\u91c7\u7528\u66f4\u591a\u6280\u672f\u6765\u9650\u5236\u8fd0\u884c\u670d\u52a1\u7684\u6743\u9650\uff0c\u800c\u9ed8\u8ba4\u6ca1\u5f00 nesting \u7684\u5bb9\u5668\u7f3a\u5c11\u5fc5\u8981\u6743\u9650\uff0c\u5bfc\u81f4 systemd-logind \u65e0\u6cd5\u542f\u52a8\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a \u4e3a\u5bb9\u5668\u5f00\u542f nesting\uff08\u548c keyctl\uff0c\u5982\u679c\u4f60\u60f3\u7684\u8bdd\uff09\u3002\u6211\u4eec\u5df2\u7ecf\u9ed8\u8ba4\u4e3a\u7528\u6237\u5bb9\u5668\u5f00\u542f\u4e86\u8fd9\u4e24\u9879\u6743\u9650\uff0c\u6240\u4ee5\u4e3a\u6211\u4eec\u81ea\u5df1\u7684\u670d\u52a1\u5bb9\u5668\u5f00\u542f\u5b83\u4eec\u4e0d\u4f1a\u6709\u989d\u5916\u7684\u95ee\u9898\u3002 pvesh set /nodes/<node_name>/lxc/<vmid>/config -features keyctl = 1 ,nesting = 1 \u53c2\u8003\u8d44\u6599\uff1a https://discuss.linuxcontainers.org/t/apparmor-blocks-systemd-services-in-container/9812 user@1000.service \u542f\u52a8\u5931\u8d25 \u00b6 \u68c0\u67e5\u73af\u5883\u53d8\u91cf XDG_RUNTIME_DIR \u662f\u5426\u8bbe\u7f6e\u6b63\u786e\uff0c\u5e94\u4e3a /run/user/<uid> \u3002 \u53e6\u5916\u5728\u672a\u77e5\u60c5\u51b5\u4e0b\u8be5\u76ee\u5f55\u6709\u53ef\u80fd\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2a\uff08\u4fdd\u9669\u8d77\u89c1\uff0c\u540c\u65f6 chown \u4e00\u4e0b\uff09\uff1a UID = \" $( id -u ) \" mkdir -p \"/run/user/ $UID \" chown \" $UID . $UID \" \"/run/user/ $UID \" Ref: https://github.com/systemd/systemd/issues/9461#issuecomment-409929860 Docker in LXC \u542f\u52a8\u5931\u8d25 \u00b6 \u75c7\u72b6\uff1a \u8fd0\u884c Docker \u5bb9\u5668\u51fa\u73b0\u7c7b\u4f3c\u4e8e docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused \"process_linux.go:449: container init caused \\\"join session keyring: create session key: disk quota exceeded\\\"\": unknown. \u7684\u9519\u8bef\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a \u53c2\u8003 https://github.com/docker/compose/issues/7295#issuecomment-657475590 \u3002 Docker \u9700\u8981\u83b7\u53d6\u5230 kernel session key \u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002\u9996\u5148\u67e5\u770b /proc/key-users \u6587\u4ef6\uff0c\u5206\u6790\u9650\u989d\u5361\u5728\u4e86\u54ea\u91cc\u3002\u6587\u4ef6\u5185\u5bb9\u7c7b\u4f3c\u4e8e\uff1a 0: 336 335/335 238/1000000 4597/25000000 100: 1 1/1 1/50000 9/20000 998: 1 1/1 1/50000 9/20000 100000: 1198 1198/1198 1198/50000 19871/20000 100101: 2 2/2 2/50000 18/20000 \u5176\u4e2d\uff1a \u7b2c\u4e00\u5217\uff1aUID\u3002 \u7b2c\u4e8c\u5217\uff1a\u76ee\u524d\u5bf9\u5e94 UID \u7684 key \u6570\u91cf\u3002 \u7b2c\u4e09\u5217\uff1a\u5b9e\u4f8b\u5316\u7684 key \u6570\u91cf\u548c\u603b key \u6570\u91cf\u3002\uff08\u5e94\u8be5\u53ef\u4ee5\u5ffd\u7565\uff09 \u7b2c\u56db\u5217\uff1akey \u6570\u91cf\u4e0e\u603b key \u6570\u91cf\u9650\u989d\u3002\uff08\u5173\u6ce8\uff09 \u7b2c\u4e94\u5217\uff1akey \u5927\u5c0f\u4e0e\u603b key \u5927\u5c0f\u9650\u989d\u3002\uff08\u5173\u6ce8\uff09 \u6ce8\u610f\u6700\u540e\u4e24\u5217\u3002\u5982\u679c\u51fa\u73b0\u5f88\u8d34\u8fd1\u9650\u989d\u7684\u60c5\u51b5\uff0c\u9700\u8981\u8c03\u6574 /proc/sys/kernel/keys/maxbytes \u548c /proc/sys/kernel/keys/maxkeys \u7684\u503c\u3002root \u4e0b echo \u4e00\u4e2a\u66f4\u5927\u7684\u6570\u8fdb\u53bb\u5373\u53ef\u3002 root_maxbytes \u548c root_maxkeys \u4e00\u822c\u90fd\u975e\u5e38\u5927\uff08\u89c1 key-users \u7684\u7b2c\u4e00\u884c\uff09\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ba1\u3002 \u5982\u679c\u9700\u8981\u6301\u4e45\u5316\u914d\u7f6e\uff0c\u9700\u8981\u7f16\u8f91 /etc/sysctl.conf \uff0c\u6dfb\u52a0\uff1a kernel.keys.maxbytes = 500000 kernel.keys.maxkeys = 5000 \u7136\u540e sysctl --system \u3002 Docker in LXC \u542f\u52a8\u5931\u8d25 (Proxmox VE 7) \u00b6 \u4ece Proxmox VE 6 \u5347\u7ea7\u5230 Proxmox VE 7 \u540e\u914d\u7f6e\u4e86 keyctl=1,nesting=1 \u7684\u5bb9\u5668\u65e0\u6cd5\u542f\u52a8 docker.service \uff0cjournalctl \u8f93\u51fa\u6709 Devices cgroup isn't mounted \u3002 \u539f\u56e0\uff1a Proxmox VE 7 \u9ed8\u8ba4\u5f00\u542f\u4e86 unified cgroup hierarchy\uff08\u5373 cgroup v2\uff09\uff0c\u800c\u65e7\u7248\u672c\u7684 Docker \u9700\u8981\u539f\u6765\u7684 cgroup v1 \u7ed3\u6784\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a \u5728\u5185\u6838\u53c2\u6570\u4e2d\u52a0\u4e0a systemd.unified_cgroup_hierarchy=0 \uff0c\u7136\u540e\u91cd\u542f\u4e3b\u673a\u3002\u5177\u4f53\u64cd\u4f5c\u662f\u5728 /etc/default/grub \u7684 GRUB_CMDLINE_LINUX_DEFAULT \u540e\u9762\u8865\u4e0a systemd.unified_cgroup_hierarchy=0 \uff0c\u7136\u540e\u6267\u884c update-grub \u5e76\u91cd\u542f\u3002 Note Docker Engine 20.10 \u5f00\u59cb\u652f\u6301 cgroup v2\uff0c\u4f46\u662f\u5230\u5168\u9762\u5e94\u7528\u8fd8\u6709\u70b9\u65e9\uff0c\u6240\u4ee5\u8fd9\u4e2a\u517c\u5bb9\u8bbe\u7f6e\u5148\u5f00\u7740\u3002 Systemd \u670d\u52a1\u56e0\u300c\u7a7a\u95f4\u4e0d\u8db3\u300d\u542f\u52a8\u5931\u8d25\u3002 \u00b6 \u75c7\u72b6\uff1a\u91cd\u8981\u670d\u52a1\u65e0\u6cd5\u542f\u52a8\uff0c\u63d0\u793a Failed to add /run/systemd/ask-password to directory watch: No space left on device \uff0c\u4f46\u662f df \u663e\u793a\u5269\u4f59\u7a7a\u95f4\u8fd8\u6709\u5f88\u591a\u3002 \u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6cd5\uff1a\u8bbe\u7f6e sysctl: fs.inotify.max_user_watches = 1048576 \u56e0\u4e3a\u51fa\u95ee\u9898\u7684\u5bb9\u5668\u88ab\u540c\u5b66\u5220\u6389\u4e86\uff0c\u6240\u4ee5\u672a\u9a8c\u8bc1\u662f\u5426\u80fd\u591f\u89e3\u51b3\u95ee\u9898\u3002 \u56fe\u5f62\u754c\u9762\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\u6570\u6700\u591a\u53ea\u80fd\u8dd1 4915 \u4e2a \u00b6 \u6240\u6709\u56fe\u5f62\u754c\u9762\u8fdb\u7a0b cgroup \u90fd\u6302\u5728 lightdm.service \u7684\u9650\u5236\u4e0b\u9762\uff0c\u800c systemd \u9ed8\u8ba4\u914d\u7f6e\u9650\u989d\u4e3a 4915\u3002 \u7b80\u5355\u5feb\u901f\u7684\u4fee\u6539\u547d\u4ee4\uff1a systemctl set-property lightdm.service TasksMax=18000 \u66f4\u8be6\u7ec6\u7684\u6307\u5bfc\u53c2\u89c1 https://www.suse.com/support/kb/doc/?id=000015901","title":"\u8e29\u5751\u8bb0\u5f55"},{"location":"traps/#_1","text":"","title":"\u8e29\u5751\u8bb0\u5f55"},{"location":"traps/#proxmox-ve","text":"","title":"Proxmox VE"},{"location":"traps/#_2","text":"\u5426\u5219\uff0c\u672a\u5f00\u542f\u7684\u8282\u70b9\u7531\u4e8e\u6ca1\u6709\u6536\u5230\u66f4\u65b0\u901a\u77e5\uff0c\u53ef\u80fd\u5728\u52a0\u5165\u96c6\u7fa4\u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u5728\u51fa\u73b0\u9519\u8bef\u7684\u8282\u70b9\u4e0a\u7684\u75c7\u72b6\uff1a pvesr.service \u65e0\u6cd5\u8fd0\u884c\uff0c\u9519\u8bef\u4fe1\u606f\u5305\u542b \"error with cfs lock 'file-replication_cfg': no quorum!\" pvecm status \u663e\u793a \"Cannot initialize CMAP service\" corosync.service \u672a\u5728\u8fd0\u884c \u89e3\u51b3\u65b9\u6cd5\uff1a \u5173\u95ed pve-cluster.service \u6267\u884c pmxcfs -l \uff0c\u5c06\u96c6\u7fa4\u6587\u4ef6\u7cfb\u7edf\u4ee5 local mode \u542f\u52a8 \u4ece\u6b63\u5e38\u8fd0\u884c\u7684\u8282\u70b9\u4e0a\u590d\u5236 /etc/pve/corosync.conf \uff0c\u8986\u76d6\u9519\u8bef\u8282\u70b9\u7684\u76f8\u5e94\u6587\u4ef6 killall pmxcfs \u91cd\u542f pve-cluster.service \u548c corosync.service","title":"\u5728\u5411\u96c6\u7fa4\u6dfb\u52a0\u8282\u70b9\u65f6\uff0c\u9700\u8981\u4fdd\u8bc1\u96c6\u7fa4\u4e2d\u5df2\u6709\u7684\u8282\u70b9\u5168\u90e8\u5f00\u542f\u5e76\u6b63\u5e38\u8fde\u63a5"},{"location":"traps/#ha-service-ct100-in-error-state-must-be-disabled-and-fixed-first","text":"\u9700\u8981\u5148 disable\uff1a ha-manager set ct:100 --state disabled \uff08 ct:100 \u66ff\u6362\u4e3a\u62a5\u9519\u63d0\u793a\u4e2d\u5bf9\u5e94\u7684\u540d\u5b57\uff09","title":"HA \u63d0\u793a service 'ct:100' in error state, must be disabled and fixed first"},{"location":"traps/#migrate-error-migration-aborted-duration-000000-ct-is-locked-migrate","text":"\u5bb9\u5668\uff1a pct unlock <ID \u53f7> \u865a\u62df\u673a\uff1a qm unlock <ID \u53f7> HA \u6ce8\u610f\u4e8b\u9879 \u8bf7\u52ff bind mount \u6216\u6302\u8f7d ISO\uff0c\u5426\u5219\u8282\u70b9\u4e0b\u7ebf\u65f6\u65e0\u6cd5\u8fdb\u884c migrate\u3002","title":"Migrate \u63d0\u793a ERROR: migration aborted (duration 00:00:00): CT is locked (migrate)"},{"location":"traps/#lvm","text":"","title":"LVM"},{"location":"traps/#cannot-process-volume-group-pve","text":"\u8fd9\u4e00\u6b65\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a IPMI \u63d0\u4f9b\u7684\u90a3\u4e2a\u8fdc\u7a0b\u7ec8\u7aef\u7ecf\u5e38\u5361\u3002 \u539f\u56e0\u662f\u7cfb\u7edf\u4e2d\u6709 /dev/sda \u548c /dev/sdb \u4e24\u4e2a\u8bbe\u5907\uff0c\u5176\u4e2d\u4e00\u4e2a\u662f SSD\uff0c\u53e6\u4e00\u4e2a\u4e0d\u77e5\u9053\u662f\u54ea\u6765\u7684\uff08\u53ef\u80fd\u662f IPMI \u7684\u865a\u62df\u8bbe\u5907\uff0c\u901a\u8fc7 USB \u603b\u7ebf\u63a5\u5165\uff09\uff0c\u4e3a\u4e86\u4e0d\u8ba9 LVM \u6bcf\u6b21\u8fd0\u884c\u65f6\u90fd\u5410\u69fd\u4e00\u904d open /dev/sdX failed: no medium found \uff0c\u5c06\u62a5\u9519\u7684\u90a3\u4e2a\u8bbe\u5907\u5c4f\u853d\uff0c\u65b9\u6cd5\u662f\u5728 /etc/lvm/lvm.conf \u4e2d\u7684 global_filters \u4e2d\u52a0\u5165 \"r|/dev/disk/by-id/usb.*|\" \uff0c\u4f7f LVM \u626b\u63cf PV \u65f6\u5ffd\u7565\u8fd9\u4e2a\u8bbe\u5907\u53ca\u5176\u4ed6\u7ecf\u8fc7 USB \u603b\u7ebf\u8fde\u63a5\u7684\u8bbe\u5907\u3002 \u5751\u70b9 1\uff08\u5df2\u89e3\u51b3\uff09 \u66fe\u7ecf\u7684\u8fc7\u6ee4\u89c4\u5219\u662f r|/dev/sdb| \uff0c\u8fd9\u6837\u5c31\u628a\u4efb\u4f55\u6620\u5c04\u5230 sdb \u7684\u8bbe\u5907\u90fd\u5ffd\u7565\u4e86\uff0c\u4f46\u662f\u5728\u4e0d\u660e\u60c5\u51b5\u4e0b\u8fd9\u4e24\u4e2a\u8bbe\u5907\u4f1a\u4e92\u6362\uff0c\u5bfc\u81f4\u539f\u5148\u7684\u8fc7\u6ee4\u89c4\u5219\u628a\u771f\u6b63\u7684\u7cfb\u7edf\u76d8\u7ed9\u8fc7\u6ee4\u6389\u4e86\uff0c\u7559\u4e0b\u4e00\u4e2a\u7a7a\u8bbe\u5907\uff0c\u65e0\u6cd5\u5f00\u673a\u542f\u52a8\uff08rootfs \u5728 LV \u5377 pve/root \u4e0a\uff09 \u597d\u5728\u76ee\u524d\u6ca1\u6709\u53d1\u73b0\u7a7a\u8bbe\u5907\u4ece sdb \u53d8\u6210 sda \u7684\u60c5\u51b5\uff0c\u56e0\u6b64\u6bcf\u4e2a\u4e3b\u673a\u6700\u591a\u53ea\u9700\u8981\u5904\u7406\u4e00\u6b21\u5c31\u884c\uff08\u5176\u5b9e\u5230\u73b0\u5728\u4e00\u5171\u5c31\u53d1\u751f\u8fc7\u4e00\u6b21\uff09\u3002 \u5751\u70b9 2 LVM \u662f\u5f00\u673a\u542f\u52a8\u5fc5\u987b\u7684\u529f\u80fd\uff0c\u56e0\u6b64 LVM \u76f8\u5173\u7684\u5de5\u5177\uff08 lvm \u547d\u4ee4\uff09\u548c\u914d\u7f6e\u6587\u4ef6\uff08\u5373 /etc/lvm/lvm.conf \uff09\u4f1a\u6253\u5305\u8fdb initramfs \u91cc\uff0c\u8fd9\u65f6\u5019\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u5728\u7cfb\u7edf\u91cc\u548c initramfs \u91cc\u5c31\u6709\u72ec\u7acb\u7684\u4e24\u4efd\u4e86\uff0c\u8981\u4fee\u6539\u5f97\u628a\u4e24\u4efd\u90fd\u4fee\u6539\u6389\u3002","title":"\u5f00\u673a\u663e\u793a Cannot process volume group pve \u7b49\u9519\u8bef\u4fe1\u606f"},{"location":"traps/#_3","text":"\u5f00\u673a\u5931\u8d25\uff0c\u8fdb\u5165 initramfs\uff0c\u8fd9\u91cc\u6709\u4e2a busybox \u548c lvm \u5de5\u5177 \u7f16\u8f91 /etc/lvm/lvm.conf \uff0c\u627e\u5230 global_filters \uff0c\u628a\u5176\u4e2d\u7684 r|/dev/sda| \u6362\u6210 r|/dev/sdb| \uff08\u6216\u8005\u53cd\u8fc7\u6765\u6539\uff0c\u53d6\u51b3\u4e8e\u539f\u5148\u5185\u5bb9\u662f\u4ec0\u4e48\u4ee5\u53ca\u524d\u9762\u62a5 no medium found \u7684\u662f\u54ea\u4e2a\u8bbe\u5907\uff09 lvm vgscan \uff0c\u8fd9\u65f6\u5019\u518d lvm vgs \u5e94\u8be5\u5c31\u80fd\u770b\u5230 pve \u8fd9\u4e2a VG \u4e86 lvm lvchange -ay pve/root \u6fc0\u6d3b rootfs \u5377\uff0c\u627e\u4e2a\u5730\u65b9\u6302\u8f7d\u8d77\u6765 chroot \u8fdb\u53bb\uff0c\u628a /etc/lvm/lvm.conf \u518d\u6539\u4e00\u904d \uff08\u548c\u7b2c 2 \u6b65\u76f8\u540c\uff09 update-initramfs -u -k all \u66f4\u65b0 initramfs\uff0c\u91cd\u542f \u5176\u5b9e\u7b2c 5 \u6b65\u4e0d\u4e00\u5b9a\u9700\u8981 chroot\uff0c\u4f46\u662f\u8fd9\u4e00\u6b65\u662f\u9700\u8981\u7684","title":"\u89e3\u51b3\u6b65\u9aa4"},{"location":"traps/#ct-100-ct-101","text":"LVM \u5377\u4e0d\u80fd\u591a\u4e2a\u4e3b\u673a\u540c\u65f6\u4f7f\u7528\uff08active \u72b6\u6001\uff09\uff0c\u5982\u679c\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u4f1a\u5bfc\u81f4 LVM \u62d2\u7edd\u4f7f\u7528\u53d7\u5f71\u54cd\u7684\u5377\u3002 \u76ee\u524d\u6211\u4eec\u7684 VG user-data \u662f\u5171\u4eab\u7684\uff0c\u800c VG pve \u662f\u6bcf\u4e2a\u4e3b\u673a\u81ea\u5df1\u7684 SSD\uff08\u5373\u4e0e\u672c\u95ee\u9898\u65e0\u5173\uff09\u3002 Proxmox VE \u4f7f\u7528 LVM Proxmox VE \u5728\u542f\u52a8\u5bb9\u5668\u6216\u865a\u62df\u673a\u65f6\u4f1a\u5c1d\u8bd5\u5360\u7528\u76f8\u5173\u7684\u5377\uff08\u8bbe\u4e3a active\uff09\uff0c\u5e76\u5728\u5173\u95ed\u5bb9\u5668\u6216\u865a\u62df\u673a\u65f6\u53d6\u6d88 active \u72b6\u6001\uff0c\u56e0\u6b64\u6b63\u5e38\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u51fa\u73b0\u8de8\u4e3b\u673a\u5360\u7528\u7684\u60c5\u51b5\u3002 \u8be5\u5751\u70b9\u53ef\u80fd\u5df2\u4fee\u590d\uff0c\u5c1a\u672a\u6d4b\u8bd5 \u51fa\u4e8e\u4e0d\u660e\u539f\u56e0\uff0c\u624b\u52a8\u6302\u8f7d iSCSI \u8bbe\u5907\u4f1a\u5bfc\u81f4\u4e0a\u9762\u6240\u6709\u7684 LV \u90fd\u53d8\u6210 active\u3002 \u89e3\u51b3\u65b9\u6cd5 \uff1a\u6839\u636e Server Fault \u4e0a\u7684 \u8fd9\u4e2a\u56de\u7b54 \uff0c\u5728 /etc/lvm/lvm.conf \u4e2d\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a auto_activation_volume_list = [ \"pve\", \"data\" ] \u4fdd\u5b58\u540e LVM \u5c31\u4e0d\u4f1a\u5728\u68c0\u6d4b\u5230\u65b0 VG \u65f6\u81ea\u52a8\u542f\u7528\u5168\u90e8\u5377\u4e86\u3002\u53ef\u80fd\u9700\u8981\u66f4\u65b0 initramfs \u548c/\u6216\u91cd\u542f\u3002 \u89e3\u51b3\u6b65\u9aa4\uff1a \u5982\u679c\u53d7\u5f71\u54cd\u7684\u5377\u4e0d\u591a\uff0c\u53ef\u4ee5\u624b\u52a8 SSH \u8fdb\u5165\u6240\u6709\u4e3b\u673a\uff0c\u5168\u90e8\u6765\u4e00\u904d lvchange -an <vg/lv> \uff0c\u8fd9\u6837\u5c31\u5728\u5168\u90e8\u4e3b\u673a\u4e0a\u628a\u8fd9\u4e2a\u5377\u53d6\u6d88\u4e86 active \u72b6\u6001\uff0c\u7136\u540e\u5176\u4e2d\u4e00\u4e2a\u4e3b\u673a\u5c31\u53ef\u4ee5\u5f00\u59cb\u4f7f\u7528\u5b83\uff08\u542f\u52a8\u5bb9\u5668\uff09\u4e86\u3002 \u5982\u679c\u53d7\u5f71\u54cd\u7684\u5377\u5f88\u591a\uff08\u5e38\u89c1\u60c5\u51b5\uff09\uff0c\u8f83\u4e3a\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u628a\u6240\u6709\u865a\u62df\u673a\u5bb9\u5668\u90fd\u5173\u6389\uff0c\u7136\u540e vgchange -an <vg> \uff0c\u4e00\u6b21\u6027\u628a\u6574\u4e2a VG \u91cc\u7684\u5168\u90e8 LV \u53d6\u6d88 active \u72b6\u6001\uff08\u5f53\u7136\u6bcf\u4e2a\u4e3b\u673a\u90fd\u8981\u91cd\u590d\u4e00\u904d\uff09\uff0c\u7136\u540e\u4e00\u5207\u6062\u590d\u6b63\u5e38\u3002 \u53e6\u4e00\u79cd\u9ad8\u7ea7\u529e\u6cd5\u662f\u4f7f\u7528\u6587\u5b57\u5904\u7406\u6280\u5de7\uff0c\u89e3\u6790 lvs \u7684\u8f93\u51fa\u5e76\u5173\u95ed\u5168\u90e8 active \u4f46\u4e0d\u662f open \u7684\u5377\uff08\u5373 flags \u4e3a -wi-a----- \u7684\u5377\uff09\u3002\u53c2\u8003\u547d\u4ee4\u5982\u4e0b\uff1a lvs | awk '$2 == \"user-data\" && substr($3, 5, 1) == \"a\" { print $2 \"/\" $1 }' | xargs lvchange -an","title":"CT 100 \u548c CT 101 \u65e0\u6cd5\u542f\u52a8"},{"location":"traps/#rootfs-lvs","text":"\u75c7\u72b6\uff1a \u5bb9\u5668\u7684 rootfs \u795e\u79d8\u6d88\u5931\u3002 journalctl \u7684\u9519\u8bef\u65e5\u5fd7\u63d0\u793a ext4\uff08\u6216\u8005\u5176\u4ed6\u6587\u4ef6\u7cfb\u7edf\uff09\u8bfb\u5199\u5bb9\u5668 rootfs \u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u5bb9\u5668\u65e0\u6cd5\u6b63\u5e38\u64cd\u4f5c\u3002 \u8fd9\u4e2a\u95ee\u9898\u5f53\u65f6\u5728 CT100 \u4e0a\u51fa\u73b0\uff0c\u539f\u56e0\u4e3a\u5728\u540c\u5b66\u64cd\u4f5c\u6d4b\u8bd5\u8282\u70b9\u65f6\uff0c\u4f7f\u7528\u4e86\u548c\u6b63\u5f0f\u73af\u5883\u76f8\u540c\u7684 LVM \u5b58\u50a8\uff0c\u4f46\u662f\u672a\u52a0\u5165\u96c6\u7fa4\uff0c\u5bfc\u81f4\u9501\u5931\u6548\u3002 \u8fd9\u79cd\u60c5\u51b5\u662f\u6781\u5176\u5371\u9669\u7684\uff0c\u6700\u574f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u7834\u574f LVM \u7684\u5206\u533a\u8868\u3002 \u76ee\u524d\uff0c\u6d4b\u8bd5\u8282\u70b9\u5df2\u52a0\u5165\u96c6\u7fa4\uff0c\u5e76\u4e14\u5bf9\u91cd\u8981\u5bb9\u5668\u7684\u5907\u4efd\u6b63\u5728\u64cd\u4f5c\u4e2d\u3002","title":"\u5bb9\u5668\u4ecd\u5728\uff08\u90e8\u5206\uff09\u8fd0\u884c\uff0c\u4f46\u662f rootfs \u672a\u5728 lvs \u4e2d\u663e\u793a"},{"location":"traps/#networking","text":"","title":"\u7f51\u7edc"},{"location":"traps/#pve-7-ifupdown2","text":"PVE 7 \u9ed8\u8ba4\u4f7f\u7528 ifupdown2\uff0c\u662f ifupdown \u7684\u4e00\u4e2a Python \u66ff\u4ee3\u54c1\uff0c\u914d\u7f6e\u6587\u4ef6 /etc/network/interfaces \u51e0\u4e4e \u517c\u5bb9\u3002 ifupdown2 \u7684 bond \u8bed\u6cd5\u6709\u4e00\u70b9\u4e0d\u4e00\u6837\uff08\u5e76\u4e14\u4f1a\u70b8\uff09\uff0c\u5c31\u662f bond \u7684 slave \u662f\u5199\u5728 bond \u8bbe\u5907\u4e0b\u7684\uff0c\u800c\u4e0d\u662f\u50cf ifupdown \u4e00\u6837\u5728 slave \u8bbe\u5907\u4e0b\u5199 bond-master \uff0c\u6240\u4ee5\u4ece ifupdown \u6362\u5230 ifupdown2 \u540e \u91cd\u542f\u524d\u52a1\u5fc5\u4fee\u6539\u914d\u7f6e \u3002\u5efa\u8bae\u4e0d\u8981\u7740\u6025\u5220\u6389 bond-master \uff0c\u56e0\u4e3a\u5c3d\u7ba1\u4e24\u79cd\u5199\u6cd5\u4e92\u4e0d\u517c\u5bb9\uff0c\u4f46\u662f\u5b83\u4eec\u4e5f\u4e92\u4e0d\u51b2\u7a81\uff08ifupdown / ifupdown2 \u4f1a\u4e92\u76f8\u65e0\u89c6\u53e6\u4e00\u79cd\u5199\u6cd5\uff09\u3002 \u5347\u7ea7 PVE 7 \u4e0d\u4e00\u5b9a\u4f1a\u81ea\u52a8\u66ff\u6362\u8f6f\u4ef6 \u5982\u679c\u66f4\u65b0\u5230 PVE 7 \u7684\u65f6\u5019\u6ca1\u6709\u81ea\u52a8\u5c06 ifupdown \u66ff\u6362\u4e3a ifupdown2\uff0c\u8bf7\u624b\u52a8\u66ff\u6362\u5e76\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\u3002 ifupdown \u7684\u8bed\u6cd5\uff1a auto eno1 iface eno1 inet manual bond-master bond0 auto eno2 iface eno2 inet manual bond-master bond0 auto bond0 iface bond0 inet manual bond-mode balance-alb bond-miimon 100 bond-downdelay 200 bond-updelay 200 ifupdown2 \u7684\u8bed\u6cd5\uff1a auto eno1 iface eno1 auto eno2 iface eno2 auto bond0 iface bond0 bond-slaves eno1 eno2 bond-mode balance-alb bond-miimon 100 bond-downdelay 200 bond-updelay 200 \u5173\u4e8e ifupdown2 \u7684 interfaces \u6587\u4ef6\uff0c\u5c24\u5176\u662f\u548c ifupdown \u7684\u533a\u522b\uff0c\u53ef\u4ee5\u770b \u8fd9\u4e2a\u9875\u9762 \u3002 \u6ce8\u610f\u4e0b\u5212\u7ebf ifupdown2 \u91cc\u4e0d\u518d\u4f7f\u7528\u4e0b\u5212\u7ebf\u4f5c\u4e3a key\uff0c\u6240\u6709 ifupdown \u91cc\u4f7f\u7528\u4e0b\u5212\u7ebf\u7684 key \u90fd\u88ab\u6362\u6210\u4e86\u51cf\u53f7\uff0c\u4f8b\u5982 bridge_ports \u5df2\u7ecf\u6362\u6210\u4e86 bridge-ports \u3002","title":"Proxmox VE 7 \u7f51\u7edc\u914d\u7f6e"},{"location":"traps/#linux-arp","text":"\u8be5\u95ee\u9898\u5df2\u4e8e 2020 \u5e74 7 \u6708 31 \u65e5\u89e3\u51b3\uff0c\u89c1\u4e0b \u9ed8\u8ba4\u60c5\u51b5\u4e0b Linux \u4f1a\u5bf9\u672c\u673a\u7684\u6240\u6709 IP \u5730\u5740\u5728\u6240\u6709\u754c\u9762\u4e0a\u54cd\u5e94 ARP \u8bf7\u6c42\uff08\u5f53\u7136 127.0.0.0/8 \u548c loopback \u662f\u9664\u5916\u7684\uff09\uff0c\u4f8b\u5982\u4e00\u4e2a\u4e3b\u673a\u62e5\u6709\u4e24\u4e2a\u754c\u9762 ifA \u548c ifB\uff0c\u5b83\u4eec\u5206\u522b\u5177\u6709 IP \u5730\u5740 ipA \u548c ipB\uff0c\u90a3\u4e48 Linux \u4f1a\u5728 ifA \u4e0a\u54cd\u5e94 who-has ipB \u7684\u8bf7\u6c42\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002 \u8fd9\u5728 2020 \u5e74\u4e0a\u534a\u5e74\u7814\u7a76 pv8 \u4e3a\u4ec0\u4e48\u8fde\u4e0d\u4e0a VXLAN \u7684\u65f6\u5019\u9020\u6210\u4e86\u5f88\u5927\u7684\u56f0\u60d1\uff0c\u56e0\u4e3a\u5b9e\u9645\u4e0a pv8 \u7684 ens1f1 \u754c\u9762\u662f\u574f\u7684\uff08\u53ef\u80fd\u662f\u5149\u7ea4\u6ca1\u63d2\u597d\u4e4b\u7c7b\u7684\uff09\uff0c\u7136\u540e\u7cfb\u7edf\u5728 ens1f0 \u754c\u9762\u4e0a\u54cd\u5e94\u4e86\u5b9e\u9645\u5c5e\u4e8e ens1f1 \u7684 IP \u5730\u5740\uff0c\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u770b\u8d77\u6765\u5c31\u50cf\u662f ens1f1 \u80fd\u8fde\u901a\u4f46 vxlan0 \u8fde\u4e0d\u901a\uff0c\u800c\u5b9e\u9645\u4e0a\u662f 10.0.0.28 \u88ab\u89e3\u6790\u5230\u4e86 pv8 \u7684 ens1f0 \u4e0a\uff0c\u6ca1\u6545\u969c\u5f53\u7136\u5c31\u80fd\u8fde\u901a\u4e86\u3002 iBug \u5907\u6ce8 \u8fd9\u4e2a\u5730\u65b9\u6211\u4e5f\u6ca1\u60f3\u5230\uff0c\u5176\u5b9e\u53ea\u8981\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u770b\u770b ARP \u7f13\u5b58\u8868\uff08 arp -a \uff09\u5c31\u80fd\u53d1\u73b0\u4e24\u4e2a IP \u89e3\u6790\u51fa\u6765\u7684 MAC \u4e00\u6837\u4e86 \u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u8bbe\u7f6e Linux \u53c2\u6570\u8ba9\u5176\u53ea\u5728\u201c\u6b63\u786e\u7684\u201d\u754c\u9762\u4e0a\u54cd\u5e94\uff0c\u8be6\u7ec6\u89e3\u91ca\u53c2\u89c1 Server Fault \u4e0a\u7684 \u8fd9\u4e2a\u56de\u7b54 \u3002\u6211\u4eec\u7684\u505a\u6cd5\u662f\u5411 /etc/sysctl.d/arp.conf \u91cc\u5199\u5165\u4e86\u5982\u4e0b\u5185\u5bb9\uff1a net.ipv4.conf.all.arp_ignore = 1 net.ipv4.conf.all.arp_announce = 2","title":"ARP \u95ee\u9898"},{"location":"traps/#vxlan-mtu","text":"\u8be5\u5751\u70b9\u5df2\u4e8e 2020 \u5e74 8 \u6708 1 \u65e5\u4fee\u590d \u5728 \u6b64\u6b21\u7ef4\u62a4\u5de5\u4f5c \u4e2d\uff0c\u4e0b\u5c42\u627f\u8f7d\u7f51\u5361 ens1f1 \u7684 MTU \u5df2\u88ab\u8c03\u6574\u4e3a 1550 \u5b57\u8282\uff0c\u4ece\u800c\u6b64\u540e\u7684 VXLAN \u7f51\u7edc\u90fd\u5177\u6709\u201c\u6b63\u5e38\u201d\u7684 1500 \u5b57\u8282\u7684\u8bbe\u7f6e\u3002 \u6ce8\u610f\u4ee5\u540e\u82e5\u6709\u65b0\u589e\u7684\u673a\u5668\u8fd8\u662f\u9700\u8981\u989d\u5916\u8bbe\u7f6e\u4e00\u904d\u7684\u3002 VXLAN \u662f\u4e00\u79cd overlay \u7f51\u7edc\u5b9e\u73b0\uff0c\u5c06\u5e27\u5305\u88c5\u5728 UDP \u5305\u4e2d\u4f20\u8f93\u3002\u7531\u4e8e\u4e00\u4e2a UDP \u5305\u5bf9\u5e94\u4e00\u4e2a\u5e27\uff0c\u56e0\u6b64 VXLAN \u7f51\u7edc\u7684 MTU \u4e3a\u4e0b\u5c42\u627f\u8f7d\u7f51\u7684 MTU \u51cf\u6389 50 \u5b57\u8282\uff08\u5404\u79cd\u5934\u4e4b\u7c7b\u7684\uff09\uff0c\u6240\u4ee5\u5728\u4e0b\u5c42\u7f51\u7edc\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\uff08MTU 1500\uff09\u7684\u60c5\u51b5\u4e0b VXLAN \u7f51\u7edc\u7684 MTU \u4e3a 1450\uff0c \u8fd9\u662f\u4e00\u4e2a\u975e\u6807\u51c6\u7684\u503c \uff0c\u800c\u4ece\u8be5 VXLAN \u7f51\u7edc\u4e2d\u6865\u63a5\u51fa\u6765\u7684\u754c\u9762\u5e76\u4e0d\u77e5\u9053\u5176\u7f51\u7edc\u7684\u771f\u5b9e MTU \u5c0f\u4e8e 1500\uff0c\u7ed3\u679c\u5c31\u662f\u4f20\u8f93\u7684\u5185\u5bb9\u7a0d\u5fae\u591a\u4e00\u70b9\uff08\u5355\u4e2a\u5e27\u8d85\u8fc7 1450 \u5b57\u8282\uff09\u7684\u65f6\u5019\u5c31\u4f1a\u88ab\u6574\u4e2a\u4e22\u6389\uff0c\u9020\u6210\u65e0\u6cd5\u8054\u7f51\u7684\u60c5\u51b5\u3002 \u89e3\u51b3\u65b9\u6cd5\u5012\u4e5f\u4e0d\u96be\uff0c\u5728\u7cfb\u7edf\u91cc\u8bbe\u7f6e\u7f51\u7edc\u7684 MTU \u4e3a 1450 \u5c31\u884c\u3002Proxmox VE \u521b\u5efa\u5bb9\u5668\u7684\u65f6\u5019\u53ef\u4ee5\u76f4\u63a5\u5728\u7f51\u7edc\u53c2\u6570\u4e2d\u6307\u5b9a mtu=1450 \uff0c\u4f46 KVM \u865a\u62df\u673a\u5c31\u5fc5\u987b\u6bcf\u4e2a\u865a\u62df\u673a\u8bbe\u7f6e\u4e86\uff0c\u8fd9\u5728 Windows \u4e0b \u5c24\u5176\u9ebb\u70e6 \u3002 \u6240\u4ee5\u6211\u4eec\u8ba1\u5212\u5728 2020 \u5e74\u6691\u5047\u628a\u8fd9\u4e2a\u95ee\u9898\u5f7b\u5e95\u89e3\u51b3\uff0c\u529e\u6cd5\u662f\u628a\u4e0b\u5c42\u627f\u8f7d\u7f51\u7684 MTU \u8c03\u5927 50 \u5b57\u8282\uff08\u53d8\u6210 1550 \u5b57\u8282\uff0c\u4fee\u6539 pv1 \u5230 pv8 \u7684 ens1f1 \u754c\u9762\uff09\uff0c\u8fd9\u6837 VXLAN \u5c31\u80fd\u62e5\u6709\u201c\u6b63\u5e38\u201d\u7684 1500 \u5b57\u8282\u7684 MTU \u4e86\uff0c\u80fd\u4e3a\u4ee5\u540e\u51cf\u5c11\u4e0d\u5c11\u9ebb\u70e6\u3002","title":"VXLAN MTU"},{"location":"traps/#vm","text":"","title":"\u865a\u62df\u673a"},{"location":"traps/#systemd-logind","text":"\u5c24\u5176\u662f\u5728\u5bb9\u5668\u4ece Debian buster \u5347\u7ea7\u5230 bullseye \u540e\u5bb9\u6613\u51fa\u73b0\u3002 \u75c7\u72b6\uff1a SSH \u767b\u5f55\u5df2\u8fde\u63a5\uff0c\u4f46\u957f\u65f6\u95f4\u4e0d\u5f39\u51fa shell\uff0c /var/log/auth.log \u663e\u793a pam_systemd(sshd:session): Failed to create session: Failed to activate service 'org.freedesktop.login1': timed out \uff0c systemctl status systemd-logind \u663e\u793a failed / code=226/NAMESPACE \u3002 \u539f\u56e0\uff1a Systemd \u4ece\u7248\u672c 242 \u5f00\u59cb\u91c7\u7528\u66f4\u591a\u6280\u672f\u6765\u9650\u5236\u8fd0\u884c\u670d\u52a1\u7684\u6743\u9650\uff0c\u800c\u9ed8\u8ba4\u6ca1\u5f00 nesting \u7684\u5bb9\u5668\u7f3a\u5c11\u5fc5\u8981\u6743\u9650\uff0c\u5bfc\u81f4 systemd-logind \u65e0\u6cd5\u542f\u52a8\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a \u4e3a\u5bb9\u5668\u5f00\u542f nesting\uff08\u548c keyctl\uff0c\u5982\u679c\u4f60\u60f3\u7684\u8bdd\uff09\u3002\u6211\u4eec\u5df2\u7ecf\u9ed8\u8ba4\u4e3a\u7528\u6237\u5bb9\u5668\u5f00\u542f\u4e86\u8fd9\u4e24\u9879\u6743\u9650\uff0c\u6240\u4ee5\u4e3a\u6211\u4eec\u81ea\u5df1\u7684\u670d\u52a1\u5bb9\u5668\u5f00\u542f\u5b83\u4eec\u4e0d\u4f1a\u6709\u989d\u5916\u7684\u95ee\u9898\u3002 pvesh set /nodes/<node_name>/lxc/<vmid>/config -features keyctl = 1 ,nesting = 1 \u53c2\u8003\u8d44\u6599\uff1a https://discuss.linuxcontainers.org/t/apparmor-blocks-systemd-services-in-container/9812","title":"systemd-logind \u542f\u52a8\u5931\u8d25"},{"location":"traps/#user1000service","text":"\u68c0\u67e5\u73af\u5883\u53d8\u91cf XDG_RUNTIME_DIR \u662f\u5426\u8bbe\u7f6e\u6b63\u786e\uff0c\u5e94\u4e3a /run/user/<uid> \u3002 \u53e6\u5916\u5728\u672a\u77e5\u60c5\u51b5\u4e0b\u8be5\u76ee\u5f55\u6709\u53ef\u80fd\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2a\uff08\u4fdd\u9669\u8d77\u89c1\uff0c\u540c\u65f6 chown \u4e00\u4e0b\uff09\uff1a UID = \" $( id -u ) \" mkdir -p \"/run/user/ $UID \" chown \" $UID . $UID \" \"/run/user/ $UID \" Ref: https://github.com/systemd/systemd/issues/9461#issuecomment-409929860","title":"user@1000.service \u542f\u52a8\u5931\u8d25"},{"location":"traps/#docker-in-lxc","text":"\u75c7\u72b6\uff1a \u8fd0\u884c Docker \u5bb9\u5668\u51fa\u73b0\u7c7b\u4f3c\u4e8e docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused \"process_linux.go:449: container init caused \\\"join session keyring: create session key: disk quota exceeded\\\"\": unknown. \u7684\u9519\u8bef\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a \u53c2\u8003 https://github.com/docker/compose/issues/7295#issuecomment-657475590 \u3002 Docker \u9700\u8981\u83b7\u53d6\u5230 kernel session key \u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002\u9996\u5148\u67e5\u770b /proc/key-users \u6587\u4ef6\uff0c\u5206\u6790\u9650\u989d\u5361\u5728\u4e86\u54ea\u91cc\u3002\u6587\u4ef6\u5185\u5bb9\u7c7b\u4f3c\u4e8e\uff1a 0: 336 335/335 238/1000000 4597/25000000 100: 1 1/1 1/50000 9/20000 998: 1 1/1 1/50000 9/20000 100000: 1198 1198/1198 1198/50000 19871/20000 100101: 2 2/2 2/50000 18/20000 \u5176\u4e2d\uff1a \u7b2c\u4e00\u5217\uff1aUID\u3002 \u7b2c\u4e8c\u5217\uff1a\u76ee\u524d\u5bf9\u5e94 UID \u7684 key \u6570\u91cf\u3002 \u7b2c\u4e09\u5217\uff1a\u5b9e\u4f8b\u5316\u7684 key \u6570\u91cf\u548c\u603b key \u6570\u91cf\u3002\uff08\u5e94\u8be5\u53ef\u4ee5\u5ffd\u7565\uff09 \u7b2c\u56db\u5217\uff1akey \u6570\u91cf\u4e0e\u603b key \u6570\u91cf\u9650\u989d\u3002\uff08\u5173\u6ce8\uff09 \u7b2c\u4e94\u5217\uff1akey \u5927\u5c0f\u4e0e\u603b key \u5927\u5c0f\u9650\u989d\u3002\uff08\u5173\u6ce8\uff09 \u6ce8\u610f\u6700\u540e\u4e24\u5217\u3002\u5982\u679c\u51fa\u73b0\u5f88\u8d34\u8fd1\u9650\u989d\u7684\u60c5\u51b5\uff0c\u9700\u8981\u8c03\u6574 /proc/sys/kernel/keys/maxbytes \u548c /proc/sys/kernel/keys/maxkeys \u7684\u503c\u3002root \u4e0b echo \u4e00\u4e2a\u66f4\u5927\u7684\u6570\u8fdb\u53bb\u5373\u53ef\u3002 root_maxbytes \u548c root_maxkeys \u4e00\u822c\u90fd\u975e\u5e38\u5927\uff08\u89c1 key-users \u7684\u7b2c\u4e00\u884c\uff09\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ba1\u3002 \u5982\u679c\u9700\u8981\u6301\u4e45\u5316\u914d\u7f6e\uff0c\u9700\u8981\u7f16\u8f91 /etc/sysctl.conf \uff0c\u6dfb\u52a0\uff1a kernel.keys.maxbytes = 500000 kernel.keys.maxkeys = 5000 \u7136\u540e sysctl --system \u3002","title":"Docker in LXC \u542f\u52a8\u5931\u8d25"},{"location":"traps/#docker-in-lxc-proxmox-ve-7","text":"\u4ece Proxmox VE 6 \u5347\u7ea7\u5230 Proxmox VE 7 \u540e\u914d\u7f6e\u4e86 keyctl=1,nesting=1 \u7684\u5bb9\u5668\u65e0\u6cd5\u542f\u52a8 docker.service \uff0cjournalctl \u8f93\u51fa\u6709 Devices cgroup isn't mounted \u3002 \u539f\u56e0\uff1a Proxmox VE 7 \u9ed8\u8ba4\u5f00\u542f\u4e86 unified cgroup hierarchy\uff08\u5373 cgroup v2\uff09\uff0c\u800c\u65e7\u7248\u672c\u7684 Docker \u9700\u8981\u539f\u6765\u7684 cgroup v1 \u7ed3\u6784\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a \u5728\u5185\u6838\u53c2\u6570\u4e2d\u52a0\u4e0a systemd.unified_cgroup_hierarchy=0 \uff0c\u7136\u540e\u91cd\u542f\u4e3b\u673a\u3002\u5177\u4f53\u64cd\u4f5c\u662f\u5728 /etc/default/grub \u7684 GRUB_CMDLINE_LINUX_DEFAULT \u540e\u9762\u8865\u4e0a systemd.unified_cgroup_hierarchy=0 \uff0c\u7136\u540e\u6267\u884c update-grub \u5e76\u91cd\u542f\u3002 Note Docker Engine 20.10 \u5f00\u59cb\u652f\u6301 cgroup v2\uff0c\u4f46\u662f\u5230\u5168\u9762\u5e94\u7528\u8fd8\u6709\u70b9\u65e9\uff0c\u6240\u4ee5\u8fd9\u4e2a\u517c\u5bb9\u8bbe\u7f6e\u5148\u5f00\u7740\u3002","title":"Docker in LXC \u542f\u52a8\u5931\u8d25 (Proxmox VE 7)"},{"location":"traps/#systemd","text":"\u75c7\u72b6\uff1a\u91cd\u8981\u670d\u52a1\u65e0\u6cd5\u542f\u52a8\uff0c\u63d0\u793a Failed to add /run/systemd/ask-password to directory watch: No space left on device \uff0c\u4f46\u662f df \u663e\u793a\u5269\u4f59\u7a7a\u95f4\u8fd8\u6709\u5f88\u591a\u3002 \u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6cd5\uff1a\u8bbe\u7f6e sysctl: fs.inotify.max_user_watches = 1048576 \u56e0\u4e3a\u51fa\u95ee\u9898\u7684\u5bb9\u5668\u88ab\u540c\u5b66\u5220\u6389\u4e86\uff0c\u6240\u4ee5\u672a\u9a8c\u8bc1\u662f\u5426\u80fd\u591f\u89e3\u51b3\u95ee\u9898\u3002","title":"Systemd \u670d\u52a1\u56e0\u300c\u7a7a\u95f4\u4e0d\u8db3\u300d\u542f\u52a8\u5931\u8d25\u3002"},{"location":"traps/#4915","text":"\u6240\u6709\u56fe\u5f62\u754c\u9762\u8fdb\u7a0b cgroup \u90fd\u6302\u5728 lightdm.service \u7684\u9650\u5236\u4e0b\u9762\uff0c\u800c systemd \u9ed8\u8ba4\u914d\u7f6e\u9650\u989d\u4e3a 4915\u3002 \u7b80\u5355\u5feb\u901f\u7684\u4fee\u6539\u547d\u4ee4\uff1a systemctl set-property lightdm.service TasksMax=18000 \u66f4\u8be6\u7ec6\u7684\u6307\u5bfc\u53c2\u89c1 https://www.suse.com/support/kb/doc/?id=000015901","title":"\u56fe\u5f62\u754c\u9762\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\u6570\u6700\u591a\u53ea\u80fd\u8dd1 4915 \u4e2a"},{"location":"backup/","text":"\u5907\u4efd \u00b6 \u6211\u4eec\u914d\u7f6e\u4e86\u4e00\u4e2a\u865a\u62df\u673a\uff08pbs\uff0cID \u4e3a 104\uff09\u5b89\u88c5 Proxmox Backup Server \u63d0\u4f9b\u865a\u62df\u673a\u7684\u5907\u4efd\u670d\u52a1\u3002 \u76ee\u524d\u8be5\u865a\u62df\u673a\u8fd0\u884c\u5728 pv8 \u4e0a\uff0c\u4ece user-data \u5206\u914d\u4e86 16 GB \u7684 rootfs\uff08PBS \u4e0e PVE \u540c\u6837\u9ed8\u8ba4\u4f7f\u7528 LVM\uff09\u548c 128 GB \u7684\u6570\u636e\u76d8\uff0c\u6302\u5728 /mnt/data \u4e0b\uff0c\u5bf9\u5e94\u7684 Datastore \u540d\u79f0\u5c31\u53eb data \u3002 \u7531\u4e8e PBS \u4e0d\u80fd\u52a0\u5165 PVE \u96c6\u7fa4\uff0c\u53ea\u80fd\u6dfb\u52a0\u4e3a\u4e00\u4e2a Storage location\uff0c\u81ea\u7136\u4e5f\u65e0\u6cd5\u4f7f\u7528 PVE \u7684\u8d26\u53f7\u7cfb\u7edf\u3002\u6211\u4eec\u76ee\u524d\u7684\u505a\u6cd5\u662f\u6bcf\u6b21\u9700\u8981\u767b\u5f55 web \u754c\u9762\u65f6\u5148 SSH \u4e0a\u53bb\u5c06 root \u5bc6\u7801\u6539\u6389\uff0c\u7136\u540e\u4f7f\u7528 root \u767b\u5f55\uff0c\u5728\u64cd\u4f5c\u5b8c\u6210\u540e\u518d passwd -d root \u3002","title":"\u5907\u4efd"},{"location":"backup/#_1","text":"\u6211\u4eec\u914d\u7f6e\u4e86\u4e00\u4e2a\u865a\u62df\u673a\uff08pbs\uff0cID \u4e3a 104\uff09\u5b89\u88c5 Proxmox Backup Server \u63d0\u4f9b\u865a\u62df\u673a\u7684\u5907\u4efd\u670d\u52a1\u3002 \u76ee\u524d\u8be5\u865a\u62df\u673a\u8fd0\u884c\u5728 pv8 \u4e0a\uff0c\u4ece user-data \u5206\u914d\u4e86 16 GB \u7684 rootfs\uff08PBS \u4e0e PVE \u540c\u6837\u9ed8\u8ba4\u4f7f\u7528 LVM\uff09\u548c 128 GB \u7684\u6570\u636e\u76d8\uff0c\u6302\u5728 /mnt/data \u4e0b\uff0c\u5bf9\u5e94\u7684 Datastore \u540d\u79f0\u5c31\u53eb data \u3002 \u7531\u4e8e PBS \u4e0d\u80fd\u52a0\u5165 PVE \u96c6\u7fa4\uff0c\u53ea\u80fd\u6dfb\u52a0\u4e3a\u4e00\u4e2a Storage location\uff0c\u81ea\u7136\u4e5f\u65e0\u6cd5\u4f7f\u7528 PVE \u7684\u8d26\u53f7\u7cfb\u7edf\u3002\u6211\u4eec\u76ee\u524d\u7684\u505a\u6cd5\u662f\u6bcf\u6b21\u9700\u8981\u767b\u5f55 web \u754c\u9762\u65f6\u5148 SSH \u4e0a\u53bb\u5c06 root \u5bc6\u7801\u6539\u6389\uff0c\u7136\u540e\u4f7f\u7528 root \u767b\u5f55\uff0c\u5728\u64cd\u4f5c\u5b8c\u6210\u540e\u518d passwd -d root \u3002","title":"\u5907\u4efd"},{"location":"history/gen1/","text":"Vlab \u7b2c\u4e00\u4ee3\u670d\u52a1\u5668 \u00b6 \u7b2c\u4e00\u4ee3 Vlab \u8fdc\u7a0b\u865a\u62df\u684c\u9762\u5e73\u53f0\u5728 2019 \u5e74 6 \u6708\u7531\u674e\u5b50\u5929\u5b66\u957f\u521d\u6b65\u914d\u7f6e\u597d\uff0c\u7ecf\u8fc7 @iBug \u548c @taoky \u7b49\u4eba\u8fdb\u4e00\u6b65\u8c03\u6574\u5e76\u7f16\u5199\u524d\u7aef\u7ba1\u7406\u7cfb\u7edf\u540e\uff0c\u4e8e 2019 \u5e74\u79cb\u5b63\u5b66\u671f\u5f00\u59cb\u5c0f\u8303\u56f4\u6d4b\u8bd5\uff08\u6b63\u5f0f\u4e0a\u7ebf\uff09\u3002 \u786c\u4ef6 \u00b6 \u7b2c\u4e00\u4ee3 Vlab \u670d\u52a1\u5668\u5305\u542b\u53cc\u8def Intel Xeon E5-2630 v4 \u5904\u7406\u5668\uff08\u5171 20 \u6838\u5fc3\u300140 \u7ebf\u7a0b\uff09\uff0c\u5b89\u88c5\u5185\u5b58 128 GB\uff088 x 16 GB DDR4 2400 ECC\uff09\u3002\u786c\u76d8\u914d\u7f6e\u4e3a\u4e00\u5757 Intel Optane 905P 480GB\uff08\u7cfb\u7edf\u76d8\uff0cswap \u548c\u7f13\u5b58\uff09\u548c\u56db\u5757 HPE 2.4TB SAS \u786c\u76d8\u3002 \u53e6\u5916\u8be5\u670d\u52a1\u5668\u4e0a\u8fd8\u6709\u4e00\u5757 NVIDIA Tesla P4 GPU\uff0c\u539f\u672c\u8ba1\u5212\u7528\u4e8e\u52a0\u901f\u6df1\u5ea6\u5b66\u4e60\u7b49\u8d1f\u8f7d\uff0c\u5b9e\u9645\u4e0a\u7531\u4e8e\u627f\u62c5\u7684\u8bfe\u7a0b\u5b9e\u9a8c\u4efb\u52a1\u7c7b\u578b\u4e0d\u540c\uff0c\u5e76\u672a\u6d3e\u4e0a\u7528\u573a\u3002 \u64cd\u4f5c\u7cfb\u7edf \u00b6 \u642d\u5efa\u8fd9\u53f0\u670d\u52a1\u5668\u7684\u5b66\u957f\u9009\u62e9\u4e86 Ubuntu 18.04 LTS\uff0c\u4f46\u662f\u5c06\u5185\u6838\u66ff\u6362\u4e3a 3.10.0-514.61.1.el7.x86_64 \uff08\u6765\u81ea RHEL 7.3 EUS\uff09\uff0c\u539f\u56e0\u662f NVIDIA \u7684\u9a71\u52a8\uff08\u5185\u6838\u6a21\u5757\uff09\u9700\u8981\u7f16\u8bd1\uff0c\u800c\u4e14\u5bf9\u5185\u6838\u7248\u672c\u975e\u5e38\u654f\u611f\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8fd9\u4e2a\u96be\u6574\u7684\u9a71\u52a8\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u4e0d\u65b9\u4fbf\u5c06\u5185\u6838\u4ea4\u7531 apt \u7ba1\u7406\u5347\u7ea7\u3002 \u865a\u62df\u5316 \u00b6 \u91c7\u7528 LXD \u5bb9\u5668\uff0c\u8fd0\u884c\u4e00\u4e2a\u5b9a\u5236\u7684\u955c\u50cf\uff08Ubuntu Minimal \u5b89\u88c5\u4e86 Xfce \u548c Xilinx Vivado\uff09\uff0c\u4e3a 2019 \u5e74\u79cb\u5b63\u5b66\u671f\u7684\u300a\u6570\u5b57\u7535\u8def\u5b9e\u9a8c\u300b\u8bfe\u7a0b\u63d0\u4f9b\u670d\u52a1\u3002 \u5b58\u50a8 \u00b6 \u6700\u5f00\u59cb\uff082019 \u5e74\u6691\u5047\u671f\u95f4\uff09\u6ca1\u6709\u4efb\u4f55\u7279\u522b\u7684\u5b58\u50a8\u67b6\u6784\uff0c\u76f4\u63a5\u7528\u7684 LXD \u7684 Directory\uff08\u4e5f\u5c31\u662f\u7eaf\u76ee\u5f55\uff09\u5b58\u50a8\uff0c\u540e\u6765\u5728\u6b63\u5f0f\u4e0a\u7ebf\u524d\u7531 iBug \u66ff\u6362\u6210\u4e86 ZFS\uff0c\u5e76\u4e00\u76f4\u8fd0\u884c\u4e0b\u53bb\u3002 \u540e\u7eed \u00b6 \u8fd9\u53f0\u673a\u5668\u5728 2020 \u5e74 3 \u6708\u5e95\u88ab\u91cd\u88c5\u4e3a Proxmox VE \u7cfb\u7edf\uff0c\u5185\u5b58\u7531 128 GB \u5347\u7ea7\u5230 160 GB\uff0c\u91cd\u65b0\u6307\u6d3e hostname \u4e3a pv0\uff0c\u8ba1\u5212\u662f\u63d0\u4f9b GPU \u5bb9\u5668\u670d\u52a1\uff0c\uff0c\u4e0d\u8fc7\u540e\u6765\u53d1\u73b0\u7b2c\u4e8c\u4ee3\u7684\u673a\u5668\u65e0\u6cd5\u52a0\u88c5 GPU \u4e4b\u540e\u5c31\u6539\u4e3a\u7528\u4f5c\u6211\u4eec\u7684\u5f00\u53d1\u6d4b\u8bd5\u73af\u5883\u4e86\uff0c\u4e0d\u63d0\u4f9b\u4efb\u4f55\u6b63\u5f0f\u670d\u52a1\uff08\u4e5f\u6ca1\u6709\u63a5\u5165\u5149\u7ea4\u5185\u7f51\uff09\u3002","title":"\u7b2c\u4e00\u4ee3"},{"location":"history/gen1/#vlab","text":"\u7b2c\u4e00\u4ee3 Vlab \u8fdc\u7a0b\u865a\u62df\u684c\u9762\u5e73\u53f0\u5728 2019 \u5e74 6 \u6708\u7531\u674e\u5b50\u5929\u5b66\u957f\u521d\u6b65\u914d\u7f6e\u597d\uff0c\u7ecf\u8fc7 @iBug \u548c @taoky \u7b49\u4eba\u8fdb\u4e00\u6b65\u8c03\u6574\u5e76\u7f16\u5199\u524d\u7aef\u7ba1\u7406\u7cfb\u7edf\u540e\uff0c\u4e8e 2019 \u5e74\u79cb\u5b63\u5b66\u671f\u5f00\u59cb\u5c0f\u8303\u56f4\u6d4b\u8bd5\uff08\u6b63\u5f0f\u4e0a\u7ebf\uff09\u3002","title":"Vlab \u7b2c\u4e00\u4ee3\u670d\u52a1\u5668"},{"location":"history/gen1/#hardware","text":"\u7b2c\u4e00\u4ee3 Vlab \u670d\u52a1\u5668\u5305\u542b\u53cc\u8def Intel Xeon E5-2630 v4 \u5904\u7406\u5668\uff08\u5171 20 \u6838\u5fc3\u300140 \u7ebf\u7a0b\uff09\uff0c\u5b89\u88c5\u5185\u5b58 128 GB\uff088 x 16 GB DDR4 2400 ECC\uff09\u3002\u786c\u76d8\u914d\u7f6e\u4e3a\u4e00\u5757 Intel Optane 905P 480GB\uff08\u7cfb\u7edf\u76d8\uff0cswap \u548c\u7f13\u5b58\uff09\u548c\u56db\u5757 HPE 2.4TB SAS \u786c\u76d8\u3002 \u53e6\u5916\u8be5\u670d\u52a1\u5668\u4e0a\u8fd8\u6709\u4e00\u5757 NVIDIA Tesla P4 GPU\uff0c\u539f\u672c\u8ba1\u5212\u7528\u4e8e\u52a0\u901f\u6df1\u5ea6\u5b66\u4e60\u7b49\u8d1f\u8f7d\uff0c\u5b9e\u9645\u4e0a\u7531\u4e8e\u627f\u62c5\u7684\u8bfe\u7a0b\u5b9e\u9a8c\u4efb\u52a1\u7c7b\u578b\u4e0d\u540c\uff0c\u5e76\u672a\u6d3e\u4e0a\u7528\u573a\u3002","title":"\u786c\u4ef6"},{"location":"history/gen1/#operating-system","text":"\u642d\u5efa\u8fd9\u53f0\u670d\u52a1\u5668\u7684\u5b66\u957f\u9009\u62e9\u4e86 Ubuntu 18.04 LTS\uff0c\u4f46\u662f\u5c06\u5185\u6838\u66ff\u6362\u4e3a 3.10.0-514.61.1.el7.x86_64 \uff08\u6765\u81ea RHEL 7.3 EUS\uff09\uff0c\u539f\u56e0\u662f NVIDIA \u7684\u9a71\u52a8\uff08\u5185\u6838\u6a21\u5757\uff09\u9700\u8981\u7f16\u8bd1\uff0c\u800c\u4e14\u5bf9\u5185\u6838\u7248\u672c\u975e\u5e38\u654f\u611f\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8fd9\u4e2a\u96be\u6574\u7684\u9a71\u52a8\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u4e0d\u65b9\u4fbf\u5c06\u5185\u6838\u4ea4\u7531 apt \u7ba1\u7406\u5347\u7ea7\u3002","title":"\u64cd\u4f5c\u7cfb\u7edf"},{"location":"history/gen1/#containerization","text":"\u91c7\u7528 LXD \u5bb9\u5668\uff0c\u8fd0\u884c\u4e00\u4e2a\u5b9a\u5236\u7684\u955c\u50cf\uff08Ubuntu Minimal \u5b89\u88c5\u4e86 Xfce \u548c Xilinx Vivado\uff09\uff0c\u4e3a 2019 \u5e74\u79cb\u5b63\u5b66\u671f\u7684\u300a\u6570\u5b57\u7535\u8def\u5b9e\u9a8c\u300b\u8bfe\u7a0b\u63d0\u4f9b\u670d\u52a1\u3002","title":"\u865a\u62df\u5316"},{"location":"history/gen1/#storage","text":"\u6700\u5f00\u59cb\uff082019 \u5e74\u6691\u5047\u671f\u95f4\uff09\u6ca1\u6709\u4efb\u4f55\u7279\u522b\u7684\u5b58\u50a8\u67b6\u6784\uff0c\u76f4\u63a5\u7528\u7684 LXD \u7684 Directory\uff08\u4e5f\u5c31\u662f\u7eaf\u76ee\u5f55\uff09\u5b58\u50a8\uff0c\u540e\u6765\u5728\u6b63\u5f0f\u4e0a\u7ebf\u524d\u7531 iBug \u66ff\u6362\u6210\u4e86 ZFS\uff0c\u5e76\u4e00\u76f4\u8fd0\u884c\u4e0b\u53bb\u3002","title":"\u5b58\u50a8"},{"location":"history/gen1/#follow-ups","text":"\u8fd9\u53f0\u673a\u5668\u5728 2020 \u5e74 3 \u6708\u5e95\u88ab\u91cd\u88c5\u4e3a Proxmox VE \u7cfb\u7edf\uff0c\u5185\u5b58\u7531 128 GB \u5347\u7ea7\u5230 160 GB\uff0c\u91cd\u65b0\u6307\u6d3e hostname \u4e3a pv0\uff0c\u8ba1\u5212\u662f\u63d0\u4f9b GPU \u5bb9\u5668\u670d\u52a1\uff0c\uff0c\u4e0d\u8fc7\u540e\u6765\u53d1\u73b0\u7b2c\u4e8c\u4ee3\u7684\u673a\u5668\u65e0\u6cd5\u52a0\u88c5 GPU \u4e4b\u540e\u5c31\u6539\u4e3a\u7528\u4f5c\u6211\u4eec\u7684\u5f00\u53d1\u6d4b\u8bd5\u73af\u5883\u4e86\uff0c\u4e0d\u63d0\u4f9b\u4efb\u4f55\u6b63\u5f0f\u670d\u52a1\uff08\u4e5f\u6ca1\u6709\u63a5\u5165\u5149\u7ea4\u5185\u7f51\uff09\u3002","title":"\u540e\u7eed"},{"location":"kvm/cloud-init/","text":"\u865a\u62df\u673a cloud-init \u914d\u7f6e\u548c\u4f7f\u7528 \u00b6 \u914d\u7f6e\u5e26\u6709 cloud-init \u7684\u955c\u50cf \u00b6 \u521b\u5efa\u865a\u62df\u673a\uff0c\u5e76\u5b89\u88c5 cloud-init \u00b6 \u4ece\u672c\u5730\u9009\u62e9 iso \u521b\u5efa\u865a\u62df\u673a\uff0c\u88c5\u597d\u7cfb\u7edf\u540e\u8fdb\u5165\u865a\u62df\u673a\uff0c\u5b89\u88c5 cloud-init\u3002\u5982\u679c\u5728\u88c5\u7cfb\u7edf\u65f6\u6ca1\u6709\u6362\u6e90\uff0c\u5c31\u5148\u6362\u6e90\u3002 sudo apt install cloud-init # Ubuntu sudo yum install cloud-init # CentOS cloud-init \u7684\u914d\u7f6e\u4fe1\u606f\u5728\u6587\u4ef6 /etc/cloud/cloud.cfg.d/*.cfg \u548c /etc/cloud/cloud.cfg \u4e2d\u3002cloud-init \u4ee5\u5b57\u6bcd\u987a\u5e8f\u8bfb\u53d6\u6240\u6709\u7684 *.cfg \u6587\u4ef6\uff0c\u76f8\u540c\u53c2\u6570\u540e\u9762\u7684\u6587\u4ef6\u4f1a\u8986\u76d6\u524d\u9762\u7684\u6587\u4ef6\u3002 \u5728 cloud.cfg \u6587\u4ef6\u4e2d\uff0c\u4efb\u52a1\u4ee5 module \u5f62\u5f0f\u7ec4\u7ec7. \u4f8b\u5982\u6307\u5b9a set_hostname \u7684 moudle \u65f6\uff0ccloud-init \u4f1a\u6267\u884c hostname \u4efb\u52a1\uff0c\u5177\u4f53\u7684\u914d\u7f6e\u53c2\u6570\u7531 metadata \u6307\u5b9a\u3002 \u6211\u4eec\u9700\u8981\u5728\u6b64\u6587\u4ef6\u4e2d\u5220\u9664\u4e0d\u9700\u8981\u7684\u6a21\u5757, \u4f8b\u5982 disable-ec2-metadata \u548c byobu \u7b49\u3002 cloud_config_modules : - snap - snap_config - ubuntu-advantage - disable-ec2-metadata - byobu cloud_final_modules : - snappy - fan - landscape - lxd - puppet - chef - mcollective - salt-minion - rightscale_userdata cloud-init \u7684\u6570\u636e\u6587\u4ef6\u653e\u5728 /var/lib/cloud/data \u4e2d\uff0c \u65e5\u5fd7\u6587\u4ef6\u653e\u5728 /var/log/cloud-init-output.log (\u6bcf\u9636\u6bb5\u8f93\u51fa)\uff0c /var/log/cloud-init.log (\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u66f4\u8be6\u7ec6\u7684\u8c03\u8bd5\u65e5\u5fd7)\uff0c /run/cloud-init \u51b3\u5b9a\u5f00\u542f\u548c\u5173\u95ed\u81ea\u8eab\u7684\u67d0\u4e9b\u529f\u80fd\u3002 \u89e3\u51b3\u4ece\u540c\u4e00\u6a21\u677f\u4e2d\u521b\u5efa\u7684\u865a\u62df\u673a\u6709\u76f8\u540c\u7684 machine-id \u95ee\u9898 \u00b6 \u65b9\u6cd5 1 \u00b6 Proxmox \u4f1a\u5bf9\u521b\u5efa\u7684\u65b0\u865a\u62df\u673a\u81ea\u52a8\u5206\u914d\u4e0d\u540c\u7684 MAC \u5730\u5740\u3002 \u4f46\u662f\u5bf9\u4e8e Ubuntu\uff0c\u4ece\u7edf\u4e00\u6a21\u677f\u4e2d\u521b\u5efa\u7684\u865a\u62df\u673a\u6709\u548c\u6a21\u677f\u76f8\u540c\u7684 machine-id\uff0c\u865a\u62df\u673a\u4f7f\u7528\u6b64 machine-id \u6765\u83b7\u53d6 DHCP \u7684 lease\uff0c\u4ece\u5bfc\u81f4\u591a\u4e2a\u865a\u62df\u673a\u7ade\u4e89\u540c\u4e00\u4e2a IP \u5730\u5740\u3002 \u89e3\u51b3\u6b64\u95ee\u9898\u7684\u65b9\u6cd5\u662f\u6587\u4ef6 /etc/machine-id \u5220\u9664\uff0c\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u540c\u540d\u7a7a\u767d\u6587\u4ef6 sudo rm /etc/machine-id sudo touch /etc/machine-id \u4e4b\u540e\uff0c\u8f6c\u5230\u6587\u4ef6 /var/lib/dbus/machine-id \uff0c\u6b64\u6587\u4ef6\u4f1a\u5728\u6bcf\u6b21\u865a\u62df\u673a\u91cd\u542f\u4e4b\u540e\u5c06 machine-id \u590d\u5236\u5230 /etc/machine-id \u4e2d\u3002 \u6240\u4ee5\u5c06\u6b64\u6587\u4ef6\u5220\u9664\uff0c\u521b\u5efa\u4e00\u4e2a /etc/machine-id \u7684\u7b26\u53f7\u94fe\u63a5\u5230\u6b64\u5904\u3002 sudo rm /var/lib/dbus/machine-id sudo ln -s /etc/machine-id /var/lib/dbus/machine-id \u7136\u540e\u5c06\u6b64\u865a\u62df\u673a\u5173\u673a\uff08\u4e0d\u662f\u91cd\u542f\uff0c\u5426\u5219\u4f1a\u751f\u6210\u65b0\u7684 machine-id\uff09\uff0c\u5236\u4f5c\u4e3a\u6a21\u677f\u3002 \u65b9\u6cd5 2 \u00b6 \u4fee\u6539 DHCP \u7684 identifier\uff0c /etc/netplan/ \u4e0b\u6587\u4ef6\uff0c\u5728 network \u4e0b\u7684 ethernets \u4e0b\u7684\u6761\u76ee\u589e\u52a0 dhcp-identifier: mac \uff0c\u5373\u53ef\u4f7f\u7528 MAC \u4f5c\u4e3a DHCP \u5206\u914d IP \u7684\u552f\u4e00\u6807\u5fd7\u3002 \u4f46 SSH \u4e5f\u4f7f\u7528 machine-id\uff0c\u6240\u4ee5\u6b64\u65b9\u6cd5\u53ea\u89e3\u51b3\u4e86 ip \u7684\u95ee\u9898\u3002 \u5b89\u88c5\u5fc5\u8981\u8f6f\u4ef6\u5305 \u00b6 \u5b89\u88c5 net-tools, openssh-server \u7b49\u5de5\u5177 \u8bbe\u7f6e username \u548c password (\u5931\u8d25\uff0c\u65e0\u6cd5\u4f7f\u7528\u5728 proxmox web \u9875\u9762\u4e0a\u8bbe\u7f6e\u7684 username \u548c password \u767b\u5f55\u865a\u62df\u673a) \u00b6 \u5b8c\u6210\u4e0a\u9762\u7684\u5de5\u4f5c\u540e\u5c06\u865a\u62df\u673a\u5173\u673a\uff0c\u5728 proxmox web \u754c\u9762 hardware \u680f\u4e2d add cloudinit Drive\uff0c\u7136\u540e\u5728 Cloud-init \u680f\u4e2d\u8bbe\u7f6e\u7528\u6237\u540d\u548c\u5bc6\u7801\uff08\u5fc5\u987b\u8bbe\u7f6e\uff0c\u5426\u5219\u65e0\u6cd5\u8fdb\u5165\u7531\u6b64\u6a21\u677f\u521b\u5efa\u7684\u865a\u62df\u673a\uff09\u3002 cloud-init \u7b80\u4ecb\u548c\u914d\u7f6e\u89e3\u91ca \u00b6 \u9636\u6bb5 \u00b6 cloud-init.cfg \u6587\u4ef6\u4e2d\u6709\u4e94\u4e2a stage\uff0ccloud-init \u5206\u4e3a\u4e94\u4e2a\u9636\u6bb5\u8fdb\u884c\uff0c\u5177\u4f53\u4ee5\u670d\u52a1\u7684\u5f62\u5f0f\u6ce8\u518c\u5230\u7cfb\u7edf\u4e2d\u6309\u5982\u4e0b\u6b21\u5e8f\u6267\u884c\uff1a generator \u6b64\u9636\u6bb5\u68c0\u6d4b ci \u662f\u5426\u88ab\u7981\u7528 local:cloud-init-local.service \u5f53/\u6302\u8f7d\u65f6\u6267\u884c\uff0c\u6b64\u9636\u6bb5\u7684\u4efb\u52a1\u4e3b\u8981\u662f\u5b9a\u4f4d\u672c\u5730\u6570\u636e\uff0c\u5c06\u7f51\u7edc\u914d\u7f6e\u5e94\u7528\u5230\u672c\u5730\u3002 \u9700\u8981\u5c06\u7f51\u7edc block \u6b64\u9636\u6bb5\u6ca1\u6709\u7528\u5230\u7684\u6a21\u5757 network:cloud-init.service \u5904\u7406\u6240\u6709\u7684 user-data, \u5305\u62ec\u4efb\u4f55 #include or #include-once , \u89e3\u538b\u7f29\u6240\u6709\u538b\u7f29\u6587\u4ef6, \u8fd0\u884c\u6240\u6709\u7684 part-handler config:cloud.config.service \u6b64\u9636\u6bb5\u4ec5\u8fd0\u884c config module, \u5176\u4ed6\u9636\u6bb5\u4e0d\u8d77\u4f5c\u7528\u7684\u6a21\u5757\u90fd\u5728\u8fd9\u4e2a\u9636\u6bb5\u8fd0\u884c final:cloud-final.service \u6b64\u9636\u6bb5\u8fd0\u884c\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u9700\u8981\u5728\u767b\u5f55\u7cfb\u7edf\u540e\u6267\u884c\u7684\u811a\u672c\u5728\u6b64\u5904\u8fd0\u884c\u3002 \u6bcf\u4e2a\u9636\u6bb5\u4e2d\u6267\u884c\u7684\u4efb\u52a1\u4ee5\u6a21\u5757\u7684\u5f62\u5f0f\u5b9a\u4e49, \u6a21\u5757\u6267\u884c\u7684\u5177\u4f53\u4efb\u52a1\u7531 metadata \u51b3\u5b9a User-Data \u00b6 cloud-init \u901a\u8fc7\u547d\u4ee4\u884c --cicustom \u5c06\u7528\u6237\u81ea\u5b9a\u4e49\u7684 config \u6587\u4ef6\u8fdb\u884c\u914d\u7f6e # Syntax qm set <vid> --cicustom \"user=<volume>, network=<volume>, meta=<volume>\" # Example qm set 9000 --cicustom \"user=local:snippets/userconfig.yaml\" cicustom \u6587\u4ef6\u9700\u8981\u5728\u652f\u6301 snippets \u5e76\u4e14\u6240\u6709\u7684 VM \u90fd\u80fd access \u7684\u8282\u70b9\u4e0a\u3002 \u521b\u5efa\u4e00\u4e2a snippets: \u5728 proxmox \u7684 web \u754c\u9762\u4e0a\u7684 datacenter \u4e2d\u70b9\u51fb\u5b58\u50a8 - add-directory, \u8bbe\u7f6e id, \u9009\u62e9\u76ee\u5f55 content \u9009\u62e9 snippets, node \u9009 ALL (No restrictions)\u3002 \u5173\u4e8e volumes \u00b6 local \u9ed8\u8ba4\u4f4d\u7f6e\u4e3a /var/lib/vz \uff08\u5b9a\u4e49\u5728\u914d\u7f6e\u6587\u4ef6 /etc/pve/storage.cfg \u4e2d\uff09 cloudinit \u65e5\u5fd7\u6587\u4ef6\u5728 /var/log/cloud-init-ouput.log \u4e2d User-Data \u683c\u5f0f \u00b6 User-Data Script \u00b6 \u901a\u5e38\u7528\u4e8e\u4ec5\u9700\u8981\u6267\u884c\u4e00\u4e2a shell \u811a\u672c\u7684\u65f6\u5019 \u683c\u5f0f\uff1a\u4ee5 #! \u5f00\u59cb\u6216\u8005\u5f53\u4f7f\u7528 MIME \u5f52\u6863\u65f6\u4ee5 Content-Type: text/x-shellscript \u5f00\u59cb \u793a\u4f8b #!/bin/sh echo \"Hello World. The time is now $( date -R ) !\" | tee /root/output.txt \u5728\u865a\u62df\u673a\u7684 /var/lib/cloud/scripts \u76ee\u5f55\u4e0b\u5b58\u653e\u8981\u6267\u884c\u7684\u811a\u672c\u6587\u4ef6\u3002 Cloud Config Data \u00b6 \u5fc5\u987b\u662f\u5408\u6cd5\u7684 yaml \u683c\u5f0f local \u76ee\u5f55\u5728 /var/lib/vz \u4e0b\uff08\u5728 /etc/pve/storage.cfg \u4e2d\u914d\u7f6e\uff09 \u683c\u5f0f: \u4ee5 #cloud-config \u5f00\u59cb\u6216\u8005\u5f53\u4f7f\u7528 MIME \u65f6\u4ee5 Content-Type: text/cloud-config \u5f00\u59cb \u5404 module \u5bf9\u5e94\u4e0b config data \u683c\u5f0f\u53ca\u529f\u80fd\u8bf4\u660e\uff1a https://cloudinit.readthedocs.io/en/latest/topics/modules.html \u793a\u4f8b bootcmd : - echo 192.168.1.130 us.archive.com > /etc/hosts - [ cloud-init-per , one , mymkfs , mkfs , /dev/vdb ] config \u793a\u4f8b: \u00b6 \u914d\u7f6e\u5b9e\u4f8b\u7684 SSH key\uff1a https://cloudinit.readthedocs.io/en/latest/topics/modules.html#ssh \u6269\u5bb9\uff1a https://cloudinit.readthedocs.io/en/latest/topics/modules.html#growpart Kernel Command Line \u00b6 \u4f7f\u7528 NoCloud \u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u5c06\u7528\u6237\u6570\u636e\u901a\u8fc7\u5185\u6838\u547d\u4ee4\u884c\u53c2\u6570\u4f20\u9012\u3002 \u5176\u4ed6 \u00b6 \u5176\u4ed6\u683c\u5f0f\u8fd8\u6709 include, upstart job, cloud boothook, part handler \u7b49 ci \u6709\u4e00\u4e2a\u811a\u672c make-mime.py \u53ef\u4ee5\u5c06\u4e0d\u540c\u7c7b\u578b\u7684\u7528\u6237\u6570\u636e\u7efc\u5408\u5728\u4e00\u8d77\uff0c\u4f8b\u5982\u5c06 cloud-config \u7c7b\u578b\u7684 config.yaml \u548c x-shellscript \u7c7b\u578b\u7684 script.sh \u7ec4\u5408\u5728\u4e00\u8d77\u5f62\u6210 user-data \u6570\u636e: ./tools/make-mime.py -a config.yaml:cloud-config -a script.sh:x-shellscript > user-data \u90e8\u7f72 \u00b6 \u90e8\u7f72\u6587\u4ef6\u5f62\u5f0f \u00b6 \u901a\u8fc7 .cfg \u6587\u4ef6: \u5728\u865a\u62df\u673a /etc/cloud/cloud.cfg.d/ \u4e0b\u6709\u591a\u4e2a .cfg \u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u8fd9\u4e9b ci \u914d\u7f6e\u6587\u4ef6\u5c06\u6309\u7167\u5b57\u6bcd\u987a\u5e8f\u6267\u884c\uff0c\u540e\u9762\u7684 cfg \u6587\u4ef6\u4f1a\u8986\u76d6\u524d\u9762\u7684 cfg \u6587\u4ef6\u4e2d\u76f8\u540c\u7684\u914d\u7f6e\u3002 \u901a\u8fc7\u6d4b\u8bd5\uff0c\u65b0\u5efa\u4e00\u4e2a cfg \u6587\u4ef6\uff0c\u4f7f\u7528\u6a21\u5757 bootcmd\uff0c\u5728\u6b64\u6a21\u5757\u4e0b\u7f16\u5199\u7684\u811a\u672c\u7a0b\u5e8f\u5c06\u4f1a\u88ab\u6267\u884c\uff0c\u4f8b\u5982\u65b0\u5efa\u6587\u4ef6 /etc/cloud/cloud.cfg.d/test.cfg \uff0c\u5199\u5165\u5185\u5bb9 bootcmd : - [ sh , -xc , \"echo 'hello world' >> testfile\" ] \u5c31\u5c06\u4f1a\u5728\u5f53\u524d .cfg \u6587\u4ef6\u76ee\u5f55\u4e0b\u5efa\u7acb\u4e00\u4e2a\u5185\u5bb9\u4e3a \"hello world\" \u7684\u540d\u4e3a testfile \u7684\u6587\u4ef6\u3002 \u865a\u62df\u673a\u6bcf\u6b21\u542f\u52a8\u90fd\u4f1a\u6267\u884c bootcmd \u5176\u540e\u7684\u547d\u4ee4\uff0c\u901a\u8fc7\u5c06\u914d\u7f6e\u8fc7\u7a0b\u5199\u6210\u811a\u672c\u7684\u5f62\u5f0f\u518d\u4f5c\u4e3a bootcmd \u7684\u53c2\u6570\u5199\u5165 .cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u865a\u62df\u673a\u4fbf\u80fd\u591f\u5b8c\u6210\u914d\u7f6e\u4efb\u52a1\u3002 \u6b64\u5916\uff0cbootcmd \u662f\u6bcf\u6b21\u865a\u62df\u673a\u542f\u52a8\u90fd\u4f1a\u6267\u884c\uff0c\u5982\u679c\u9700\u8981\u865a\u62df\u673a\u53ea\u6267\u884c\u4e00\u6b21\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u7528 runcmd \u9009\u9879\u3002 \u901a\u8fc7 userdata script \u6587\u4ef6: \u6b64\u5916\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06\u914d\u7f6e\u8fc7\u7a0b\u4ee5\u811a\u672c\u7684\u5f62\u5f0f\u5448\u73b0\uff0c\u5c06\u5176\u5b58\u50a8\u5728 /var/lib/cloud/scripts/ \u4e0b\uff0c\u865a\u62df\u673a\u6bcf\u6b21\u542f\u52a8\u90fd\u4f1a\u6267\u884c\u6b64\u811a\u672c\u4e2d\u7684\u547d\u4ee4\u3002 \u90e8\u7f72\u65b9\u5f0f \u00b6 \u865a\u62df\u673a\u672c\u5730 \u5c06 .cfg \u548c script \u6587\u4ef6\u5b58\u50a8\u5728\u76f8\u5e94\u76ee\u5f55\u4e0b\uff0c\u7531\u865a\u62df\u673a\u5728\u542f\u52a8\u7684\u65f6\u5019\u8bfb\u53d6\u5e76\u6267\u884c\u914d\u7f6e\u8fc7\u7a0b qm \u547d\u4ee4\u4ece\u6570\u636e\u4e2d\u5fc3\u7684\u547d\u4ee4\u884c\uff08\u672a\u5b9e\u73b0\uff09 \u4ece\u6570\u636e\u4e2d\u5fc3\u7684\u7ec8\u7aef\u4e0a\u6267\u884c\u547d\u4ee4\u8fdb\u884c\u90e8\u7f72 # \u683c\u5f0f qm set <vmid> --cicustom \"user=<volume>\" # \u793a\u4f8b qm set 101 --cicustom \"user=local:snippets/userconfig.yaml\" \u5176\u4ed6\u95ee\u9898 \u00b6 \u4fee\u590d\u62a5\u9519: \u9519\u8bef\u8868\u73b0\u5982\u4e0b perl: warning: Setting locale failed. perl: warning: Please check that your locale settings: LANGUAGE = ( unset ) , LC_ALL = ( unset ) , LC_ADDRESS = \"zh_CN.UTF-8\" , ..... are supported and installed on your system. perl: warning: Falling back to a fallback locale ( \"en_US.UTF-8\" ) . \u89e3\u51b3\u65b9\u6cd5\uff1a\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf LC_ALL=C \u6216 LC_ALL=C.UTF-8","title":"cloud-init \u914d\u7f6e"},{"location":"kvm/cloud-init/#cloud-init","text":"","title":"\u865a\u62df\u673a cloud-init \u914d\u7f6e\u548c\u4f7f\u7528"},{"location":"kvm/cloud-init/#cloud-init_1","text":"","title":"\u914d\u7f6e\u5e26\u6709 cloud-init \u7684\u955c\u50cf"},{"location":"kvm/cloud-init/#cloud-init_2","text":"\u4ece\u672c\u5730\u9009\u62e9 iso \u521b\u5efa\u865a\u62df\u673a\uff0c\u88c5\u597d\u7cfb\u7edf\u540e\u8fdb\u5165\u865a\u62df\u673a\uff0c\u5b89\u88c5 cloud-init\u3002\u5982\u679c\u5728\u88c5\u7cfb\u7edf\u65f6\u6ca1\u6709\u6362\u6e90\uff0c\u5c31\u5148\u6362\u6e90\u3002 sudo apt install cloud-init # Ubuntu sudo yum install cloud-init # CentOS cloud-init \u7684\u914d\u7f6e\u4fe1\u606f\u5728\u6587\u4ef6 /etc/cloud/cloud.cfg.d/*.cfg \u548c /etc/cloud/cloud.cfg \u4e2d\u3002cloud-init \u4ee5\u5b57\u6bcd\u987a\u5e8f\u8bfb\u53d6\u6240\u6709\u7684 *.cfg \u6587\u4ef6\uff0c\u76f8\u540c\u53c2\u6570\u540e\u9762\u7684\u6587\u4ef6\u4f1a\u8986\u76d6\u524d\u9762\u7684\u6587\u4ef6\u3002 \u5728 cloud.cfg \u6587\u4ef6\u4e2d\uff0c\u4efb\u52a1\u4ee5 module \u5f62\u5f0f\u7ec4\u7ec7. \u4f8b\u5982\u6307\u5b9a set_hostname \u7684 moudle \u65f6\uff0ccloud-init \u4f1a\u6267\u884c hostname \u4efb\u52a1\uff0c\u5177\u4f53\u7684\u914d\u7f6e\u53c2\u6570\u7531 metadata \u6307\u5b9a\u3002 \u6211\u4eec\u9700\u8981\u5728\u6b64\u6587\u4ef6\u4e2d\u5220\u9664\u4e0d\u9700\u8981\u7684\u6a21\u5757, \u4f8b\u5982 disable-ec2-metadata \u548c byobu \u7b49\u3002 cloud_config_modules : - snap - snap_config - ubuntu-advantage - disable-ec2-metadata - byobu cloud_final_modules : - snappy - fan - landscape - lxd - puppet - chef - mcollective - salt-minion - rightscale_userdata cloud-init \u7684\u6570\u636e\u6587\u4ef6\u653e\u5728 /var/lib/cloud/data \u4e2d\uff0c \u65e5\u5fd7\u6587\u4ef6\u653e\u5728 /var/log/cloud-init-output.log (\u6bcf\u9636\u6bb5\u8f93\u51fa)\uff0c /var/log/cloud-init.log (\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u66f4\u8be6\u7ec6\u7684\u8c03\u8bd5\u65e5\u5fd7)\uff0c /run/cloud-init \u51b3\u5b9a\u5f00\u542f\u548c\u5173\u95ed\u81ea\u8eab\u7684\u67d0\u4e9b\u529f\u80fd\u3002","title":"\u521b\u5efa\u865a\u62df\u673a\uff0c\u5e76\u5b89\u88c5 cloud-init"},{"location":"kvm/cloud-init/#machine-id","text":"","title":"\u89e3\u51b3\u4ece\u540c\u4e00\u6a21\u677f\u4e2d\u521b\u5efa\u7684\u865a\u62df\u673a\u6709\u76f8\u540c\u7684 machine-id \u95ee\u9898"},{"location":"kvm/cloud-init/#1","text":"Proxmox \u4f1a\u5bf9\u521b\u5efa\u7684\u65b0\u865a\u62df\u673a\u81ea\u52a8\u5206\u914d\u4e0d\u540c\u7684 MAC \u5730\u5740\u3002 \u4f46\u662f\u5bf9\u4e8e Ubuntu\uff0c\u4ece\u7edf\u4e00\u6a21\u677f\u4e2d\u521b\u5efa\u7684\u865a\u62df\u673a\u6709\u548c\u6a21\u677f\u76f8\u540c\u7684 machine-id\uff0c\u865a\u62df\u673a\u4f7f\u7528\u6b64 machine-id \u6765\u83b7\u53d6 DHCP \u7684 lease\uff0c\u4ece\u5bfc\u81f4\u591a\u4e2a\u865a\u62df\u673a\u7ade\u4e89\u540c\u4e00\u4e2a IP \u5730\u5740\u3002 \u89e3\u51b3\u6b64\u95ee\u9898\u7684\u65b9\u6cd5\u662f\u6587\u4ef6 /etc/machine-id \u5220\u9664\uff0c\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u540c\u540d\u7a7a\u767d\u6587\u4ef6 sudo rm /etc/machine-id sudo touch /etc/machine-id \u4e4b\u540e\uff0c\u8f6c\u5230\u6587\u4ef6 /var/lib/dbus/machine-id \uff0c\u6b64\u6587\u4ef6\u4f1a\u5728\u6bcf\u6b21\u865a\u62df\u673a\u91cd\u542f\u4e4b\u540e\u5c06 machine-id \u590d\u5236\u5230 /etc/machine-id \u4e2d\u3002 \u6240\u4ee5\u5c06\u6b64\u6587\u4ef6\u5220\u9664\uff0c\u521b\u5efa\u4e00\u4e2a /etc/machine-id \u7684\u7b26\u53f7\u94fe\u63a5\u5230\u6b64\u5904\u3002 sudo rm /var/lib/dbus/machine-id sudo ln -s /etc/machine-id /var/lib/dbus/machine-id \u7136\u540e\u5c06\u6b64\u865a\u62df\u673a\u5173\u673a\uff08\u4e0d\u662f\u91cd\u542f\uff0c\u5426\u5219\u4f1a\u751f\u6210\u65b0\u7684 machine-id\uff09\uff0c\u5236\u4f5c\u4e3a\u6a21\u677f\u3002","title":"\u65b9\u6cd5 1"},{"location":"kvm/cloud-init/#2","text":"\u4fee\u6539 DHCP \u7684 identifier\uff0c /etc/netplan/ \u4e0b\u6587\u4ef6\uff0c\u5728 network \u4e0b\u7684 ethernets \u4e0b\u7684\u6761\u76ee\u589e\u52a0 dhcp-identifier: mac \uff0c\u5373\u53ef\u4f7f\u7528 MAC \u4f5c\u4e3a DHCP \u5206\u914d IP \u7684\u552f\u4e00\u6807\u5fd7\u3002 \u4f46 SSH \u4e5f\u4f7f\u7528 machine-id\uff0c\u6240\u4ee5\u6b64\u65b9\u6cd5\u53ea\u89e3\u51b3\u4e86 ip \u7684\u95ee\u9898\u3002","title":"\u65b9\u6cd5 2"},{"location":"kvm/cloud-init/#_1","text":"\u5b89\u88c5 net-tools, openssh-server \u7b49\u5de5\u5177","title":"\u5b89\u88c5\u5fc5\u8981\u8f6f\u4ef6\u5305"},{"location":"kvm/cloud-init/#username-password-proxmox-web-username-password","text":"\u5b8c\u6210\u4e0a\u9762\u7684\u5de5\u4f5c\u540e\u5c06\u865a\u62df\u673a\u5173\u673a\uff0c\u5728 proxmox web \u754c\u9762 hardware \u680f\u4e2d add cloudinit Drive\uff0c\u7136\u540e\u5728 Cloud-init \u680f\u4e2d\u8bbe\u7f6e\u7528\u6237\u540d\u548c\u5bc6\u7801\uff08\u5fc5\u987b\u8bbe\u7f6e\uff0c\u5426\u5219\u65e0\u6cd5\u8fdb\u5165\u7531\u6b64\u6a21\u677f\u521b\u5efa\u7684\u865a\u62df\u673a\uff09\u3002","title":"\u8bbe\u7f6e username \u548c password (\u5931\u8d25\uff0c\u65e0\u6cd5\u4f7f\u7528\u5728 proxmox web \u9875\u9762\u4e0a\u8bbe\u7f6e\u7684 username \u548c password \u767b\u5f55\u865a\u62df\u673a)"},{"location":"kvm/cloud-init/#cloud-init_3","text":"","title":"cloud-init \u7b80\u4ecb\u548c\u914d\u7f6e\u89e3\u91ca"},{"location":"kvm/cloud-init/#_2","text":"cloud-init.cfg \u6587\u4ef6\u4e2d\u6709\u4e94\u4e2a stage\uff0ccloud-init \u5206\u4e3a\u4e94\u4e2a\u9636\u6bb5\u8fdb\u884c\uff0c\u5177\u4f53\u4ee5\u670d\u52a1\u7684\u5f62\u5f0f\u6ce8\u518c\u5230\u7cfb\u7edf\u4e2d\u6309\u5982\u4e0b\u6b21\u5e8f\u6267\u884c\uff1a generator \u6b64\u9636\u6bb5\u68c0\u6d4b ci \u662f\u5426\u88ab\u7981\u7528 local:cloud-init-local.service \u5f53/\u6302\u8f7d\u65f6\u6267\u884c\uff0c\u6b64\u9636\u6bb5\u7684\u4efb\u52a1\u4e3b\u8981\u662f\u5b9a\u4f4d\u672c\u5730\u6570\u636e\uff0c\u5c06\u7f51\u7edc\u914d\u7f6e\u5e94\u7528\u5230\u672c\u5730\u3002 \u9700\u8981\u5c06\u7f51\u7edc block \u6b64\u9636\u6bb5\u6ca1\u6709\u7528\u5230\u7684\u6a21\u5757 network:cloud-init.service \u5904\u7406\u6240\u6709\u7684 user-data, \u5305\u62ec\u4efb\u4f55 #include or #include-once , \u89e3\u538b\u7f29\u6240\u6709\u538b\u7f29\u6587\u4ef6, \u8fd0\u884c\u6240\u6709\u7684 part-handler config:cloud.config.service \u6b64\u9636\u6bb5\u4ec5\u8fd0\u884c config module, \u5176\u4ed6\u9636\u6bb5\u4e0d\u8d77\u4f5c\u7528\u7684\u6a21\u5757\u90fd\u5728\u8fd9\u4e2a\u9636\u6bb5\u8fd0\u884c final:cloud-final.service \u6b64\u9636\u6bb5\u8fd0\u884c\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u9700\u8981\u5728\u767b\u5f55\u7cfb\u7edf\u540e\u6267\u884c\u7684\u811a\u672c\u5728\u6b64\u5904\u8fd0\u884c\u3002 \u6bcf\u4e2a\u9636\u6bb5\u4e2d\u6267\u884c\u7684\u4efb\u52a1\u4ee5\u6a21\u5757\u7684\u5f62\u5f0f\u5b9a\u4e49, \u6a21\u5757\u6267\u884c\u7684\u5177\u4f53\u4efb\u52a1\u7531 metadata \u51b3\u5b9a","title":"\u9636\u6bb5"},{"location":"kvm/cloud-init/#user-data","text":"cloud-init \u901a\u8fc7\u547d\u4ee4\u884c --cicustom \u5c06\u7528\u6237\u81ea\u5b9a\u4e49\u7684 config \u6587\u4ef6\u8fdb\u884c\u914d\u7f6e # Syntax qm set <vid> --cicustom \"user=<volume>, network=<volume>, meta=<volume>\" # Example qm set 9000 --cicustom \"user=local:snippets/userconfig.yaml\" cicustom \u6587\u4ef6\u9700\u8981\u5728\u652f\u6301 snippets \u5e76\u4e14\u6240\u6709\u7684 VM \u90fd\u80fd access \u7684\u8282\u70b9\u4e0a\u3002 \u521b\u5efa\u4e00\u4e2a snippets: \u5728 proxmox \u7684 web \u754c\u9762\u4e0a\u7684 datacenter \u4e2d\u70b9\u51fb\u5b58\u50a8 - add-directory, \u8bbe\u7f6e id, \u9009\u62e9\u76ee\u5f55 content \u9009\u62e9 snippets, node \u9009 ALL (No restrictions)\u3002","title":"User-Data"},{"location":"kvm/cloud-init/#volumes","text":"local \u9ed8\u8ba4\u4f4d\u7f6e\u4e3a /var/lib/vz \uff08\u5b9a\u4e49\u5728\u914d\u7f6e\u6587\u4ef6 /etc/pve/storage.cfg \u4e2d\uff09 cloudinit \u65e5\u5fd7\u6587\u4ef6\u5728 /var/log/cloud-init-ouput.log \u4e2d","title":"\u5173\u4e8e volumes"},{"location":"kvm/cloud-init/#user-data_1","text":"","title":"User-Data \u683c\u5f0f"},{"location":"kvm/cloud-init/#user-data-script","text":"\u901a\u5e38\u7528\u4e8e\u4ec5\u9700\u8981\u6267\u884c\u4e00\u4e2a shell \u811a\u672c\u7684\u65f6\u5019 \u683c\u5f0f\uff1a\u4ee5 #! \u5f00\u59cb\u6216\u8005\u5f53\u4f7f\u7528 MIME \u5f52\u6863\u65f6\u4ee5 Content-Type: text/x-shellscript \u5f00\u59cb \u793a\u4f8b #!/bin/sh echo \"Hello World. The time is now $( date -R ) !\" | tee /root/output.txt \u5728\u865a\u62df\u673a\u7684 /var/lib/cloud/scripts \u76ee\u5f55\u4e0b\u5b58\u653e\u8981\u6267\u884c\u7684\u811a\u672c\u6587\u4ef6\u3002","title":"User-Data Script"},{"location":"kvm/cloud-init/#cloud-config-data","text":"\u5fc5\u987b\u662f\u5408\u6cd5\u7684 yaml \u683c\u5f0f local \u76ee\u5f55\u5728 /var/lib/vz \u4e0b\uff08\u5728 /etc/pve/storage.cfg \u4e2d\u914d\u7f6e\uff09 \u683c\u5f0f: \u4ee5 #cloud-config \u5f00\u59cb\u6216\u8005\u5f53\u4f7f\u7528 MIME \u65f6\u4ee5 Content-Type: text/cloud-config \u5f00\u59cb \u5404 module \u5bf9\u5e94\u4e0b config data \u683c\u5f0f\u53ca\u529f\u80fd\u8bf4\u660e\uff1a https://cloudinit.readthedocs.io/en/latest/topics/modules.html \u793a\u4f8b bootcmd : - echo 192.168.1.130 us.archive.com > /etc/hosts - [ cloud-init-per , one , mymkfs , mkfs , /dev/vdb ]","title":"Cloud Config Data"},{"location":"kvm/cloud-init/#config","text":"\u914d\u7f6e\u5b9e\u4f8b\u7684 SSH key\uff1a https://cloudinit.readthedocs.io/en/latest/topics/modules.html#ssh \u6269\u5bb9\uff1a https://cloudinit.readthedocs.io/en/latest/topics/modules.html#growpart","title":"config \u793a\u4f8b:"},{"location":"kvm/cloud-init/#kernel-command-line","text":"\u4f7f\u7528 NoCloud \u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u5c06\u7528\u6237\u6570\u636e\u901a\u8fc7\u5185\u6838\u547d\u4ee4\u884c\u53c2\u6570\u4f20\u9012\u3002","title":"Kernel Command Line"},{"location":"kvm/cloud-init/#_3","text":"\u5176\u4ed6\u683c\u5f0f\u8fd8\u6709 include, upstart job, cloud boothook, part handler \u7b49 ci \u6709\u4e00\u4e2a\u811a\u672c make-mime.py \u53ef\u4ee5\u5c06\u4e0d\u540c\u7c7b\u578b\u7684\u7528\u6237\u6570\u636e\u7efc\u5408\u5728\u4e00\u8d77\uff0c\u4f8b\u5982\u5c06 cloud-config \u7c7b\u578b\u7684 config.yaml \u548c x-shellscript \u7c7b\u578b\u7684 script.sh \u7ec4\u5408\u5728\u4e00\u8d77\u5f62\u6210 user-data \u6570\u636e: ./tools/make-mime.py -a config.yaml:cloud-config -a script.sh:x-shellscript > user-data","title":"\u5176\u4ed6"},{"location":"kvm/cloud-init/#_4","text":"","title":"\u90e8\u7f72"},{"location":"kvm/cloud-init/#_5","text":"\u901a\u8fc7 .cfg \u6587\u4ef6: \u5728\u865a\u62df\u673a /etc/cloud/cloud.cfg.d/ \u4e0b\u6709\u591a\u4e2a .cfg \u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u8fd9\u4e9b ci \u914d\u7f6e\u6587\u4ef6\u5c06\u6309\u7167\u5b57\u6bcd\u987a\u5e8f\u6267\u884c\uff0c\u540e\u9762\u7684 cfg \u6587\u4ef6\u4f1a\u8986\u76d6\u524d\u9762\u7684 cfg \u6587\u4ef6\u4e2d\u76f8\u540c\u7684\u914d\u7f6e\u3002 \u901a\u8fc7\u6d4b\u8bd5\uff0c\u65b0\u5efa\u4e00\u4e2a cfg \u6587\u4ef6\uff0c\u4f7f\u7528\u6a21\u5757 bootcmd\uff0c\u5728\u6b64\u6a21\u5757\u4e0b\u7f16\u5199\u7684\u811a\u672c\u7a0b\u5e8f\u5c06\u4f1a\u88ab\u6267\u884c\uff0c\u4f8b\u5982\u65b0\u5efa\u6587\u4ef6 /etc/cloud/cloud.cfg.d/test.cfg \uff0c\u5199\u5165\u5185\u5bb9 bootcmd : - [ sh , -xc , \"echo 'hello world' >> testfile\" ] \u5c31\u5c06\u4f1a\u5728\u5f53\u524d .cfg \u6587\u4ef6\u76ee\u5f55\u4e0b\u5efa\u7acb\u4e00\u4e2a\u5185\u5bb9\u4e3a \"hello world\" \u7684\u540d\u4e3a testfile \u7684\u6587\u4ef6\u3002 \u865a\u62df\u673a\u6bcf\u6b21\u542f\u52a8\u90fd\u4f1a\u6267\u884c bootcmd \u5176\u540e\u7684\u547d\u4ee4\uff0c\u901a\u8fc7\u5c06\u914d\u7f6e\u8fc7\u7a0b\u5199\u6210\u811a\u672c\u7684\u5f62\u5f0f\u518d\u4f5c\u4e3a bootcmd \u7684\u53c2\u6570\u5199\u5165 .cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u865a\u62df\u673a\u4fbf\u80fd\u591f\u5b8c\u6210\u914d\u7f6e\u4efb\u52a1\u3002 \u6b64\u5916\uff0cbootcmd \u662f\u6bcf\u6b21\u865a\u62df\u673a\u542f\u52a8\u90fd\u4f1a\u6267\u884c\uff0c\u5982\u679c\u9700\u8981\u865a\u62df\u673a\u53ea\u6267\u884c\u4e00\u6b21\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u7528 runcmd \u9009\u9879\u3002 \u901a\u8fc7 userdata script \u6587\u4ef6: \u6b64\u5916\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06\u914d\u7f6e\u8fc7\u7a0b\u4ee5\u811a\u672c\u7684\u5f62\u5f0f\u5448\u73b0\uff0c\u5c06\u5176\u5b58\u50a8\u5728 /var/lib/cloud/scripts/ \u4e0b\uff0c\u865a\u62df\u673a\u6bcf\u6b21\u542f\u52a8\u90fd\u4f1a\u6267\u884c\u6b64\u811a\u672c\u4e2d\u7684\u547d\u4ee4\u3002","title":"\u90e8\u7f72\u6587\u4ef6\u5f62\u5f0f"},{"location":"kvm/cloud-init/#_6","text":"\u865a\u62df\u673a\u672c\u5730 \u5c06 .cfg \u548c script \u6587\u4ef6\u5b58\u50a8\u5728\u76f8\u5e94\u76ee\u5f55\u4e0b\uff0c\u7531\u865a\u62df\u673a\u5728\u542f\u52a8\u7684\u65f6\u5019\u8bfb\u53d6\u5e76\u6267\u884c\u914d\u7f6e\u8fc7\u7a0b qm \u547d\u4ee4\u4ece\u6570\u636e\u4e2d\u5fc3\u7684\u547d\u4ee4\u884c\uff08\u672a\u5b9e\u73b0\uff09 \u4ece\u6570\u636e\u4e2d\u5fc3\u7684\u7ec8\u7aef\u4e0a\u6267\u884c\u547d\u4ee4\u8fdb\u884c\u90e8\u7f72 # \u683c\u5f0f qm set <vmid> --cicustom \"user=<volume>\" # \u793a\u4f8b qm set 101 --cicustom \"user=local:snippets/userconfig.yaml\"","title":"\u90e8\u7f72\u65b9\u5f0f"},{"location":"kvm/cloud-init/#_7","text":"\u4fee\u590d\u62a5\u9519: \u9519\u8bef\u8868\u73b0\u5982\u4e0b perl: warning: Setting locale failed. perl: warning: Please check that your locale settings: LANGUAGE = ( unset ) , LC_ALL = ( unset ) , LC_ADDRESS = \"zh_CN.UTF-8\" , ..... are supported and installed on your system. perl: warning: Falling back to a fallback locale ( \"en_US.UTF-8\" ) . \u89e3\u51b3\u65b9\u6cd5\uff1a\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf LC_ALL=C \u6216 LC_ALL=C.UTF-8","title":"\u5176\u4ed6\u95ee\u9898"},{"location":"networking/","text":"\u7f51\u7edc\u914d\u7f6e \u00b6 \u4e0e\u672c\u4ee3 Vlab \u96c6\u7fa4\u76f8\u5173\u7684\u7f51\u7edc\u6709\u4e09\u4e2a\uff0c\u4e0b\u9762\u5206\u522b\u4ecb\u7ecd\u3002 \u6821\u56ed\u7f51 \u00b6 \u6240\u6709\u673a\u5668\u90fd\u5728\u7535\u4e09\u697c 524 \u673a\u623f\uff0c\u901a\u8fc7\u94dc\u7ebf\u76f4\u63a5\u63a5\u5165\u7535\u4e09\u697c\u7684 VLAN\uff0c\u8be5 VLAN \u6709\u4e09\u4e2a\u516c\u7f51 IP \u5730\u5740\u6bb5 202.38.75.254/24, 202.38.79.254/24, 202.38.86.254/24\uff0c\u53e6\u6709\u4e00\u4e2a\u4ec5\u6821\u56ed\u7f51\u7684\u5730\u5740\u6bb5 10.38.79.254/24\uff0c\u76ee\u524d\u90e8\u7f72\u4e86\u6240\u6709\u4e3b\u673a\u7684 IPMI \u754c\u9762\u3002 \u9664 pv8 \u5916\u6240\u6709\u673a\u5668\u7684\u56db\u4e2a\u7f51\u53e3\u505a\u4e00\u4e2a bond\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a bond \u6865\u63a5\uff0c\u7cfb\u7edf\u4e2d\u663e\u793a\u7684\u754c\u9762\u540d\u79f0\u4e3a vmbr0 \u3002\u65b9\u4fbf\u8d77\u89c1\u6240\u6709\u4e3b\u673a\u7684\u6821\u56ed\u7f51 IP \u90fd\u4ece 202.38.75.0/24 \u7f51\u6bb5\u4e2d\u53d6\uff0c\u8bb0\u5f55\u5728\u57df\u540d pv#.vlab.ibugone.net \u4e2d\u3002 pv8 \u7684 eno4 \u63a5\u5728\u5149\u4ea4\u6362\u673a\u7684\u7ba1\u7406\u7aef\u53e3\u4e0a\uff0c\u56e0\u6b64 pv8 \u53ea\u6709\u4e09\u4e2a\u7f51\u53e3\u505a bond\u3002 \u5149\u7ea4\u5185\u7f51 \u00b6 \u5149\u7ea4\u754c\u9762\u4e3a ens1f0 \u548c ens1f1 \uff0c\u901a\u8fc7\u4e00\u4e2a\u534e\u4e3a\u5149\u4ea4\u6362\u673a\u4e92\u8054\uff0c\u56e0\u6b64\u53ea\u6709\u670d\u52a1\u5668\u96c6\u7fa4\u5185\u90e8\u8fde\u901a\uff0c\u7531\u4e8e\u6bcf\u53f0\u8ba1\u7b97\u670d\u52a1\u5668\u5404\u81ea\u63a5\u5165\u6821\u56ed\u7f51\uff0c\u6240\u4ee5\u5149\u7ea4\u5185\u7f51\u53ea\u7528\u4e8e\u4e92\u8054\uff08\u5305\u62ec\u8fde\u63a5 iSCSI\uff09\uff0c\u4e0d\u7528\u4e8e\u8f6c\u53d1\u3002 IP \u5206\u914d\u60c5\u51b5\u89c1 IP \u5730\u5740\u5217\u8868 \u3002 \u8fd0\u884c\u5728\u8fd9\u4e2a\u7f51\u7edc\u4e0a\u7684\u8bbe\u65bd\u6709 iSCSI \u548c NFS\uff08\u7528\u4e8e\u5171\u4eab\u5bb9\u5668\u955c\u50cf\uff0cLVM \u5e26\u9501\u4e0d\u80fd\u76f4\u63a5\u591a\u673a\u540c\u65f6\u6302\u8f7d\uff09\u3002 \u5bb9\u5668\u5185\u7f51 \u00b6 \u5bb9\u5668\u4e4b\u95f4\u7684\u8fde\u63a5\u57fa\u4e8e\u8fd0\u884c\u5728\u5149\u7ea4\u4e4b\u4e0a\u7684 overlay \u7f51\u7edc\uff0coverlay \u5b9e\u73b0\u91c7\u7528 VXLAN\uff0cIP \u5730\u5740\u6bb5\u6682\u5b9a\u4e3a 172.31.0.0/16\uff0c\u5728\u4e3b\u673a\u4e0a\u7684\u63a5\u53e3\u4e3a vmbr1\u3002\u66f4\u591a\u4fe1\u606f\u53c2\u89c1 \u5bb9\u5668\u5185\u7f51 \u4e00\u9875\u3002 \u5b66\u751f\u673a\u7f51\u7edc \u00b6 CT100 \u4e3a\u7f51\u5173\uff0c\u5c06\u6240\u6709\u5b66\u751f\u673a\u7684\u4e0a\u884c\u6d41\u91cf NAT \u540e\u8fde\u63a5\u5230\u6821\u56ed\u7f51\uff0c\u8be6\u89c1 CT100 \u5bb9\u5668\u7684\u6587\u6863 \u3002 CT101 \u4e3a web \u670d\u52a1\u5668\uff0c\u63d0\u4f9b web \u754c\u9762\uff08Nginx, Django\uff09\u548c VNC \u7edf\u4e00\u63a5\u5165\uff08\u7a0b\u5e8f\u5728 pdlan \u7684\u4e00\u4e2a\u79c1\u6709\u4ed3\u5e93\u4e2d\uff0c\u7531\u4e8e\u6f5c\u5728\u7684\u7248\u6743\u95ee\u9898\u4e0d\u80fd\u516c\u5f00\uff09\u3002\u5177\u4f53\u5185\u5bb9\u8be6\u89c1 CT101 \u5bb9\u5668\u7684\u6587\u6863 \u3002","title":"\u7f51\u7edc\u754c\u9762"},{"location":"networking/#_1","text":"\u4e0e\u672c\u4ee3 Vlab \u96c6\u7fa4\u76f8\u5173\u7684\u7f51\u7edc\u6709\u4e09\u4e2a\uff0c\u4e0b\u9762\u5206\u522b\u4ecb\u7ecd\u3002","title":"\u7f51\u7edc\u914d\u7f6e"},{"location":"networking/#ustcnet","text":"\u6240\u6709\u673a\u5668\u90fd\u5728\u7535\u4e09\u697c 524 \u673a\u623f\uff0c\u901a\u8fc7\u94dc\u7ebf\u76f4\u63a5\u63a5\u5165\u7535\u4e09\u697c\u7684 VLAN\uff0c\u8be5 VLAN \u6709\u4e09\u4e2a\u516c\u7f51 IP \u5730\u5740\u6bb5 202.38.75.254/24, 202.38.79.254/24, 202.38.86.254/24\uff0c\u53e6\u6709\u4e00\u4e2a\u4ec5\u6821\u56ed\u7f51\u7684\u5730\u5740\u6bb5 10.38.79.254/24\uff0c\u76ee\u524d\u90e8\u7f72\u4e86\u6240\u6709\u4e3b\u673a\u7684 IPMI \u754c\u9762\u3002 \u9664 pv8 \u5916\u6240\u6709\u673a\u5668\u7684\u56db\u4e2a\u7f51\u53e3\u505a\u4e00\u4e2a bond\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a bond \u6865\u63a5\uff0c\u7cfb\u7edf\u4e2d\u663e\u793a\u7684\u754c\u9762\u540d\u79f0\u4e3a vmbr0 \u3002\u65b9\u4fbf\u8d77\u89c1\u6240\u6709\u4e3b\u673a\u7684\u6821\u56ed\u7f51 IP \u90fd\u4ece 202.38.75.0/24 \u7f51\u6bb5\u4e2d\u53d6\uff0c\u8bb0\u5f55\u5728\u57df\u540d pv#.vlab.ibugone.net \u4e2d\u3002 pv8 \u7684 eno4 \u63a5\u5728\u5149\u4ea4\u6362\u673a\u7684\u7ba1\u7406\u7aef\u53e3\u4e0a\uff0c\u56e0\u6b64 pv8 \u53ea\u6709\u4e09\u4e2a\u7f51\u53e3\u505a bond\u3002","title":"\u6821\u56ed\u7f51"},{"location":"networking/#fibre-intranet","text":"\u5149\u7ea4\u754c\u9762\u4e3a ens1f0 \u548c ens1f1 \uff0c\u901a\u8fc7\u4e00\u4e2a\u534e\u4e3a\u5149\u4ea4\u6362\u673a\u4e92\u8054\uff0c\u56e0\u6b64\u53ea\u6709\u670d\u52a1\u5668\u96c6\u7fa4\u5185\u90e8\u8fde\u901a\uff0c\u7531\u4e8e\u6bcf\u53f0\u8ba1\u7b97\u670d\u52a1\u5668\u5404\u81ea\u63a5\u5165\u6821\u56ed\u7f51\uff0c\u6240\u4ee5\u5149\u7ea4\u5185\u7f51\u53ea\u7528\u4e8e\u4e92\u8054\uff08\u5305\u62ec\u8fde\u63a5 iSCSI\uff09\uff0c\u4e0d\u7528\u4e8e\u8f6c\u53d1\u3002 IP \u5206\u914d\u60c5\u51b5\u89c1 IP \u5730\u5740\u5217\u8868 \u3002 \u8fd0\u884c\u5728\u8fd9\u4e2a\u7f51\u7edc\u4e0a\u7684\u8bbe\u65bd\u6709 iSCSI \u548c NFS\uff08\u7528\u4e8e\u5171\u4eab\u5bb9\u5668\u955c\u50cf\uff0cLVM \u5e26\u9501\u4e0d\u80fd\u76f4\u63a5\u591a\u673a\u540c\u65f6\u6302\u8f7d\uff09\u3002","title":"\u5149\u7ea4\u5185\u7f51"},{"location":"networking/#overlay-intranet","text":"\u5bb9\u5668\u4e4b\u95f4\u7684\u8fde\u63a5\u57fa\u4e8e\u8fd0\u884c\u5728\u5149\u7ea4\u4e4b\u4e0a\u7684 overlay \u7f51\u7edc\uff0coverlay \u5b9e\u73b0\u91c7\u7528 VXLAN\uff0cIP \u5730\u5740\u6bb5\u6682\u5b9a\u4e3a 172.31.0.0/16\uff0c\u5728\u4e3b\u673a\u4e0a\u7684\u63a5\u53e3\u4e3a vmbr1\u3002\u66f4\u591a\u4fe1\u606f\u53c2\u89c1 \u5bb9\u5668\u5185\u7f51 \u4e00\u9875\u3002","title":"\u5bb9\u5668\u5185\u7f51"},{"location":"networking/#vm-network","text":"CT100 \u4e3a\u7f51\u5173\uff0c\u5c06\u6240\u6709\u5b66\u751f\u673a\u7684\u4e0a\u884c\u6d41\u91cf NAT \u540e\u8fde\u63a5\u5230\u6821\u56ed\u7f51\uff0c\u8be6\u89c1 CT100 \u5bb9\u5668\u7684\u6587\u6863 \u3002 CT101 \u4e3a web \u670d\u52a1\u5668\uff0c\u63d0\u4f9b web \u754c\u9762\uff08Nginx, Django\uff09\u548c VNC \u7edf\u4e00\u63a5\u5165\uff08\u7a0b\u5e8f\u5728 pdlan \u7684\u4e00\u4e2a\u79c1\u6709\u4ed3\u5e93\u4e2d\uff0c\u7531\u4e8e\u6f5c\u5728\u7684\u7248\u6743\u95ee\u9898\u4e0d\u80fd\u516c\u5f00\uff09\u3002\u5177\u4f53\u5185\u5bb9\u8be6\u89c1 CT101 \u5bb9\u5668\u7684\u6587\u6863 \u3002","title":"\u5b66\u751f\u673a\u7f51\u7edc"},{"location":"networking/firewall/","text":"\u670d\u52a1\u5668\u9632\u706b\u5899\u914d\u7f6e \u00b6 \u9632\u706b\u5899\u4f7f\u7528 Linux \u81ea\u5e26\u7684 iptables \u7ba1\u7406\uff0c\u9ed8\u8ba4\u7b56\u7565\u4e3a INPUT DROP , FORWARD ACCEPT , OUTPUT ACCEPT \u3002\u65b9\u4fbf\u8d77\u89c1\u4f7f\u7528 iptables-persistent \u8ba9\u9632\u706b\u5899\u89c4\u5219\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d\u3002 \u4ee5\u4e0b\u4e3a pv1 \u4e0a\u7684\u9632\u706b\u5899\u914d\u7f6e\uff08 /etc/iptables/rules.v4 \u548c rules.v6 \u6587\u4ef6\u5185\u5bb9\u4e00\u6837\uff09\uff1a pv1 \u7684\u989d\u5916\u914d\u7f6e pv1 \u9700\u8981\u4fee\u6539\u4ee5\u4e0b\u914d\u7f6e\uff0c\u989d\u5916\u653e\u884c 8090 \u7aef\u53e3\uff0c\u4ee5\u7528\u4e8e\u865a\u62df\u673a\u521b\u5efa\u65f6\u7684\u989d\u5916\u521d\u59cb\u5316\uff08post-creation-agent\uff09\u3002 *filter :INPUT ACCEPT [ 0 :0 ] :FORWARD ACCEPT [ 0 :0 ] :OUTPUT ACCEPT [ 0 :0 ] :VLAB - [ 0 :0 ] -A INPUT -i lo -j ACCEPT -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -A INPUT -p icmp -j ACCEPT -A INPUT -i vmbr+ -j VLAB -A INPUT -i ens1f0 -j ACCEPT -A INPUT -i ens1f1 -j ACCEPT -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -A FORWARD -i vmbr+ -j DROP -A VLAB -p tcp -m state --state NEW -m tcp --sport 1024 :65535 -m multiport --dports 22 ,80,443,8006 -j ACCEPT -A VLAB -j DROP COMMIT *nat :PREROUTING ACCEPT [ 0 :0 ] :INPUT ACCEPT [ 0 :0 ] :OUTPUT ACCEPT [ 0 :0 ] :POSTROUTING ACCEPT [ 0 :0 ] -A PREROUTING -m addrtype --dst-type LOCAL -p tcp --dport 443 -j REDIRECT --to-ports 8006 COMMIT \u90e8\u5206\u9632\u706b\u5899\u89c4\u5219\u89e3\u91ca \u00b6 -A INPUT -i lo -j ACCEPT -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT \u8fd9\u4e24\u4e2a\u653e\u6700\u524d\u9762\uff0c\u8ba9\u672c\u673a\u6d41\u91cf -i lo \u548c\u5df2\u7ecf\u5efa\u7acb\u8d77\u6765\u7684 TCP / UDP \u8fde\u63a5\u7ecf\u8fc7\u6700\u5c11\u7684\u94fe\u9879\uff0c\u63d0\u9ad8\u6027\u80fd\u964d\u4f4e CPU \u4f7f\u7528\u91cf\uff0c\u8fd9\u662f\u56e0\u4e3a iptables \u89c4\u5219\u662f\u6309\u987a\u5e8f\u9010\u6761\u5339\u914d\u7684\u3002 -I INPUT -i ens1f0 -j ACCEPT -I INPUT -i ens1f1 -j ACCEPT \u5149\u7ea4\u5185\u7f51\u4e0d\u8bbe\u9632\u3002","title":"\u9632\u706b\u5899\u4e0e\u5b89\u5168"},{"location":"networking/firewall/#_1","text":"\u9632\u706b\u5899\u4f7f\u7528 Linux \u81ea\u5e26\u7684 iptables \u7ba1\u7406\uff0c\u9ed8\u8ba4\u7b56\u7565\u4e3a INPUT DROP , FORWARD ACCEPT , OUTPUT ACCEPT \u3002\u65b9\u4fbf\u8d77\u89c1\u4f7f\u7528 iptables-persistent \u8ba9\u9632\u706b\u5899\u89c4\u5219\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d\u3002 \u4ee5\u4e0b\u4e3a pv1 \u4e0a\u7684\u9632\u706b\u5899\u914d\u7f6e\uff08 /etc/iptables/rules.v4 \u548c rules.v6 \u6587\u4ef6\u5185\u5bb9\u4e00\u6837\uff09\uff1a pv1 \u7684\u989d\u5916\u914d\u7f6e pv1 \u9700\u8981\u4fee\u6539\u4ee5\u4e0b\u914d\u7f6e\uff0c\u989d\u5916\u653e\u884c 8090 \u7aef\u53e3\uff0c\u4ee5\u7528\u4e8e\u865a\u62df\u673a\u521b\u5efa\u65f6\u7684\u989d\u5916\u521d\u59cb\u5316\uff08post-creation-agent\uff09\u3002 *filter :INPUT ACCEPT [ 0 :0 ] :FORWARD ACCEPT [ 0 :0 ] :OUTPUT ACCEPT [ 0 :0 ] :VLAB - [ 0 :0 ] -A INPUT -i lo -j ACCEPT -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -A INPUT -p icmp -j ACCEPT -A INPUT -i vmbr+ -j VLAB -A INPUT -i ens1f0 -j ACCEPT -A INPUT -i ens1f1 -j ACCEPT -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -A FORWARD -i vmbr+ -j DROP -A VLAB -p tcp -m state --state NEW -m tcp --sport 1024 :65535 -m multiport --dports 22 ,80,443,8006 -j ACCEPT -A VLAB -j DROP COMMIT *nat :PREROUTING ACCEPT [ 0 :0 ] :INPUT ACCEPT [ 0 :0 ] :OUTPUT ACCEPT [ 0 :0 ] :POSTROUTING ACCEPT [ 0 :0 ] -A PREROUTING -m addrtype --dst-type LOCAL -p tcp --dport 443 -j REDIRECT --to-ports 8006 COMMIT","title":"\u670d\u52a1\u5668\u9632\u706b\u5899\u914d\u7f6e"},{"location":"networking/firewall/#explanations","text":"-A INPUT -i lo -j ACCEPT -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT \u8fd9\u4e24\u4e2a\u653e\u6700\u524d\u9762\uff0c\u8ba9\u672c\u673a\u6d41\u91cf -i lo \u548c\u5df2\u7ecf\u5efa\u7acb\u8d77\u6765\u7684 TCP / UDP \u8fde\u63a5\u7ecf\u8fc7\u6700\u5c11\u7684\u94fe\u9879\uff0c\u63d0\u9ad8\u6027\u80fd\u964d\u4f4e CPU \u4f7f\u7528\u91cf\uff0c\u8fd9\u662f\u56e0\u4e3a iptables \u89c4\u5219\u662f\u6309\u987a\u5e8f\u9010\u6761\u5339\u914d\u7684\u3002 -I INPUT -i ens1f0 -j ACCEPT -I INPUT -i ens1f1 -j ACCEPT \u5149\u7ea4\u5185\u7f51\u4e0d\u8bbe\u9632\u3002","title":"\u90e8\u5206\u9632\u706b\u5899\u89c4\u5219\u89e3\u91ca"},{"location":"networking/host/","text":"\u4e3b\u673a\u7f51\u5361 \u00b6 Proxmox VE \u4e0d\u652f\u6301 ifupdown \u4ee5\u5916\u7684\u7f51\u7edc\u7ba1\u7406\u7cfb\u7edf\uff08PVE 7 \u5f00\u59cb\u9ed8\u8ba4\u4f7f\u7528 ifupdown2\uff09\uff0c\u5982 NetworkManager \u548c systemd-networkd \u7b49\uff0c\u56e0\u6b64\u7f51\u7edc\u914d\u7f6e\u53ea\u80fd\u4f7f\u7528 /etc/network/interfaces \u6587\u4ef6\u3002 \u53c2\u8003 pv2 \u4e0a\u914d\u7f6e\uff0c\u590d\u5236\u65f6\u6ce8\u610f\u66ff\u6362 IP \u5730\u5740\uff0c\u4ee5\u53ca pvg1 \u548c pvg2 \u7684\u5149\u7ea4\u7aef\u53e3\u4e3a ens4f0/ens4f1 \u3002 ifupdown auto lo iface lo inet loopback auto eno1 iface eno1 inet manual bond-master bond0 auto eno2 iface eno2 inet manual bond-master bond0 auto eno3 iface eno3 inet manual bond-master bond0 auto eno4 iface eno4 inet manual bond-master bond0 auto ens1f0 iface ens1f0 inet manual bond-master bond1 mtu 1550 auto ens1f1 iface ens1f1 inet manual bond-master bond1 mtu 1550 auto bond0 iface bond0 inet manual bond-mode balance-alb bond-miimon 100 bond-downdelay 200 bond-updelay 200 auto bond1 iface bond1 inet static address 10.0.0.12/24 bond-mode 802.3ad bond-miimon 100 bond-downdelay 200 bond-updelay 200 auto vmbr0 iface vmbr0 inet static address 202.38.75.97/24 gateway 202.38.75.254 dns-nameservers 202.38.64.1 bridge_ports bond0 bridge_stp off bridge_fd 0 iface vmbr0 inet6 static address 2001:da8:d800:75::a2/64 gateway 2001:da8:d800:75::1 # Overlay network for VMs auto vxlan0 iface vxlan0 inet manual pre-up ip link add vxlan0 type vxlan id 10 group 239.1.1.1 dstport 0 dev bond1 || true up ip link set vxlan0 up down ip link set vxlan0 down post-down ip link delete vxlan0 || true mtu 1500 auto vmbr1 iface vmbr1 inet static address 172.30.0.102/24 bridge_ports vxlan0 bridge_stp off bridge_fd 0 ifupdown2 auto lo iface lo inet loopback auto eno1 iface eno1 auto eno2 iface eno2 auto eno3 iface eno3 auto eno4 iface eno4 auto ens1f0 iface ens1f0 mtu 1550 auto ens1f1 iface ens1f1 mtu 1550 auto bond0 iface bond0 bond-slaves eno1 eno2 eno3 eno4 bond-mode balance-alb bond-miimon 100 bond-downdelay 200 bond-updelay 200 auto bond1 iface bond1 address 10.0.0.12/24 bond-slaves ens1f0 ens1f1 bond-mode 802.3ad bond-miimon 100 bond-downdelay 200 bond-updelay 200 auto vmbr0 iface vmbr0 address 202.38.75.97/24 gateway 202.38.75.254 dns-nameservers 202.38.64.1 bridge-ports bond0 bridge-stp off bridge-fd 0 iface vmbr0 inet6 static address 2001:da8:d800:75::a2/64 gateway 2001:da8:d800:75::1 # Overlay network for VMs auto vxlan0 iface vxlan0 pre-up ip link add $IFACE type vxlan id 10 group 239.1.1.1 dstport 0 dev bond1 || true post-down ip link delete $IFACE || true mtu 1500 auto vmbr1 iface vmbr1 address 172.30.0.102/24 bridge-ports vxlan0 bridge-stp off bridge-fd 0 \u5176\u4e2d ens1f1 \u7684 mtu 1550 \u548c vxlan0 \u7684 mtu 1500 \u8bbe\u7f6e\u89c1 \u8e29\u5751\u8bb0\u5f55 \u4e2d\u7684\u89e3\u91ca\u3002","title":"\u4e3b\u673a\u7f51\u5361"},{"location":"networking/host/#_1","text":"Proxmox VE \u4e0d\u652f\u6301 ifupdown \u4ee5\u5916\u7684\u7f51\u7edc\u7ba1\u7406\u7cfb\u7edf\uff08PVE 7 \u5f00\u59cb\u9ed8\u8ba4\u4f7f\u7528 ifupdown2\uff09\uff0c\u5982 NetworkManager \u548c systemd-networkd \u7b49\uff0c\u56e0\u6b64\u7f51\u7edc\u914d\u7f6e\u53ea\u80fd\u4f7f\u7528 /etc/network/interfaces \u6587\u4ef6\u3002 \u53c2\u8003 pv2 \u4e0a\u914d\u7f6e\uff0c\u590d\u5236\u65f6\u6ce8\u610f\u66ff\u6362 IP \u5730\u5740\uff0c\u4ee5\u53ca pvg1 \u548c pvg2 \u7684\u5149\u7ea4\u7aef\u53e3\u4e3a ens4f0/ens4f1 \u3002 ifupdown auto lo iface lo inet loopback auto eno1 iface eno1 inet manual bond-master bond0 auto eno2 iface eno2 inet manual bond-master bond0 auto eno3 iface eno3 inet manual bond-master bond0 auto eno4 iface eno4 inet manual bond-master bond0 auto ens1f0 iface ens1f0 inet manual bond-master bond1 mtu 1550 auto ens1f1 iface ens1f1 inet manual bond-master bond1 mtu 1550 auto bond0 iface bond0 inet manual bond-mode balance-alb bond-miimon 100 bond-downdelay 200 bond-updelay 200 auto bond1 iface bond1 inet static address 10.0.0.12/24 bond-mode 802.3ad bond-miimon 100 bond-downdelay 200 bond-updelay 200 auto vmbr0 iface vmbr0 inet static address 202.38.75.97/24 gateway 202.38.75.254 dns-nameservers 202.38.64.1 bridge_ports bond0 bridge_stp off bridge_fd 0 iface vmbr0 inet6 static address 2001:da8:d800:75::a2/64 gateway 2001:da8:d800:75::1 # Overlay network for VMs auto vxlan0 iface vxlan0 inet manual pre-up ip link add vxlan0 type vxlan id 10 group 239.1.1.1 dstport 0 dev bond1 || true up ip link set vxlan0 up down ip link set vxlan0 down post-down ip link delete vxlan0 || true mtu 1500 auto vmbr1 iface vmbr1 inet static address 172.30.0.102/24 bridge_ports vxlan0 bridge_stp off bridge_fd 0 ifupdown2 auto lo iface lo inet loopback auto eno1 iface eno1 auto eno2 iface eno2 auto eno3 iface eno3 auto eno4 iface eno4 auto ens1f0 iface ens1f0 mtu 1550 auto ens1f1 iface ens1f1 mtu 1550 auto bond0 iface bond0 bond-slaves eno1 eno2 eno3 eno4 bond-mode balance-alb bond-miimon 100 bond-downdelay 200 bond-updelay 200 auto bond1 iface bond1 address 10.0.0.12/24 bond-slaves ens1f0 ens1f1 bond-mode 802.3ad bond-miimon 100 bond-downdelay 200 bond-updelay 200 auto vmbr0 iface vmbr0 address 202.38.75.97/24 gateway 202.38.75.254 dns-nameservers 202.38.64.1 bridge-ports bond0 bridge-stp off bridge-fd 0 iface vmbr0 inet6 static address 2001:da8:d800:75::a2/64 gateway 2001:da8:d800:75::1 # Overlay network for VMs auto vxlan0 iface vxlan0 pre-up ip link add $IFACE type vxlan id 10 group 239.1.1.1 dstport 0 dev bond1 || true post-down ip link delete $IFACE || true mtu 1500 auto vmbr1 iface vmbr1 address 172.30.0.102/24 bridge-ports vxlan0 bridge-stp off bridge-fd 0 \u5176\u4e2d ens1f1 \u7684 mtu 1550 \u548c vxlan0 \u7684 mtu 1500 \u8bbe\u7f6e\u89c1 \u8e29\u5751\u8bb0\u5f55 \u4e2d\u7684\u89e3\u91ca\u3002","title":"\u4e3b\u673a\u7f51\u5361"},{"location":"networking/intranet/","text":"\u5bb9\u5668\u5185\u7f51 \u00b6 \u5bb9\u5668\u5185\u7f51\u4f7f\u7528 VXLAN \u5b9e\u73b0\uff0c\u5728\u6240\u6709\u8ba1\u7b97\u670d\u52a1\u5668\u4e0a\u5747\u4f7f\u7528 ens1f1 \u754c\u9762\u8fde\u63a5\uff0c\u521b\u5efa\u547d\u4ee4\u4e3a ip link add vxlan0 type vxlan id 10 group 239 .1.1.1 dstport 0 dev ens1f1 RFC 7348 \u6307\u51fa VXLAN \u63a5\u6536\u7aef\u53e3\u4e3a UDP 4789 ,\u4f46\u7531\u4e8e\u5386\u53f2\u539f\u56e0\u5305\u62ec Linux \u5728\u5185\u7684\u4e00\u4f17\u5382\u5546\u90fd\u5728\u4f7f\u7528 UDP 8472\uff0c\u56e0\u6b64\u8be5\u7aef\u53e3\u5fc5\u987b\u5728 ens1f1 \u4e0a\u5f00\u653e\u3002\u5b9e\u9645\u4e0a\u7531\u4e8e ens1f0 \u548c ens1f1 \u8fd9\u4e24\u4e2a\u754c\u9762\u6ca1\u6709\u5916\u90e8\u63a5\u5165\uff0c\u6545\u4e0d\u8bbe\u9632\u3002 IP \u5730\u5740\u5206\u914d \u00b6 \u5bb9\u5668\u5185\u7f51 IP \u6bb5\u4e3a 172.31.0.0/16\uff0c\u76ee\u524d\u4f7f\u7528\u60c5\u51b5\uff1a 172.31.0.1 \u4e3a\u5185\u7f51\u7f51\u5173\uff0c\u8fd0\u884c\u5728 CT 100 \u4e0a\uff0c\u8be5\u5bb9\u5668\u540c\u65f6\u8fde\u63a5\u6821\u56ed\u7f51\uff0c\u5bf9\u5916 IP \u4e3a 202.38.75.252\uff0c\u63d0\u4f9b\u6240\u6709\u5b66\u751f\u673a\u7684\u6821\u56ed\u7f51\u8bbf\u95ee\u4ee5\u53ca SSH \u63a5\u5165\uff08\u5747\u4e3a NAT\uff09 172.31.0.2 \u4e3a web \u670d\u52a1\u5668\uff0c\u5373 CT 101\uff0c\u5bf9\u5916 IP \u4e3a 202.38.75.226\uff0c\u4e5f\u662f\u57df\u540d vlab.ustc.edu.cn \u6307\u5411\u7684\u5730\u5740 172.31.0.0/22 \u4fdd\u7559\uff0c\u7528\u4e8e\u5b9e\u9a8c\u7b49\u5185\u90e8\u7528\u9014 172.31.0.0 \u548c 172.31.255.255 \u4e0d\u662f\u5355\u64ad\u5730\u5740\uff0c\u65e0\u6cd5\u4f7f\u7528 172.31.4.0 - 172.31.255.254 \u5206\u914d\u7ed9\u5b66\u751f\u673a\u4f7f\u7528 \u53e6\u5916\u8fd8\u6709\u4e00\u6bb5 172.30.0.0/24 \u7528\u4e8e\u4e3b\u673a\u63a5\u5165\u7b49\u5185\u90e8\u7528\u9014\uff0c\u76ee\u524d\u5206\u914d\u60c5\u51b5\u5982\u4e0b\uff1a 172.30.0.1 = CT 100 172.30.0.2 = CT 101 172.30.0.3 = CT 102 172.30.0.101 - 172.30.0.108 \u4e3a\u4e3b\u673a\u63a5\u5165","title":"\u5bb9\u5668\u5185\u7f51"},{"location":"networking/intranet/#_1","text":"\u5bb9\u5668\u5185\u7f51\u4f7f\u7528 VXLAN \u5b9e\u73b0\uff0c\u5728\u6240\u6709\u8ba1\u7b97\u670d\u52a1\u5668\u4e0a\u5747\u4f7f\u7528 ens1f1 \u754c\u9762\u8fde\u63a5\uff0c\u521b\u5efa\u547d\u4ee4\u4e3a ip link add vxlan0 type vxlan id 10 group 239 .1.1.1 dstport 0 dev ens1f1 RFC 7348 \u6307\u51fa VXLAN \u63a5\u6536\u7aef\u53e3\u4e3a UDP 4789 ,\u4f46\u7531\u4e8e\u5386\u53f2\u539f\u56e0\u5305\u62ec Linux \u5728\u5185\u7684\u4e00\u4f17\u5382\u5546\u90fd\u5728\u4f7f\u7528 UDP 8472\uff0c\u56e0\u6b64\u8be5\u7aef\u53e3\u5fc5\u987b\u5728 ens1f1 \u4e0a\u5f00\u653e\u3002\u5b9e\u9645\u4e0a\u7531\u4e8e ens1f0 \u548c ens1f1 \u8fd9\u4e24\u4e2a\u754c\u9762\u6ca1\u6709\u5916\u90e8\u63a5\u5165\uff0c\u6545\u4e0d\u8bbe\u9632\u3002","title":"\u5bb9\u5668\u5185\u7f51"},{"location":"networking/intranet/#ip","text":"\u5bb9\u5668\u5185\u7f51 IP \u6bb5\u4e3a 172.31.0.0/16\uff0c\u76ee\u524d\u4f7f\u7528\u60c5\u51b5\uff1a 172.31.0.1 \u4e3a\u5185\u7f51\u7f51\u5173\uff0c\u8fd0\u884c\u5728 CT 100 \u4e0a\uff0c\u8be5\u5bb9\u5668\u540c\u65f6\u8fde\u63a5\u6821\u56ed\u7f51\uff0c\u5bf9\u5916 IP \u4e3a 202.38.75.252\uff0c\u63d0\u4f9b\u6240\u6709\u5b66\u751f\u673a\u7684\u6821\u56ed\u7f51\u8bbf\u95ee\u4ee5\u53ca SSH \u63a5\u5165\uff08\u5747\u4e3a NAT\uff09 172.31.0.2 \u4e3a web \u670d\u52a1\u5668\uff0c\u5373 CT 101\uff0c\u5bf9\u5916 IP \u4e3a 202.38.75.226\uff0c\u4e5f\u662f\u57df\u540d vlab.ustc.edu.cn \u6307\u5411\u7684\u5730\u5740 172.31.0.0/22 \u4fdd\u7559\uff0c\u7528\u4e8e\u5b9e\u9a8c\u7b49\u5185\u90e8\u7528\u9014 172.31.0.0 \u548c 172.31.255.255 \u4e0d\u662f\u5355\u64ad\u5730\u5740\uff0c\u65e0\u6cd5\u4f7f\u7528 172.31.4.0 - 172.31.255.254 \u5206\u914d\u7ed9\u5b66\u751f\u673a\u4f7f\u7528 \u53e6\u5916\u8fd8\u6709\u4e00\u6bb5 172.30.0.0/24 \u7528\u4e8e\u4e3b\u673a\u63a5\u5165\u7b49\u5185\u90e8\u7528\u9014\uff0c\u76ee\u524d\u5206\u914d\u60c5\u51b5\u5982\u4e0b\uff1a 172.30.0.1 = CT 100 172.30.0.2 = CT 101 172.30.0.3 = CT 102 172.30.0.101 - 172.30.0.108 \u4e3a\u4e3b\u673a\u63a5\u5165","title":"IP \u5730\u5740\u5206\u914d"},{"location":"networking/ips/","text":"IP \u5730\u5740\u5217\u8868 \u00b6 \u6821\u56ed\u7f51 IPv4 \u00b6 IP \u5730\u5740 \u4e3b\u673a\u6216\u7528\u9014 10.38.79.98 10.38.79.99 \u5b58\u50a8\u670d\u52a1\u5668\u7684\u7ba1\u7406\u7aef\u53e3 10.38.79.100 pv0 IPMI 10.38.79.101 pv1 IPMI 10.38.79.102 pv2 IPMI 10.38.79.103 pv3 IPMI 10.38.79.104 pv4 IPMI 10.38.79.105 pv5 IPMI 10.38.79.106 pv6 IPMI 10.38.79.107 pv7 IPMI 10.38.79.108 pv8 IPMI 10.38.79.181 pvg1 IPMI 10.38.79.182 pvg2 IPMI 202.38.75.4 web0\uff08\u6d4b\u8bd5\u73af\u5883\u7684 CT 101\uff09 202.38.75.24 gateway0\uff08\u6d4b\u8bd5\u73af\u5883\u7684 CT 100\uff09 202.38.75.85 pv0 202.38.75.86 pv1 202.38.75.97 pv2 202.38.75.98 pv3 202.38.75.99 pv4 202.38.75.100 pv5 202.38.75.102 pv6 202.38.75.103 pv7 202.38.75.104 pv8 202.38.75.105 pvg1 202.38.75.108 pvg2 202.38.75.226 CT 101 \uff08Web \u670d\u52a1\u5668\uff09 202.38.75.250 VM 104 \uff08\u5907\u4efd\u670d\u52a1\u5668\uff09 202.38.75.252 CT 100 \uff08\u5185\u7f51\u7f51\u5173\u51fa\u53e3\uff09 Info \u53e6\u5916\u6709\u4e00\u4e2a\u7279\u6b8a\u7684 IPv4 \u5730\u5740 202.38.84.252 \u6302\u5728 CT 100 \u4e0a\uff0c\u5b9e\u9645\u5e76\u4e0d\u5c5e\u4e8e\u7535\u4e09\u697c\uff0c\u7528\u6765\u901a\u8fc7 NAT \u4f9b\u7535\u4e09\u697c 420 \u623f\u95f4\u4e0a\u7f51\u3002 \u6821\u56ed\u7f51 IPv6 \u00b6 IP \u5730\u5740 \u4e3b\u673a\u6216\u7528\u9014 2001:da8:d800:75::4 web0\uff08\u6d4b\u8bd5\u73af\u5883\u7684 CT 101\uff09 2001:da8:d800:75::226 CT 101\uff08Web \u670d\u52a1\u5668\uff09 2001:da8:d800:75::aaaa CT 100\uff08\u5185\u7f51\u7f51\u5173\u51fa\u53e3\uff09 2001:da8:d800:75::bbbb gateway0\uff08\u6d4b\u8bd5\u73af\u5883\u7684 CT 100\uff09 \u5185\u7f51 IPv4 \u00b6 CIDR \u5730\u5740\u6bb5 \u7528\u9014 10.0.0.0/24 \u4e3b\u673a\u95f4\u5149\u7ea4\u901a\u4fe1 \uff08\u5305\u62ec\u5b58\u50a8\u8bbe\u65bd\u7684 iSCSI\uff09 172.30.0.0/ 24 \u5185\u90e8\u8bbe\u65bd\u95f4\u7684\u901a\u4fe1\uff0c\u5305\u62ec\u865a\u62df\u673a\u548c\u4e3b\u673a \uff08\u4e0d\u5305\u542b iSCSI\uff0c\u5b89\u5168\u8d77\u89c1\u9700\u8981\u9694\u79bb\uff09 172.31.0.0/ 16 \u7528\u6237\u7f51\u7edc\uff08vmbr1\uff09 192.168.252.0/24 WireGuard \u5916\u90e8\u63a5\u5165 \uff08\u7ecf\u8fc7 CT 100 \u7f51\u5173\uff09 IP \u5730\u5740 \u4e3b\u673a 10.0.0.1 10.0.0.11 pv1 10.0.0.12 pv2 10.0.0.13 pv3 10.0.0.14 pv4 10.0.0.15 pv5 10.0.0.16 pv6 10.0.0.17 pv7 10.0.0.18 pv8 10.0.0.81 pvg1 10.0.0.82 pvg2 172.30.0.1 172.31.0.1 CT 100 \u7f51\u5173 172.30.0.2 172.31.0.2 CT 101 \u670d\u52a1\u5668 172.30.0.3 CT 102 (monitor, InfluxDB) 172.30.0.4 172.31.0.7 VM 103 Wireguard 172.30.0.101 pv1 172.30.0.102 pv2 172.30.0.103 pv3 172.30.0.104 pv4 172.30.0.105 pv5 172.30.0.106 pv6 172.30.0.107 pv7 172.30.0.108 pv8 172.30.0.181 pvg1 172.30.0.182 pvg2 172.31.0.3 CT 802 Foresyn (iGEM 2019) 172.31.0.221 VM 805 (iBug \u7684\u865a\u62df\u673a) 172.31.0.222 VM 999 (iBug \u7684\u865a\u62df\u673a) 172.31.0.223 VM 998 (iBug \u7684\u865a\u62df\u673a) 172.31.1.1 VM 803 (Verilog OJ) 172.31.1.4 VM 804 (FPGAOL Compile) \u5185\u7f51 IPv6 \u00b6 \u6211\u4eec\u6ca1\u6709\u5185\u7f51\u670d\u52a1\u8fd0\u884c\u5728 IPv6 \u4e0a\u3002 IP \u5730\u5740\u6bb5 \u5206\u914d\u7528\u9014 2001:da8:d800:4bfc::/64 \u901a\u8fc7 SLAAC \u4f9b\u7528\u6237\u865a\u62df\u673a\u8bbf\u95ee IPv6 2001:da8:d800:4b18::/64 \u540c\u4e0a\uff0c\u4f46\u662f\u662f\u6d4b\u8bd5\u73af\u5883","title":"IP \u5730\u5740\u5217\u8868"},{"location":"networking/ips/#ip","text":"","title":"IP \u5730\u5740\u5217\u8868"},{"location":"networking/ips/#ipv4","text":"IP \u5730\u5740 \u4e3b\u673a\u6216\u7528\u9014 10.38.79.98 10.38.79.99 \u5b58\u50a8\u670d\u52a1\u5668\u7684\u7ba1\u7406\u7aef\u53e3 10.38.79.100 pv0 IPMI 10.38.79.101 pv1 IPMI 10.38.79.102 pv2 IPMI 10.38.79.103 pv3 IPMI 10.38.79.104 pv4 IPMI 10.38.79.105 pv5 IPMI 10.38.79.106 pv6 IPMI 10.38.79.107 pv7 IPMI 10.38.79.108 pv8 IPMI 10.38.79.181 pvg1 IPMI 10.38.79.182 pvg2 IPMI 202.38.75.4 web0\uff08\u6d4b\u8bd5\u73af\u5883\u7684 CT 101\uff09 202.38.75.24 gateway0\uff08\u6d4b\u8bd5\u73af\u5883\u7684 CT 100\uff09 202.38.75.85 pv0 202.38.75.86 pv1 202.38.75.97 pv2 202.38.75.98 pv3 202.38.75.99 pv4 202.38.75.100 pv5 202.38.75.102 pv6 202.38.75.103 pv7 202.38.75.104 pv8 202.38.75.105 pvg1 202.38.75.108 pvg2 202.38.75.226 CT 101 \uff08Web \u670d\u52a1\u5668\uff09 202.38.75.250 VM 104 \uff08\u5907\u4efd\u670d\u52a1\u5668\uff09 202.38.75.252 CT 100 \uff08\u5185\u7f51\u7f51\u5173\u51fa\u53e3\uff09 Info \u53e6\u5916\u6709\u4e00\u4e2a\u7279\u6b8a\u7684 IPv4 \u5730\u5740 202.38.84.252 \u6302\u5728 CT 100 \u4e0a\uff0c\u5b9e\u9645\u5e76\u4e0d\u5c5e\u4e8e\u7535\u4e09\u697c\uff0c\u7528\u6765\u901a\u8fc7 NAT \u4f9b\u7535\u4e09\u697c 420 \u623f\u95f4\u4e0a\u7f51\u3002","title":"\u6821\u56ed\u7f51 IPv4"},{"location":"networking/ips/#ipv6","text":"IP \u5730\u5740 \u4e3b\u673a\u6216\u7528\u9014 2001:da8:d800:75::4 web0\uff08\u6d4b\u8bd5\u73af\u5883\u7684 CT 101\uff09 2001:da8:d800:75::226 CT 101\uff08Web \u670d\u52a1\u5668\uff09 2001:da8:d800:75::aaaa CT 100\uff08\u5185\u7f51\u7f51\u5173\u51fa\u53e3\uff09 2001:da8:d800:75::bbbb gateway0\uff08\u6d4b\u8bd5\u73af\u5883\u7684 CT 100\uff09","title":"\u6821\u56ed\u7f51 IPv6"},{"location":"networking/ips/#ipv4_1","text":"CIDR \u5730\u5740\u6bb5 \u7528\u9014 10.0.0.0/24 \u4e3b\u673a\u95f4\u5149\u7ea4\u901a\u4fe1 \uff08\u5305\u62ec\u5b58\u50a8\u8bbe\u65bd\u7684 iSCSI\uff09 172.30.0.0/ 24 \u5185\u90e8\u8bbe\u65bd\u95f4\u7684\u901a\u4fe1\uff0c\u5305\u62ec\u865a\u62df\u673a\u548c\u4e3b\u673a \uff08\u4e0d\u5305\u542b iSCSI\uff0c\u5b89\u5168\u8d77\u89c1\u9700\u8981\u9694\u79bb\uff09 172.31.0.0/ 16 \u7528\u6237\u7f51\u7edc\uff08vmbr1\uff09 192.168.252.0/24 WireGuard \u5916\u90e8\u63a5\u5165 \uff08\u7ecf\u8fc7 CT 100 \u7f51\u5173\uff09 IP \u5730\u5740 \u4e3b\u673a 10.0.0.1 10.0.0.11 pv1 10.0.0.12 pv2 10.0.0.13 pv3 10.0.0.14 pv4 10.0.0.15 pv5 10.0.0.16 pv6 10.0.0.17 pv7 10.0.0.18 pv8 10.0.0.81 pvg1 10.0.0.82 pvg2 172.30.0.1 172.31.0.1 CT 100 \u7f51\u5173 172.30.0.2 172.31.0.2 CT 101 \u670d\u52a1\u5668 172.30.0.3 CT 102 (monitor, InfluxDB) 172.30.0.4 172.31.0.7 VM 103 Wireguard 172.30.0.101 pv1 172.30.0.102 pv2 172.30.0.103 pv3 172.30.0.104 pv4 172.30.0.105 pv5 172.30.0.106 pv6 172.30.0.107 pv7 172.30.0.108 pv8 172.30.0.181 pvg1 172.30.0.182 pvg2 172.31.0.3 CT 802 Foresyn (iGEM 2019) 172.31.0.221 VM 805 (iBug \u7684\u865a\u62df\u673a) 172.31.0.222 VM 999 (iBug \u7684\u865a\u62df\u673a) 172.31.0.223 VM 998 (iBug \u7684\u865a\u62df\u673a) 172.31.1.1 VM 803 (Verilog OJ) 172.31.1.4 VM 804 (FPGAOL Compile)","title":"\u5185\u7f51 IPv4"},{"location":"networking/ips/#ipv6_1","text":"\u6211\u4eec\u6ca1\u6709\u5185\u7f51\u670d\u52a1\u8fd0\u884c\u5728 IPv6 \u4e0a\u3002 IP \u5730\u5740\u6bb5 \u5206\u914d\u7528\u9014 2001:da8:d800:4bfc::/64 \u901a\u8fc7 SLAAC \u4f9b\u7528\u6237\u865a\u62df\u673a\u8bbf\u95ee IPv6 2001:da8:d800:4b18::/64 \u540c\u4e0a\uff0c\u4f46\u662f\u662f\u6d4b\u8bd5\u73af\u5883","title":"\u5185\u7f51 IPv6"},{"location":"records/2020-03-31/","text":"2020 \u5e74 3 \u6708 31 \u65e5\u5de5\u4f5c\u603b\u7ed3 \u00b6 \u5df2\u5b8c\u6210 \u00b6 \u56db\u5757 Agilio \u667a\u80fd\u7f51\u5361\u5df2\u5b89\u88c5\u5728 2~5 \u53f7\u670d\u52a1\u5668\u4e0a 15 \u6761\u5185\u5b58\u5df2\u5206\u522b\u6dfb\u52a0\u81f3\u4e5d\u53f0\u670d\u52a1\u5668\u4e0a\uff080 \u53f7\u4e00\u6761\uff0c2~8 \u53f7\u5404\u4e24\u6761\uff0c1 \u53f7\u672a\u6539\u52a8\uff09 7 \u53f7\u548c 8 \u53f7\u670d\u52a1\u5668\u5df2\u914d\u7f6e\u5b8c\u6bd5\u5e76\u6295\u5165\u4f7f\u7528 \u5e73\u53f0\u5df2\u6062\u590d\u6b63\u5e38\u8fd0\u884c\uff083 \u6708 31 \u65e5\u4e0b\u5348 5:00 \u81f3 4 \u6708 1 \u65e5\u65e9\u4e0a\u505c\u7535\u524d\uff0c\u4ee5\u53ca 4 \u6708 1 \u65e5\u505c\u7535\u6062\u590d\u540e\uff09 \u672a\u5b8c\u6210 \u00b6 \u667a\u80fd\u7f51\u5361\u7684\u8f6f\u4ef6\u8c03\u7814\u4e0e\u914d\u7f6e\uff0c\u5728\u667a\u80fd\u7f51\u5361\u53ef\u4ee5\u63d0\u4f9b\u7ed9\u5ba2\u6237\uff08\u5b66\u751f\uff09\u4f7f\u7528\u524d\u8fd8\u9700\u8981\u4e00\u4e9b\u7814\u7a76\u5de5\u4f5c GPU \u7684\u8f6f\u4ef6\u8c03\u7814\u4e0e\u914d\u7f6e\uff0c\u6211\u4eec\u8ba1\u5212\u4f7f\u7528 0 \u53f7\u670d\u52a1\u5668\u8fdb\u884c\u7814\u7a76\u5b9e\u9a8c\uff08\u4e0a\u9762\u6709\u4e00\u5757 Tesla P4\uff09 \u56e0\u6b64 0 \u53f7\u670d\u52a1\u5668\u6682\u4e0d\u6295\u5165\u4f7f\u7528 \u9047\u5230\u95ee\u9898 \u00b6 \u6ca1\u6709\u5b89\u88c5 GPU\uff0c\u56e0\u4e3a\u673a\u8eab\u7f3a\u5c11 GPU \u6240\u9700\u7684\u989d\u5916\u4f9b\u7535\u8bbe\u65bd \u7ecf\u8fc7\u8c03\u7814\uff0c\u8fd9\u516b\u53f0\u670d\u52a1\u5668\u65e0\u6cd5\u6dfb\u52a0 GPU \u6240\u9700\u7535\u6e90\uff0c\u56e0\u6b64\u65e0\u6cd5\u5b89\u88c5 GPU 8 \u53f7\u670d\u52a1\u5668\u7684\u4e24\u5757\u56fa\u6001\u786c\u76d8\u6709\u4e00\u5757\u6545\u969c\uff0c\u8003\u8651\u8d70\u4fdd\u4fee \u7f3a\u5c11\u7269\u8d44\uff08\u9700\u8981\u91c7\u8d2d\uff09 \u00b6 \u5149\u4ea4\u6362\u673a\u4e00\u53f0\uff08\u7528\u4e8e\u667a\u80fd\u7f51\u5361\u95f4\u7684\u4e92\u8054\uff0c\u81f3\u5c11 8 \u53e3\uff09 \u5149\u6a21\u5757 22 \u4e2a\uff08\u667a\u80fd\u7f51\u5361 16 \u4e2a\uff0c0 \u53f7\u670d\u52a1\u5668 2 \u4e2a\uff0c\u5b58\u50a8\u670d\u52a1\u5668 4 \u4e2a\uff09 \u5149\u7f06 12 \u5bf9\uff08\u667a\u80fd\u7f51\u5361 8 \u5bf9\uff0c0 \u53f7\u670d\u52a1\u5668 2 \u5bf9\uff0c\u5b58\u50a8\u670d\u52a1\u5668 2 \u5bf9\uff09 2.4 TB \u5907\u7528\u786c\u76d8\u81f3\u5c11 4 \u5757\uff08\u53c2\u8003\u578b\u53f7 EG002400JWJNN\uff09","title":"2020 \u5e74 3 \u6708 31 \u65e5"},{"location":"records/2020-03-31/#2020-3-31","text":"","title":"2020 \u5e74 3 \u6708 31 \u65e5\u5de5\u4f5c\u603b\u7ed3"},{"location":"records/2020-03-31/#_1","text":"\u56db\u5757 Agilio \u667a\u80fd\u7f51\u5361\u5df2\u5b89\u88c5\u5728 2~5 \u53f7\u670d\u52a1\u5668\u4e0a 15 \u6761\u5185\u5b58\u5df2\u5206\u522b\u6dfb\u52a0\u81f3\u4e5d\u53f0\u670d\u52a1\u5668\u4e0a\uff080 \u53f7\u4e00\u6761\uff0c2~8 \u53f7\u5404\u4e24\u6761\uff0c1 \u53f7\u672a\u6539\u52a8\uff09 7 \u53f7\u548c 8 \u53f7\u670d\u52a1\u5668\u5df2\u914d\u7f6e\u5b8c\u6bd5\u5e76\u6295\u5165\u4f7f\u7528 \u5e73\u53f0\u5df2\u6062\u590d\u6b63\u5e38\u8fd0\u884c\uff083 \u6708 31 \u65e5\u4e0b\u5348 5:00 \u81f3 4 \u6708 1 \u65e5\u65e9\u4e0a\u505c\u7535\u524d\uff0c\u4ee5\u53ca 4 \u6708 1 \u65e5\u505c\u7535\u6062\u590d\u540e\uff09","title":"\u5df2\u5b8c\u6210"},{"location":"records/2020-03-31/#_2","text":"\u667a\u80fd\u7f51\u5361\u7684\u8f6f\u4ef6\u8c03\u7814\u4e0e\u914d\u7f6e\uff0c\u5728\u667a\u80fd\u7f51\u5361\u53ef\u4ee5\u63d0\u4f9b\u7ed9\u5ba2\u6237\uff08\u5b66\u751f\uff09\u4f7f\u7528\u524d\u8fd8\u9700\u8981\u4e00\u4e9b\u7814\u7a76\u5de5\u4f5c GPU \u7684\u8f6f\u4ef6\u8c03\u7814\u4e0e\u914d\u7f6e\uff0c\u6211\u4eec\u8ba1\u5212\u4f7f\u7528 0 \u53f7\u670d\u52a1\u5668\u8fdb\u884c\u7814\u7a76\u5b9e\u9a8c\uff08\u4e0a\u9762\u6709\u4e00\u5757 Tesla P4\uff09 \u56e0\u6b64 0 \u53f7\u670d\u52a1\u5668\u6682\u4e0d\u6295\u5165\u4f7f\u7528","title":"\u672a\u5b8c\u6210"},{"location":"records/2020-03-31/#_3","text":"\u6ca1\u6709\u5b89\u88c5 GPU\uff0c\u56e0\u4e3a\u673a\u8eab\u7f3a\u5c11 GPU \u6240\u9700\u7684\u989d\u5916\u4f9b\u7535\u8bbe\u65bd \u7ecf\u8fc7\u8c03\u7814\uff0c\u8fd9\u516b\u53f0\u670d\u52a1\u5668\u65e0\u6cd5\u6dfb\u52a0 GPU \u6240\u9700\u7535\u6e90\uff0c\u56e0\u6b64\u65e0\u6cd5\u5b89\u88c5 GPU 8 \u53f7\u670d\u52a1\u5668\u7684\u4e24\u5757\u56fa\u6001\u786c\u76d8\u6709\u4e00\u5757\u6545\u969c\uff0c\u8003\u8651\u8d70\u4fdd\u4fee","title":"\u9047\u5230\u95ee\u9898"},{"location":"records/2020-03-31/#_4","text":"\u5149\u4ea4\u6362\u673a\u4e00\u53f0\uff08\u7528\u4e8e\u667a\u80fd\u7f51\u5361\u95f4\u7684\u4e92\u8054\uff0c\u81f3\u5c11 8 \u53e3\uff09 \u5149\u6a21\u5757 22 \u4e2a\uff08\u667a\u80fd\u7f51\u5361 16 \u4e2a\uff0c0 \u53f7\u670d\u52a1\u5668 2 \u4e2a\uff0c\u5b58\u50a8\u670d\u52a1\u5668 4 \u4e2a\uff09 \u5149\u7f06 12 \u5bf9\uff08\u667a\u80fd\u7f51\u5361 8 \u5bf9\uff0c0 \u53f7\u670d\u52a1\u5668 2 \u5bf9\uff0c\u5b58\u50a8\u670d\u52a1\u5668 2 \u5bf9\uff09 2.4 TB \u5907\u7528\u786c\u76d8\u81f3\u5c11 4 \u5757\uff08\u53c2\u8003\u578b\u53f7 EG002400JWJNN\uff09","title":"\u7f3a\u5c11\u7269\u8d44\uff08\u9700\u8981\u91c7\u8d2d\uff09"},{"location":"records/2020-08-01/","text":"2020 \u5e74 8 \u6708 1 \u65e5\u5de5\u4f5c\u603b\u7ed3 \u00b6 \u7cfb\u7edf\u7ef4\u62a4\uff08MTU \u8bbe\u7f6e\uff09 \u00b6 VXLAN \u7684 MTU \u4e3a\u4e0b\u5c42\u627f\u8f7d\u7f51\u7edc\u7684\u51cf\u53bb 50 \u5b57\u8282\uff0c\u8003\u8651\u5230 1450 \u5b57\u8282\u8fd9\u79cd\u975e\u6807\u51c6\u7684\u8bbe\u5b9a\u65e9\u665a\u4f1a\u5bfc\u81f4\u66f4\u591a\u7684\u9ebb\u70e6\uff08\u4f8b\u5982 KVM \u865a\u62df\u673a\u9700\u8981\u5355\u72ec\u8bbe\u7f6e\u7b49\uff09\uff0c\u51b3\u5b9a\u627e\u673a\u4f1a\u8fdb\u884c\u7cfb\u7edf\u7ef4\u62a4\uff0c\u628a\u8fd9\u4e2a\u8bbe\u7f6e\u6539\u6389\uff0c\u628a\u4e0b\u5c42\u627f\u8f7d\u7f51\u5361\u7684 MTU \u589e\u52a0 50 \u5b57\u8282\u4ee5\u4f9b VXLAN \u586b\u8865\u3002 \u5177\u4f53\u7684\u8c03\u6574\u65b9\u6cd5\u5c31\u662f\u5728 /etc/network/interfaces \u4e2d\u7684 iface ens1f1 inet static \u540e\u9762\u52a0\u5165\u4e00\u884c mtu 1550 \uff0c\u540c\u6837\uff08\u4fdd\u9669\u8d77\u89c1\uff09\u5728 iface vxlan0 \u540e\u9762\u52a0\u5165\u4e00\u884c mtu 1500 \u3002 \u6539\u8fc7\u4e4b\u540e\u7684 interfaces \u6587\u4ef6\u7c7b\u4f3c\u8fd9\u6837\uff1a auto ens1f1 iface ens1f1 inet static address 10.0.0.1 netmask 255.255.255.0 mtu 1550 auto vxlan0 iface vxlan0 inet manual pre-up ip link add vxlan0 type vxlan id 10 group 239.1.1.1 dstport 0 dev ens1f1 || true up ip link set vxlan0 up down ip link set vxlan0 down post-down ip link delete vxlan0 || true mtu 1500 \u5bf9\u4e8e\u8fd0\u884c\u4e86\u5bb9\u5668\u7684\u4e3b\u673a\uff0c\u76f4\u63a5\u91cd\u542f\u66f4\u52a0\u65b9\u4fbf\uff08\u5f53\u7136 iSCSI \u7684\u81ea\u52a8\u6302\u8f7d\u53c8\u51fa\u95ee\u9898\u4e86\uff0c\u89c1 \u8e29\u5751\u8bb0\u5f55 \u7684 LVM \u4e00\u8282\uff09\u3002\u5bf9\u4e8e\u6ca1\u6709\u8fd0\u884c\u5bb9\u5668\u7684\u4e3b\u673a\uff0c\u53ef\u4ee5\u76f4\u63a5\u628a\u4f9d\u8d56\u7684\u7f51\u5361\u4e00\u4e2a\u4e2a down \u6389\u518d up \u56de\u6765\uff1a ifdown vmbr1 vxlan0 ens1f1 ifup ens1f1 vxlan0 vmbr1 \u63a5\u4e0b\u6765\u7531\u4e8e\u73b0\u6709\u5bb9\u5668\u5df2\u7ecf\u8bbe\u7f6e\u4e86 MTU = 1450\uff0c\u8981\u628a\u8bbe\u7f6e\u5220\u6389\uff0c\u505a\u6cd5\u7b80\u5355\u7c97\u66b4\uff1a cd /etc/pve/nodes grep -lwirF mtu = 1450 | xargs sed -Ei 's/,mtu=1450//' Proxmox \u4f1a\u81ea\u52a8\u5c06\u4fee\u6539\u8fc7\u7684\u914d\u7f6e\u6587\u4ef6\u540c\u6b65\u81f3\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6\u4e3b\u673a\uff08\u6ce8\u610f\u9700\u8981\u5168\u90e8\u4fdd\u6301\u5728\u7ebf\uff0c\u5426\u5219\u540c\u6b65\u4f1a\u6302\uff0c\u8e29\u5751\u8bb0\u5f55\u6709\u5199\uff09\u3002 \u6700\u540e\u628a Django \u524d\u7aef\u7684 config.py \u6539\u4e00\u4e0b\uff0c\u8ba9\u65b0\u521b\u5efa\u7684\u5bb9\u5668\u4f7f\u7528\u9ed8\u8ba4\u7684 MTU \u5c31\u884c\u4e86\u3002 pv8 \u5149\u7ea4\u7f51\u7edc\u95ee\u9898 \u00b6 \u4e00\u5f00\u59cb\u7684\u8868\u73b0\u662f pv8 \u7684\u4e24\u4e2a\u5149\u7ea4\u5185\u7f51 IP \u90fd\u80fd\u8fde\u901a\uff0c\u4f46\u662f VXLAN \u6b7b\u6d3b\u8fde\u4e0d\u4e0a\u3002 \u9996\u5148\u8fd9\u91cc\u6709 \u53e6\u4e00\u4e2a\u5751 \uff0c\u89e3\u51b3\u4e4b\u540e\u91cd\u65b0\u68c0\u67e5\uff0c\u786e\u5b9a\u5b9e\u9645\u95ee\u9898\u662f ens1f1 \u754c\u9762\u4e0d\u8fde\u901a\uff0c\u8054\u7cfb\u5362\u5efa\u826f\u8001\u5e08\u524d\u5f80\u673a\u623f\u5b9e\u5730\u6392\u67e5\uff0c\u6700\u7ec8\u786e\u8ba4\u6545\u969c\u90e8\u4ef6\u662f\u8be5\u7f51\u8def\u5728\u4ea4\u6362\u673a\u4e00\u7aef\u7684\u5149\u6a21\u5757\u6709\u95ee\u9898\uff0c\u66ff\u6362\u6210\u65c1\u8fb9\u4e00\u4e2a\u95f2\u7f6e\u7684\u5149\u6a21\u5757\u540e\u7f51\u7edc\u8fde\u901a\u6027\u6062\u590d\u3002 \u63a5\u4e0b\u6765\u7684\u5f85\u529e\u4e8b\u9879\u5c31\u662f\u8bf7\u4eba\u68c0\u67e5\u8fd9\u4e2a\u5149\u6a21\u5757\u6709\u4ec0\u4e48\u95ee\u9898\u4e86\uff08\u8fd9\u4e2a\u5c31\u4ea4\u7ed9\u8001\u5e08\u5904\u7406\u4e86\uff09\u3002 \u5f85\u529e\u4e8b\u9879 \u00b6 \u89c1\u4e0a","title":"2020 \u5e74 8 \u6708 1 \u65e5"},{"location":"records/2020-08-01/#2020-8-1","text":"","title":"2020 \u5e74 8 \u6708 1 \u65e5\u5de5\u4f5c\u603b\u7ed3"},{"location":"records/2020-08-01/#mtu","text":"VXLAN \u7684 MTU \u4e3a\u4e0b\u5c42\u627f\u8f7d\u7f51\u7edc\u7684\u51cf\u53bb 50 \u5b57\u8282\uff0c\u8003\u8651\u5230 1450 \u5b57\u8282\u8fd9\u79cd\u975e\u6807\u51c6\u7684\u8bbe\u5b9a\u65e9\u665a\u4f1a\u5bfc\u81f4\u66f4\u591a\u7684\u9ebb\u70e6\uff08\u4f8b\u5982 KVM \u865a\u62df\u673a\u9700\u8981\u5355\u72ec\u8bbe\u7f6e\u7b49\uff09\uff0c\u51b3\u5b9a\u627e\u673a\u4f1a\u8fdb\u884c\u7cfb\u7edf\u7ef4\u62a4\uff0c\u628a\u8fd9\u4e2a\u8bbe\u7f6e\u6539\u6389\uff0c\u628a\u4e0b\u5c42\u627f\u8f7d\u7f51\u5361\u7684 MTU \u589e\u52a0 50 \u5b57\u8282\u4ee5\u4f9b VXLAN \u586b\u8865\u3002 \u5177\u4f53\u7684\u8c03\u6574\u65b9\u6cd5\u5c31\u662f\u5728 /etc/network/interfaces \u4e2d\u7684 iface ens1f1 inet static \u540e\u9762\u52a0\u5165\u4e00\u884c mtu 1550 \uff0c\u540c\u6837\uff08\u4fdd\u9669\u8d77\u89c1\uff09\u5728 iface vxlan0 \u540e\u9762\u52a0\u5165\u4e00\u884c mtu 1500 \u3002 \u6539\u8fc7\u4e4b\u540e\u7684 interfaces \u6587\u4ef6\u7c7b\u4f3c\u8fd9\u6837\uff1a auto ens1f1 iface ens1f1 inet static address 10.0.0.1 netmask 255.255.255.0 mtu 1550 auto vxlan0 iface vxlan0 inet manual pre-up ip link add vxlan0 type vxlan id 10 group 239.1.1.1 dstport 0 dev ens1f1 || true up ip link set vxlan0 up down ip link set vxlan0 down post-down ip link delete vxlan0 || true mtu 1500 \u5bf9\u4e8e\u8fd0\u884c\u4e86\u5bb9\u5668\u7684\u4e3b\u673a\uff0c\u76f4\u63a5\u91cd\u542f\u66f4\u52a0\u65b9\u4fbf\uff08\u5f53\u7136 iSCSI \u7684\u81ea\u52a8\u6302\u8f7d\u53c8\u51fa\u95ee\u9898\u4e86\uff0c\u89c1 \u8e29\u5751\u8bb0\u5f55 \u7684 LVM \u4e00\u8282\uff09\u3002\u5bf9\u4e8e\u6ca1\u6709\u8fd0\u884c\u5bb9\u5668\u7684\u4e3b\u673a\uff0c\u53ef\u4ee5\u76f4\u63a5\u628a\u4f9d\u8d56\u7684\u7f51\u5361\u4e00\u4e2a\u4e2a down \u6389\u518d up \u56de\u6765\uff1a ifdown vmbr1 vxlan0 ens1f1 ifup ens1f1 vxlan0 vmbr1 \u63a5\u4e0b\u6765\u7531\u4e8e\u73b0\u6709\u5bb9\u5668\u5df2\u7ecf\u8bbe\u7f6e\u4e86 MTU = 1450\uff0c\u8981\u628a\u8bbe\u7f6e\u5220\u6389\uff0c\u505a\u6cd5\u7b80\u5355\u7c97\u66b4\uff1a cd /etc/pve/nodes grep -lwirF mtu = 1450 | xargs sed -Ei 's/,mtu=1450//' Proxmox \u4f1a\u81ea\u52a8\u5c06\u4fee\u6539\u8fc7\u7684\u914d\u7f6e\u6587\u4ef6\u540c\u6b65\u81f3\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6\u4e3b\u673a\uff08\u6ce8\u610f\u9700\u8981\u5168\u90e8\u4fdd\u6301\u5728\u7ebf\uff0c\u5426\u5219\u540c\u6b65\u4f1a\u6302\uff0c\u8e29\u5751\u8bb0\u5f55\u6709\u5199\uff09\u3002 \u6700\u540e\u628a Django \u524d\u7aef\u7684 config.py \u6539\u4e00\u4e0b\uff0c\u8ba9\u65b0\u521b\u5efa\u7684\u5bb9\u5668\u4f7f\u7528\u9ed8\u8ba4\u7684 MTU \u5c31\u884c\u4e86\u3002","title":"\u7cfb\u7edf\u7ef4\u62a4\uff08MTU \u8bbe\u7f6e\uff09"},{"location":"records/2020-08-01/#pv8","text":"\u4e00\u5f00\u59cb\u7684\u8868\u73b0\u662f pv8 \u7684\u4e24\u4e2a\u5149\u7ea4\u5185\u7f51 IP \u90fd\u80fd\u8fde\u901a\uff0c\u4f46\u662f VXLAN \u6b7b\u6d3b\u8fde\u4e0d\u4e0a\u3002 \u9996\u5148\u8fd9\u91cc\u6709 \u53e6\u4e00\u4e2a\u5751 \uff0c\u89e3\u51b3\u4e4b\u540e\u91cd\u65b0\u68c0\u67e5\uff0c\u786e\u5b9a\u5b9e\u9645\u95ee\u9898\u662f ens1f1 \u754c\u9762\u4e0d\u8fde\u901a\uff0c\u8054\u7cfb\u5362\u5efa\u826f\u8001\u5e08\u524d\u5f80\u673a\u623f\u5b9e\u5730\u6392\u67e5\uff0c\u6700\u7ec8\u786e\u8ba4\u6545\u969c\u90e8\u4ef6\u662f\u8be5\u7f51\u8def\u5728\u4ea4\u6362\u673a\u4e00\u7aef\u7684\u5149\u6a21\u5757\u6709\u95ee\u9898\uff0c\u66ff\u6362\u6210\u65c1\u8fb9\u4e00\u4e2a\u95f2\u7f6e\u7684\u5149\u6a21\u5757\u540e\u7f51\u7edc\u8fde\u901a\u6027\u6062\u590d\u3002 \u63a5\u4e0b\u6765\u7684\u5f85\u529e\u4e8b\u9879\u5c31\u662f\u8bf7\u4eba\u68c0\u67e5\u8fd9\u4e2a\u5149\u6a21\u5757\u6709\u4ec0\u4e48\u95ee\u9898\u4e86\uff08\u8fd9\u4e2a\u5c31\u4ea4\u7ed9\u8001\u5e08\u5904\u7406\u4e86\uff09\u3002","title":"pv8 \u5149\u7ea4\u7f51\u7edc\u95ee\u9898"},{"location":"records/2020-08-01/#_1","text":"\u89c1\u4e0a","title":"\u5f85\u529e\u4e8b\u9879"},{"location":"records/2021-03-18/","text":"2021 \u5e74 3 \u6708 18 \u65e5\u8ba8\u8bba\u603b\u7ed3 \u00b6 \u5de5\u4f5c\u6c47\u62a5 \u00b6 Page 2 - \u5df2\u5b8c\u6210\u7684\u5185\u5bb9 \u00b6 \u7528\u91cf\u7edf\u8ba1\u4fe1\u606f\u9875\u9762\uff08Grafana\uff09 SSH \u7edf\u4e00\u767b\u5f55 Vlab \u8f6f\u4ef6\u7ec4\u5408 Xilinx Vivado MATLAB Wolfram Mathematica Logisim \u6d4f\u89c8\u5668 Visual Studio Code \u4f9b\u6211\u4eec\u81ea\u5df1\u9605\u8bfb\u4f7f\u7528\u7684\u7ef4\u62a4\u6587\u6863 Page 3 - \u7528\u91cf\u7edf\u8ba1 \u00b6 https://vlab.ustc.edu.cn/grafana/d/2 Page 4 - SSH \u7edf\u4e00\u767b\u5f55 \u00b6 \u66ff\u4ee3\u4e86\u539f\u6765\u7684\u5f00\u653e SSH \u7aef\u53e3\u7684\u505a\u6cd5 \u53ef\u4ee5\u8fdb\u884c\u767b\u5f55\u7edf\u8ba1 \u66f4\u5b89\u5168\uff0c\u9632\u6b62\u626b\u63cf\u7206\u7834\u5165\u4fb5 \u9632\u6b62\u6ee5\u7528 Page 5 - Vlab \u8f6f\u4ef6\u7ec4\u5408 \u00b6 \u4f5c\u4e3a\u6253\u5305\u9884\u88c5\u8f6f\u4ef6\u7684\u66ff\u4ee3 \u51cf\u5c0f\u955c\u50cf\u5bb9\u91cf\uff0c\u52a0\u5feb\u65b0\u865a\u62df\u673a\u521b\u5efa \u53ef\u4ee5\u900f\u660e\u66f4\u65b0\u53ca\u6dfb\u52a0\u65b0\u8f6f\u4ef6 \u5171\u4eab\u8f6f\u4ef6\u5bb9\u91cf\uff0c\u51cf\u5c11\u91cd\u590d\u5185\u5bb9\u548c\u786c\u76d8\u5360\u7528 Page 6 - \u6d4f\u89c8\u5668 VS Code \u00b6 Visual Studio Code \u662f\u5fae\u8f6f\u5f00\u53d1\u7684\u5e7f\u53d7\u6b22\u8fce\u7684\u4ee3\u7801\u7f16\u8f91\u5668\uff0c\u6709\u4e30\u5bcc\u7684\u5185\u7f6e\u529f\u80fd\u548c\u63d2\u4ef6\u5e02\u573a \u6d4f\u89c8\u5668\u4fbf\u4e8e\u4f7f\u7528\u53ca\u914d\u7f6e \u65b9\u4fbf\u4e86\u7528\u6237\u5728 Vlab \u5e73\u53f0\u4e0a\u8fdb\u884c\u4ee3\u7801\u7f16\u8f91\u4e0e\u8f6f\u4ef6\u5f00\u53d1 \u501f\u52a9 web \u524d\u7aef\u5b9e\u73b0\u7edf\u4e00\u63a5\u53e3\u767b\u5f55\u4f7f\u7528 Page 7 - \u5f00\u53d1\u6587\u6863/\u7ef4\u62a4\u6587\u6863 \u00b6 https://vlab.ibugone.com/ Page 8 - \u540e\u7eed\u5de5\u4f5c\u8ba1\u5212 \u00b6 \u91cd\u6784 web \u524d\u7aef\u7ba1\u7406\u5668 \u529f\u80fd\u4e0a\u4fdd\u6301\u4e00\u81f4\uff0c\u66f4\u5229\u4e8e\u4ee5\u540e\u7ef4\u62a4\u548c\u5f00\u53d1 \u6dfb\u52a0 KVM \u652f\u6301 \u5b8c\u5584\u7528\u6237\u6587\u6863\u4e0e\u7ef4\u62a4\u6587\u6863 \u4f1a\u8bae\u7b14\u8bb0\uff08\u6539\u8fdb\u5efa\u8bae & \u63a8\u5e7f\u8ba1\u5212\uff09 \u00b6 \u672c\u5b66\u671f\uff1a\u7ec4\u539f\u5b9e\u9a8c\uff08Vlab + FPGAOL\uff09 \u6570\u7535\u5b9e\u9a8c\u95ee\u9898\uff1aVivado \u7684\u7a33\u5b9a\u6027 \u7528\u91cf\u591a\u7684\u65f6\u5019\u4f1a\u9047\u5230\u5404\u79cd\u62a5\u9519\uff0c\u6709\u4e9b\u62a5\u9519\u4e0d\u4fee\u6539\u4ee3\u7801\u76f4\u63a5\u91cd\u65b0\u8fd0\u884c\u5c31\u597d\u4e86 Vivado \u672c\u8eab\u4ea7\u751f\u7684\u4e00\u4e9b\u96be\u4ee5\u7406\u89e3\u7684\u62a5\u9519 \u5c1d\u8bd5\u6362\u4e2a\u7248\u672c\uff08Current: 2019.1, Target: 2016.2 / 2018.2 ?\uff09\uff0c\u4f8b\u5982\u56de\u9000 \u4e24\u5468\u540e\u5f00\u59cb\u672c\u5b66\u671f\uff082021 Spring\uff09 \u7ec4\u539f\u5b9e\u9a8c \uff0c\u51c6\u5907\u5168\u9762\u91c7\u7528 RISC-V\uff08 !important \uff09 \u8ba1\u5212\u76ee\u6807\u5f62\u5f0f\uff08\u5b8c\u6210\u72b6\u6001\uff09\uff1aC to RISC-V\uff0c\u8fd0\u884c\u5728\u81ea\u5df1\u5199\u7684\uff08\u7ec4\u539f\u5b9e\u9a8c\u6210\u679c\uff09RV SoC / CPU \u4e0a \u9884\u5907 RV \u4ea4\u53c9\u5de5\u5177\u94fe\uff08GCC / binutils\uff0camd64 to riscv\uff09\u4ee5\u65b9\u4fbf\u5b66\u751f\u5b9e\u9a8c Chisel \u5de5\u5177\u94fe\uff08\u53ef\u9009\uff09 RARS \u6c47\u7f16\u53ca\u6a21\u62df\u5668\uff08 TheThirdOne/rars \uff09 https://mirrors.ustc.edu.cn/ \u63d0\u4f9b\u76f8\u5173 GitHub \u4ed3\u5e93\u7684 Releases \u7684\u955c\u50cf Vlab \u7684 UX \uff08FAQ?\uff09\uff08Embedded docs?\uff09\uff08\"Quick links\"?\uff09 \u590d\u6742\u5185\u5bb9\uff1anavbar \u7684\u7f51\u9875\u767b\u5f55\u8981\u5220\u6389 \u300c\u6587\u4ef6\u4f20\u8f93\u300d\u7684\u6613\u7528\u6027\u4e0e\u6587\u6863 \u76f4\u63a5\u4e0d\u7528\u586b\u5bc6\u7801\u4e86\uff08\u5df2\u7ecf\u7ecf\u8fc7 CAS \u8ba4\u8bc1\u4e86\uff09 \u300cSSH \u5bc6\u94a5\u7ba1\u7406\u300d\u7684\u79c1\u94a5\u53ef\u4ee5\u91cd\u590d\u4e0b\u8f7d\uff08 status-bydesign \uff09 \u5bc6\u94a5\u7ba1\u7406\u9875\u9762\u6dfb\u52a0\u4f7f\u7528\u5e2e\u52a9\uff08jump link / <iframe> ?\uff09 \u7cfb\u7edf\u548c\u6570\u636e\u5206\u79bb \uff08EBS / EFS \u6302\u8f7d\uff1f\uff09 \u591a\u7cfb\u7edf Depends: KVM support Windows \u7684\u652f\u6301\u4e0e\u5bf9\u63a5\uff08\u96be\uff09 \u628a \u201c\u5173\u95ed VNC \u901a\u77e5\u201d \u63a5\u53e3\u516c\u5f00 \u5f00\u53d1\u8fc7\u7a0b \u4eba\u5458\u5206\u5de5\uff08\uff1f\uff09\u4efb\u52a1\u8981\u660e\u786e \u63a8\u5e7f\u8ba1\u5212 \u6559\u52a1\u5904 / \u5b9e\u9a8c\u4e2d\u5fc3 / \u8ba1\u7b97\u673a\u5b66\u9662\u9886\u5bfc\u90fd\u770b\u597d \u4e09\u6559\u7684\u8bb2\u53f0\u7535\u8111\uff08 !?!? \uff09 \u5185\u5b58\u5f00\u59cb\u7d27\u5f20\u4e86\uff08\u554a\uff09 \u4f8b\u5982\u4e00\u4e2a\u661f\u671f\u6ca1\u8fde\u63a5\u5c31\u5173\u673a \u6bd5\u4e1a\u56de\u6536\u5f97\u5f00\u59cb\u8d76\u4e86\uff08x\uff09","title":"2021 \u5e74 3 \u6708 18 \u65e5"},{"location":"records/2021-03-18/#2021-3-18","text":"","title":"2021 \u5e74 3 \u6708 18 \u65e5\u8ba8\u8bba\u603b\u7ed3"},{"location":"records/2021-03-18/#_1","text":"","title":"\u5de5\u4f5c\u6c47\u62a5"},{"location":"records/2021-03-18/#page-2-","text":"\u7528\u91cf\u7edf\u8ba1\u4fe1\u606f\u9875\u9762\uff08Grafana\uff09 SSH \u7edf\u4e00\u767b\u5f55 Vlab \u8f6f\u4ef6\u7ec4\u5408 Xilinx Vivado MATLAB Wolfram Mathematica Logisim \u6d4f\u89c8\u5668 Visual Studio Code \u4f9b\u6211\u4eec\u81ea\u5df1\u9605\u8bfb\u4f7f\u7528\u7684\u7ef4\u62a4\u6587\u6863","title":"Page 2 - \u5df2\u5b8c\u6210\u7684\u5185\u5bb9"},{"location":"records/2021-03-18/#page-3-","text":"https://vlab.ustc.edu.cn/grafana/d/2","title":"Page 3 - \u7528\u91cf\u7edf\u8ba1"},{"location":"records/2021-03-18/#page-4-ssh","text":"\u66ff\u4ee3\u4e86\u539f\u6765\u7684\u5f00\u653e SSH \u7aef\u53e3\u7684\u505a\u6cd5 \u53ef\u4ee5\u8fdb\u884c\u767b\u5f55\u7edf\u8ba1 \u66f4\u5b89\u5168\uff0c\u9632\u6b62\u626b\u63cf\u7206\u7834\u5165\u4fb5 \u9632\u6b62\u6ee5\u7528","title":"Page 4 - SSH \u7edf\u4e00\u767b\u5f55"},{"location":"records/2021-03-18/#page-5-vlab","text":"\u4f5c\u4e3a\u6253\u5305\u9884\u88c5\u8f6f\u4ef6\u7684\u66ff\u4ee3 \u51cf\u5c0f\u955c\u50cf\u5bb9\u91cf\uff0c\u52a0\u5feb\u65b0\u865a\u62df\u673a\u521b\u5efa \u53ef\u4ee5\u900f\u660e\u66f4\u65b0\u53ca\u6dfb\u52a0\u65b0\u8f6f\u4ef6 \u5171\u4eab\u8f6f\u4ef6\u5bb9\u91cf\uff0c\u51cf\u5c11\u91cd\u590d\u5185\u5bb9\u548c\u786c\u76d8\u5360\u7528","title":"Page 5 - Vlab \u8f6f\u4ef6\u7ec4\u5408"},{"location":"records/2021-03-18/#page-6-vs-code","text":"Visual Studio Code \u662f\u5fae\u8f6f\u5f00\u53d1\u7684\u5e7f\u53d7\u6b22\u8fce\u7684\u4ee3\u7801\u7f16\u8f91\u5668\uff0c\u6709\u4e30\u5bcc\u7684\u5185\u7f6e\u529f\u80fd\u548c\u63d2\u4ef6\u5e02\u573a \u6d4f\u89c8\u5668\u4fbf\u4e8e\u4f7f\u7528\u53ca\u914d\u7f6e \u65b9\u4fbf\u4e86\u7528\u6237\u5728 Vlab \u5e73\u53f0\u4e0a\u8fdb\u884c\u4ee3\u7801\u7f16\u8f91\u4e0e\u8f6f\u4ef6\u5f00\u53d1 \u501f\u52a9 web \u524d\u7aef\u5b9e\u73b0\u7edf\u4e00\u63a5\u53e3\u767b\u5f55\u4f7f\u7528","title":"Page 6 - \u6d4f\u89c8\u5668 VS Code"},{"location":"records/2021-03-18/#page-7-","text":"https://vlab.ibugone.com/","title":"Page 7 - \u5f00\u53d1\u6587\u6863/\u7ef4\u62a4\u6587\u6863"},{"location":"records/2021-03-18/#page-8-","text":"\u91cd\u6784 web \u524d\u7aef\u7ba1\u7406\u5668 \u529f\u80fd\u4e0a\u4fdd\u6301\u4e00\u81f4\uff0c\u66f4\u5229\u4e8e\u4ee5\u540e\u7ef4\u62a4\u548c\u5f00\u53d1 \u6dfb\u52a0 KVM \u652f\u6301 \u5b8c\u5584\u7528\u6237\u6587\u6863\u4e0e\u7ef4\u62a4\u6587\u6863","title":"Page 8 - \u540e\u7eed\u5de5\u4f5c\u8ba1\u5212"},{"location":"records/2021-03-18/#_2","text":"\u672c\u5b66\u671f\uff1a\u7ec4\u539f\u5b9e\u9a8c\uff08Vlab + FPGAOL\uff09 \u6570\u7535\u5b9e\u9a8c\u95ee\u9898\uff1aVivado \u7684\u7a33\u5b9a\u6027 \u7528\u91cf\u591a\u7684\u65f6\u5019\u4f1a\u9047\u5230\u5404\u79cd\u62a5\u9519\uff0c\u6709\u4e9b\u62a5\u9519\u4e0d\u4fee\u6539\u4ee3\u7801\u76f4\u63a5\u91cd\u65b0\u8fd0\u884c\u5c31\u597d\u4e86 Vivado \u672c\u8eab\u4ea7\u751f\u7684\u4e00\u4e9b\u96be\u4ee5\u7406\u89e3\u7684\u62a5\u9519 \u5c1d\u8bd5\u6362\u4e2a\u7248\u672c\uff08Current: 2019.1, Target: 2016.2 / 2018.2 ?\uff09\uff0c\u4f8b\u5982\u56de\u9000 \u4e24\u5468\u540e\u5f00\u59cb\u672c\u5b66\u671f\uff082021 Spring\uff09 \u7ec4\u539f\u5b9e\u9a8c \uff0c\u51c6\u5907\u5168\u9762\u91c7\u7528 RISC-V\uff08 !important \uff09 \u8ba1\u5212\u76ee\u6807\u5f62\u5f0f\uff08\u5b8c\u6210\u72b6\u6001\uff09\uff1aC to RISC-V\uff0c\u8fd0\u884c\u5728\u81ea\u5df1\u5199\u7684\uff08\u7ec4\u539f\u5b9e\u9a8c\u6210\u679c\uff09RV SoC / CPU \u4e0a \u9884\u5907 RV \u4ea4\u53c9\u5de5\u5177\u94fe\uff08GCC / binutils\uff0camd64 to riscv\uff09\u4ee5\u65b9\u4fbf\u5b66\u751f\u5b9e\u9a8c Chisel \u5de5\u5177\u94fe\uff08\u53ef\u9009\uff09 RARS \u6c47\u7f16\u53ca\u6a21\u62df\u5668\uff08 TheThirdOne/rars \uff09 https://mirrors.ustc.edu.cn/ \u63d0\u4f9b\u76f8\u5173 GitHub \u4ed3\u5e93\u7684 Releases \u7684\u955c\u50cf Vlab \u7684 UX \uff08FAQ?\uff09\uff08Embedded docs?\uff09\uff08\"Quick links\"?\uff09 \u590d\u6742\u5185\u5bb9\uff1anavbar \u7684\u7f51\u9875\u767b\u5f55\u8981\u5220\u6389 \u300c\u6587\u4ef6\u4f20\u8f93\u300d\u7684\u6613\u7528\u6027\u4e0e\u6587\u6863 \u76f4\u63a5\u4e0d\u7528\u586b\u5bc6\u7801\u4e86\uff08\u5df2\u7ecf\u7ecf\u8fc7 CAS \u8ba4\u8bc1\u4e86\uff09 \u300cSSH \u5bc6\u94a5\u7ba1\u7406\u300d\u7684\u79c1\u94a5\u53ef\u4ee5\u91cd\u590d\u4e0b\u8f7d\uff08 status-bydesign \uff09 \u5bc6\u94a5\u7ba1\u7406\u9875\u9762\u6dfb\u52a0\u4f7f\u7528\u5e2e\u52a9\uff08jump link / <iframe> ?\uff09 \u7cfb\u7edf\u548c\u6570\u636e\u5206\u79bb \uff08EBS / EFS \u6302\u8f7d\uff1f\uff09 \u591a\u7cfb\u7edf Depends: KVM support Windows \u7684\u652f\u6301\u4e0e\u5bf9\u63a5\uff08\u96be\uff09 \u628a \u201c\u5173\u95ed VNC \u901a\u77e5\u201d \u63a5\u53e3\u516c\u5f00 \u5f00\u53d1\u8fc7\u7a0b \u4eba\u5458\u5206\u5de5\uff08\uff1f\uff09\u4efb\u52a1\u8981\u660e\u786e \u63a8\u5e7f\u8ba1\u5212 \u6559\u52a1\u5904 / \u5b9e\u9a8c\u4e2d\u5fc3 / \u8ba1\u7b97\u673a\u5b66\u9662\u9886\u5bfc\u90fd\u770b\u597d \u4e09\u6559\u7684\u8bb2\u53f0\u7535\u8111\uff08 !?!? \uff09 \u5185\u5b58\u5f00\u59cb\u7d27\u5f20\u4e86\uff08\u554a\uff09 \u4f8b\u5982\u4e00\u4e2a\u661f\u671f\u6ca1\u8fde\u63a5\u5c31\u5173\u673a \u6bd5\u4e1a\u56de\u6536\u5f97\u5f00\u59cb\u8d76\u4e86\uff08x\uff09","title":"\u4f1a\u8bae\u7b14\u8bb0\uff08\u6539\u8fdb\u5efa\u8bae &amp; \u63a8\u5e7f\u8ba1\u5212\uff09"},{"location":"records/2021-06-13/","text":"2021 \u5e74 6 \u6708 13 \u65e5\u5de5\u4f5c\u603b\u7ed3 \u00b6 \u79fb\u9664 Django \u4ee3\u7801\u91cc\u7684\u201c\u865a\u62df\u673a ID \u504f\u79fb\u91cf\u201d \u00b6 \u540c\u65f6\u6539\u6570\u636e\u5e93\u548c Django \u4ee3\u7801\uff0c\u6e05\u7406\u6389 VMID_INCR \u8fd9\u4e2a\u5386\u53f2\u5305\u88b1\u3002 -- Drop foreign key -- https://stackoverflow.com/posts/comments/32882353 ALTER TABLE vm_sshkey DROP CONSTRAINT ` vm_sshkey_ct_id_8bfb3d03_fk_vm_pvect_id ` ; -- Remove auto increment and PK -- https://stackoverflow.com/a/6741189/5958455 ALTER TABLE vm_pvect MODIFY COLUMN id INT ( 11 ); ALTER TABLE vm_pvect DROP PRIMARY KEY ; -- Work data UPDATE vm_pvect SET id = id + 1000 ; UPDATE vm_sshkey SET ct_id = ct_id + 1000 ; -- Add back AI and PK ALTER TABLE vm_pvect ADD PRIMARY KEY ( ` id ` ); ALTER TABLE vm_pvect MODIFY COLUMN id INT ( 11 ) AUTO_INCREMENT ; -- Add back FK ALTER TABLE vm_sshkey ADD CONSTRAINT ` vm_sshkey_ct_id_8bfb3d03_fk_vm_pvect_id ` FOREIGN KEY ( ` ct_id ` ) REFERENCES ` vm_pvect ` ( ` id ` ); \u4ee3\u7801\u90e8\u5206\u89c1 Pull Request #1 \u5176\u4ed6 \u00b6 \u5c06 /mnt/container-template \u91cd\u547d\u540d\u4e3a\u4e86\u66f4\u7b80\u6d01\u7684 /mnt/vz \u3002\u7531\u4e8e PVE \u7684\u4e00\u4e9b\u8bbe\u5b9a\uff0c\u64cd\u4f5c\u987a\u5e8f\u5982\u4e0b\uff1a \u5728\u6240\u6709\u673a\u5668\u4e0a mkdir /mnt/vz \uff0c\u66f4\u65b0 /etc/fstab \u7136\u540e\u6302\u8f7d\u65b0\u8def\u5f84 \u7f16\u8f91 /etc/pve/storage.cfg \u4f7f\u7528\u65b0\u8def\u5f84 \u5728\u6240\u6709\u673a\u5668\u4e0a umount /mnt/container-template \u5378\u8f7d\u65e7\u8def\u5f84\u5e76 rmdir -p \u5728 pv1-pv8 \u4ee5\u53ca web \u5bb9\u5668\u4e2d\u8fdb\u884c\u4e86\u7cfb\u7edf\u66f4\u65b0\uff08\u4e0a\u6e38\u5747\u66f4\u6362\u4e3a\u4e86\u79d1\u5927\u6e90\uff09\uff0c\u5e76\u5728 pv1, pv7, pv8 \u4e0a\u5b89\u88c5\u4e86 apt-listbugs \uff08\u5b89\u88c5\u65f6\u4f7f\u7528 --no-install-recommends \u51cf\u5c11\u9644\u5e26\u7684\u5783\u573e\uff09 \u66f4\u65b0\u4e86 iptables \u9632\u706b\u5899\u89c4\u5219 \u66f4\u65b0\u4e86 lvm.conf \u91cc\u7684\u6392\u9664\u89c4\u5219 global_filters \uff0c\u4f7f\u7528 /dev/disk/by-id/usb.* \u6765\u6392\u9664\u90a3\u4e2a\u6c38\u8fdc No medium found \u7684\u8bbe\u5907\uff0c\u4ee5\u907f\u514d\u6f5c\u5728\u7684\u91cd\u542f\u540e sda/sdb \u4ea4\u6362\u5bfc\u81f4\u7684\u95ee\u9898\uff08\u89c1 \u8e29\u5751\u8bb0\u5f55 \uff09","title":"2021 \u5e74 6 \u6708 13 \u65e5"},{"location":"records/2021-06-13/#2021-6-13","text":"","title":"2021 \u5e74 6 \u6708 13 \u65e5\u5de5\u4f5c\u603b\u7ed3"},{"location":"records/2021-06-13/#django-id","text":"\u540c\u65f6\u6539\u6570\u636e\u5e93\u548c Django \u4ee3\u7801\uff0c\u6e05\u7406\u6389 VMID_INCR \u8fd9\u4e2a\u5386\u53f2\u5305\u88b1\u3002 -- Drop foreign key -- https://stackoverflow.com/posts/comments/32882353 ALTER TABLE vm_sshkey DROP CONSTRAINT ` vm_sshkey_ct_id_8bfb3d03_fk_vm_pvect_id ` ; -- Remove auto increment and PK -- https://stackoverflow.com/a/6741189/5958455 ALTER TABLE vm_pvect MODIFY COLUMN id INT ( 11 ); ALTER TABLE vm_pvect DROP PRIMARY KEY ; -- Work data UPDATE vm_pvect SET id = id + 1000 ; UPDATE vm_sshkey SET ct_id = ct_id + 1000 ; -- Add back AI and PK ALTER TABLE vm_pvect ADD PRIMARY KEY ( ` id ` ); ALTER TABLE vm_pvect MODIFY COLUMN id INT ( 11 ) AUTO_INCREMENT ; -- Add back FK ALTER TABLE vm_sshkey ADD CONSTRAINT ` vm_sshkey_ct_id_8bfb3d03_fk_vm_pvect_id ` FOREIGN KEY ( ` ct_id ` ) REFERENCES ` vm_pvect ` ( ` id ` ); \u4ee3\u7801\u90e8\u5206\u89c1 Pull Request #1","title":"\u79fb\u9664 Django \u4ee3\u7801\u91cc\u7684\u201c\u865a\u62df\u673a ID \u504f\u79fb\u91cf\u201d"},{"location":"records/2021-06-13/#_1","text":"\u5c06 /mnt/container-template \u91cd\u547d\u540d\u4e3a\u4e86\u66f4\u7b80\u6d01\u7684 /mnt/vz \u3002\u7531\u4e8e PVE \u7684\u4e00\u4e9b\u8bbe\u5b9a\uff0c\u64cd\u4f5c\u987a\u5e8f\u5982\u4e0b\uff1a \u5728\u6240\u6709\u673a\u5668\u4e0a mkdir /mnt/vz \uff0c\u66f4\u65b0 /etc/fstab \u7136\u540e\u6302\u8f7d\u65b0\u8def\u5f84 \u7f16\u8f91 /etc/pve/storage.cfg \u4f7f\u7528\u65b0\u8def\u5f84 \u5728\u6240\u6709\u673a\u5668\u4e0a umount /mnt/container-template \u5378\u8f7d\u65e7\u8def\u5f84\u5e76 rmdir -p \u5728 pv1-pv8 \u4ee5\u53ca web \u5bb9\u5668\u4e2d\u8fdb\u884c\u4e86\u7cfb\u7edf\u66f4\u65b0\uff08\u4e0a\u6e38\u5747\u66f4\u6362\u4e3a\u4e86\u79d1\u5927\u6e90\uff09\uff0c\u5e76\u5728 pv1, pv7, pv8 \u4e0a\u5b89\u88c5\u4e86 apt-listbugs \uff08\u5b89\u88c5\u65f6\u4f7f\u7528 --no-install-recommends \u51cf\u5c11\u9644\u5e26\u7684\u5783\u573e\uff09 \u66f4\u65b0\u4e86 iptables \u9632\u706b\u5899\u89c4\u5219 \u66f4\u65b0\u4e86 lvm.conf \u91cc\u7684\u6392\u9664\u89c4\u5219 global_filters \uff0c\u4f7f\u7528 /dev/disk/by-id/usb.* \u6765\u6392\u9664\u90a3\u4e2a\u6c38\u8fdc No medium found \u7684\u8bbe\u5907\uff0c\u4ee5\u907f\u514d\u6f5c\u5728\u7684\u91cd\u542f\u540e sda/sdb \u4ea4\u6362\u5bfc\u81f4\u7684\u95ee\u9898\uff08\u89c1 \u8e29\u5751\u8bb0\u5f55 \uff09","title":"\u5176\u4ed6"},{"location":"references/desktop/","text":"X Desktop \u56fe\u6807\u914d\u7f6e \u00b6 Xilinx Vivado \u00b6 [Desktop Entry] Name = Vivado 2019.1 Exec = /opt/vlab/bin/vivado Icon = /opt/vlab/vivado/Xilinx/Vivado/2019.1/doc/images/vivado_logo.png Terminal = false Type = Application X-Desktop-File-Install-Version = 0.23","title":"desktop \u684c\u9762\u56fe\u6807\u6587\u4ef6"},{"location":"references/desktop/#x-desktop","text":"","title":"X Desktop \u56fe\u6807\u914d\u7f6e"},{"location":"references/desktop/#xilinx-vivado","text":"[Desktop Entry] Name = Vivado 2019.1 Exec = /opt/vlab/bin/vivado Icon = /opt/vlab/vivado/Xilinx/Vivado/2019.1/doc/images/vivado_logo.png Terminal = false Type = Application X-Desktop-File-Install-Version = 0.23","title":"Xilinx Vivado"},{"location":"references/pve-ids/","text":"Proxmox \u865a\u62df\u673a ID \u5206\u914d \u00b6 ID \u6216 ID \u6bb5 \u5206\u914d\u60c5\u51b5 100-199 vlab \u670d\u52a1 \u5982 gateway, web \u7b49 200-799 \u672a\u5206\u914d 800-899 \u6258\u7ba1\u5728 vlab \u4e0a\u7684\u5176\u4ed6\u670d\u52a1 \u5982 USTC OJ, Verilog OJ \u7b49 900-999 vlab \u7ef4\u62a4\u5c0f\u7ec4\u81ea\u5df1\u4f7f\u7528\u7684\u865a\u62df\u673a 1000-? \u7528\u6237\u521b\u5efa\u7684\u865a\u62df\u673a","title":"Proxmox ID \u5206\u914d\u8868"},{"location":"references/pve-ids/#proxmox-id","text":"ID \u6216 ID \u6bb5 \u5206\u914d\u60c5\u51b5 100-199 vlab \u670d\u52a1 \u5982 gateway, web \u7b49 200-799 \u672a\u5206\u914d 800-899 \u6258\u7ba1\u5728 vlab \u4e0a\u7684\u5176\u4ed6\u670d\u52a1 \u5982 USTC OJ, Verilog OJ \u7b49 900-999 vlab \u7ef4\u62a4\u5c0f\u7ec4\u81ea\u5df1\u4f7f\u7528\u7684\u865a\u62df\u673a 1000-? \u7528\u6237\u521b\u5efa\u7684\u865a\u62df\u673a","title":"Proxmox \u865a\u62df\u673a ID \u5206\u914d"},{"location":"references/ustccas/","text":"\u7edf\u4e00\u8eab\u4efd\u8ba4\u8bc1\u8d44\u6599 \u00b6 \u54cd\u5e94\u6837\u4f8b \u00b6 \u6ce8\uff1a\u975e\u539f\u59cb\u54cd\u5e94\uff0c\u5df2\u89e3\u6790\u4e3a Python dict \uff1a { 'xbm' : '1' , 'logintime' : '2020-02-30 12:34:56' , 'gid' : '2201234567' , 'ryzxztdm' : '10' , 'ryfldm' : '201030000' , 'loginip' : '192.0.2.0' , 'name' : '\u5f20\u4e09' , 'login' : 'PB17000001' , 'zjhm' : 'PB17000001' , 'glzjh' : 'SA21011000 \\t PB17000001' , 'deptCode' : '011' , 'email' : 'noreply@mail.ustc.edu.cn' } \u4eba\u5458\u5728\u6821\u72b6\u6001\u7801 \u00b6 id,sfztm,sfzt 1,10,\u5728\u6821 2,20,\u79bb\u6821\uff08\u542b\u6821\u5185\u8eab\u4efd\u7ed3\u675f\uff09 3,30,\u6821\u5185\u8eab\u4efd\u8f6c\u6362 5,40,\u79bb\u9000\u4f11 6,50,\"\u6682\u65f6\u79bb\u6821(\u4f11\u5b66/\u51fa\u56fd\u7b49)\" 7,99,\u5176\u4ed6 8,91,\u8bc1\u4ef6\u505c\u7528\u6216\u6ce8\u9500 \u4eba\u5458\u5206\u7c7b\u7801 \u00b6 id,ryflm,ryfl 1,101010000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u6559\u5b66\u5c97 2,101020000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u79d1\u7814\u5c97 3,101030000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u7ba1\u7406\u5c97 4,101040000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u652f\u6491\u5c97 5,101ZZ0000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u5176\u4ed6\u5c97\u6216\u672a\u660e\u5c97 6,201010000,\u5b66\u751f-\u6b63\u5f0f\u79d1\u5b66\u5b66\u4f4d\u535a\u58eb 7,201020000,\u5b66\u751f-\u6b63\u5f0f\u79d1\u5b66\u5b66\u4f4d\u7855\u58eb 8,201030000,\u5b66\u751f-\u6b63\u5f0f\u672c\u79d1 9,201040000,\u5b66\u751f-\u6b63\u5f0f\u5b66\u751f\u4e13\u79d1 10,201ZZ0000,\u5b66\u751f-\u6b63\u5f0f\u5b66\u751f\u5176\u4ed6\u6216\u672a\u77e5\u5c42\u6b21 11,202010000,\u5b66\u751f-\u4e13\u4e1a\u5b66\u4f4d\u535a\u58eb 12,202020000,\u5b66\u751f-\u4e13\u4e1a\u5b66\u4f4d\u7855\u58eb 13,202ZZ0000,\u5b66\u751f-\u4e13\u4e1a\u5b66\u4f4d\u5176\u4ed6\u6216\u672a\u77e5\u5c42\u6b21 14,240030000,\u5b66\u751f-\u591c\u5927\u51fd\u6388\u57f9\u8bad\u73ed\u672c\u79d1 15,240040000,\u5b66\u751f-\u591c\u5927\u51fd\u6570\u57f9\u8bad\u73ed\u4e13\u79d1 16,240ZZ0000,\u5b66\u751f-\u591c\u5927\u51fd\u6570\u57f9\u8bad\u73ed\u5176\u4ed6\u6216\u672a\u77e5\u5c42\u6b21 17,290ZZ0000,\u77ed\u671f\u57f9\u8bad\u5b66\u751f 18,2ZZZZ0000,\u5b66\u751f-\u5176\u4ed6\u7c7b\u578b\u5b66\u751f 19,300000000,\u535a\u58eb\u540e 20,901000000,\u6765\u8bbf\u4eba\u5458-\u4e0a\u7ea7\u90e8\u95e8\u5404\u79cd\u7c7b\u578b\u6765\u8bbf\u4eba\u5458 21,902000000,\u4ea4\u6d41\u8bbf\u95ee\u8fdb\u4fee\u4eba\u5458 22,903000000,\u6765\u8bbf\u4eba\u5458-\u9080\u8bf7\u6765\u7684\u8bb2\u5ea7\u3001\u6f14\u51fa\u3001\u4ea4\u6d41\u4eba\u5458 23,904000000,\u6765\u8bbf\u4eba\u5458-\u53c2\u52a0\u4f1a\u8bae\u4eba\u5458 24,905000000,\u6765\u8bbf\u4eba\u5458-\u6765\u6821\u53c2\u89c2\u4eba\u5458 25,906000000,\u6765\u8bbf\u4eba\u5458-\u5b66\u751f\u5bb6\u957f 26,9ZZ000000,\u6765\u8bbf\u4eba\u5458-\u5176\u4ed6\u6765\u8bbf\u4eba\u5458 27,Z01000000,\u6559\u5de5\u5bb6\u5c5e 28,Z02000000,\u9644\u4e2d\u5b66\u751f 29,ZZZ000000,\u5176\u4ed6\u4eba\u5458 30,103ZZ0000,\u6559\u5de5-\u6821\u8058\u7528\u4eba\u5458\u5176\u4ed6\u5c97\u6216\u672a\u660e\u5c97 31,180ZZ0000,\u5404\u5355\u4f4d\u81ea\u8058\u4eba\u5458 33,190ZZ0000,\u5404\u5355\u4f4d\u4e34\u65f6\u8058\u7528\u4eba\u5458 34,301000000,\u6821\u5185\u535a\u58eb\u540e 35,309000000,\u4f01\u4e1a\u535a\u58eb\u540e","title":"\u7edf\u4e00\u8eab\u4efd\u8ba4\u8bc1"},{"location":"references/ustccas/#_1","text":"","title":"\u7edf\u4e00\u8eab\u4efd\u8ba4\u8bc1\u8d44\u6599"},{"location":"references/ustccas/#_2","text":"\u6ce8\uff1a\u975e\u539f\u59cb\u54cd\u5e94\uff0c\u5df2\u89e3\u6790\u4e3a Python dict \uff1a { 'xbm' : '1' , 'logintime' : '2020-02-30 12:34:56' , 'gid' : '2201234567' , 'ryzxztdm' : '10' , 'ryfldm' : '201030000' , 'loginip' : '192.0.2.0' , 'name' : '\u5f20\u4e09' , 'login' : 'PB17000001' , 'zjhm' : 'PB17000001' , 'glzjh' : 'SA21011000 \\t PB17000001' , 'deptCode' : '011' , 'email' : 'noreply@mail.ustc.edu.cn' }","title":"\u54cd\u5e94\u6837\u4f8b"},{"location":"references/ustccas/#_3","text":"id,sfztm,sfzt 1,10,\u5728\u6821 2,20,\u79bb\u6821\uff08\u542b\u6821\u5185\u8eab\u4efd\u7ed3\u675f\uff09 3,30,\u6821\u5185\u8eab\u4efd\u8f6c\u6362 5,40,\u79bb\u9000\u4f11 6,50,\"\u6682\u65f6\u79bb\u6821(\u4f11\u5b66/\u51fa\u56fd\u7b49)\" 7,99,\u5176\u4ed6 8,91,\u8bc1\u4ef6\u505c\u7528\u6216\u6ce8\u9500","title":"\u4eba\u5458\u5728\u6821\u72b6\u6001\u7801"},{"location":"references/ustccas/#_4","text":"id,ryflm,ryfl 1,101010000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u6559\u5b66\u5c97 2,101020000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u79d1\u7814\u5c97 3,101030000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u7ba1\u7406\u5c97 4,101040000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u652f\u6491\u5c97 5,101ZZ0000,\u6559\u5de5-\u6b63\u5f0f\u7f16\u5236\u5176\u4ed6\u5c97\u6216\u672a\u660e\u5c97 6,201010000,\u5b66\u751f-\u6b63\u5f0f\u79d1\u5b66\u5b66\u4f4d\u535a\u58eb 7,201020000,\u5b66\u751f-\u6b63\u5f0f\u79d1\u5b66\u5b66\u4f4d\u7855\u58eb 8,201030000,\u5b66\u751f-\u6b63\u5f0f\u672c\u79d1 9,201040000,\u5b66\u751f-\u6b63\u5f0f\u5b66\u751f\u4e13\u79d1 10,201ZZ0000,\u5b66\u751f-\u6b63\u5f0f\u5b66\u751f\u5176\u4ed6\u6216\u672a\u77e5\u5c42\u6b21 11,202010000,\u5b66\u751f-\u4e13\u4e1a\u5b66\u4f4d\u535a\u58eb 12,202020000,\u5b66\u751f-\u4e13\u4e1a\u5b66\u4f4d\u7855\u58eb 13,202ZZ0000,\u5b66\u751f-\u4e13\u4e1a\u5b66\u4f4d\u5176\u4ed6\u6216\u672a\u77e5\u5c42\u6b21 14,240030000,\u5b66\u751f-\u591c\u5927\u51fd\u6388\u57f9\u8bad\u73ed\u672c\u79d1 15,240040000,\u5b66\u751f-\u591c\u5927\u51fd\u6570\u57f9\u8bad\u73ed\u4e13\u79d1 16,240ZZ0000,\u5b66\u751f-\u591c\u5927\u51fd\u6570\u57f9\u8bad\u73ed\u5176\u4ed6\u6216\u672a\u77e5\u5c42\u6b21 17,290ZZ0000,\u77ed\u671f\u57f9\u8bad\u5b66\u751f 18,2ZZZZ0000,\u5b66\u751f-\u5176\u4ed6\u7c7b\u578b\u5b66\u751f 19,300000000,\u535a\u58eb\u540e 20,901000000,\u6765\u8bbf\u4eba\u5458-\u4e0a\u7ea7\u90e8\u95e8\u5404\u79cd\u7c7b\u578b\u6765\u8bbf\u4eba\u5458 21,902000000,\u4ea4\u6d41\u8bbf\u95ee\u8fdb\u4fee\u4eba\u5458 22,903000000,\u6765\u8bbf\u4eba\u5458-\u9080\u8bf7\u6765\u7684\u8bb2\u5ea7\u3001\u6f14\u51fa\u3001\u4ea4\u6d41\u4eba\u5458 23,904000000,\u6765\u8bbf\u4eba\u5458-\u53c2\u52a0\u4f1a\u8bae\u4eba\u5458 24,905000000,\u6765\u8bbf\u4eba\u5458-\u6765\u6821\u53c2\u89c2\u4eba\u5458 25,906000000,\u6765\u8bbf\u4eba\u5458-\u5b66\u751f\u5bb6\u957f 26,9ZZ000000,\u6765\u8bbf\u4eba\u5458-\u5176\u4ed6\u6765\u8bbf\u4eba\u5458 27,Z01000000,\u6559\u5de5\u5bb6\u5c5e 28,Z02000000,\u9644\u4e2d\u5b66\u751f 29,ZZZ000000,\u5176\u4ed6\u4eba\u5458 30,103ZZ0000,\u6559\u5de5-\u6821\u8058\u7528\u4eba\u5458\u5176\u4ed6\u5c97\u6216\u672a\u660e\u5c97 31,180ZZ0000,\u5404\u5355\u4f4d\u81ea\u8058\u4eba\u5458 33,190ZZ0000,\u5404\u5355\u4f4d\u4e34\u65f6\u8058\u7528\u4eba\u5458 34,301000000,\u6821\u5185\u535a\u58eb\u540e 35,309000000,\u4f01\u4e1a\u535a\u58eb\u540e","title":"\u4eba\u5458\u5206\u7c7b\u7801"},{"location":"servers/ct100/","text":"\u7f51\u5173\u673a (CT 100) \u00b6 \u7f51\u5173\u673a\u987e\u540d\u601d\u4e49\u5c31\u662f\uff08\u5bb9\u5668\u5185\u7f51\u7684\uff09\u7f51\u5173\uff0c\u540c\u65f6\u63a5\u5165\u4e86\u5bb9\u5668\u5185\u7f51\uff08 vmbr1 / eth1 / 172.31.0.1/16 , 172.30.0.1/24 \uff09\u548c\u6821\u56ed\u7f51\uff08 vmbr0 / eth0 / 202.38.75.252/24 \uff09\uff0c\u901a\u8fc7 NAT \u63d0\u4f9b\u5185\u7f51\u673a\u5668\u7684\u5bf9\u5916\u8bbf\u95ee\u4ee5\u53ca\u5c06\u5185\u7f51\u673a\u5668\u7684 SSH \u7aef\u53e3\u8f6c\u53d1\u5230\u516c\u7f51\u4e0a\u3002 \u8be5\u5bb9\u5668\u914d\u7f6e\u4e3a\u56db\u6838 8G\uff0c\u4ec5\u8fd0\u884c\u4e86\u57fa\u672c\u7cfb\u7edf\u7ec4\u4ef6\uff08\u4e3b\u8981\u662f iptables \u548c radvd\uff09\u3002 \u5185\u7f51\u4e0a\u7f51\u8f6c\u53d1 \u00b6 \u5185\u7f51\u865a\u62df\u673a\uff08172.31.0.0/16\uff0c172.30.0.0/24\uff09\u7684\u6240\u6709\u5230\u5916\u7f51\u6d41\u91cf\u90fd\u901a\u8fc7\u672c\u673a\u8f6c\u53d1\uff0c\u8f6c\u53d1\u901a\u8fc7 iptables \u8bbe\u7f6e\uff0c\u7531\u5185\u6838\u5b8c\u6210\uff0c\u56e0\u6b64\u672c\u5bb9\u5668\u4e2d\u7684 iptables \u89c4\u5219\u5341\u5206\u91cd\u8981\u3002\u4e0b\u9762\u89e3\u91ca\u8bbe\u7f6e\u6587\u4ef6 iptables.sh \uff08\u66fe\u7ecf\u4f4d\u4e8e /root \u4e0b\uff0c\u5728 2020 \u5e74 11 \u6708 rootfs \u635f\u574f\u540e\u4e22\u5931\uff0c \u73b0\u5728\u7684\u505a\u6cd5 \u662f\u76f4\u63a5\u624b\u52a8 /etc/iptables/rules.v4 / rules.v6 \uff09\u3002 \u9632\u706b\u5899\u90e8\u5206 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 ### IPv4 ### iptables -P INPUT DROP iptables -P FORWARD ACCEPT iptables -P OUTPUT ACCEPT iptables -F iptables -X iptables -N VLAB iptables -A VLAB -i lo -j ACCEPT iptables -A VLAB -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT iptables -A VLAB -p tcp --dport 22 -j ACCEPT iptables -A VLAB -p tcp --dport 1024 ! -s 202 .38.75.226 -j DROP iptables -A INPUT -j VLAB \u5f00\u5934\u7684\u90e8\u5206 1-6 \u884c\u521d\u59cb\u5316 iptables \u8bbe\u7f6e\uff0c\u6ce8\u610f\u5230\u8f6c\u53d1\u7684\u6d41\u91cf\u8d70\u7684\u662f FORWARD \u94fe\u800c\u4e0d\u662f INPUT \u94fe\uff0c\u6240\u4ee5\u6709 -P FORWARD ACCEPT \u3002\u7b2c 7 \u884c\u521b\u5efa VLAB \u94fe\u653e\u6211\u4eec\u81ea\u5df1\u7684 rules\u3002 9-13 \u884c\u8fd9\u90e8\u5206\u540c \u9632\u706b\u5899 \u3002\u4e0b\u9762\u7684 15 \u884c\u4e5f\u76f8\u540c\u3002 \u8f6c\u53d1\u9632\u706b\u5899\u90e8\u5206 \u00b6 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #iptables -A FORWARD -p udp -m state --ctstate NEW -j NFLOG --nflog-prefix '[vlab]' iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT iptables -A FORWARD -p tcp --dport 25 -j DROP # Block SMTP iptables -A FORWARD -i eth0 -o eth1 -p tcp --dport 22 -m state --state NEW -j NFLOG --nflog-prefix '[vlab]' iptables -A FORWARD -i eth0 -o eth1 -p tcp --dport 22 --tcp-flag FIN FIN -j NFLOG --nflog-prefix '[vlab]' iptables -A FORWARD -i eth0 -o eth1 -p tcp --dport 22 --tcp-flag RST RST -j NFLOG --nflog-prefix '[vlab]' iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT iptables -A FORWARD -d 10 .0.0.0/8 -j DROP iptables -A FORWARD -d 172 .16.0.0/12 -j DROP iptables -A FORWARD -d 192 .168.0.0/16 -j DROP iptables -A FORWARD -d 202 .38.64.58/31 -j DROP iptables -A FORWARD -d 202 .38.96.193 -j DROP iptables -A FORWARD -d 210 .45.224.65 -j DROP iptables -Z 16 \u884c\u5c4f\u853d\u8fde\u63a5\u8fdc\u7aef 25\uff08SMTP\uff09\u7aef\u53e3\uff0c\u9632\u6b62\u6709\u4eba\u53d1\u5783\u573e\u90ae\u4ef6\uff0c\u8fd9\u548c LUG VPN \u4e00\u6837\u3002\u73b0\u5728\u7684\u4e92\u8054\u7f51\u5bf9\u5783\u573e\u90ae\u4ef6\u5f88\u654f\u611f\uff0c\u5f88\u5bb9\u6613\u56e0\u6b64\u7ed9 IP \u5730\u5740\u751a\u81f3\u6821\u56ed\u7f51 AS \u5e26\u6765\u4e0d\u597d\u7684\u58f0\u8a89\uff0c\u6240\u4ee5\u5c4f\u853d\u6389\u3002 17-19 \u884c\u5c1d\u8bd5\u8bb0\u5f55\u6bcf\u4e2a TCP \u8fde\u63a5\uff0c\u7531\u4e8e LXC \u91cc\u7684 iptables \u65e0\u6cd5\u8bbf\u95ee rsyslog 1 \uff0c\u6211\u4eec\u4f7f\u7528 ulogd2 \u7684\u529e\u6cd5 2 \u3002\u4e0d\u8fc7\u60c5\u51b5\u662f\uff0c\u7531\u4e8e\u6570\u636e\u91cf\u592a\u5927\uff0c ulogd2.service \u73b0\u5728\u88ab\u5173\u6389\u4e86\uff08LOL...\uff09 21-23 \u884c\u5c4f\u853d\u5185\u7f51\u8bbf\u95ee\uff0c\u867d\u7136\u8fd9\u4e9b IP \u6bb5\u4e5f\u6709\u4e00\u4e9b\u6821\u56ed\u7f51\u8def\u7531\uff0c\u4e0d\u8fc7\u8fd9\u4e0d\u662f vlab \u7684\u670d\u52a1\u76ee\u7684\uff0c\u6240\u4ee5\u4e00\u8d77\u5c4f\u853d\u6389\u4e5f\u65e0\u6240\u8c13\u3002 24-26 \u884c\u5c4f\u853d \u7f51\u7edc\u901a \uff0c\u907f\u514d\u6211\u4eec\u7684\u51fa\u53e3 IP \u8bbe\u7f6e\u88ab\u6539\uff08\u8fd9\u4e2a\u53c8\u548c LUG VPN \u4e00\u6837\uff09\u3002\u7f51\u7edc\u901a\u4e00\u5171\u6709 4 \u4e2a IP\uff0c\u5176\u4e2d 202.38.64.{58,59} \u662f\u76f8\u90bb\u7684\uff0c\u6240\u4ee5\u5408\u5e76\u8d77\u6765\u7528\u4e00\u4e2a /31 \u7684\u7f51\u6bb5\u505a\u89c4\u5219\u3002 \u8f6c\u53d1 NAT \u90e8\u5206 \u00b6 29 30 31 32 33 34 35 36 37 38 39 40 iptables -t nat -F PREROUTING iptables -t nat -F POSTROUTING #iptables -t nat -X iptables -t nat -N VLAB_STUDENT >/dev/null 2 > & 1 iptables -t nat -A PREROUTING -i eth1 -d 202 .38.64.58/31 -j DNAT --to-destination 202 .38.75.226 iptables -t nat -A PREROUTING -i eth1 -d 202 .38.96.193/32 -j DNAT --to-destination 202 .38.75.226 iptables -t nat -A PREROUTING -i eth1 -d 210 .45.224.65/32 -j DNAT --to-destination 202 .38.75.226 iptables -t nat -A PREROUTING -i eth0 -p tcp -m tcp --dport 10001 :29999 -j VLAB_STUDENT iptables -t nat -A POSTROUTING -s 172 .30.0.0/15 -j MASQUERADE iptables -t nat -A POSTROUTING -s 10 .38.79.0/24 -j MASQUERADE #iptables -t nat -Z iptables-save -f /etc/iptables/rules.v4 NAT \u90e8\u5206\u6211\u4eec\u53ea\u7528\u5230\u4e86 PREROUTING \u548c POSTROUTING \u4e24\u4e2a\u94fe\uff08\u8fd9\u662f\u5178\u578b\u6a21\u5f0f\uff09\u3002 32 \u884c\u521b\u5efa VLAB_STUDENT \u94fe\u7ed9 pfserver \u7a0b\u5e8f\u7528\u3002 33-35 \u884c\u628a\u5c1d\u8bd5\u8bbf\u95ee\u7f51\u7edc\u901a\u7684\u6d41\u91cf\u90fd\u52ab\u6301\u5230 web \u5bb9\u5668\u4e2d\uff0c\u8fd9\u6837\u5c31\u80fd\u663e\u793a\u201c\u7f51\u7edc\u901a\u88ab\u5c4f\u853d\u201d\u7684\u6d88\u606f\u4e86\u3002 36 \u884c\u63d0\u4f9b VLAB_STUDENT \u94fe\u7684\u5165\u53e3\uff0c\u8be5\u5165\u53e3\u9650\u5236\u4e86\u53ea\u6709 10001:29999 \u4e4b\u95f4\uff08inclusive\uff09\u7684\u7aef\u53e3\u80fd\u591f\u88ab\u8f6c\u53d1\u3002 37 \u662f\u51fa\u53e3 NAT\uff0c\u5bf9\u4e8e\u8f6c\u53d1\u51fa\u53bb\u7684\u6d41\u91cf\uff0c\u6839\u636e\u6e90\u5730\u5740\u8fdb\u884c NAT\u3002\uff08POSTROUTING \u94fe\u4e2d\u6ca1\u6709 -i \u53ef\u7528\uff09\uff0c38 \u884c\u7c7b\u4f3c\uff08\u6b64\u5904\u5ffd\u7565\uff09 MTU \u8bbe\u7f6e \u00b6 ip link set dev eth0 mtu 1500 \uff08\u65b0\u5efa\u65f6\u53ef\u80fd\u4f1a\u662f 1450\uff0c\u914d\u7f6e\u9519\u8bef\u4f1a\u5bfc\u81f4\u5b66\u751f\u5bb9\u5668\u770b\u8d77\u6765\u7f51\u7edc\u6b63\u5e38\uff0c\u4f46\u662f\u7f51\u7edc\u4f1a\u5e38\u5e38\u5361\u4f4f\uff09 radvd \u00b6 radvd \u662f IPv6 \u7684 Router Advertisement Daemon\uff0c\u7528\u4e8e\u5411\u865a\u62df\u673a\u63d0\u4f9b IPv6 RA \u4f7f\u5f97\u865a\u62df\u673a\u53ef\u4ee5\u4f7f\u7528 SLAAC \u81ea\u52a8\u914d\u7f6e IPv6 \u7f51\u7edc\u3002 /etc/radvd.conf \u914d\u7f6e\u5982\u4e0b\uff1a interface eth1 { AdvSendAdvert on; MinRtrAdvInterval 3; MaxRtrAdvInterval 10; AdvDefaultPreference medium; AdvHomeAgentFlag off; prefix 2001:da8:d800:4bfc::/64 { AdvOnLink on; AdvAutonomous on; AdvRouterAddr on; }; }; \u6545\u969c \u00b6 2020 \u5e74 11 \u6708 16 \u65e5\u53d1\u73b0\u8be5\u5bb9\u5668\u65e0\u6cd5\u767b\u5f55\uff0c\u8fdb\u4e00\u6b65\u68c0\u67e5\u53d1\u73b0\u5176 rootfs \u5df2\u5b8c\u5168\u635f\u574f\u65e0\u6cd5\u6062\u590d\u3002\u7531\u4e8e iptables \u89c4\u5219\u662f\u8fd0\u884c\u5728\u5185\u6838\u4e2d\u7684\uff0c\u5176\u671f\u671b\u529f\u80fd\uff08\u4f5c\u4e3a\u7f51\u5173\uff09\u6ca1\u6709\u53d7\u5230\u5f71\u54cd\u3002\u8003\u8651\u5230\u5931\u63a7\u7684\u5371\u5bb3\uff08\u8be5\u5bb9\u5668\u4e0d\u80fd\u91cd\u542f\uff0c\u5426\u5219\u5c31\u518d\u4e5f\u5f00\u4e0d\u8d77\u6765\u4e86\uff09\uff0c\u5df2\u4ece\u8fd8\u5728\u8fd0\u884c\u7684 namespace \u4e2d\u63d0\u53d6\u51fa iptables \u89c4\u5219\uff0c\u5e76\u91cd\u5efa\u4f5c\u4e3a\u66ff\u4ee3\u3002\u65b0\u7684 CT 100 \u5c06 rootfs \u7f29\u5c0f\u5230\u4e86 2 GB\uff0c\u914d\u7f6e\u597d\u4e86 iptables-persistent \u548c radvd\u3002 \u4e8b\u540e\u67e5\u660e\u6545\u969c\u539f\u56e0\u4e3a\uff0cPVE \u6d4b\u8bd5\u8282\u70b9\u672a\u52a0\u5165\u96c6\u7fa4\uff0c\u4f46\u662f\u4f7f\u7528\u4e86\u76f8\u540c\u7684 LVM \u5b58\u50a8\uff0c\u5bfc\u81f4\u5728\u521b\u5efa/\u5220\u9664 LVM \u5377\u65f6\uff0cLVM \u6ca1\u6709\u6b63\u786e\u88ab\u9501\u5b9a\u3002\u5728\u6d4b\u8bd5\u8282\u70b9\u5220\u9664\u5176\u4e0a\u7684 CT 100 \u65f6\uff0c\u51fa\u73b0\u6df7\u4e71\u3002 Logging from iptables to rsyslog inside container fails. - Linux Continers Mailing Lists \u21a9 iptables logging inside LXC containers - Proxmox Support Forum \u21a9","title":"\u7f51\u5173 (CT 100)"},{"location":"servers/ct100/#ct-100","text":"\u7f51\u5173\u673a\u987e\u540d\u601d\u4e49\u5c31\u662f\uff08\u5bb9\u5668\u5185\u7f51\u7684\uff09\u7f51\u5173\uff0c\u540c\u65f6\u63a5\u5165\u4e86\u5bb9\u5668\u5185\u7f51\uff08 vmbr1 / eth1 / 172.31.0.1/16 , 172.30.0.1/24 \uff09\u548c\u6821\u56ed\u7f51\uff08 vmbr0 / eth0 / 202.38.75.252/24 \uff09\uff0c\u901a\u8fc7 NAT \u63d0\u4f9b\u5185\u7f51\u673a\u5668\u7684\u5bf9\u5916\u8bbf\u95ee\u4ee5\u53ca\u5c06\u5185\u7f51\u673a\u5668\u7684 SSH \u7aef\u53e3\u8f6c\u53d1\u5230\u516c\u7f51\u4e0a\u3002 \u8be5\u5bb9\u5668\u914d\u7f6e\u4e3a\u56db\u6838 8G\uff0c\u4ec5\u8fd0\u884c\u4e86\u57fa\u672c\u7cfb\u7edf\u7ec4\u4ef6\uff08\u4e3b\u8981\u662f iptables \u548c radvd\uff09\u3002","title":"\u7f51\u5173\u673a (CT 100)"},{"location":"servers/ct100/#_1","text":"\u5185\u7f51\u865a\u62df\u673a\uff08172.31.0.0/16\uff0c172.30.0.0/24\uff09\u7684\u6240\u6709\u5230\u5916\u7f51\u6d41\u91cf\u90fd\u901a\u8fc7\u672c\u673a\u8f6c\u53d1\uff0c\u8f6c\u53d1\u901a\u8fc7 iptables \u8bbe\u7f6e\uff0c\u7531\u5185\u6838\u5b8c\u6210\uff0c\u56e0\u6b64\u672c\u5bb9\u5668\u4e2d\u7684 iptables \u89c4\u5219\u5341\u5206\u91cd\u8981\u3002\u4e0b\u9762\u89e3\u91ca\u8bbe\u7f6e\u6587\u4ef6 iptables.sh \uff08\u66fe\u7ecf\u4f4d\u4e8e /root \u4e0b\uff0c\u5728 2020 \u5e74 11 \u6708 rootfs \u635f\u574f\u540e\u4e22\u5931\uff0c \u73b0\u5728\u7684\u505a\u6cd5 \u662f\u76f4\u63a5\u624b\u52a8 /etc/iptables/rules.v4 / rules.v6 \uff09\u3002","title":"\u5185\u7f51\u4e0a\u7f51\u8f6c\u53d1"},{"location":"servers/ct100/#_2","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 ### IPv4 ### iptables -P INPUT DROP iptables -P FORWARD ACCEPT iptables -P OUTPUT ACCEPT iptables -F iptables -X iptables -N VLAB iptables -A VLAB -i lo -j ACCEPT iptables -A VLAB -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT iptables -A VLAB -p tcp --dport 22 -j ACCEPT iptables -A VLAB -p tcp --dport 1024 ! -s 202 .38.75.226 -j DROP iptables -A INPUT -j VLAB \u5f00\u5934\u7684\u90e8\u5206 1-6 \u884c\u521d\u59cb\u5316 iptables \u8bbe\u7f6e\uff0c\u6ce8\u610f\u5230\u8f6c\u53d1\u7684\u6d41\u91cf\u8d70\u7684\u662f FORWARD \u94fe\u800c\u4e0d\u662f INPUT \u94fe\uff0c\u6240\u4ee5\u6709 -P FORWARD ACCEPT \u3002\u7b2c 7 \u884c\u521b\u5efa VLAB \u94fe\u653e\u6211\u4eec\u81ea\u5df1\u7684 rules\u3002 9-13 \u884c\u8fd9\u90e8\u5206\u540c \u9632\u706b\u5899 \u3002\u4e0b\u9762\u7684 15 \u884c\u4e5f\u76f8\u540c\u3002","title":"\u9632\u706b\u5899\u90e8\u5206"},{"location":"servers/ct100/#_3","text":"14 15 16 17 18 19 20 21 22 23 24 25 26 27 #iptables -A FORWARD -p udp -m state --ctstate NEW -j NFLOG --nflog-prefix '[vlab]' iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT iptables -A FORWARD -p tcp --dport 25 -j DROP # Block SMTP iptables -A FORWARD -i eth0 -o eth1 -p tcp --dport 22 -m state --state NEW -j NFLOG --nflog-prefix '[vlab]' iptables -A FORWARD -i eth0 -o eth1 -p tcp --dport 22 --tcp-flag FIN FIN -j NFLOG --nflog-prefix '[vlab]' iptables -A FORWARD -i eth0 -o eth1 -p tcp --dport 22 --tcp-flag RST RST -j NFLOG --nflog-prefix '[vlab]' iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT iptables -A FORWARD -d 10 .0.0.0/8 -j DROP iptables -A FORWARD -d 172 .16.0.0/12 -j DROP iptables -A FORWARD -d 192 .168.0.0/16 -j DROP iptables -A FORWARD -d 202 .38.64.58/31 -j DROP iptables -A FORWARD -d 202 .38.96.193 -j DROP iptables -A FORWARD -d 210 .45.224.65 -j DROP iptables -Z 16 \u884c\u5c4f\u853d\u8fde\u63a5\u8fdc\u7aef 25\uff08SMTP\uff09\u7aef\u53e3\uff0c\u9632\u6b62\u6709\u4eba\u53d1\u5783\u573e\u90ae\u4ef6\uff0c\u8fd9\u548c LUG VPN \u4e00\u6837\u3002\u73b0\u5728\u7684\u4e92\u8054\u7f51\u5bf9\u5783\u573e\u90ae\u4ef6\u5f88\u654f\u611f\uff0c\u5f88\u5bb9\u6613\u56e0\u6b64\u7ed9 IP \u5730\u5740\u751a\u81f3\u6821\u56ed\u7f51 AS \u5e26\u6765\u4e0d\u597d\u7684\u58f0\u8a89\uff0c\u6240\u4ee5\u5c4f\u853d\u6389\u3002 17-19 \u884c\u5c1d\u8bd5\u8bb0\u5f55\u6bcf\u4e2a TCP \u8fde\u63a5\uff0c\u7531\u4e8e LXC \u91cc\u7684 iptables \u65e0\u6cd5\u8bbf\u95ee rsyslog 1 \uff0c\u6211\u4eec\u4f7f\u7528 ulogd2 \u7684\u529e\u6cd5 2 \u3002\u4e0d\u8fc7\u60c5\u51b5\u662f\uff0c\u7531\u4e8e\u6570\u636e\u91cf\u592a\u5927\uff0c ulogd2.service \u73b0\u5728\u88ab\u5173\u6389\u4e86\uff08LOL...\uff09 21-23 \u884c\u5c4f\u853d\u5185\u7f51\u8bbf\u95ee\uff0c\u867d\u7136\u8fd9\u4e9b IP \u6bb5\u4e5f\u6709\u4e00\u4e9b\u6821\u56ed\u7f51\u8def\u7531\uff0c\u4e0d\u8fc7\u8fd9\u4e0d\u662f vlab \u7684\u670d\u52a1\u76ee\u7684\uff0c\u6240\u4ee5\u4e00\u8d77\u5c4f\u853d\u6389\u4e5f\u65e0\u6240\u8c13\u3002 24-26 \u884c\u5c4f\u853d \u7f51\u7edc\u901a \uff0c\u907f\u514d\u6211\u4eec\u7684\u51fa\u53e3 IP \u8bbe\u7f6e\u88ab\u6539\uff08\u8fd9\u4e2a\u53c8\u548c LUG VPN \u4e00\u6837\uff09\u3002\u7f51\u7edc\u901a\u4e00\u5171\u6709 4 \u4e2a IP\uff0c\u5176\u4e2d 202.38.64.{58,59} \u662f\u76f8\u90bb\u7684\uff0c\u6240\u4ee5\u5408\u5e76\u8d77\u6765\u7528\u4e00\u4e2a /31 \u7684\u7f51\u6bb5\u505a\u89c4\u5219\u3002","title":"\u8f6c\u53d1\u9632\u706b\u5899\u90e8\u5206"},{"location":"servers/ct100/#nat","text":"29 30 31 32 33 34 35 36 37 38 39 40 iptables -t nat -F PREROUTING iptables -t nat -F POSTROUTING #iptables -t nat -X iptables -t nat -N VLAB_STUDENT >/dev/null 2 > & 1 iptables -t nat -A PREROUTING -i eth1 -d 202 .38.64.58/31 -j DNAT --to-destination 202 .38.75.226 iptables -t nat -A PREROUTING -i eth1 -d 202 .38.96.193/32 -j DNAT --to-destination 202 .38.75.226 iptables -t nat -A PREROUTING -i eth1 -d 210 .45.224.65/32 -j DNAT --to-destination 202 .38.75.226 iptables -t nat -A PREROUTING -i eth0 -p tcp -m tcp --dport 10001 :29999 -j VLAB_STUDENT iptables -t nat -A POSTROUTING -s 172 .30.0.0/15 -j MASQUERADE iptables -t nat -A POSTROUTING -s 10 .38.79.0/24 -j MASQUERADE #iptables -t nat -Z iptables-save -f /etc/iptables/rules.v4 NAT \u90e8\u5206\u6211\u4eec\u53ea\u7528\u5230\u4e86 PREROUTING \u548c POSTROUTING \u4e24\u4e2a\u94fe\uff08\u8fd9\u662f\u5178\u578b\u6a21\u5f0f\uff09\u3002 32 \u884c\u521b\u5efa VLAB_STUDENT \u94fe\u7ed9 pfserver \u7a0b\u5e8f\u7528\u3002 33-35 \u884c\u628a\u5c1d\u8bd5\u8bbf\u95ee\u7f51\u7edc\u901a\u7684\u6d41\u91cf\u90fd\u52ab\u6301\u5230 web \u5bb9\u5668\u4e2d\uff0c\u8fd9\u6837\u5c31\u80fd\u663e\u793a\u201c\u7f51\u7edc\u901a\u88ab\u5c4f\u853d\u201d\u7684\u6d88\u606f\u4e86\u3002 36 \u884c\u63d0\u4f9b VLAB_STUDENT \u94fe\u7684\u5165\u53e3\uff0c\u8be5\u5165\u53e3\u9650\u5236\u4e86\u53ea\u6709 10001:29999 \u4e4b\u95f4\uff08inclusive\uff09\u7684\u7aef\u53e3\u80fd\u591f\u88ab\u8f6c\u53d1\u3002 37 \u662f\u51fa\u53e3 NAT\uff0c\u5bf9\u4e8e\u8f6c\u53d1\u51fa\u53bb\u7684\u6d41\u91cf\uff0c\u6839\u636e\u6e90\u5730\u5740\u8fdb\u884c NAT\u3002\uff08POSTROUTING \u94fe\u4e2d\u6ca1\u6709 -i \u53ef\u7528\uff09\uff0c38 \u884c\u7c7b\u4f3c\uff08\u6b64\u5904\u5ffd\u7565\uff09","title":"\u8f6c\u53d1 NAT \u90e8\u5206"},{"location":"servers/ct100/#mtu","text":"ip link set dev eth0 mtu 1500 \uff08\u65b0\u5efa\u65f6\u53ef\u80fd\u4f1a\u662f 1450\uff0c\u914d\u7f6e\u9519\u8bef\u4f1a\u5bfc\u81f4\u5b66\u751f\u5bb9\u5668\u770b\u8d77\u6765\u7f51\u7edc\u6b63\u5e38\uff0c\u4f46\u662f\u7f51\u7edc\u4f1a\u5e38\u5e38\u5361\u4f4f\uff09","title":"MTU \u8bbe\u7f6e"},{"location":"servers/ct100/#radvd","text":"radvd \u662f IPv6 \u7684 Router Advertisement Daemon\uff0c\u7528\u4e8e\u5411\u865a\u62df\u673a\u63d0\u4f9b IPv6 RA \u4f7f\u5f97\u865a\u62df\u673a\u53ef\u4ee5\u4f7f\u7528 SLAAC \u81ea\u52a8\u914d\u7f6e IPv6 \u7f51\u7edc\u3002 /etc/radvd.conf \u914d\u7f6e\u5982\u4e0b\uff1a interface eth1 { AdvSendAdvert on; MinRtrAdvInterval 3; MaxRtrAdvInterval 10; AdvDefaultPreference medium; AdvHomeAgentFlag off; prefix 2001:da8:d800:4bfc::/64 { AdvOnLink on; AdvAutonomous on; AdvRouterAddr on; }; };","title":"radvd"},{"location":"servers/ct100/#_4","text":"2020 \u5e74 11 \u6708 16 \u65e5\u53d1\u73b0\u8be5\u5bb9\u5668\u65e0\u6cd5\u767b\u5f55\uff0c\u8fdb\u4e00\u6b65\u68c0\u67e5\u53d1\u73b0\u5176 rootfs \u5df2\u5b8c\u5168\u635f\u574f\u65e0\u6cd5\u6062\u590d\u3002\u7531\u4e8e iptables \u89c4\u5219\u662f\u8fd0\u884c\u5728\u5185\u6838\u4e2d\u7684\uff0c\u5176\u671f\u671b\u529f\u80fd\uff08\u4f5c\u4e3a\u7f51\u5173\uff09\u6ca1\u6709\u53d7\u5230\u5f71\u54cd\u3002\u8003\u8651\u5230\u5931\u63a7\u7684\u5371\u5bb3\uff08\u8be5\u5bb9\u5668\u4e0d\u80fd\u91cd\u542f\uff0c\u5426\u5219\u5c31\u518d\u4e5f\u5f00\u4e0d\u8d77\u6765\u4e86\uff09\uff0c\u5df2\u4ece\u8fd8\u5728\u8fd0\u884c\u7684 namespace \u4e2d\u63d0\u53d6\u51fa iptables \u89c4\u5219\uff0c\u5e76\u91cd\u5efa\u4f5c\u4e3a\u66ff\u4ee3\u3002\u65b0\u7684 CT 100 \u5c06 rootfs \u7f29\u5c0f\u5230\u4e86 2 GB\uff0c\u914d\u7f6e\u597d\u4e86 iptables-persistent \u548c radvd\u3002 \u4e8b\u540e\u67e5\u660e\u6545\u969c\u539f\u56e0\u4e3a\uff0cPVE \u6d4b\u8bd5\u8282\u70b9\u672a\u52a0\u5165\u96c6\u7fa4\uff0c\u4f46\u662f\u4f7f\u7528\u4e86\u76f8\u540c\u7684 LVM \u5b58\u50a8\uff0c\u5bfc\u81f4\u5728\u521b\u5efa/\u5220\u9664 LVM \u5377\u65f6\uff0cLVM \u6ca1\u6709\u6b63\u786e\u88ab\u9501\u5b9a\u3002\u5728\u6d4b\u8bd5\u8282\u70b9\u5220\u9664\u5176\u4e0a\u7684 CT 100 \u65f6\uff0c\u51fa\u73b0\u6df7\u4e71\u3002 Logging from iptables to rsyslog inside container fails. - Linux Continers Mailing Lists \u21a9 iptables logging inside LXC containers - Proxmox Support Forum \u21a9","title":"\u6545\u969c"},{"location":"servers/ct101/","text":"Web \u670d\u52a1\u5668 (CT 101) \u00b6 \u8fd9\u4e2a\u5bb9\u5668\u662f vlab \u5bf9\u5916\u670d\u52a1\u7684\u4e3b\u8981\u573a\u6240\uff0c\u4e0a\u9762\u8fd0\u884c\u4e86\u6211\u4eec\u7684\u5404\u79cd\u7a0b\u5e8f\u3002 \u8be5\u5bb9\u5668\u63a5\u5165\u6821\u56ed\u7f51\uff08 vmbr0 / eth0 / 202.38.75.226/24 \uff0c\u4e14\u8be5 IP \u662f vlab.ustc.edu.cn \u57df\u540d\u6307\u5411\u7684\uff09\u548c\u5bb9\u5668\u5185\u7f51\uff08 vmbr1 / eth1 / 172.31.0.2/16 , 172.30.0.2/24 \uff09\uff0c\u901a\u8fc7\u6821\u56ed\u7f51\u5bf9\u5916\u63d0\u4f9b Web \u670d\u52a1\u3001VNC \u7edf\u4e00\u767b\u5f55\u670d\u52a1\u548c SSH \u7edf\u4e00\u767b\u5f55\u670d\u52a1\uff0c\u901a\u8fc7\u5bb9\u5668\u5185\u7f51\u8fde\u63a5\u5176\u4ed6\u865a\u62df\u673a\u3002\u5c3d\u7ba1\u672c\u5bb9\u5668\u63a5\u5165\u4e86\u4e24\u4e2a\u7f51\u7edc\uff0c\u4f46\u662f \u4e0d\u7528\u4f5c\u8f6c\u53d1 \u3002 \u7531\u4e8e\u8fd9\u4e2a\u5bb9\u5668\u7684 22 \u7aef\u53e3\u7528\u4f5c SSH \u7edf\u4e00\u767b\u5f55\u4e86\uff0c\u56e0\u6b64\u5b83\u81ea\u5df1\u7684 sshd \u5f00\u5728 179 \u7aef\u53e3\u4e0a\u3002 Django web \u5e94\u7528\u4e0e Nginx \u00b6 \u672a\u5b8c\u5f85\u7eed VNC \u7edf\u4e00\u767b\u5f55 \u00b6 \u672a\u5b8c\u5f85\u7eed SSH \u7edf\u4e00\u767b\u5f55 \u00b6 \u672a\u5b8c\u5f85\u7eed Webhook \u4e0e\u7528\u6237\u6587\u6863 \u00b6 \u5bb9\u5668\u91cc\u6709\u4e00\u4e2a webhook \u670d\u52a1\u5668\uff0c\u4ece GitHub \u63a5\u6536\u7528\u6237\u6587\u6863\u4ed3\u5e93 USTC-vlab/docs \u7684\u66f4\u65b0\u901a\u77e5\u5e76\u62c9\u53d6\u66f4\u65b0\u3002 \u4ee3\u7801\u66fe\u7ecf\u662f\u7528 Ruby Sinatra \u5199\u7684\uff0c\u540e\u6765\u6362\u6210\u4e86 Go\uff0c\u53c2\u89c1 /root/webhook/main.go \uff08\u6216 \u8fd9\u4e2a Gist \uff09 \u7531\u4e8e\u8be5 webhook \u8fc7\u4e8e\u7b80\u5355\uff0c\u5b83\u81ea\u5df1\u751a\u81f3\u6ca1\u6709\u4e00\u4e2a Git \u4ed3\u5e93\u505a\u7248\u672c\u7ba1\u7406\uff08 \u6ce8\u610f \u8fd9\u4e2a webhook \u524d\u9762\u8fd8\u662f\u5957\u4e86\u4e00\u5c42 Nginx \u7684\uff0c\u4e0d\u662f\u76f4\u8fde\u7684 Grafana \u4e0e\u76d1\u63a7\u3001\u7edf\u8ba1 \u00b6 \u672a\u5b8c\u5f85\u7eed","title":"Web \u670d\u52a1\u5668 (CT 101)"},{"location":"servers/ct101/#web-ct-101","text":"\u8fd9\u4e2a\u5bb9\u5668\u662f vlab \u5bf9\u5916\u670d\u52a1\u7684\u4e3b\u8981\u573a\u6240\uff0c\u4e0a\u9762\u8fd0\u884c\u4e86\u6211\u4eec\u7684\u5404\u79cd\u7a0b\u5e8f\u3002 \u8be5\u5bb9\u5668\u63a5\u5165\u6821\u56ed\u7f51\uff08 vmbr0 / eth0 / 202.38.75.226/24 \uff0c\u4e14\u8be5 IP \u662f vlab.ustc.edu.cn \u57df\u540d\u6307\u5411\u7684\uff09\u548c\u5bb9\u5668\u5185\u7f51\uff08 vmbr1 / eth1 / 172.31.0.2/16 , 172.30.0.2/24 \uff09\uff0c\u901a\u8fc7\u6821\u56ed\u7f51\u5bf9\u5916\u63d0\u4f9b Web \u670d\u52a1\u3001VNC \u7edf\u4e00\u767b\u5f55\u670d\u52a1\u548c SSH \u7edf\u4e00\u767b\u5f55\u670d\u52a1\uff0c\u901a\u8fc7\u5bb9\u5668\u5185\u7f51\u8fde\u63a5\u5176\u4ed6\u865a\u62df\u673a\u3002\u5c3d\u7ba1\u672c\u5bb9\u5668\u63a5\u5165\u4e86\u4e24\u4e2a\u7f51\u7edc\uff0c\u4f46\u662f \u4e0d\u7528\u4f5c\u8f6c\u53d1 \u3002 \u7531\u4e8e\u8fd9\u4e2a\u5bb9\u5668\u7684 22 \u7aef\u53e3\u7528\u4f5c SSH \u7edf\u4e00\u767b\u5f55\u4e86\uff0c\u56e0\u6b64\u5b83\u81ea\u5df1\u7684 sshd \u5f00\u5728 179 \u7aef\u53e3\u4e0a\u3002","title":"Web \u670d\u52a1\u5668 (CT 101)"},{"location":"servers/ct101/#web","text":"\u672a\u5b8c\u5f85\u7eed","title":"Django web \u5e94\u7528\u4e0e Nginx"},{"location":"servers/ct101/#vnc-unified-login","text":"\u672a\u5b8c\u5f85\u7eed","title":"VNC \u7edf\u4e00\u767b\u5f55"},{"location":"servers/ct101/#ssh-unified-login","text":"\u672a\u5b8c\u5f85\u7eed","title":"SSH \u7edf\u4e00\u767b\u5f55"},{"location":"servers/ct101/#user-docs","text":"\u5bb9\u5668\u91cc\u6709\u4e00\u4e2a webhook \u670d\u52a1\u5668\uff0c\u4ece GitHub \u63a5\u6536\u7528\u6237\u6587\u6863\u4ed3\u5e93 USTC-vlab/docs \u7684\u66f4\u65b0\u901a\u77e5\u5e76\u62c9\u53d6\u66f4\u65b0\u3002 \u4ee3\u7801\u66fe\u7ecf\u662f\u7528 Ruby Sinatra \u5199\u7684\uff0c\u540e\u6765\u6362\u6210\u4e86 Go\uff0c\u53c2\u89c1 /root/webhook/main.go \uff08\u6216 \u8fd9\u4e2a Gist \uff09 \u7531\u4e8e\u8be5 webhook \u8fc7\u4e8e\u7b80\u5355\uff0c\u5b83\u81ea\u5df1\u751a\u81f3\u6ca1\u6709\u4e00\u4e2a Git \u4ed3\u5e93\u505a\u7248\u672c\u7ba1\u7406\uff08 \u6ce8\u610f \u8fd9\u4e2a webhook \u524d\u9762\u8fd8\u662f\u5957\u4e86\u4e00\u5c42 Nginx \u7684\uff0c\u4e0d\u662f\u76f4\u8fde\u7684","title":"Webhook \u4e0e\u7528\u6237\u6587\u6863"},{"location":"servers/ct101/#grafana","text":"\u672a\u5b8c\u5f85\u7eed","title":"Grafana \u4e0e\u76d1\u63a7\u3001\u7edf\u8ba1"},{"location":"servers/vm104/","text":"\u5907\u4efd\u670d\u52a1\u5668\uff08VM 104\uff09 \u00b6 \u53c2\u89c1 \u5907\u4efd \u3002 \u00b6","title":"\u5907\u4efd\u670d\u52a1\u5668 (VM 104)"},{"location":"servers/vm104/#vm-104","text":"","title":"\u5907\u4efd\u670d\u52a1\u5668\uff08VM 104\uff09"},{"location":"servers/vm104/#_1","text":"","title":"\u53c2\u89c1\u5907\u4efd\u3002"},{"location":"testbed/","text":"\u6d4b\u8bd5\u73af\u5883 \u00b6 \u6211\u4eec\u7684\u6d4b\u8bd5\u73af\u5883\u8fd0\u884c\u5728\u5355\u673a pv0 \u4e0a\uff0c\u6ca1\u6709\u4f7f\u7528\u96c6\u7fa4\u914d\u7f6e\u3002 \u4e0e\u751f\u4ea7\u73af\u5883\u7684\u6bd4\u8f83 \u00b6 \u6d4b\u8bd5\u73af\u5883\u4e3b\u8981\u7528\u4e8e\u5f00\u53d1\u548c\u6d4b\u8bd5\uff0c\u5404\u65b9\u9762\u914d\u7f6e\u90fd\u4e0e\u751f\u4ea7\u73af\u5883\u63a5\u8fd1\uff0c\u4f8b\u5982\uff1a \u76f8\u540c\u7684 CT 100\uff08gateway\uff09\u548c CT 101\uff08web\uff09 \u76f8\u540c\u7684\u7f51\u7edc\u67b6\u6784 \u540c\u6837\u7684 bond / vmbr0 / vmbr1 \u540c\u6837\u91c7\u7528 VXLAN \u4f5c\u4e3a\u5bb9\u5668\u5185\u7f51\uff08\u4f46\u662f\u6ca1\u6709\u591a\u673a\uff0c\u4e00\u4e9b\u9632\u706b\u5899\u89c4\u5219\u53ef\u80fd\u4e0d\u8d77\u4f5c\u7528\uff09 \u540c\u6837\u7684 IP \u5730\u5740\u5206\u914d\uff08\u5982\u6d4b\u8bd5\u548c\u751f\u4ea7\u7684 gateway \u5bf9\u5185\u90fd\u662f 172.31.0.1\uff09 \u540c\u65f6\u6d4b\u8bd5\u73af\u5883\u4e5f\u7528\u4e8e\u8e29\u5751\uff0c\u6240\u4ee5\u5728\u65b0\u8f6f\u4ef6\u6216\u65b0\u7248\u64cd\u4f5c\u7cfb\u7edf\u53d1\u5e03\u65f6\u751a\u81f3\u53d1\u5e03\u524d\uff0c\u6211\u4eec\u4e5f\u4f1a\u66f4\u79ef\u6781\u5730\u5347\u7ea7\uff0c\u4f8b\u5982\uff1a pv0 \u5728 2021 \u5e74 7 \u6708\u91cd\u88c5\uff0c\u6211\u4eec\u76f4\u63a5\u91c7\u7528\u4e86 Proxmox VE 7 \u7684 iso \u955c\u50cf\u5b89\u88c5\uff0c\u800c\u5f53\u65f6\u7684\u751f\u4ea7\u73af\u5883\u8fd8\u90fd\u5728\u8fd0\u884c PVE 6.4 gateway0 \u548c web0 \u4f7f\u7528 Proxmox \u63d0\u4f9b\u7684 Debian 10.10 (buster) \u955c\u50cf\u521b\u5efa\uff0c\u4f46\u521b\u5efa\u540e\u7acb\u523b\u5347\u7ea7\u5230\u4e86 Debian 11.0 (bullseye) \u4e0e\u751f\u4ea7\u73af\u5883\u7684\u8054\u7cfb \u00b6 \u767b\u5f55 \u00b6 \u4e3a\u4e86\u65b9\u4fbf\u590d\u5236\u548c\u4f20\u8f93\u6570\u636e\uff0c\u90e8\u5206\u751f\u4ea7\u73af\u5883\u7684\u4e3b\u673a\u548c\u865a\u62df\u673a\u53ef\u4ee5\u76f4\u63a5 SSH \u767b\u5f55\u90e8\u5206\u6d4b\u8bd5\u73af\u5883\uff08\u5f53\u7136\u4e5f\u5c31\u53ef\u4ee5 rsync \u4e86\uff09\uff1a root@pv1 \u901a\u8fc7 SSH \u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee pv0 root@web \u901a\u8fc7 SSH \u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee web0 \u4ee5\u4e0a\u4e24\u4e2a\u8bbf\u95ee\u90fd\u662f\u76f4\u63a5\u6dfb\u52a0\u7684 ~/.ssh/authorized_keys \u3002 Warning \u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c \u4e0d\u8981 \u5728\u6d4b\u8bd5\u73af\u5883\u4e2d\u914d\u7f6e\u751f\u4ea7\u73af\u5883\u7684\u767b\u5f55\u6743\u9650\uff08\u6dfb\u52a0\u516c\u94a5\u7b49\uff09\u3002 \u914d\u7f6e \u00b6 \u6d4b\u8bd5\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\u5171\u7528\u540c\u4e00\u5957 Nginx \u914d\u7f6e\u6587\u4ef6\u65b9\u4fbf\u8c03\u8bd5\uff0c\u4f46\u6d4b\u8bd5\u73af\u5883\u7684 /etc/nginx \u4ed3\u5e93\u4e2d\u7684 deploy key \u6ca1\u6709\u5199\u5165\u6743\u9650\uff0c\u8bf7\u81ea\u884c git pull \u540e\u518d git push \u3002 \u5176\u4ed6\u914d\u7f6e\u6682\u65f6\u6ca1\u6709\u5171\u4eab\u3002","title":"\u7b80\u4ecb"},{"location":"testbed/#_1","text":"\u6211\u4eec\u7684\u6d4b\u8bd5\u73af\u5883\u8fd0\u884c\u5728\u5355\u673a pv0 \u4e0a\uff0c\u6ca1\u6709\u4f7f\u7528\u96c6\u7fa4\u914d\u7f6e\u3002","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"testbed/#_2","text":"\u6d4b\u8bd5\u73af\u5883\u4e3b\u8981\u7528\u4e8e\u5f00\u53d1\u548c\u6d4b\u8bd5\uff0c\u5404\u65b9\u9762\u914d\u7f6e\u90fd\u4e0e\u751f\u4ea7\u73af\u5883\u63a5\u8fd1\uff0c\u4f8b\u5982\uff1a \u76f8\u540c\u7684 CT 100\uff08gateway\uff09\u548c CT 101\uff08web\uff09 \u76f8\u540c\u7684\u7f51\u7edc\u67b6\u6784 \u540c\u6837\u7684 bond / vmbr0 / vmbr1 \u540c\u6837\u91c7\u7528 VXLAN \u4f5c\u4e3a\u5bb9\u5668\u5185\u7f51\uff08\u4f46\u662f\u6ca1\u6709\u591a\u673a\uff0c\u4e00\u4e9b\u9632\u706b\u5899\u89c4\u5219\u53ef\u80fd\u4e0d\u8d77\u4f5c\u7528\uff09 \u540c\u6837\u7684 IP \u5730\u5740\u5206\u914d\uff08\u5982\u6d4b\u8bd5\u548c\u751f\u4ea7\u7684 gateway \u5bf9\u5185\u90fd\u662f 172.31.0.1\uff09 \u540c\u65f6\u6d4b\u8bd5\u73af\u5883\u4e5f\u7528\u4e8e\u8e29\u5751\uff0c\u6240\u4ee5\u5728\u65b0\u8f6f\u4ef6\u6216\u65b0\u7248\u64cd\u4f5c\u7cfb\u7edf\u53d1\u5e03\u65f6\u751a\u81f3\u53d1\u5e03\u524d\uff0c\u6211\u4eec\u4e5f\u4f1a\u66f4\u79ef\u6781\u5730\u5347\u7ea7\uff0c\u4f8b\u5982\uff1a pv0 \u5728 2021 \u5e74 7 \u6708\u91cd\u88c5\uff0c\u6211\u4eec\u76f4\u63a5\u91c7\u7528\u4e86 Proxmox VE 7 \u7684 iso \u955c\u50cf\u5b89\u88c5\uff0c\u800c\u5f53\u65f6\u7684\u751f\u4ea7\u73af\u5883\u8fd8\u90fd\u5728\u8fd0\u884c PVE 6.4 gateway0 \u548c web0 \u4f7f\u7528 Proxmox \u63d0\u4f9b\u7684 Debian 10.10 (buster) \u955c\u50cf\u521b\u5efa\uff0c\u4f46\u521b\u5efa\u540e\u7acb\u523b\u5347\u7ea7\u5230\u4e86 Debian 11.0 (bullseye)","title":"\u4e0e\u751f\u4ea7\u73af\u5883\u7684\u6bd4\u8f83"},{"location":"testbed/#_3","text":"","title":"\u4e0e\u751f\u4ea7\u73af\u5883\u7684\u8054\u7cfb"},{"location":"testbed/#_4","text":"\u4e3a\u4e86\u65b9\u4fbf\u590d\u5236\u548c\u4f20\u8f93\u6570\u636e\uff0c\u90e8\u5206\u751f\u4ea7\u73af\u5883\u7684\u4e3b\u673a\u548c\u865a\u62df\u673a\u53ef\u4ee5\u76f4\u63a5 SSH \u767b\u5f55\u90e8\u5206\u6d4b\u8bd5\u73af\u5883\uff08\u5f53\u7136\u4e5f\u5c31\u53ef\u4ee5 rsync \u4e86\uff09\uff1a root@pv1 \u901a\u8fc7 SSH \u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee pv0 root@web \u901a\u8fc7 SSH \u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee web0 \u4ee5\u4e0a\u4e24\u4e2a\u8bbf\u95ee\u90fd\u662f\u76f4\u63a5\u6dfb\u52a0\u7684 ~/.ssh/authorized_keys \u3002 Warning \u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c \u4e0d\u8981 \u5728\u6d4b\u8bd5\u73af\u5883\u4e2d\u914d\u7f6e\u751f\u4ea7\u73af\u5883\u7684\u767b\u5f55\u6743\u9650\uff08\u6dfb\u52a0\u516c\u94a5\u7b49\uff09\u3002","title":"\u767b\u5f55"},{"location":"testbed/#_5","text":"\u6d4b\u8bd5\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\u5171\u7528\u540c\u4e00\u5957 Nginx \u914d\u7f6e\u6587\u4ef6\u65b9\u4fbf\u8c03\u8bd5\uff0c\u4f46\u6d4b\u8bd5\u73af\u5883\u7684 /etc/nginx \u4ed3\u5e93\u4e2d\u7684 deploy key \u6ca1\u6709\u5199\u5165\u6743\u9650\uff0c\u8bf7\u81ea\u884c git pull \u540e\u518d git push \u3002 \u5176\u4ed6\u914d\u7f6e\u6682\u65f6\u6ca1\u6709\u5171\u4eab\u3002","title":"\u914d\u7f6e"},{"location":"ui/vncmux/","text":"\u8fdc\u7a0b\u684c\u9762\u914d\u7f6e\u4e0e\u7ba1\u7406 \u00b6 vnc-multiplexer (\u4ee5\u4e0b\u7b80\u79f0 vncmux) \u7528\u4e8e\u5b9e\u73b0 VNC \u7edf\u4e00\u767b\u5f55\u3002vncmux \u7528\u6237\u5728\u767b\u5f55\u4e2d\u8f93\u5165\u7684\u7528\u6237\u540d\u3001\u5bc6\u7801\uff0c\u5c06\u88ab\u7a0b\u5e8f\u901a\u8fc7 API \u53d1\u9001\u7ed9 Django \u540e\u7aef\uff0c\u5e76\u5f97\u5230\u5185\u7f51\u5ba2\u6237\u673a\u7684 VNC \u670d\u52a1\u5668\u8fde\u63a5\u4fe1\u606f\uff0c\u4ee5\u6b64\u5b9e\u73b0\u8f6c\u53d1\u3002\u9664\u4e86\u7b80\u5355\u7684\u8f6c\u53d1\u6570\u636e\uff0cvncmux \u8fd8\u4f1a\u5bf9 VNC \u534f\u8bae\u7684\u6d88\u606f\u8fdb\u884c\u89e3\u6790\u3001\u4fee\u6539\uff0c\u4ee5\u6b64\u5b9e\u73b0\u901a\u77e5\u529f\u80fd\u3002\u4ee5\u4e0b\u7b80\u4ecb vncmux \u7684\u914d\u7f6e\u548c\u7ba1\u7406\u65b9\u6cd5\u3002 \u914d\u7f6e\u6587\u4ef6 \u00b6 vncmux \u7684\u914d\u7f6e\u6587\u4ef6\u5b58\u50a8\u5728 /etc/vnc_multiplexer/config.json \uff0c\u76ee\u524d\u5982\u4e0b\uff1a { \"port\" : 5900 , \"api\" : \"http://127.0.0.1:8000/vm/vnc/\" , \"cert_chain_file\" : \"/etc/letsencrypt/live/vlab.ustc.edu.cn/fullchain.pem\" , \"private_key_file\" : \"/etc/letsencrypt/live/vlab.ustc.edu.cn/privkey.pem\" , \"dhparam_file\" : \"/etc/vnc_multiplexer/dhparam.pem\" , \"ra2_private_key_file\" : \"/etc/vnc_multiplexer/ra2.pem\" , \"enabled_protocol\" : [ \"RA2r_256\" , \"RA2r\" , \"RA2_256\" , \"RA2\" , \"VeNCrypt\" ], \"enable_log\" : true , \"logger_ip\" : \"127.0.0.1\" , \"logger_port\" : 5555 , \"enable_notification\" : true , \"notification_file\" : \"/etc/vnc_multiplexer/notification.png\" , \"enable_admin\" : true , \"admin_path\" : \"\" , \"enable_websocket\" : true , \"websocket_port\" : 5801 , \"enable_tight_translation\" : true , \"tight_jpeg_level\" : 7 , \"threads\" : 8 } \u5176\u4e2d\u5404\u9879\u610f\u4e49\u5982\u4e0b\uff1a api \uff1a Django \u540e\u7aef API \u7684 URL \uff0c\u8bf7\u6ce8\u610f\u4e0d\u5f97\u4f7f\u7528 HTTPS\u3002 cert_chain_file \uff1a TLS \u8bc1\u4e66\u6587\u4ef6\uff0c\u4e0d\u7528\u66f4\u6539\u3002 private_key_file \uff1a TLS \u79c1\u94a5\u6587\u4ef6\uff0c\u4e0d\u7528\u66f4\u6539\u3002 dhparam_file \uff1a DH \u5bf9\u6587\u4ef6\uff0c\u4e0d\u7528\u66f4\u6539\u3002 ra2_private_key_file \uff1a RealVNC \u534f\u8bae\u79c1\u94a5\u6587\u4ef6\uff0c\u7528\u4e8e\u8bc1\u660e\u670d\u52a1\u5668\u7684\u8eab\u4efd\u3002\u5fc5\u987b\u4e3a PKCS#8 RSA 2048 \u79c1\u94a5\u6587\u4ef6\u3002 enabled_protocol \uff1a \u5141\u8bb8\u7684\u534f\u8bae\u3002 VeNCrypt \u4e3a TigerVNC \u4f7f\u7528\u7684\u534f\u8bae\u3002 RA2 , RA2r , RA2_256 , RA2r_256 \u5747\u4e3a RealVNC \u7684\u52a0\u5bc6\u534f\u8bae, RA2ne , RA2ne_256 \u4e3a RealVNC \u4f7f\u7528\u7684\u975e\u52a0\u5bc6\u534f\u8bae\uff0c\u5efa\u8bae\u5173\u95ed\u3002 enable_log \uff1a \u662f\u5426\u5f00\u542f\u65e5\u5fd7\u3002\u65e5\u5fd7\u5c06\u5728\u6bcf\u4e2a\u8fde\u63a5\u5173\u95ed\u540e\u901a\u8fc7 UDP \u62a5\u6587\u53d1\u9001\u7ed9\u65e5\u5fd7\u670d\u52a1\u5668\u3002 logger_ip \uff1a \u65e5\u5fd7\u670d\u52a1\u5668 IP logger_port \uff1a \u65e5\u5fd7\u670d\u52a1\u5668\u7aef\u53e3 enable_notification \uff1a \u662f\u5426\u5f00\u542f\u901a\u77e5\u529f\u80fd\u3002\u82e5\u5f00\u542f\uff0c\u6bcf\u4e2a\u7528\u6237\u8fde\u63a5\u540e vncmux \u90fd\u5c06\u5728\u753b\u9762\u4e0a\u6ce8\u5165\u4e00\u4e2a\u53ef\u5173\u95ed\u7684\u5bf9\u8bdd\u6846\u7528\u4ee5\u663e\u793a\u901a\u77e5\u3002 notification_file \uff1a \u901a\u77e5\u56fe\u7247\u6587\u4ef6\u3002\u5fc5\u987b\u4e3a PNG \u683c\u5f0f\u3002 enable_admin \uff1a \u662f\u5426\u5f00\u542f\u7ba1\u7406\u7aef\u53e3\u3002\u82e5\u5f00\u542f\uff0c vncmux \u5c06\u5728\u4e00\u4e2a Unix domain socket \u4e0a\u63a5\u6536\u7ba1\u7406\u547d\u4ee4\uff0c\u4ee5\u6b64\u4e0e vncmux-cli \u5de5\u5177\u8fde\u63a5\u3002 admin_path \uff1a \u7ba1\u7406\u7aef\u53e3\u7684\u8def\u5f84\uff0c\u7559\u7a7a\u5219\u4e3a\u9ed8\u8ba4\u503c /var/run/vncmux.sock enable_websocket \uff1a \u662f\u5426\u5f00\u542f WebSocket \u529f\u80fd\u3002noVNC \u5fc5\u987b\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u56e0\u6b64\u603b\u662f\u5e94\u8be5\u5f00\u542f\u3002\u8fd9\u91cc\u7684 WebSocket \u8fde\u63a5\u662f\u672a\u52a0\u5bc6\u7684\uff0c\u9700\u8981\u4f7f\u7528 Nginx \u53cd\u4ee3\u3002 websocket_port \uff1a WebSocket \u670d\u52a1\u7aef\u53e3 enable_tight_translation \uff1a \u662f\u5426\u7ed9 RealVNC \u5f00\u542f\u6709\u635f\u538b\u7f29\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b RealVNC \u8fde\u63a5 TigerVNC \u670d\u52a1\u7aef\u53ea\u652f\u6301\u65e0\u635f\u538b\u7f29\u3002\u6b64\u529f\u80fd\u5c06 TigerVNC \u53d1\u51fa\u7684 Tight \u7f16\u7801\u6570\u636e\u8f6c\u6362\u6210 RealVNC \u53ef\u8bfb\u7684\u683c\u5f0f\uff0c\u4ee5\u6b64\u5b9e\u73b0\u4f7f\u7528 JPEG \u538b\u7f29\u3002\u5f00\u542f\u540e\u53ef\u4ee5\u8ba9 RealVNC \u6d41\u7545\u5f88\u591a\uff0c\u4f46\u662f\u53ef\u80fd\u964d\u4f4e\u753b\u8d28\u3002 tight_jpeg_level \uff1a RealVNC \u6709\u635f\u538b\u7f29\u7684\u8d28\u91cf\u7b49\u7ea7\u3002\u53d6\u503c\u8303\u56f4\u662f 0 \u5230 9\u3002\u5982\u679c\u4e3a 8 \u63a5\u8fd1\u65e0\u635f\u3002 threads \uff1a \u5de5\u4f5c\u7ebf\u7a0b\u6570 vncmux-cli \u5de5\u5177 \u00b6 vncmux-cli \u5de5\u5177\u7528\u4e8e\u7ba1\u7406\u8fd0\u884c\u4e2d\u7684 vncmux \u670d\u52a1\u5668\u3002\u8fde\u63a5\u5230 vncmux \u670d\u52a1\u5668\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a vncmux-cli [ path ] \u8fde\u63a5\u540e\u8f93\u5165 exit \u53ef\u4ee5\u9000\u51fa\uff0c\u8f93\u5165 help \u53ef\u4ee5\u663e\u793a\u5e2e\u52a9\uff0c\u8fd8\u53ef\u4ee5\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5217\u51fa\u5728\u7ebf\u7528\u6237 \u00b6 \u8f93\u5165 list \u5373\u53ef\u5217\u51fa\u5728\u7ebf\u7528\u6237\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u8fde\u63a5 ID \u3001\u8fde\u63a5\u65f6\u95f4\u3001\u7528\u6237\u540d\u3001\u4e3b\u673a IP \u3001\u7528\u6237 IP \u3001\u5ba2\u6237\u7aef\u7c7b\u578b\u3002 \u65ad\u5f00\u7528\u6237\u8fde\u63a5 \u00b6 \u8f93\u5165 disconnect <id> \u53ef\u4ee5\u628a ID \u5bf9\u5e94\u7684\u8fde\u63a5\u65ad\u5f00\u3002 \u66f4\u6362\u901a\u77e5\u56fe\u7247 \u00b6 \u8f93\u5165 load-notification <image file> \u53ef\u4ee5\u66f4\u6362\u901a\u77e5\u6587\u4ef6\uff0c\u901a\u77e5\u6587\u4ef6\u6700\u597d\u662f\u7edd\u5bf9\u8def\u5f84\u3002\u5f53\u524d\u5df2\u5728\u7ebf\u7684\u7528\u6237\u5c06\u4e0d\u4f1a\u770b\u5230\u65b0\u7684\u901a\u77e5\u3002 \u53d1\u9001\u56fe\u7247 \u00b6 \u53ef\u4ee5\u53d1\u9001 PNG \u683c\u5f0f\u7684\u56fe\u7247\u7ed9\u4e00\u4e2a\u6216\u591a\u4e2a\u7528\u6237\u3002\u547d\u4ee4\u683c\u5f0f\u4e3a send-image <image file> <id> [id] ... \uff0c\u5176\u4e2d id \u53ef\u4ee5\u4ece list \u7684\u8f93\u51fa\u5f97\u77e5\u3002 \u6253\u5f00\u548c\u5173\u95ed\u901a\u77e5 \u00b6 \u547d\u4ee4\u5206\u522b\u4e3a enable-notification \u548c disable-notification \u6253\u5f00\u548c\u5173\u95ed RealVNC \u6709\u635f\u538b\u7f29 \u00b6 \u547d\u4ee4\u5206\u522b\u4e3a enable-realvnc-lossy \u548c disable-realvnc-lossy \u8bbe\u5b9a RealVNC \u6709\u635f\u538b\u7f29\u8d28\u91cf\u7b49\u7ea7 \u00b6 \u547d\u4ee4\u4e3a set-realvnc-jpeg-level <0-9>","title":"VNC \u7edf\u4e00\u767b\u5f55"},{"location":"ui/vncmux/#_1","text":"vnc-multiplexer (\u4ee5\u4e0b\u7b80\u79f0 vncmux) \u7528\u4e8e\u5b9e\u73b0 VNC \u7edf\u4e00\u767b\u5f55\u3002vncmux \u7528\u6237\u5728\u767b\u5f55\u4e2d\u8f93\u5165\u7684\u7528\u6237\u540d\u3001\u5bc6\u7801\uff0c\u5c06\u88ab\u7a0b\u5e8f\u901a\u8fc7 API \u53d1\u9001\u7ed9 Django \u540e\u7aef\uff0c\u5e76\u5f97\u5230\u5185\u7f51\u5ba2\u6237\u673a\u7684 VNC \u670d\u52a1\u5668\u8fde\u63a5\u4fe1\u606f\uff0c\u4ee5\u6b64\u5b9e\u73b0\u8f6c\u53d1\u3002\u9664\u4e86\u7b80\u5355\u7684\u8f6c\u53d1\u6570\u636e\uff0cvncmux \u8fd8\u4f1a\u5bf9 VNC \u534f\u8bae\u7684\u6d88\u606f\u8fdb\u884c\u89e3\u6790\u3001\u4fee\u6539\uff0c\u4ee5\u6b64\u5b9e\u73b0\u901a\u77e5\u529f\u80fd\u3002\u4ee5\u4e0b\u7b80\u4ecb vncmux \u7684\u914d\u7f6e\u548c\u7ba1\u7406\u65b9\u6cd5\u3002","title":"\u8fdc\u7a0b\u684c\u9762\u914d\u7f6e\u4e0e\u7ba1\u7406"},{"location":"ui/vncmux/#_2","text":"vncmux \u7684\u914d\u7f6e\u6587\u4ef6\u5b58\u50a8\u5728 /etc/vnc_multiplexer/config.json \uff0c\u76ee\u524d\u5982\u4e0b\uff1a { \"port\" : 5900 , \"api\" : \"http://127.0.0.1:8000/vm/vnc/\" , \"cert_chain_file\" : \"/etc/letsencrypt/live/vlab.ustc.edu.cn/fullchain.pem\" , \"private_key_file\" : \"/etc/letsencrypt/live/vlab.ustc.edu.cn/privkey.pem\" , \"dhparam_file\" : \"/etc/vnc_multiplexer/dhparam.pem\" , \"ra2_private_key_file\" : \"/etc/vnc_multiplexer/ra2.pem\" , \"enabled_protocol\" : [ \"RA2r_256\" , \"RA2r\" , \"RA2_256\" , \"RA2\" , \"VeNCrypt\" ], \"enable_log\" : true , \"logger_ip\" : \"127.0.0.1\" , \"logger_port\" : 5555 , \"enable_notification\" : true , \"notification_file\" : \"/etc/vnc_multiplexer/notification.png\" , \"enable_admin\" : true , \"admin_path\" : \"\" , \"enable_websocket\" : true , \"websocket_port\" : 5801 , \"enable_tight_translation\" : true , \"tight_jpeg_level\" : 7 , \"threads\" : 8 } \u5176\u4e2d\u5404\u9879\u610f\u4e49\u5982\u4e0b\uff1a api \uff1a Django \u540e\u7aef API \u7684 URL \uff0c\u8bf7\u6ce8\u610f\u4e0d\u5f97\u4f7f\u7528 HTTPS\u3002 cert_chain_file \uff1a TLS \u8bc1\u4e66\u6587\u4ef6\uff0c\u4e0d\u7528\u66f4\u6539\u3002 private_key_file \uff1a TLS \u79c1\u94a5\u6587\u4ef6\uff0c\u4e0d\u7528\u66f4\u6539\u3002 dhparam_file \uff1a DH \u5bf9\u6587\u4ef6\uff0c\u4e0d\u7528\u66f4\u6539\u3002 ra2_private_key_file \uff1a RealVNC \u534f\u8bae\u79c1\u94a5\u6587\u4ef6\uff0c\u7528\u4e8e\u8bc1\u660e\u670d\u52a1\u5668\u7684\u8eab\u4efd\u3002\u5fc5\u987b\u4e3a PKCS#8 RSA 2048 \u79c1\u94a5\u6587\u4ef6\u3002 enabled_protocol \uff1a \u5141\u8bb8\u7684\u534f\u8bae\u3002 VeNCrypt \u4e3a TigerVNC \u4f7f\u7528\u7684\u534f\u8bae\u3002 RA2 , RA2r , RA2_256 , RA2r_256 \u5747\u4e3a RealVNC \u7684\u52a0\u5bc6\u534f\u8bae, RA2ne , RA2ne_256 \u4e3a RealVNC \u4f7f\u7528\u7684\u975e\u52a0\u5bc6\u534f\u8bae\uff0c\u5efa\u8bae\u5173\u95ed\u3002 enable_log \uff1a \u662f\u5426\u5f00\u542f\u65e5\u5fd7\u3002\u65e5\u5fd7\u5c06\u5728\u6bcf\u4e2a\u8fde\u63a5\u5173\u95ed\u540e\u901a\u8fc7 UDP \u62a5\u6587\u53d1\u9001\u7ed9\u65e5\u5fd7\u670d\u52a1\u5668\u3002 logger_ip \uff1a \u65e5\u5fd7\u670d\u52a1\u5668 IP logger_port \uff1a \u65e5\u5fd7\u670d\u52a1\u5668\u7aef\u53e3 enable_notification \uff1a \u662f\u5426\u5f00\u542f\u901a\u77e5\u529f\u80fd\u3002\u82e5\u5f00\u542f\uff0c\u6bcf\u4e2a\u7528\u6237\u8fde\u63a5\u540e vncmux \u90fd\u5c06\u5728\u753b\u9762\u4e0a\u6ce8\u5165\u4e00\u4e2a\u53ef\u5173\u95ed\u7684\u5bf9\u8bdd\u6846\u7528\u4ee5\u663e\u793a\u901a\u77e5\u3002 notification_file \uff1a \u901a\u77e5\u56fe\u7247\u6587\u4ef6\u3002\u5fc5\u987b\u4e3a PNG \u683c\u5f0f\u3002 enable_admin \uff1a \u662f\u5426\u5f00\u542f\u7ba1\u7406\u7aef\u53e3\u3002\u82e5\u5f00\u542f\uff0c vncmux \u5c06\u5728\u4e00\u4e2a Unix domain socket \u4e0a\u63a5\u6536\u7ba1\u7406\u547d\u4ee4\uff0c\u4ee5\u6b64\u4e0e vncmux-cli \u5de5\u5177\u8fde\u63a5\u3002 admin_path \uff1a \u7ba1\u7406\u7aef\u53e3\u7684\u8def\u5f84\uff0c\u7559\u7a7a\u5219\u4e3a\u9ed8\u8ba4\u503c /var/run/vncmux.sock enable_websocket \uff1a \u662f\u5426\u5f00\u542f WebSocket \u529f\u80fd\u3002noVNC \u5fc5\u987b\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u56e0\u6b64\u603b\u662f\u5e94\u8be5\u5f00\u542f\u3002\u8fd9\u91cc\u7684 WebSocket \u8fde\u63a5\u662f\u672a\u52a0\u5bc6\u7684\uff0c\u9700\u8981\u4f7f\u7528 Nginx \u53cd\u4ee3\u3002 websocket_port \uff1a WebSocket \u670d\u52a1\u7aef\u53e3 enable_tight_translation \uff1a \u662f\u5426\u7ed9 RealVNC \u5f00\u542f\u6709\u635f\u538b\u7f29\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b RealVNC \u8fde\u63a5 TigerVNC \u670d\u52a1\u7aef\u53ea\u652f\u6301\u65e0\u635f\u538b\u7f29\u3002\u6b64\u529f\u80fd\u5c06 TigerVNC \u53d1\u51fa\u7684 Tight \u7f16\u7801\u6570\u636e\u8f6c\u6362\u6210 RealVNC \u53ef\u8bfb\u7684\u683c\u5f0f\uff0c\u4ee5\u6b64\u5b9e\u73b0\u4f7f\u7528 JPEG \u538b\u7f29\u3002\u5f00\u542f\u540e\u53ef\u4ee5\u8ba9 RealVNC \u6d41\u7545\u5f88\u591a\uff0c\u4f46\u662f\u53ef\u80fd\u964d\u4f4e\u753b\u8d28\u3002 tight_jpeg_level \uff1a RealVNC \u6709\u635f\u538b\u7f29\u7684\u8d28\u91cf\u7b49\u7ea7\u3002\u53d6\u503c\u8303\u56f4\u662f 0 \u5230 9\u3002\u5982\u679c\u4e3a 8 \u63a5\u8fd1\u65e0\u635f\u3002 threads \uff1a \u5de5\u4f5c\u7ebf\u7a0b\u6570","title":"\u914d\u7f6e\u6587\u4ef6"},{"location":"ui/vncmux/#vncmux-cli","text":"vncmux-cli \u5de5\u5177\u7528\u4e8e\u7ba1\u7406\u8fd0\u884c\u4e2d\u7684 vncmux \u670d\u52a1\u5668\u3002\u8fde\u63a5\u5230 vncmux \u670d\u52a1\u5668\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a vncmux-cli [ path ] \u8fde\u63a5\u540e\u8f93\u5165 exit \u53ef\u4ee5\u9000\u51fa\uff0c\u8f93\u5165 help \u53ef\u4ee5\u663e\u793a\u5e2e\u52a9\uff0c\u8fd8\u53ef\u4ee5\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a","title":"vncmux-cli \u5de5\u5177"},{"location":"ui/vncmux/#_3","text":"\u8f93\u5165 list \u5373\u53ef\u5217\u51fa\u5728\u7ebf\u7528\u6237\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u8fde\u63a5 ID \u3001\u8fde\u63a5\u65f6\u95f4\u3001\u7528\u6237\u540d\u3001\u4e3b\u673a IP \u3001\u7528\u6237 IP \u3001\u5ba2\u6237\u7aef\u7c7b\u578b\u3002","title":"\u5217\u51fa\u5728\u7ebf\u7528\u6237"},{"location":"ui/vncmux/#_4","text":"\u8f93\u5165 disconnect <id> \u53ef\u4ee5\u628a ID \u5bf9\u5e94\u7684\u8fde\u63a5\u65ad\u5f00\u3002","title":"\u65ad\u5f00\u7528\u6237\u8fde\u63a5"},{"location":"ui/vncmux/#_5","text":"\u8f93\u5165 load-notification <image file> \u53ef\u4ee5\u66f4\u6362\u901a\u77e5\u6587\u4ef6\uff0c\u901a\u77e5\u6587\u4ef6\u6700\u597d\u662f\u7edd\u5bf9\u8def\u5f84\u3002\u5f53\u524d\u5df2\u5728\u7ebf\u7684\u7528\u6237\u5c06\u4e0d\u4f1a\u770b\u5230\u65b0\u7684\u901a\u77e5\u3002","title":"\u66f4\u6362\u901a\u77e5\u56fe\u7247"},{"location":"ui/vncmux/#_6","text":"\u53ef\u4ee5\u53d1\u9001 PNG \u683c\u5f0f\u7684\u56fe\u7247\u7ed9\u4e00\u4e2a\u6216\u591a\u4e2a\u7528\u6237\u3002\u547d\u4ee4\u683c\u5f0f\u4e3a send-image <image file> <id> [id] ... \uff0c\u5176\u4e2d id \u53ef\u4ee5\u4ece list \u7684\u8f93\u51fa\u5f97\u77e5\u3002","title":"\u53d1\u9001\u56fe\u7247"},{"location":"ui/vncmux/#_7","text":"\u547d\u4ee4\u5206\u522b\u4e3a enable-notification \u548c disable-notification","title":"\u6253\u5f00\u548c\u5173\u95ed\u901a\u77e5"},{"location":"ui/vncmux/#realvnc","text":"\u547d\u4ee4\u5206\u522b\u4e3a enable-realvnc-lossy \u548c disable-realvnc-lossy","title":"\u6253\u5f00\u548c\u5173\u95ed RealVNC \u6709\u635f\u538b\u7f29"},{"location":"ui/vncmux/#realvnc_1","text":"\u547d\u4ee4\u4e3a set-realvnc-jpeg-level <0-9>","title":"\u8bbe\u5b9a RealVNC \u6709\u635f\u538b\u7f29\u8d28\u91cf\u7b49\u7ea7"},{"location":"vlab-software/","text":"Vlab \u8f6f\u4ef6\u7ec4\u5408 \u00b6 Vlab Software \u662f\u5b58\u653e\u4e8e\u5404\u4e2a\u4e3b\u673a\u4e0a\u7684 /opt/vlab \u7684\u8f6f\u4ef6\u7ec4\u5408\uff0c\u901a\u8fc7 bind mount \u6302\u8f7d\u8fdb\u865a\u62df\u673a\u7684 /opt/vlab \u76ee\u5f55\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u9884\u88c5\u7684\u8f6f\u4ef6\u3002\u56e0\u6b64\u6211\u4eec\u4e5f\u7ecf\u5e38\u79f0\u4e3a /opt/vlab\u3002 \u4e3a\u865a\u62df\u673a\u914d\u7f6e Vlab Software \u00b6 \u53d6\u51b3\u4e8e\u6240\u5b89\u88c5\u7684\u684c\u9762\u73af\u5883\uff0c\u5728 /etc/xdg/menus \u4e0b\u7684\u67d0\u4e2a .menu \u6587\u4ef6\u6700\u540e\u7684\u5173\u95ed\u6807\u7b7e \u524d \u63d2\u5165\u5982\u4e0b\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u5728\u6700\u5916\u5c42\u7684 <Menu> \u4e0b\u6dfb\u52a0\u4e00\u4e2a\u5b50\u952e\u3002 <!-- Vlab --> <Menu> <Name> Vlab </Name> <Directory> Vlab.directory </Directory> <AppDir> /opt/vlab/applications </AppDir> <Include><And><Category> Vlab </Category></And></Include> </Menu> \u4f8b\u5982\uff0c\u5bf9\u4e8e MATE \u684c\u9762\u73af\u5883\uff0c\u6587\u4ef6\u662f /etc/xdg/menus/mate-applications.menu \uff1b\u5bf9\u4e8e Xfce \u6587\u4ef6\u540d\u662f xfce-applications.menu \u3002 \u540c\u65f6\u4e3a\u4e86\u4f7f\u547d\u4ee4\u884c\u73af\u5883\u80fd\u591f\u6b63\u786e\u52a0\u8f7d PATH\uff0c\u9700\u8981\u5728 /etc/profile.d \u4e0b\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6 vlab.sh \uff1a if [ -e /opt/vlab/path.sh ] ; then source /opt/vlab/path.sh fi \u5982\u679c\u6ca1\u6709 /etc/profile.d \u76ee\u5f55\uff0c\u5c31\u5c06\u8fd9\u51e0\u884c\u4ee3\u7801\u52a0\u5728 /etc/profile \u7684\u672b\u5c3e\u3002 \u6700\u540e\uff0c\u8bb0\u5f97\u66ff\u6362\u4e0a Vlab \u7684 \u4e13\u5c5e \u684c\u9762\uff1a https://vlab.ustc.edu.cn/downloads/background.jpg \uff08wget \u4e0b\u6765\u653e\u5728\u5408\u9002\u7684\u4f4d\u7f6e\u914d\u7f6e\u597d\u684c\u9762\u8bbe\u7f6e\uff09","title":"\u914d\u7f6e"},{"location":"vlab-software/#vlab","text":"Vlab Software \u662f\u5b58\u653e\u4e8e\u5404\u4e2a\u4e3b\u673a\u4e0a\u7684 /opt/vlab \u7684\u8f6f\u4ef6\u7ec4\u5408\uff0c\u901a\u8fc7 bind mount \u6302\u8f7d\u8fdb\u865a\u62df\u673a\u7684 /opt/vlab \u76ee\u5f55\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u9884\u88c5\u7684\u8f6f\u4ef6\u3002\u56e0\u6b64\u6211\u4eec\u4e5f\u7ecf\u5e38\u79f0\u4e3a /opt/vlab\u3002","title":"Vlab \u8f6f\u4ef6\u7ec4\u5408"},{"location":"vlab-software/#vlab-software","text":"\u53d6\u51b3\u4e8e\u6240\u5b89\u88c5\u7684\u684c\u9762\u73af\u5883\uff0c\u5728 /etc/xdg/menus \u4e0b\u7684\u67d0\u4e2a .menu \u6587\u4ef6\u6700\u540e\u7684\u5173\u95ed\u6807\u7b7e \u524d \u63d2\u5165\u5982\u4e0b\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u5728\u6700\u5916\u5c42\u7684 <Menu> \u4e0b\u6dfb\u52a0\u4e00\u4e2a\u5b50\u952e\u3002 <!-- Vlab --> <Menu> <Name> Vlab </Name> <Directory> Vlab.directory </Directory> <AppDir> /opt/vlab/applications </AppDir> <Include><And><Category> Vlab </Category></And></Include> </Menu> \u4f8b\u5982\uff0c\u5bf9\u4e8e MATE \u684c\u9762\u73af\u5883\uff0c\u6587\u4ef6\u662f /etc/xdg/menus/mate-applications.menu \uff1b\u5bf9\u4e8e Xfce \u6587\u4ef6\u540d\u662f xfce-applications.menu \u3002 \u540c\u65f6\u4e3a\u4e86\u4f7f\u547d\u4ee4\u884c\u73af\u5883\u80fd\u591f\u6b63\u786e\u52a0\u8f7d PATH\uff0c\u9700\u8981\u5728 /etc/profile.d \u4e0b\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6 vlab.sh \uff1a if [ -e /opt/vlab/path.sh ] ; then source /opt/vlab/path.sh fi \u5982\u679c\u6ca1\u6709 /etc/profile.d \u76ee\u5f55\uff0c\u5c31\u5c06\u8fd9\u51e0\u884c\u4ee3\u7801\u52a0\u5728 /etc/profile \u7684\u672b\u5c3e\u3002 \u6700\u540e\uff0c\u8bb0\u5f97\u66ff\u6362\u4e0a Vlab \u7684 \u4e13\u5c5e \u684c\u9762\uff1a https://vlab.ustc.edu.cn/downloads/background.jpg \uff08wget \u4e0b\u6765\u653e\u5728\u5408\u9002\u7684\u4f4d\u7f6e\u914d\u7f6e\u597d\u684c\u9762\u8bbe\u7f6e\uff09","title":"\u4e3a\u865a\u62df\u673a\u914d\u7f6e Vlab Software"},{"location":"vlab-software/installation/","text":"\u5404\u8f6f\u4ef6\u7684\u5b89\u88c5\u65b9\u5f0f \u00b6 \u672a\u5b8c\u5f85\u7eed","title":"\u8f6f\u4ef6\u5b89\u88c5"},{"location":"vlab-software/installation/#_1","text":"\u672a\u5b8c\u5f85\u7eed","title":"\u5404\u8f6f\u4ef6\u7684\u5b89\u88c5\u65b9\u5f0f"},{"location":"workflow/new-host/","text":"\u914d\u7f6e\u65b0\u4e3b\u673a\u5e76\u52a0\u5165\u96c6\u7fa4 \u00b6 \u4f7f\u7528 U \u76d8\u5b89\u88c5\u597d Proxmox VE\uff0c\u4e3b\u673a\u540d\u4e3a pv#.vlab.ustc.edu.cn \uff08Proxmox \u5b89\u88c5\u7a0b\u5e8f\u8981\u6c42\uff0c\u88c5\u597d\u540e\u53ef\u4ee5\u6539\uff09\uff0c\u5176\u4e2d # \u4e3a\u6570\u5b57\u6216\u5176\u4ed6\u6807\u8bb0\uff0c\u624b\u52a8\u9012\u589e\u3002 \u8fdc\u7a0b\u8bbf\u95ee \u00b6 \u5148\u914d\u597d SSH \u8bbf\u95ee\uff0c\u5bf9 SSH Host Key \u7b7e\u540d\uff0c\u5e76\u52a0\u5165 TrustedUserCAKeys\u3002\u89c1 SSH \u8bc1\u4e66\u8ba4\u8bc1 \u4e00\u9875\u3002 \u5728\u52a0\u5165\u73b0\u6709\u7684 Proxmox VE \u96c6\u7fa4\u540e \u5220\u9664 root \u5bc6\u7801\uff08 passwd -d root \uff09\uff0c\u65b9\u4fbf\u4ee5\u540e\u7ef4\u62a4\u3002 \u8f6f\u4ef6\u6e90 \u00b6 \u4fee\u6539 /etc/apt/sources.list \uff0c\u5c06\u8f6f\u4ef6\u6e90\u66ff\u6362\u4e3a TUNA\uff1a deb https://mirrors.ustc.edu.cn/debian bullseye main contrib deb https://mirrors.ustc.edu.cn/debian bullseye-updates main contrib deb https://mirrors.ustc.edu.cn/debian-security bullseye-security main contrib \u5220\u9664 /etc/apt/sources.list.d/pve-enterprise.list \uff0c\u65b0\u5efa /etc/apt/sources.list.d/pve.list \uff0c\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a deb https://mirrors.ustc.edu.cn/proxmox/debian bullseye pve-no-subscription \u5237\u65b0\u8f6f\u4ef6\u6e90\u5e76\u5b89\u88c5\u66f4\u65b0\u3002 \u5b89\u88c5\u8f6f\u4ef6\uff08\u53ef\u9009\uff09 \u00b6 \u4ece APT \u5b89\u88c5\u4e00\u4e9b\u8f6f\u4ef6\u4ee5\u4fbf\u7ba1\u7406\u548c\u8c03\u8bd5\u3002\u8bf7\u5c3d\u53ef\u80fd\u4fdd\u6301\u4e3b\u673a\u7cfb\u7edf\u7b80\u6d01\u3002 Vim \u5b87\u5b99\u7b2c\u4e00\u6587\u672c\u7f16\u8f91\u5668 Htop \u4efb\u52a1\u7ba1\u7406\u5668 iptables-persistent \u7528\u4e8e\u4fdd\u5b58 iptables \u914d\u7f6e ipmitool \u7528\u4e8e\u7ef4\u62a4 IPMI\uff0c \u4f7f\u7528\u6700\u7b80\u5b89\u88c5\uff08\u5373 --no-install-recommends \uff09 \u914d\u7f6e\u7f51\u5361 \u00b6 \u53c2\u89c1 \u4e3b\u673a\u7f51\u5361 \u4e00\u9875\u3002 \u914d\u7f6e\u9632\u706b\u5899 \u00b6 \u9700\u8981\u5b89\u88c5 iptables-persistent \u8f6f\u4ef6\u5305\u3002\u5c06 \u9632\u706b\u5899 \u4e00\u9875\u7ed9\u51fa\u7684\u811a\u672c\u4fdd\u5b58\u4e3a iptables.sh \u5e76\u8fd0\u884c\u3002 \u6302\u8f7d\u5b58\u50a8\u670d\u52a1\u5668 \u00b6 \u4f7f\u7528 iSCSI \u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177 iscsiadm -m discover iscsiadm -d2 -m node -T iqn.2015-11.com.hpe:storage.msa1050.1840436ed4 -p 10 .0.0.200 --login \u5b58\u50a8\u670d\u52a1\u5668\u7684\u4f7f\u7528\u5730\u5740\u4e3a 10.0.0.200 \u4e0e 10.0.0.201\uff0c\u5206\u522b\u5f52\u5c5e\u4e24\u4e2a\u63a7\u5236\u5668\uff0c\u5efa\u8bae\u5404\u53f0\u8ba1\u7b97\u670d\u52a1\u5668\u4ea4\u66ff\u8fde\u63a5\u8fd9\u4e24\u4e2a\u5730\u5740\u4ee5\u300c\u8d1f\u8f7d\u5747\u8861\u300d\u3002 \u6302\u8f7d NFS \u955c\u50cf\u5171\u4eab \u00b6 \u6302\u8f7d NFS \u5171\u4eab\u6240\u7528\u7684 /etc/fstab \u6761\u76ee\uff1a 10.0.0.1:/var/lib/vz /mnt/vz nfs rw,async,hard,intr,noexec 0 0 \u6ce8\u610f\u5148\u5728 pv1 \u4e0a\u7f16\u8f91 /etc/exports \u5e76\u8fd0\u884c exportfs -a \u5237\u65b0\u6302\u8f7d\u6743\u9650\u3002","title":"\u914d\u7f6e\u65b0\u4e3b\u673a"},{"location":"workflow/new-host/#_1","text":"\u4f7f\u7528 U \u76d8\u5b89\u88c5\u597d Proxmox VE\uff0c\u4e3b\u673a\u540d\u4e3a pv#.vlab.ustc.edu.cn \uff08Proxmox \u5b89\u88c5\u7a0b\u5e8f\u8981\u6c42\uff0c\u88c5\u597d\u540e\u53ef\u4ee5\u6539\uff09\uff0c\u5176\u4e2d # \u4e3a\u6570\u5b57\u6216\u5176\u4ed6\u6807\u8bb0\uff0c\u624b\u52a8\u9012\u589e\u3002","title":"\u914d\u7f6e\u65b0\u4e3b\u673a\u5e76\u52a0\u5165\u96c6\u7fa4"},{"location":"workflow/new-host/#_2","text":"\u5148\u914d\u597d SSH \u8bbf\u95ee\uff0c\u5bf9 SSH Host Key \u7b7e\u540d\uff0c\u5e76\u52a0\u5165 TrustedUserCAKeys\u3002\u89c1 SSH \u8bc1\u4e66\u8ba4\u8bc1 \u4e00\u9875\u3002 \u5728\u52a0\u5165\u73b0\u6709\u7684 Proxmox VE \u96c6\u7fa4\u540e \u5220\u9664 root \u5bc6\u7801\uff08 passwd -d root \uff09\uff0c\u65b9\u4fbf\u4ee5\u540e\u7ef4\u62a4\u3002","title":"\u8fdc\u7a0b\u8bbf\u95ee"},{"location":"workflow/new-host/#_3","text":"\u4fee\u6539 /etc/apt/sources.list \uff0c\u5c06\u8f6f\u4ef6\u6e90\u66ff\u6362\u4e3a TUNA\uff1a deb https://mirrors.ustc.edu.cn/debian bullseye main contrib deb https://mirrors.ustc.edu.cn/debian bullseye-updates main contrib deb https://mirrors.ustc.edu.cn/debian-security bullseye-security main contrib \u5220\u9664 /etc/apt/sources.list.d/pve-enterprise.list \uff0c\u65b0\u5efa /etc/apt/sources.list.d/pve.list \uff0c\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a deb https://mirrors.ustc.edu.cn/proxmox/debian bullseye pve-no-subscription \u5237\u65b0\u8f6f\u4ef6\u6e90\u5e76\u5b89\u88c5\u66f4\u65b0\u3002","title":"\u8f6f\u4ef6\u6e90"},{"location":"workflow/new-host/#_4","text":"\u4ece APT \u5b89\u88c5\u4e00\u4e9b\u8f6f\u4ef6\u4ee5\u4fbf\u7ba1\u7406\u548c\u8c03\u8bd5\u3002\u8bf7\u5c3d\u53ef\u80fd\u4fdd\u6301\u4e3b\u673a\u7cfb\u7edf\u7b80\u6d01\u3002 Vim \u5b87\u5b99\u7b2c\u4e00\u6587\u672c\u7f16\u8f91\u5668 Htop \u4efb\u52a1\u7ba1\u7406\u5668 iptables-persistent \u7528\u4e8e\u4fdd\u5b58 iptables \u914d\u7f6e ipmitool \u7528\u4e8e\u7ef4\u62a4 IPMI\uff0c \u4f7f\u7528\u6700\u7b80\u5b89\u88c5\uff08\u5373 --no-install-recommends \uff09","title":"\u5b89\u88c5\u8f6f\u4ef6\uff08\u53ef\u9009\uff09"},{"location":"workflow/new-host/#_5","text":"\u53c2\u89c1 \u4e3b\u673a\u7f51\u5361 \u4e00\u9875\u3002","title":"\u914d\u7f6e\u7f51\u5361"},{"location":"workflow/new-host/#_6","text":"\u9700\u8981\u5b89\u88c5 iptables-persistent \u8f6f\u4ef6\u5305\u3002\u5c06 \u9632\u706b\u5899 \u4e00\u9875\u7ed9\u51fa\u7684\u811a\u672c\u4fdd\u5b58\u4e3a iptables.sh \u5e76\u8fd0\u884c\u3002","title":"\u914d\u7f6e\u9632\u706b\u5899"},{"location":"workflow/new-host/#_7","text":"\u4f7f\u7528 iSCSI \u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177 iscsiadm -m discover iscsiadm -d2 -m node -T iqn.2015-11.com.hpe:storage.msa1050.1840436ed4 -p 10 .0.0.200 --login \u5b58\u50a8\u670d\u52a1\u5668\u7684\u4f7f\u7528\u5730\u5740\u4e3a 10.0.0.200 \u4e0e 10.0.0.201\uff0c\u5206\u522b\u5f52\u5c5e\u4e24\u4e2a\u63a7\u5236\u5668\uff0c\u5efa\u8bae\u5404\u53f0\u8ba1\u7b97\u670d\u52a1\u5668\u4ea4\u66ff\u8fde\u63a5\u8fd9\u4e24\u4e2a\u5730\u5740\u4ee5\u300c\u8d1f\u8f7d\u5747\u8861\u300d\u3002","title":"\u6302\u8f7d\u5b58\u50a8\u670d\u52a1\u5668"},{"location":"workflow/new-host/#nfs","text":"\u6302\u8f7d NFS \u5171\u4eab\u6240\u7528\u7684 /etc/fstab \u6761\u76ee\uff1a 10.0.0.1:/var/lib/vz /mnt/vz nfs rw,async,hard,intr,noexec 0 0 \u6ce8\u610f\u5148\u5728 pv1 \u4e0a\u7f16\u8f91 /etc/exports \u5e76\u8fd0\u884c exportfs -a \u5237\u65b0\u6302\u8f7d\u6743\u9650\u3002","title":"\u6302\u8f7d NFS \u955c\u50cf\u5171\u4eab"},{"location":"workflow/pack-ct-image/","text":"\u6253\u5305\u5bb9\u5668\u955c\u50cf \u00b6 Proxmox VE \u7684\u5bb9\u5668\u955c\u50cf\u548c LXC \u7565\u6709\u4e0d\u540c\uff0c\u6240\u4ee5\u4ece LXC \u4e0b\u8f7d\u7684\u955c\u50cf\u4e0d\u5b9c\u76f4\u63a5\u7528\u4e8e Proxmox VE\u3002\u57fa\u51c6\u955c\u50cf\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5df2\u6709\u7684 vlab \u955c\u50cf\uff08\u63a8\u8350\uff09\uff0c\u6216\u8005\u4f7f\u7528 pveam \u547d\u4ee4\u4ece Proxmox \u5b98\u65b9\u4e0b\u8f7d\u3002 \u540c\u6837\u7531\u4e8e\u955c\u50cf\u5185\u5bb9\u7684\u4e0d\u4e00\u81f4\u4ee5\u53ca\u4e0b\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u4e0e\u7f51\u7edc\u76f8\u5173\u7684\u8bbe\u7f6e\uff0c\u5c1d\u8bd5\u5728\u81ea\u5df1\u7684 LXC / LXD \u73af\u5883\u4e2d\u8fdb\u884c\u955c\u50cf\u7684\u914d\u7f6e\u5de5\u4f5c\u53ef\u80fd\u4f1a\u9047\u5230\u5404\u79cd\u5404\u6837\u7684\u56f0\u96be\uff0c\u4f8b\u5982\u6743\u9650\u95ee\u9898\u3001\u7f51\u7edc\u95ee\u9898\u7b49\uff0c\u56e0\u6b64\u6211\u4eec\u76f4\u63a5\u5728\u73b0\u6709\u7684 Proxmox \u96c6\u7fa4\u4e2d\u64cd\u4f5c\u5c31\u884c\u4e86\u3002 \u6253\u5305\u7684\u5bb9\u5668\u955c\u50cf\u5e94\u5f53\u5728\u529f\u80fd\u5b8c\u6574\u3001\u8ffd\u6c42\u5f00\u7bb1\u5373\u7528\u7684\u60c5\u51b5\u4e0b \u5c3d\u53ef\u80fd\u4fdd\u6301\u7cbe\u7b80 \uff0c\u4f8b\u5982 build-essential \u53ef\u4ee5\u5b89\u88c5\uff0c\u4f46\u662f Clang / LLVM \u6700\u597d\u4e0d\u8981\uff08 \u4e00\u3001\u51c6\u5907\u65b0\u7684\u5bb9\u5668\u73af\u5883 \u00b6 \u767b\u5f55\u96c6\u7fa4\u65b0\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u6311\u4e00\u4e2a\u8d1f\u8f7d\u8f83\u4f4e\u7684\u8282\u70b9\uff08\u4f8b\u5982 pv8\uff09\uff0c\u628a Unprivileged container \u53d6\u6d88\u52fe\u9009\uff08\u9ed8\u8ba4\u662f\u9009\u4e2d\u7684\uff0c\u4e0d\u53d6\u6d88\u7684\u8bdd\u540e\u9762\u6253\u5305\u65f6 \u8981\u989d\u5916\u5904\u7406\u4e00\u4e0b \uff09\uff0c\u6a21\u677f\u9009\u4e00\u4e2a\u57fa\u7840\u955c\u50cf\uff0c\u786c\u76d8\u5927\u5c0f\u6839\u636e\u8981\u88c5\u7684\u4e1c\u897f\u4f30\u8ba1\uff0c\u5178\u578b\u7684 Ubuntu 20.04 \u955c\u50cf\u53ea\u8981 4 GB \u5c31\u591f\uff0c\u8fd9\u91cc\u53ef\u4ee5\u9009\u62e9\u5b58\u50a8\u4e3a local-lvm \u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u786c\u76d8\u6027\u80fd\uff08\u4e3b\u673a\u7684 SSD\uff09\u3002CPU \u548c\u5185\u5b58\u53ef\u4ee5\u968f\u610f\uff0c\u53cd\u6b63\u8fd9\u4e2a\u5bb9\u5668\u662f\u4e34\u65f6\u4f7f\u7528\u7684\u3002 \u5bb9\u5668\u7f51\u7edc \u8fde\u63a5\u5230 vmbr1\uff0c\u968f\u4fbf\u53d6\u4e00\u4e2a\u6ca1\u7528\u8fc7\u7684 IPv4 \u5730\u5740\uff08\u5efa\u8bae 172.31.0.240 - 172.31.0.255 \u4e4b\u95f4\uff09\uff0c\u63a9\u7801\u662f /16\uff0c\u7f51\u5173\u4e3a 172.31.0.1\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u4e0b\u4e00\u6b65\u521b\u5efa\u4e86\u3002 \u4e8c\u3001\u57fa\u7840\u5de5\u4f5c \u00b6 \u672c\u8282\u5de5\u4f5c\u53ea\u9700\u8981\u5bf9\u4ece Proxmox \u76f4\u63a5\u4e0b\u8f7d\u7684\u201c\u6700\u539f\u59cb\u201d\u7684\u955c\u50cf\u5904\u7406\u3002 \u6362\u6e90 \uff1a\u5c06 apt / yum \u6e90\u6362\u4e3a mirrors.ustc.edu.cn \u52a0\u5165 SSH CA \u516c\u94a5 \uff1a\u8fd9\u91cc\u8bf7\u52a0\u5165 Vlab User CA\uff08 SSH \u8bc1\u4e66\u8ba4\u8bc1 \u8fd9\u4e00\u9875\u4e0b\u9762\u90a3\u4e2a\uff09 \u5bf9\u4e8e Ubuntu 20.04 \u7cfb\u7edf\uff0c\u5176\u9ed8\u8ba4\u7684 sshd_config \u91cc\u6709\u4e00\u884c Include\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5728 /etc/ssh/sshd_config.d \u4e0b\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\u7528\u6765\u5199 TrustedUserCAKeys \u3002\u5bf9\u4e8e\u5176\u4ed6\u7cfb\u7edf\uff0c\u8fd8\u662f\u5c06\u914d\u7f6e\u76f4\u63a5\u8ffd\u52a0\u81f3\u7cfb\u7edf\u7684 sshd_config \u3002 \u8bbe\u7f6e\u7cfb\u7edf\u8bed\u8a00 \uff1a\u4f7f\u7528 dpkg-reconfigure locales \u751f\u6210 en_US.UTF-8 \u548c zh_CN.UTF-8 \u7684\u8bed\u8a00\u5e76\u5c06\u4e2d\u6587\u8bbe\u4e3a\u9ed8\u8ba4\u3002\u4e0d\u8981\u5b89\u88c5 locales-all \u5305\uff0c\u5b83\u592a\u5927\u4e86\uff0c\u6211\u4eec\u7528\u4e0d\u4e0a \u4e0b\u9762\u8fd9\u4e9b\u5de5\u4f5c\u53ef\u4ee5\u51ed\u81ea\u5df1\u559c\u597d\u9009\u505a\uff1a \u5b89\u88c5\u8f6f\u4ef6 \uff1a\u4f8b\u5982 build-essential , Git, Vim \u7b49\u5e38\u7528\u8f6f\u4ef6\u5de5\u5177\u3002\u8bf7\u5c3d\u91cf\u4fdd\u6301\u7cbe\u7b80 \u66f4\u65b0 /etc/skel \uff1a\u4f8b\u5982\uff0c\u5728 .bashrc \u91cc\u9ed8\u8ba4\u542f\u7528\u6709\u989c\u8272\u7684 PS1\uff08\u9650 Ubuntu / Debian\uff09\uff0c\u6216\u8005\u63d0\u4f9b\u9ed8\u8ba4\u7684 rc \u7c7b\u914d\u7f6e\u6587\u4ef6 \u66f4\u65b0 /etc/motd \uff1a\u4e5f\u5c31 SSH \u767b\u5f55\u7684\u65f6\u5019\u663e\u793a\u4e00\u4e0b\uff0c\u6539\u4e0d\u6539\u6ca1\u5565\u533a\u522b \u5982\u679c\u6253\u5305\u7684\u76ee\u6807\u4e0d\u662f\u5e26\u684c\u9762\u73af\u5883\u7684\u955c\u50cf\u7684\u8bdd\uff0c\u7b2c\u4e09\u6b65\u5c31\u53ef\u4ee5\u8df3\u8fc7\u4e86\u3002 \u4e09\u3001\u5b89\u88c5\u4e0e\u6d4b\u8bd5\u684c\u9762\u73af\u5883 \u00b6 \u684c\u9762\u73af\u5883\u7684\u914d\u7f6e\u8f83\u4e3a\u590d\u6742\uff0c\u56e0\u4e3a\u8981\u8fd0\u884c VNC server \u5e76\u5c06\u5176\u4f5c\u4e3a\u684c\u9762\u7ba1\u7406\u5668\u7684\u4e3b\u663e\u793a\u8f93\u51fa\u3002\u7ecf\u8fc7 pdlan \u7684\u8c03\u8bd5\uff0c\u91c7\u7528 LightDM + TigerVNC server \u7684\u7ec4\u5408\uff0c\u4f7f\u7528\u4e00\u4e2a\u81ea\u5df1\u7f16\u5199\u7684\u542f\u52a8\u811a\u672c\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002\u8fd9\u90e8\u5206\u914d\u7f6e\u5de5\u4f5c\u6211\u4eec\u5df2\u7ecf\u6253\u5305\u6210\u4e86\u4e00\u4e2a Debian package\uff0c\u653e\u5728 https://vlab.ustc.edu.cn/repo/vlab-vnc.deb \uff0c\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5\uff0c \u6ce8\u610f\u4f7f\u7528 --no-install-recommends \u3002 \u7531\u4e8e\u540e\u53f0 VNC server \u91c7\u7528\u4e86\u65e0\u5bc6\u7801\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u56e0\u6b64\u989d\u5916\u4f7f\u7528 iptables \u9632\u706b\u5899\u6765\u9650\u5236\u53ea\u80fd\u4ece web \u670d\u52a1\u5668\u7684\u5730\u5740\u8fde\u63a5 VNC server\uff0c\u8be5\u90e8\u5206\u5904\u7406\u653e\u5728\u4e86 deb \u7684 postinst \u64cd\u4f5c\u4e2d\uff0c\u4f1a\u52a0\u4e0a\u4e00\u6761 IPv4 \u89c4\u5219\u9650\u5236\u6765\u6e90\u548c\u4e00\u6761 IPv6 \u89c4\u5219\u62d2\u7edd\u6240\u6709\u8fde\u63a5\u3002 \u684c\u9762\u73af\u5883\u6211\u4eec\u4e00\u822c\u9009\u7528\u8f7b\u91cf\u7684 Xfce\uff08\u5b89\u88c5 xfce4 \uff0c\u4e5f\u8981\u4f7f\u7528 --no-install-recommends \uff09\uff0c\u88c5\u597d\u4e4b\u540e\u542f\u52a8 lightdm.service \u5c31\u53ef\u4ee5\u6d4b\u8bd5\u4e86\u3002 \u4e3a\u4e86\u505a\u5230\u201c\u5f00\u7bb1\u5373\u7528\u201d\uff0c\u4e00\u822c\u8fd8\u4f1a\u5b89\u88c5\u4e00\u4e9b\u5e38\u7528\u8f6f\u4ef6\uff0c\u5982\u6d4f\u89c8\u5668\u3001\u6587\u672c\u7f16\u8f91\u5668\u7b49\uff0c\u540c\u65f6\u5b89\u88c5\u5408\u9002\u7684\u5b57\u4f53\u548c\u8f93\u5165\u6cd5\u786e\u4fdd\u4e2d\u6587\u80fd\u591f\u6b63\u5e38\u4f7f\u7528\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u5b89\u88c5\uff1a Firefox \u6d4f\u89c8\u5668 Xfce \u7684\u5c0f\u73a9\u610f xfce-goodies \uff0c\u8fd9\u4e2a\u5305\u4f1a\u5e26\u4e0a\u8bb0\u4e8b\u672c\u8ba1\u7b97\u5668\u7b49\u5c0f\u5de5\u5177 ibus-pinyin \u6216 fcitx-libpinyin \u5e76\u914d\u7f6e\u597d\uff0c\u4f5c\u4e3a\u9ed8\u8ba4\u7684\u4e2d\u6587\u62fc\u97f3\u8f93\u5165\u6cd5 fonts-droid-fallback \u6216 fonts-wqy-microhei \u4f5c\u4e3a\u4e2d\u6587\u5b57\u4f53\u3002\u4e0d\u8981\u5b89\u88c5 fonts-noto-sans \u7b49\u5b57\u4f53\uff0c\u5b83\u4eec\u592a\u5927\u4e86 \u7531\u4e8e\u684c\u9762\u73af\u5883\u7ecf\u5e38\u9644\u5e26\u4e00\u5806\u7528\u4e0d\u4e0a\u7684\u4e1c\u897f\uff0c\u6240\u4ee5\u6253\u5305\u524d\u591a\u82b1\u70b9\u65f6\u95f4\u6e05\u7406\u3002 \u914d\u7f6e Vlab Software \u00b6 \u4e3b\u6587\u7ae0\uff1a Vlab Software \u53d6\u51b3\u4e8e\u6240\u5b89\u88c5\u7684\u684c\u9762\u73af\u5883\uff0c\u5728 /etc/xdg/menus \u4e0b\u7684\u67d0\u4e2a .menu \u6587\u4ef6\u6700\u540e\u7684\u5173\u95ed\u6807\u7b7e \u524d \u63d2\u5165\u5982\u4e0b\u5185\u5bb9\uff1a <!-- Vlab --> <Menu> <Name> Vlab </Name> <Directory> Vlab.directory </Directory> <AppDir> /opt/vlab/applications </AppDir> <Include><And><Category> Vlab </Category></And></Include> </Menu> \u5373\u5c06\u4ee5\u4e0a\u5185\u5bb9\u6dfb\u52a0\u4e3a\u6700\u5916\u5c42\u7684 <Menu> \u7684\u4e00\u4e2a\u5b50\u952e\u3002 \u521b\u5efa /etc/profile.d/vlab.sh \uff0c\u586b\u5165\u5982\u4e0b\u5185\u5bb9\uff1a if [ -e /opt/vlab/path.sh ] ; then . /opt/vlab/path.sh fi \u5982\u679c\u6ca1\u6709 /etc/profile.d \u76ee\u5f55\uff0c\u5c31\u5c06\u8fd9\u51e0\u884c\u4ee3\u7801\u52a0\u5728 /etc/profile \u7684\u672b\u5c3e\u3002 \u975e Ubuntu \u865a\u62df\u673a\u7684 lightdm \u53ef\u80fd\u4e0d\u4f1a\u52a0\u8f7d profile\uff0c\u6240\u4ee5\u9700\u8981\uff1a ln -s /etc/profile.d/vlab.sh /etc/X11/Xsession.d/99vlab \u8ba9 lightdm \u542f\u52a8\u65f6\u66f4\u65b0 vlab \u4fe1\u606f\u3002 \u6700\u540e\uff0c\u8bb0\u5f97\u66ff\u6362\u4e0a Vlab \u7684 \u4e13\u5c5e \u684c\u9762\uff1a https://vlab.ustc.edu.cn/downloads/background.jpg \u6d4b\u8bd5\u684c\u9762\u73af\u5883 \u00b6 \u53ea\u63a5\u5165\u5185\u7f51\u7684\u5bb9\u5668\u4e2d\u8f6c\u53d1\u4ec0\u4e48\u7684\u6bd4\u8f83\u9ebb\u70e6\uff08\u5982\u679c\u4f60\u4f1a\u7528 SSH \u8f6c\u53d1 ssh -L \u7684\u8bdd\u5f53\u7136\u4e5f\u53ef\u4ee5\uff09\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u4f7f\u7528 VNC \u7edf\u4e00\u767b\u5f55\u7684\u529e\u6cd5\uff0c\u5c31\u662f\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u673a\uff0c\u8bb0\u5f55\u4e0b IP \u4e4b\u540e\u5173\u673a\uff0c\u518d\u628a IP \u5207\u6362\u5230\u6b63\u5728\u5b89\u88c5\u914d\u7f6e\u7684\u8fd9\u4e2a\u5bb9\u5668\u4e0a\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 VNC \u7edf\u4e00\u767b\u5f55\u4e86\u3002 LightDM \u7684\u5173\u673a\u91cd\u542f\u529f\u80fd\u65e0\u6548\u662f\u6b63\u5e38\u73b0\u8c61\uff0c\u653e\u5fc3\u5ffd\u7565\uff0c\u53ea\u8981 Logout \u80fd\u7528\u5c31\u57fa\u672c OK \u4e86\u3002 \u56db\u3001\u6253\u5305\u524d\u7684\u5de5\u4f5c \u00b6 \u5176\u5b9e\u5c31\u662f\u6e05\u7406\u5de5\u4f5c\uff0c\u907f\u514d\u628a\u4e0d\u5fc5\u8981\u7684\u5185\u5bb9\u6253\u5305\u8fdb\u955c\u50cf\u3002\u4e0b\u9762\u662f\u4e00\u4e9b\u9700\u8981\u6e05\u7406\u7684\u4e1c\u897f\uff1a /etc/ssh \uff1a\u5c06\u751f\u6210\u7684 Host Key \u5168\u90e8\u5220\u6389\uff08\u5982\u679c\u6709\uff09\uff0c\u8fd9\u6837\u521b\u5efa\u65b0\u5bb9\u5668\u7684\u65f6\u5019\u53ef\u4ee5\u751f\u6210\u65b0\u7684\u4e3b\u673a\u5bc6\u94a5\u5bf9 /run , /tmp , /var/{backups,cache,crash,log,tmp} \uff1a\u5168\u90e8\u6e05\u7a7a\uff0c\u6ce8\u610f /tmp , /var/crash \u548c /var/tmp \u8fd9\u4e09\u4e2a\u76ee\u5f55\u7684\u6743\u9650\u662f 1777 (rwxrwxrwt)\uff0c\u5176\u4ed6\u76ee\u5f55\u6743\u9650\u90fd\u662f 0755 (rwxr-xr-x)\u3002 /root \u548c /home/<user> \uff1a\u628a .bash_history \u4e4b\u7c7b\u7684\u6587\u4ef6\u90fd\u5220\u6389\uff0c\u53ea\u7559\u4e0b\u6700\u57fa\u672c\u7684\u5185\u5bb9\uff08\u5982\u679c\u914d\u7f6e\u4e86\u684c\u9762\u73af\u5883\uff0c\u8c28\u614e\u6e05\u7406 .config \uff09\u3002 \u5bf9\u4e8e Ubuntu/Debian \u955c\u50cf\uff0c\u8fd8\uff08\u6700\u597d\uff09\u8981\u6e05\u9664 apt \u7684\u7f13\u5b58\u3002\u53ef\u4ee5\u4f7f\u7528 chroot \u8fdb\u5165\u955c\u50cf\u8fd0\u884c apt-get clean \uff0c\u4e5f\u53ef\u4ee5\u624b\u52a8\u6e05\u7a7a /var/lib/apt/lists \u76ee\u5f55\u3002 \u5f53\u7136\u6e05\u7406\u4e4b\u524d\u8981\u628a\u5bb9\u5668\u5173\u673a\u4e86\uff0c\u4e0d\u7136 tmp \u548c cache \u4e4b\u7c7b\u7684\u4e1c\u897f\u8fd8\u4f1a\u6e90\u6e90\u4e0d\u65ad\u5730\u5192\u51fa\u6765\u3002 \u4e94\u3001\u6253\u5305 \u00b6 \u6839\u636e\u7b2c\u4e00\u6b65\u521b\u5efa\u5bb9\u5668\u65f6\u9009\u62e9\u7684\u5b58\u50a8\uff0c\u8fd9\u91cc\u6d89\u53ca\u5230\u7684 VG \u53ef\u80fd\u662f user-data \u6216 pve \u3002 \u901a\u8fc7\u547d\u4ee4\u884c\u767b\u5f55\u4e3b\u673a\uff0c\u9996\u5148\u6fc0\u6d3b\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\uff1a lvchange -a y { vg } /vm- { id } -disk-0 mkdir tmp mount /dev/ { vg } /vm- { id } -disk-0 tmp \u7136\u540e\u5c31\u53ef\u4ee5\u8fdb\u5165 tmp \u8fdb\u884c\u6e05\u7406\u5de5\u4f5c\u4e86\u3002 \u6700\u540e\u6253\u5305\u8981\u5728 tmp \u76ee\u5f55\u4e0b\uff08\u5373\u5bb9\u5668\u7684\u6839\u76ee\u5f55\uff09\u8fdb\u884c\uff0c\u56e0\u4e3a\uff08\u663e\u7136\uff09tar \u538b\u7f29\u5305\u4e2d\u7684\u8def\u5f84\u662f\u6709\u5f71\u54cd\u7684\u3002 tar zcvf /mnt/vz/template/cache/vlab99-example.tar.gz . Unprivileged container \u6253\u5305\u540e\u7684 UID/GID \u5904\u7406 \u00b6 \u5982\u679c\u5bb9\u5668\u521b\u5efa\u65f6\u8bbe\u7f6e\u4e3a\u4e86 unprivileged\uff0c\u5219\u5176\u5b58\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684 UID/GID \u7b49\u90fd\u88ab LXC \u6620\u5c04\u5230\u4e86 +100000\uff0810 \u4e07\uff09\u7684\u6570\u503c\uff0c\u6253\u5305\u540e\u9700\u8981\u5c06\u8fd9\u589e\u52a0\u7684\u6570\u503c\u4fee\u6539\u56de\u6765\u3002\u53c2\u8003 \u8fd9\u4e2a Stack Overflow \u4e3b\u9898 \uff0c\u4f7f\u7528\u8fd9\u4e2a Go \u7a0b\u5e8f\u53ef\u4ee5\u6539\u5199 tar \u4e2d\u7684\u6587\u4ef6\u4fe1\u606f\uff1a Go \u4ee3\u7801 package main import ( \"archive/tar\" \"io\" \"log\" \"os\" ) func main () { tr := tar . NewReader ( os . Stdin ) tw := tar . NewWriter ( os . Stdout ) for { hdr , err := tr . Next () if err == io . EOF { break } else if err != nil { log . Fatal ( err ) } hdr . Uid -= 100000 hdr . Gid -= 100000 if err := tw . WriteHeader ( hdr ); err != nil { log . Fatal ( err ) } if hdr . Typeflag == tar . TypeReg { if _ , err := io . Copy ( tw , tr ); err != nil { log . Fatal ( err ) } } } if err := tw . Close (); err != nil { log . Fatal ( err ) } } \u4f7f\u7528 Go \u7a0b\u5e8f\u6539\u5199 tar \u5305 \u4e0a\u9762\u7684 Go \u793a\u4f8b\u7a0b\u5e8f\u53ea\u80fd\u5904\u7406\u672a\u538b\u7f29\u7684 tar \u5305\uff0c\u5982\u679c\u4f60\u5728\u6253\u5305\u65f6\u52a0\u5165\u4e86 z \u6216\u5176\u4ed6\u538b\u7f29\u53c2\u6570\uff0c\u9700\u8981\u5148\u89e3\u538b\u518d\u8f93\u5165\u7a0b\u5e8f\uff0c\u4f8b\u5982\uff1a gunzip -c original.tar.gz | go run script.go | gzip -c9 > processed.tar.gz \u6253\u5305\u5b8c\u6210\u540e\u8981\u628a django \u524d\u7aef reload \u4e00\u4e0b\u624d\u80fd\u5728\u201c\u65b0\u5efa\u865a\u62df\u673a\u201d\u7684\u9875\u9762\u770b\u5230\u65b0\u955c\u50cf\u3002","title":"\u6253\u5305\u5bb9\u5668\u955c\u50cf"},{"location":"workflow/pack-ct-image/#_1","text":"Proxmox VE \u7684\u5bb9\u5668\u955c\u50cf\u548c LXC \u7565\u6709\u4e0d\u540c\uff0c\u6240\u4ee5\u4ece LXC \u4e0b\u8f7d\u7684\u955c\u50cf\u4e0d\u5b9c\u76f4\u63a5\u7528\u4e8e Proxmox VE\u3002\u57fa\u51c6\u955c\u50cf\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5df2\u6709\u7684 vlab \u955c\u50cf\uff08\u63a8\u8350\uff09\uff0c\u6216\u8005\u4f7f\u7528 pveam \u547d\u4ee4\u4ece Proxmox \u5b98\u65b9\u4e0b\u8f7d\u3002 \u540c\u6837\u7531\u4e8e\u955c\u50cf\u5185\u5bb9\u7684\u4e0d\u4e00\u81f4\u4ee5\u53ca\u4e0b\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u4e0e\u7f51\u7edc\u76f8\u5173\u7684\u8bbe\u7f6e\uff0c\u5c1d\u8bd5\u5728\u81ea\u5df1\u7684 LXC / LXD \u73af\u5883\u4e2d\u8fdb\u884c\u955c\u50cf\u7684\u914d\u7f6e\u5de5\u4f5c\u53ef\u80fd\u4f1a\u9047\u5230\u5404\u79cd\u5404\u6837\u7684\u56f0\u96be\uff0c\u4f8b\u5982\u6743\u9650\u95ee\u9898\u3001\u7f51\u7edc\u95ee\u9898\u7b49\uff0c\u56e0\u6b64\u6211\u4eec\u76f4\u63a5\u5728\u73b0\u6709\u7684 Proxmox \u96c6\u7fa4\u4e2d\u64cd\u4f5c\u5c31\u884c\u4e86\u3002 \u6253\u5305\u7684\u5bb9\u5668\u955c\u50cf\u5e94\u5f53\u5728\u529f\u80fd\u5b8c\u6574\u3001\u8ffd\u6c42\u5f00\u7bb1\u5373\u7528\u7684\u60c5\u51b5\u4e0b \u5c3d\u53ef\u80fd\u4fdd\u6301\u7cbe\u7b80 \uff0c\u4f8b\u5982 build-essential \u53ef\u4ee5\u5b89\u88c5\uff0c\u4f46\u662f Clang / LLVM \u6700\u597d\u4e0d\u8981\uff08","title":"\u6253\u5305\u5bb9\u5668\u955c\u50cf"},{"location":"workflow/pack-ct-image/#prepare-ct","text":"\u767b\u5f55\u96c6\u7fa4\u65b0\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u6311\u4e00\u4e2a\u8d1f\u8f7d\u8f83\u4f4e\u7684\u8282\u70b9\uff08\u4f8b\u5982 pv8\uff09\uff0c\u628a Unprivileged container \u53d6\u6d88\u52fe\u9009\uff08\u9ed8\u8ba4\u662f\u9009\u4e2d\u7684\uff0c\u4e0d\u53d6\u6d88\u7684\u8bdd\u540e\u9762\u6253\u5305\u65f6 \u8981\u989d\u5916\u5904\u7406\u4e00\u4e0b \uff09\uff0c\u6a21\u677f\u9009\u4e00\u4e2a\u57fa\u7840\u955c\u50cf\uff0c\u786c\u76d8\u5927\u5c0f\u6839\u636e\u8981\u88c5\u7684\u4e1c\u897f\u4f30\u8ba1\uff0c\u5178\u578b\u7684 Ubuntu 20.04 \u955c\u50cf\u53ea\u8981 4 GB \u5c31\u591f\uff0c\u8fd9\u91cc\u53ef\u4ee5\u9009\u62e9\u5b58\u50a8\u4e3a local-lvm \u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u786c\u76d8\u6027\u80fd\uff08\u4e3b\u673a\u7684 SSD\uff09\u3002CPU \u548c\u5185\u5b58\u53ef\u4ee5\u968f\u610f\uff0c\u53cd\u6b63\u8fd9\u4e2a\u5bb9\u5668\u662f\u4e34\u65f6\u4f7f\u7528\u7684\u3002 \u5bb9\u5668\u7f51\u7edc \u8fde\u63a5\u5230 vmbr1\uff0c\u968f\u4fbf\u53d6\u4e00\u4e2a\u6ca1\u7528\u8fc7\u7684 IPv4 \u5730\u5740\uff08\u5efa\u8bae 172.31.0.240 - 172.31.0.255 \u4e4b\u95f4\uff09\uff0c\u63a9\u7801\u662f /16\uff0c\u7f51\u5173\u4e3a 172.31.0.1\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u4e0b\u4e00\u6b65\u521b\u5efa\u4e86\u3002","title":"\u4e00\u3001\u51c6\u5907\u65b0\u7684\u5bb9\u5668\u73af\u5883"},{"location":"workflow/pack-ct-image/#base-works","text":"\u672c\u8282\u5de5\u4f5c\u53ea\u9700\u8981\u5bf9\u4ece Proxmox \u76f4\u63a5\u4e0b\u8f7d\u7684\u201c\u6700\u539f\u59cb\u201d\u7684\u955c\u50cf\u5904\u7406\u3002 \u6362\u6e90 \uff1a\u5c06 apt / yum \u6e90\u6362\u4e3a mirrors.ustc.edu.cn \u52a0\u5165 SSH CA \u516c\u94a5 \uff1a\u8fd9\u91cc\u8bf7\u52a0\u5165 Vlab User CA\uff08 SSH \u8bc1\u4e66\u8ba4\u8bc1 \u8fd9\u4e00\u9875\u4e0b\u9762\u90a3\u4e2a\uff09 \u5bf9\u4e8e Ubuntu 20.04 \u7cfb\u7edf\uff0c\u5176\u9ed8\u8ba4\u7684 sshd_config \u91cc\u6709\u4e00\u884c Include\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5728 /etc/ssh/sshd_config.d \u4e0b\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\u7528\u6765\u5199 TrustedUserCAKeys \u3002\u5bf9\u4e8e\u5176\u4ed6\u7cfb\u7edf\uff0c\u8fd8\u662f\u5c06\u914d\u7f6e\u76f4\u63a5\u8ffd\u52a0\u81f3\u7cfb\u7edf\u7684 sshd_config \u3002 \u8bbe\u7f6e\u7cfb\u7edf\u8bed\u8a00 \uff1a\u4f7f\u7528 dpkg-reconfigure locales \u751f\u6210 en_US.UTF-8 \u548c zh_CN.UTF-8 \u7684\u8bed\u8a00\u5e76\u5c06\u4e2d\u6587\u8bbe\u4e3a\u9ed8\u8ba4\u3002\u4e0d\u8981\u5b89\u88c5 locales-all \u5305\uff0c\u5b83\u592a\u5927\u4e86\uff0c\u6211\u4eec\u7528\u4e0d\u4e0a \u4e0b\u9762\u8fd9\u4e9b\u5de5\u4f5c\u53ef\u4ee5\u51ed\u81ea\u5df1\u559c\u597d\u9009\u505a\uff1a \u5b89\u88c5\u8f6f\u4ef6 \uff1a\u4f8b\u5982 build-essential , Git, Vim \u7b49\u5e38\u7528\u8f6f\u4ef6\u5de5\u5177\u3002\u8bf7\u5c3d\u91cf\u4fdd\u6301\u7cbe\u7b80 \u66f4\u65b0 /etc/skel \uff1a\u4f8b\u5982\uff0c\u5728 .bashrc \u91cc\u9ed8\u8ba4\u542f\u7528\u6709\u989c\u8272\u7684 PS1\uff08\u9650 Ubuntu / Debian\uff09\uff0c\u6216\u8005\u63d0\u4f9b\u9ed8\u8ba4\u7684 rc \u7c7b\u914d\u7f6e\u6587\u4ef6 \u66f4\u65b0 /etc/motd \uff1a\u4e5f\u5c31 SSH \u767b\u5f55\u7684\u65f6\u5019\u663e\u793a\u4e00\u4e0b\uff0c\u6539\u4e0d\u6539\u6ca1\u5565\u533a\u522b \u5982\u679c\u6253\u5305\u7684\u76ee\u6807\u4e0d\u662f\u5e26\u684c\u9762\u73af\u5883\u7684\u955c\u50cf\u7684\u8bdd\uff0c\u7b2c\u4e09\u6b65\u5c31\u53ef\u4ee5\u8df3\u8fc7\u4e86\u3002","title":"\u4e8c\u3001\u57fa\u7840\u5de5\u4f5c"},{"location":"workflow/pack-ct-image/#_2","text":"\u684c\u9762\u73af\u5883\u7684\u914d\u7f6e\u8f83\u4e3a\u590d\u6742\uff0c\u56e0\u4e3a\u8981\u8fd0\u884c VNC server \u5e76\u5c06\u5176\u4f5c\u4e3a\u684c\u9762\u7ba1\u7406\u5668\u7684\u4e3b\u663e\u793a\u8f93\u51fa\u3002\u7ecf\u8fc7 pdlan \u7684\u8c03\u8bd5\uff0c\u91c7\u7528 LightDM + TigerVNC server \u7684\u7ec4\u5408\uff0c\u4f7f\u7528\u4e00\u4e2a\u81ea\u5df1\u7f16\u5199\u7684\u542f\u52a8\u811a\u672c\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002\u8fd9\u90e8\u5206\u914d\u7f6e\u5de5\u4f5c\u6211\u4eec\u5df2\u7ecf\u6253\u5305\u6210\u4e86\u4e00\u4e2a Debian package\uff0c\u653e\u5728 https://vlab.ustc.edu.cn/repo/vlab-vnc.deb \uff0c\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5\uff0c \u6ce8\u610f\u4f7f\u7528 --no-install-recommends \u3002 \u7531\u4e8e\u540e\u53f0 VNC server \u91c7\u7528\u4e86\u65e0\u5bc6\u7801\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u56e0\u6b64\u989d\u5916\u4f7f\u7528 iptables \u9632\u706b\u5899\u6765\u9650\u5236\u53ea\u80fd\u4ece web \u670d\u52a1\u5668\u7684\u5730\u5740\u8fde\u63a5 VNC server\uff0c\u8be5\u90e8\u5206\u5904\u7406\u653e\u5728\u4e86 deb \u7684 postinst \u64cd\u4f5c\u4e2d\uff0c\u4f1a\u52a0\u4e0a\u4e00\u6761 IPv4 \u89c4\u5219\u9650\u5236\u6765\u6e90\u548c\u4e00\u6761 IPv6 \u89c4\u5219\u62d2\u7edd\u6240\u6709\u8fde\u63a5\u3002 \u684c\u9762\u73af\u5883\u6211\u4eec\u4e00\u822c\u9009\u7528\u8f7b\u91cf\u7684 Xfce\uff08\u5b89\u88c5 xfce4 \uff0c\u4e5f\u8981\u4f7f\u7528 --no-install-recommends \uff09\uff0c\u88c5\u597d\u4e4b\u540e\u542f\u52a8 lightdm.service \u5c31\u53ef\u4ee5\u6d4b\u8bd5\u4e86\u3002 \u4e3a\u4e86\u505a\u5230\u201c\u5f00\u7bb1\u5373\u7528\u201d\uff0c\u4e00\u822c\u8fd8\u4f1a\u5b89\u88c5\u4e00\u4e9b\u5e38\u7528\u8f6f\u4ef6\uff0c\u5982\u6d4f\u89c8\u5668\u3001\u6587\u672c\u7f16\u8f91\u5668\u7b49\uff0c\u540c\u65f6\u5b89\u88c5\u5408\u9002\u7684\u5b57\u4f53\u548c\u8f93\u5165\u6cd5\u786e\u4fdd\u4e2d\u6587\u80fd\u591f\u6b63\u5e38\u4f7f\u7528\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u5b89\u88c5\uff1a Firefox \u6d4f\u89c8\u5668 Xfce \u7684\u5c0f\u73a9\u610f xfce-goodies \uff0c\u8fd9\u4e2a\u5305\u4f1a\u5e26\u4e0a\u8bb0\u4e8b\u672c\u8ba1\u7b97\u5668\u7b49\u5c0f\u5de5\u5177 ibus-pinyin \u6216 fcitx-libpinyin \u5e76\u914d\u7f6e\u597d\uff0c\u4f5c\u4e3a\u9ed8\u8ba4\u7684\u4e2d\u6587\u62fc\u97f3\u8f93\u5165\u6cd5 fonts-droid-fallback \u6216 fonts-wqy-microhei \u4f5c\u4e3a\u4e2d\u6587\u5b57\u4f53\u3002\u4e0d\u8981\u5b89\u88c5 fonts-noto-sans \u7b49\u5b57\u4f53\uff0c\u5b83\u4eec\u592a\u5927\u4e86 \u7531\u4e8e\u684c\u9762\u73af\u5883\u7ecf\u5e38\u9644\u5e26\u4e00\u5806\u7528\u4e0d\u4e0a\u7684\u4e1c\u897f\uff0c\u6240\u4ee5\u6253\u5305\u524d\u591a\u82b1\u70b9\u65f6\u95f4\u6e05\u7406\u3002","title":"\u4e09\u3001\u5b89\u88c5\u4e0e\u6d4b\u8bd5\u684c\u9762\u73af\u5883"},{"location":"workflow/pack-ct-image/#vlab-software","text":"\u4e3b\u6587\u7ae0\uff1a Vlab Software \u53d6\u51b3\u4e8e\u6240\u5b89\u88c5\u7684\u684c\u9762\u73af\u5883\uff0c\u5728 /etc/xdg/menus \u4e0b\u7684\u67d0\u4e2a .menu \u6587\u4ef6\u6700\u540e\u7684\u5173\u95ed\u6807\u7b7e \u524d \u63d2\u5165\u5982\u4e0b\u5185\u5bb9\uff1a <!-- Vlab --> <Menu> <Name> Vlab </Name> <Directory> Vlab.directory </Directory> <AppDir> /opt/vlab/applications </AppDir> <Include><And><Category> Vlab </Category></And></Include> </Menu> \u5373\u5c06\u4ee5\u4e0a\u5185\u5bb9\u6dfb\u52a0\u4e3a\u6700\u5916\u5c42\u7684 <Menu> \u7684\u4e00\u4e2a\u5b50\u952e\u3002 \u521b\u5efa /etc/profile.d/vlab.sh \uff0c\u586b\u5165\u5982\u4e0b\u5185\u5bb9\uff1a if [ -e /opt/vlab/path.sh ] ; then . /opt/vlab/path.sh fi \u5982\u679c\u6ca1\u6709 /etc/profile.d \u76ee\u5f55\uff0c\u5c31\u5c06\u8fd9\u51e0\u884c\u4ee3\u7801\u52a0\u5728 /etc/profile \u7684\u672b\u5c3e\u3002 \u975e Ubuntu \u865a\u62df\u673a\u7684 lightdm \u53ef\u80fd\u4e0d\u4f1a\u52a0\u8f7d profile\uff0c\u6240\u4ee5\u9700\u8981\uff1a ln -s /etc/profile.d/vlab.sh /etc/X11/Xsession.d/99vlab \u8ba9 lightdm \u542f\u52a8\u65f6\u66f4\u65b0 vlab \u4fe1\u606f\u3002 \u6700\u540e\uff0c\u8bb0\u5f97\u66ff\u6362\u4e0a Vlab \u7684 \u4e13\u5c5e \u684c\u9762\uff1a https://vlab.ustc.edu.cn/downloads/background.jpg","title":"\u914d\u7f6e Vlab Software"},{"location":"workflow/pack-ct-image/#_3","text":"\u53ea\u63a5\u5165\u5185\u7f51\u7684\u5bb9\u5668\u4e2d\u8f6c\u53d1\u4ec0\u4e48\u7684\u6bd4\u8f83\u9ebb\u70e6\uff08\u5982\u679c\u4f60\u4f1a\u7528 SSH \u8f6c\u53d1 ssh -L \u7684\u8bdd\u5f53\u7136\u4e5f\u53ef\u4ee5\uff09\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u4f7f\u7528 VNC \u7edf\u4e00\u767b\u5f55\u7684\u529e\u6cd5\uff0c\u5c31\u662f\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u673a\uff0c\u8bb0\u5f55\u4e0b IP \u4e4b\u540e\u5173\u673a\uff0c\u518d\u628a IP \u5207\u6362\u5230\u6b63\u5728\u5b89\u88c5\u914d\u7f6e\u7684\u8fd9\u4e2a\u5bb9\u5668\u4e0a\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 VNC \u7edf\u4e00\u767b\u5f55\u4e86\u3002 LightDM \u7684\u5173\u673a\u91cd\u542f\u529f\u80fd\u65e0\u6548\u662f\u6b63\u5e38\u73b0\u8c61\uff0c\u653e\u5fc3\u5ffd\u7565\uff0c\u53ea\u8981 Logout \u80fd\u7528\u5c31\u57fa\u672c OK \u4e86\u3002","title":"\u6d4b\u8bd5\u684c\u9762\u73af\u5883"},{"location":"workflow/pack-ct-image/#pre-packaging","text":"\u5176\u5b9e\u5c31\u662f\u6e05\u7406\u5de5\u4f5c\uff0c\u907f\u514d\u628a\u4e0d\u5fc5\u8981\u7684\u5185\u5bb9\u6253\u5305\u8fdb\u955c\u50cf\u3002\u4e0b\u9762\u662f\u4e00\u4e9b\u9700\u8981\u6e05\u7406\u7684\u4e1c\u897f\uff1a /etc/ssh \uff1a\u5c06\u751f\u6210\u7684 Host Key \u5168\u90e8\u5220\u6389\uff08\u5982\u679c\u6709\uff09\uff0c\u8fd9\u6837\u521b\u5efa\u65b0\u5bb9\u5668\u7684\u65f6\u5019\u53ef\u4ee5\u751f\u6210\u65b0\u7684\u4e3b\u673a\u5bc6\u94a5\u5bf9 /run , /tmp , /var/{backups,cache,crash,log,tmp} \uff1a\u5168\u90e8\u6e05\u7a7a\uff0c\u6ce8\u610f /tmp , /var/crash \u548c /var/tmp \u8fd9\u4e09\u4e2a\u76ee\u5f55\u7684\u6743\u9650\u662f 1777 (rwxrwxrwt)\uff0c\u5176\u4ed6\u76ee\u5f55\u6743\u9650\u90fd\u662f 0755 (rwxr-xr-x)\u3002 /root \u548c /home/<user> \uff1a\u628a .bash_history \u4e4b\u7c7b\u7684\u6587\u4ef6\u90fd\u5220\u6389\uff0c\u53ea\u7559\u4e0b\u6700\u57fa\u672c\u7684\u5185\u5bb9\uff08\u5982\u679c\u914d\u7f6e\u4e86\u684c\u9762\u73af\u5883\uff0c\u8c28\u614e\u6e05\u7406 .config \uff09\u3002 \u5bf9\u4e8e Ubuntu/Debian \u955c\u50cf\uff0c\u8fd8\uff08\u6700\u597d\uff09\u8981\u6e05\u9664 apt \u7684\u7f13\u5b58\u3002\u53ef\u4ee5\u4f7f\u7528 chroot \u8fdb\u5165\u955c\u50cf\u8fd0\u884c apt-get clean \uff0c\u4e5f\u53ef\u4ee5\u624b\u52a8\u6e05\u7a7a /var/lib/apt/lists \u76ee\u5f55\u3002 \u5f53\u7136\u6e05\u7406\u4e4b\u524d\u8981\u628a\u5bb9\u5668\u5173\u673a\u4e86\uff0c\u4e0d\u7136 tmp \u548c cache \u4e4b\u7c7b\u7684\u4e1c\u897f\u8fd8\u4f1a\u6e90\u6e90\u4e0d\u65ad\u5730\u5192\u51fa\u6765\u3002","title":"\u56db\u3001\u6253\u5305\u524d\u7684\u5de5\u4f5c"},{"location":"workflow/pack-ct-image/#packaging","text":"\u6839\u636e\u7b2c\u4e00\u6b65\u521b\u5efa\u5bb9\u5668\u65f6\u9009\u62e9\u7684\u5b58\u50a8\uff0c\u8fd9\u91cc\u6d89\u53ca\u5230\u7684 VG \u53ef\u80fd\u662f user-data \u6216 pve \u3002 \u901a\u8fc7\u547d\u4ee4\u884c\u767b\u5f55\u4e3b\u673a\uff0c\u9996\u5148\u6fc0\u6d3b\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\uff1a lvchange -a y { vg } /vm- { id } -disk-0 mkdir tmp mount /dev/ { vg } /vm- { id } -disk-0 tmp \u7136\u540e\u5c31\u53ef\u4ee5\u8fdb\u5165 tmp \u8fdb\u884c\u6e05\u7406\u5de5\u4f5c\u4e86\u3002 \u6700\u540e\u6253\u5305\u8981\u5728 tmp \u76ee\u5f55\u4e0b\uff08\u5373\u5bb9\u5668\u7684\u6839\u76ee\u5f55\uff09\u8fdb\u884c\uff0c\u56e0\u4e3a\uff08\u663e\u7136\uff09tar \u538b\u7f29\u5305\u4e2d\u7684\u8def\u5f84\u662f\u6709\u5f71\u54cd\u7684\u3002 tar zcvf /mnt/vz/template/cache/vlab99-example.tar.gz .","title":"\u4e94\u3001\u6253\u5305"},{"location":"workflow/pack-ct-image/#process-uid-for-unprivileged-containers","text":"\u5982\u679c\u5bb9\u5668\u521b\u5efa\u65f6\u8bbe\u7f6e\u4e3a\u4e86 unprivileged\uff0c\u5219\u5176\u5b58\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684 UID/GID \u7b49\u90fd\u88ab LXC \u6620\u5c04\u5230\u4e86 +100000\uff0810 \u4e07\uff09\u7684\u6570\u503c\uff0c\u6253\u5305\u540e\u9700\u8981\u5c06\u8fd9\u589e\u52a0\u7684\u6570\u503c\u4fee\u6539\u56de\u6765\u3002\u53c2\u8003 \u8fd9\u4e2a Stack Overflow \u4e3b\u9898 \uff0c\u4f7f\u7528\u8fd9\u4e2a Go \u7a0b\u5e8f\u53ef\u4ee5\u6539\u5199 tar \u4e2d\u7684\u6587\u4ef6\u4fe1\u606f\uff1a Go \u4ee3\u7801 package main import ( \"archive/tar\" \"io\" \"log\" \"os\" ) func main () { tr := tar . NewReader ( os . Stdin ) tw := tar . NewWriter ( os . Stdout ) for { hdr , err := tr . Next () if err == io . EOF { break } else if err != nil { log . Fatal ( err ) } hdr . Uid -= 100000 hdr . Gid -= 100000 if err := tw . WriteHeader ( hdr ); err != nil { log . Fatal ( err ) } if hdr . Typeflag == tar . TypeReg { if _ , err := io . Copy ( tw , tr ); err != nil { log . Fatal ( err ) } } } if err := tw . Close (); err != nil { log . Fatal ( err ) } } \u4f7f\u7528 Go \u7a0b\u5e8f\u6539\u5199 tar \u5305 \u4e0a\u9762\u7684 Go \u793a\u4f8b\u7a0b\u5e8f\u53ea\u80fd\u5904\u7406\u672a\u538b\u7f29\u7684 tar \u5305\uff0c\u5982\u679c\u4f60\u5728\u6253\u5305\u65f6\u52a0\u5165\u4e86 z \u6216\u5176\u4ed6\u538b\u7f29\u53c2\u6570\uff0c\u9700\u8981\u5148\u89e3\u538b\u518d\u8f93\u5165\u7a0b\u5e8f\uff0c\u4f8b\u5982\uff1a gunzip -c original.tar.gz | go run script.go | gzip -c9 > processed.tar.gz \u6253\u5305\u5b8c\u6210\u540e\u8981\u628a django \u524d\u7aef reload \u4e00\u4e0b\u624d\u80fd\u5728\u201c\u65b0\u5efa\u865a\u62df\u673a\u201d\u7684\u9875\u9762\u770b\u5230\u65b0\u955c\u50cf\u3002","title":"Unprivileged container \u6253\u5305\u540e\u7684 UID/GID \u5904\u7406"},{"location":"workflow/pack-vm-image/","text":"\u6253\u5305\u865a\u62df\u673a\u955c\u50cf \u00b6 \u7531\u4e8e Proxmox VE \u4e0a\u7684\u865a\u62df\u673a\u4f7f\u7528 cloud-init \u8fdb\u884c\u5b9a\u5236\uff0c\u6211\u4eec\u63a8\u8350\u4ee5\u53d1\u884c\u7248\u5b98\u65b9\u7684 cloud image \u4e3a\u57fa\u7840\u8fdb\u884c\u989d\u5916\u914d\u7f6e\u3002 \u4e00\u3001\u4ece Ubuntu cloud images \u5f00\u59cb\u51c6\u5907\u865a\u62df\u673a \u00b6 \u4ee5 Ubuntu 20.04 LTS \u4e3a\u4f8b\uff0c\u9996\u5148\u4e0b\u8f7d https://mirrors.ustc.edu.cn/ubuntu-cloud-images/focal/current/focal-server-cloudimg-amd64.img \u5230\u672c\u5730\u3002 \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u865a\u62df\u673a\uff08\u6ce8\u610f\u5c06 ID 910 \u6362\u6210\u4e00\u4e2a\u5408\u9002\u7684\u7a7a\u95f2 ID \uff09 qm create 910 --memory 2048 --net0 virtio,bridge = vmbr1 \u5c06\u521a\u4e0b\u8f7d\u7684\u955c\u50cf\u5bfc\u5165\u65b0\u865a\u62df\u673a\uff08\u8fd9\u4e2a img \u955c\u50cf\u5b9e\u9645\u4e0a\u662f qcow2 \u683c\u5f0f\uff09\u5e76\u6302\u8f7d\u4e3a SCSI \u786c\u76d8\uff0c\u5c06\u65b0\u786c\u76d8\u8bbe\u4e3a\u542f\u52a8\u76d8 qm importdisk 910 focal-server-cloudimg-amd64.img local-lvm qm set 910 --scsihw virtio-scsi-pci --scsi0 local-lvm:vm-910-disk-1 qm set 910 --boot c --bootdisk scsi0 \u4e8c\u3001\u914d\u7f6e Cloud-init \u00b6 \u8fd9\u4e00\u6b65\u53ef\u4ee5\u5b8c\u5168\u5728 Proxmox VE web \u754c\u9762\u4e0a\u64cd\u4f5c\uff0c\u4e0b\u9762\u8fd8\u662f\u7ed9\u51fa\u547d\u4ee4\u884c\u6307\u5bfc\u3002 \u6dfb\u52a0 Cloud-init \u914d\u7f6e\u76d8\uff08\u5b98\u65b9\u6587\u6863\u91cc\u662f\u6dfb\u52a0\u4e3a IDE \u76d8\uff0c\u5b9e\u9645\u52a0\u6210 SCSI \u7684\u4e5f\u6ca1\u95ee\u9898\uff0c\u8fd9\u91cc\u8ddf\u968f\u5b98\u65b9\uff09 qm set 910 --ide2 local-lvm:cloudinit \u4e3a\u865a\u62df\u673a\u63d0\u4f9b\u7f51\u7edc\u4fe1\u606f\uff08\u6ce8\u610f\u628a IP \u5730\u5740\u6539\u6389\uff09\uff1a qm set 910 --ipconfig0 ip = 172 .31.0.256/16,gw = 172 .31.0.1,ip6 = auto \u53ef\u9009\u9879\u76ee\uff1a\u5c06 console \u8bbe\u4e3a\u4e32\u53e3 Proxmox VE \u5b98\u65b9\u6587\u6863\u91cc\u7684\u8bf4\u660e\uff1a Many Cloud-Init images rely on this, as it is an requirement for OpenStack images. qm set 910 --serial0 socket --vga serial0 \u53ef\u9009\u9879\u76ee\uff1a\u5f00\u673a \u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 qm start 910 \u542f\u52a8\u865a\u62df\u673a\u8fdb\u884c\u9ad8\u7ea7\u914d\u7f6e\u4e86\u3002 \u770b\u5b8c\u7b2c\u4e09\u7ae0\u548c\u7b2c\u56db\u7ae0\u4e4b\u540e\u4f60\u5c31\u77e5\u9053\u4e3a\u4ec0\u4e48\u5c06\u865a\u62df\u673a\u5f00\u673a\u662f\u53ef\u9009\u7684\u4e86\u3002 \u4e09\u3001\u955c\u50cf\u7684\u5904\u7406 \u00b6 \u6211\u4eec\u8ba4\u4e3a KVM \u865a\u62df\u673a\u7684\u53d7\u4f17\u662f\u4e0d\u9700\u8981\u684c\u9762\u73af\u5883\u548c Vlab Software \u8fdb\u884c\u8f83\u4e3a\u201c\u901a\u7528\u201d\u7684\u5b9e\u9a8c\u548c\u8ba1\u7b97\u7684\u7528\u6237\uff0c\u56e0\u6b64\u6211\u4eec\u5728 KVM \u955c\u50cf\u4e2d\u4e0d\u63d0\u4f9b\u684c\u9762\u73af\u5883\u548c /opt/vlab \uff08\u5176\u5b9e\u8981\u5f04\u8fd8\u6709\u70b9\u9ebb\u70e6\uff09\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4e0b\u8f7d\u4e0b\u6765\u7684\u5b98\u65b9\u955c\u50cf\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8fdb\u884c \u6700\u57fa\u672c\u7684\u4fee\u6539 \u5373\u53ef\u3002 \u56db\u3001\u6253\u5305\u524d\u7684\u5de5\u4f5c \u00b6 \u4e0e \u6253\u5305\u5bb9\u5668\u955c\u50cf\u524d\u7684\u6e05\u7406\u5de5\u4f5c \u4e00\u6837\u3002 \u6302\u8f7d\u865a\u62df\u673a\u78c1\u76d8 \u00b6 \u6ce8\u610f KVM \u7684\u201c\u5377\u201d\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u78c1\u76d8\uff0c\u800c\u5bb9\u5668\u7684\u201c\u5377\u201d\u53ea\u5305\u542b rootfs \u6240\u5728\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u56e0\u6b64\u8981\u6302\u8f7d KVM \u7684 rootfs \u9700\u8981\u5148\u5904\u7406\u78c1\u76d8\u5206\u533a\u7684\u95ee\u9898\u3002\u6211\u4eec\u63a8\u8350\u4f7f\u7528 kpartx \u5de5\u5177\u3002 kpartx -av /dev/pve/vm-910-disk-0 \u4f60\u4f1a\u770b\u5230\u7c7b\u4f3c\u8fd9\u6837\u7684\u8f93\u51fa\uff1a add map pve-vm--910--disk--0p1 (253:19): 0 4384735 linear 253:14 227328 add map pve-vm--910--disk--0p14 (253:23): 0 8192 linear 253:14 2048 add map pve-vm--910--disk--0p15 (253:24): 0 217088 linear 253:14 10240 \u6839\u636e\u5bb9\u91cf\u5224\u65ad\uff0cp1 \u5c31\u662f\u865a\u62df\u673a\u7684 rootfs\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u6302\u8f7d /dev/mapper/pve-vm--910--disk--0p1 \u8fdb\u884c\u6e05\u7406\u5de5\u4f5c\u4e86\u3002 \u6e05\u7406\u5b8c\u6210\u5e76 umount \u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 kpartx -d /dev/pve/vm-910-disk-0 \u5220\u9664\u5206\u533a\u6620\u5c04\u3002 \u540c\u6837\u7684\uff0c\u53d6\u51b3\u4e8e\u865a\u62df\u78c1\u76d8\u7684\u4f4d\u7f6e\uff0cPVE \u6709\u53ef\u80fd\u4f1a\u5728\u5173\u673a\u540e\u5c06\u865a\u62df\u78c1\u76d8\u7684 LVM \u5377\u8bbe\u7f6e\u4e3a inactive\uff0c\u9700\u8981\u4f7f\u7528 lvchange \u5148\u6fc0\u6d3b\uff0c\u53c2\u89c1\u6253\u5305\u5bb9\u5668\u955c\u50cf\u7684 \u7ae0\u8282 \u3002 \u4e94\u3001\u6253\u5305 \u00b6 \u5982\u679c\u6253\u5305\u597d\u7684\u955c\u50cf\u8981\u4f5c\u4e3a VM \u6a21\u677f\u4f7f\u7528\uff0c\u9700\u8981\u8fc1\u79fb\u81f3\u5404 pve \u4e3b\u673a\u95f4\u7684\u5171\u4eab\u5b58\u50a8\u4e0a\uff0c\u5982 user-data\u3002 \u53c2\u8003\u8d44\u6599 \u00b6 Proxmox VE \u5173\u4e8e Cloud-init \u7684\u6587\u6863\uff1a https://pve.proxmox.com/wiki/Cloud-Init_Support","title":"\u6253\u5305\u865a\u62df\u673a\u955c\u50cf"},{"location":"workflow/pack-vm-image/#_1","text":"\u7531\u4e8e Proxmox VE \u4e0a\u7684\u865a\u62df\u673a\u4f7f\u7528 cloud-init \u8fdb\u884c\u5b9a\u5236\uff0c\u6211\u4eec\u63a8\u8350\u4ee5\u53d1\u884c\u7248\u5b98\u65b9\u7684 cloud image \u4e3a\u57fa\u7840\u8fdb\u884c\u989d\u5916\u914d\u7f6e\u3002","title":"\u6253\u5305\u865a\u62df\u673a\u955c\u50cf"},{"location":"workflow/pack-vm-image/#ubuntu-cloud-images","text":"\u4ee5 Ubuntu 20.04 LTS \u4e3a\u4f8b\uff0c\u9996\u5148\u4e0b\u8f7d https://mirrors.ustc.edu.cn/ubuntu-cloud-images/focal/current/focal-server-cloudimg-amd64.img \u5230\u672c\u5730\u3002 \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u865a\u62df\u673a\uff08\u6ce8\u610f\u5c06 ID 910 \u6362\u6210\u4e00\u4e2a\u5408\u9002\u7684\u7a7a\u95f2 ID \uff09 qm create 910 --memory 2048 --net0 virtio,bridge = vmbr1 \u5c06\u521a\u4e0b\u8f7d\u7684\u955c\u50cf\u5bfc\u5165\u65b0\u865a\u62df\u673a\uff08\u8fd9\u4e2a img \u955c\u50cf\u5b9e\u9645\u4e0a\u662f qcow2 \u683c\u5f0f\uff09\u5e76\u6302\u8f7d\u4e3a SCSI \u786c\u76d8\uff0c\u5c06\u65b0\u786c\u76d8\u8bbe\u4e3a\u542f\u52a8\u76d8 qm importdisk 910 focal-server-cloudimg-amd64.img local-lvm qm set 910 --scsihw virtio-scsi-pci --scsi0 local-lvm:vm-910-disk-1 qm set 910 --boot c --bootdisk scsi0","title":"\u4e00\u3001\u4ece Ubuntu cloud images \u5f00\u59cb\u51c6\u5907\u865a\u62df\u673a"},{"location":"workflow/pack-vm-image/#cloud-init","text":"\u8fd9\u4e00\u6b65\u53ef\u4ee5\u5b8c\u5168\u5728 Proxmox VE web \u754c\u9762\u4e0a\u64cd\u4f5c\uff0c\u4e0b\u9762\u8fd8\u662f\u7ed9\u51fa\u547d\u4ee4\u884c\u6307\u5bfc\u3002 \u6dfb\u52a0 Cloud-init \u914d\u7f6e\u76d8\uff08\u5b98\u65b9\u6587\u6863\u91cc\u662f\u6dfb\u52a0\u4e3a IDE \u76d8\uff0c\u5b9e\u9645\u52a0\u6210 SCSI \u7684\u4e5f\u6ca1\u95ee\u9898\uff0c\u8fd9\u91cc\u8ddf\u968f\u5b98\u65b9\uff09 qm set 910 --ide2 local-lvm:cloudinit \u4e3a\u865a\u62df\u673a\u63d0\u4f9b\u7f51\u7edc\u4fe1\u606f\uff08\u6ce8\u610f\u628a IP \u5730\u5740\u6539\u6389\uff09\uff1a qm set 910 --ipconfig0 ip = 172 .31.0.256/16,gw = 172 .31.0.1,ip6 = auto \u53ef\u9009\u9879\u76ee\uff1a\u5c06 console \u8bbe\u4e3a\u4e32\u53e3 Proxmox VE \u5b98\u65b9\u6587\u6863\u91cc\u7684\u8bf4\u660e\uff1a Many Cloud-Init images rely on this, as it is an requirement for OpenStack images. qm set 910 --serial0 socket --vga serial0 \u53ef\u9009\u9879\u76ee\uff1a\u5f00\u673a \u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 qm start 910 \u542f\u52a8\u865a\u62df\u673a\u8fdb\u884c\u9ad8\u7ea7\u914d\u7f6e\u4e86\u3002 \u770b\u5b8c\u7b2c\u4e09\u7ae0\u548c\u7b2c\u56db\u7ae0\u4e4b\u540e\u4f60\u5c31\u77e5\u9053\u4e3a\u4ec0\u4e48\u5c06\u865a\u62df\u673a\u5f00\u673a\u662f\u53ef\u9009\u7684\u4e86\u3002","title":"\u4e8c\u3001\u914d\u7f6e Cloud-init"},{"location":"workflow/pack-vm-image/#_2","text":"\u6211\u4eec\u8ba4\u4e3a KVM \u865a\u62df\u673a\u7684\u53d7\u4f17\u662f\u4e0d\u9700\u8981\u684c\u9762\u73af\u5883\u548c Vlab Software \u8fdb\u884c\u8f83\u4e3a\u201c\u901a\u7528\u201d\u7684\u5b9e\u9a8c\u548c\u8ba1\u7b97\u7684\u7528\u6237\uff0c\u56e0\u6b64\u6211\u4eec\u5728 KVM \u955c\u50cf\u4e2d\u4e0d\u63d0\u4f9b\u684c\u9762\u73af\u5883\u548c /opt/vlab \uff08\u5176\u5b9e\u8981\u5f04\u8fd8\u6709\u70b9\u9ebb\u70e6\uff09\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4e0b\u8f7d\u4e0b\u6765\u7684\u5b98\u65b9\u955c\u50cf\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8fdb\u884c \u6700\u57fa\u672c\u7684\u4fee\u6539 \u5373\u53ef\u3002","title":"\u4e09\u3001\u955c\u50cf\u7684\u5904\u7406"},{"location":"workflow/pack-vm-image/#pre-packaging","text":"\u4e0e \u6253\u5305\u5bb9\u5668\u955c\u50cf\u524d\u7684\u6e05\u7406\u5de5\u4f5c \u4e00\u6837\u3002","title":"\u56db\u3001\u6253\u5305\u524d\u7684\u5de5\u4f5c"},{"location":"workflow/pack-vm-image/#_3","text":"\u6ce8\u610f KVM \u7684\u201c\u5377\u201d\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u78c1\u76d8\uff0c\u800c\u5bb9\u5668\u7684\u201c\u5377\u201d\u53ea\u5305\u542b rootfs \u6240\u5728\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u56e0\u6b64\u8981\u6302\u8f7d KVM \u7684 rootfs \u9700\u8981\u5148\u5904\u7406\u78c1\u76d8\u5206\u533a\u7684\u95ee\u9898\u3002\u6211\u4eec\u63a8\u8350\u4f7f\u7528 kpartx \u5de5\u5177\u3002 kpartx -av /dev/pve/vm-910-disk-0 \u4f60\u4f1a\u770b\u5230\u7c7b\u4f3c\u8fd9\u6837\u7684\u8f93\u51fa\uff1a add map pve-vm--910--disk--0p1 (253:19): 0 4384735 linear 253:14 227328 add map pve-vm--910--disk--0p14 (253:23): 0 8192 linear 253:14 2048 add map pve-vm--910--disk--0p15 (253:24): 0 217088 linear 253:14 10240 \u6839\u636e\u5bb9\u91cf\u5224\u65ad\uff0cp1 \u5c31\u662f\u865a\u62df\u673a\u7684 rootfs\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u6302\u8f7d /dev/mapper/pve-vm--910--disk--0p1 \u8fdb\u884c\u6e05\u7406\u5de5\u4f5c\u4e86\u3002 \u6e05\u7406\u5b8c\u6210\u5e76 umount \u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 kpartx -d /dev/pve/vm-910-disk-0 \u5220\u9664\u5206\u533a\u6620\u5c04\u3002 \u540c\u6837\u7684\uff0c\u53d6\u51b3\u4e8e\u865a\u62df\u78c1\u76d8\u7684\u4f4d\u7f6e\uff0cPVE \u6709\u53ef\u80fd\u4f1a\u5728\u5173\u673a\u540e\u5c06\u865a\u62df\u78c1\u76d8\u7684 LVM \u5377\u8bbe\u7f6e\u4e3a inactive\uff0c\u9700\u8981\u4f7f\u7528 lvchange \u5148\u6fc0\u6d3b\uff0c\u53c2\u89c1\u6253\u5305\u5bb9\u5668\u955c\u50cf\u7684 \u7ae0\u8282 \u3002","title":"\u6302\u8f7d\u865a\u62df\u673a\u78c1\u76d8"},{"location":"workflow/pack-vm-image/#packaging","text":"\u5982\u679c\u6253\u5305\u597d\u7684\u955c\u50cf\u8981\u4f5c\u4e3a VM \u6a21\u677f\u4f7f\u7528\uff0c\u9700\u8981\u8fc1\u79fb\u81f3\u5404 pve \u4e3b\u673a\u95f4\u7684\u5171\u4eab\u5b58\u50a8\u4e0a\uff0c\u5982 user-data\u3002","title":"\u4e94\u3001\u6253\u5305"},{"location":"workflow/pack-vm-image/#references","text":"Proxmox VE \u5173\u4e8e Cloud-init \u7684\u6587\u6863\uff1a https://pve.proxmox.com/wiki/Cloud-Init_Support","title":"\u53c2\u8003\u8d44\u6599"},{"location":"workflow/pack-windows-image/","text":"\u6253\u5305 Windows \u955c\u50cf \u00b6 \u8b66\u544a \u6253\u5305\u548c\u7ef4\u62a4 Windows \u955c\u50cf\u975e\u5e38\u9ebb\u70e6\u5e76\u4e14\u5f88\u96be debug\uff0c \u5feb\u8dd1\uff01\uff01\uff01 You have been warned. Run!!! \u7531\u4e8e Proxmox VE \u4e0a\u7684\u865a\u62df\u673a\u4f7f\u7528 cloud-init \u8fdb\u884c\u5b9a\u5236\uff0c\u5e76\u4e14 Windows \u548c Unix \u4e00\u5957\u4f53\u7cfb\u5b8c\u5168\u4e0d\u5728\u4e00\u4e2a\u9891\u9053\u4e0a\uff0c\u6240\u4ee5\u5236\u4f5c\u53ef\u4ee5\u7528 cloud-init \u5373\u4f7f\u53ea\u662f\u7b80\u5355\u5b9a\u5236\u7684 Windows \u955c\u50cf\u4e5f\u975e\u5e38\u6298\u817e\u3002 \u4e0b\u9762\u8ba9\u6211\u4eec\u4e00\u8d77\u6765\u53d7\u7f6a\u5427\uff01 \u4e00\u3001\u51c6\u5907\u865a\u62df\u673a \u00b6 \u5b89\u88c5\u865a\u62df\u673a \u00b6 \u5b66\u6821\u4e70\u4e86\u6b63\u7248\u7684 Windows 10\uff0c\u53ef\u4ee5\u5728 \u8f6f\u4ef6\u6b63\u7248\u5316 \u7f51\u7ad9\u4e0a\u4e0b\u8f7d\uff0c\u5efa\u8bae\u9009\u4e2d\u6587\u7248\uff08\u56e0\u4e3a\u662f\u9762\u5411\u7528\u6237\u7684\uff09\u3002\u65c1\u8fb9\u7684 KMS \u6ce8\u518c\u6587\u4ef6\u4e0d\u7528\u4e0b\u8f7d\uff0c\u5b9e\u9645\u53ea\u9700\u8981\u4e00\u884c\u547d\u4ee4\u5c31\u80fd\u89e3\u51b3\uff0c\u540e\u9762\u4f1a\u63d0\u5230\u3002 \u540c\u65f6\u4e5f\u8981\u4e0b\u8f7d VirtIO Windows \u9a71\u52a8 \uff0c\u9009 Stable ISO\u3002 \u521b\u5efa\u4e00\u4e2a\u865a\u62df\u673a\uff0c\u9009\u62e9\u4e00\u4e2a ID \u548c\u540d\u79f0 OS \u9875\u9762\u6ce8\u610f\u5728\u53f3\u8fb9\u7684 Guest OS \u6b63\u786e\u9009\u62e9 Windows 10 System \u9875\u9762\u52fe\u4e0a Qemu Agent\uff0c\u5c06 SCSI Controller \u6539\u4e3a Default \u786c\u76d8\u603b\u7ebf\u9009 SATA \uff0c\u5b58\u50a8\u548c\u5bb9\u91cf\u81ea\u5b9a\uff0c\u63a8\u8350 32 GB \u5c31\u591f\uff0c\u9664\u975e\u4f60\u8fd8\u8981\u989d\u5916\u5b89\u88c5\u8f6f\u4ef6\uff08\u5efa\u8bae\u522b\u81ea\u627e\u9ebb\u70e6\uff09 CPU \u5185\u5b58\u6309\u9700\u5206\u914d\uff0c4 \u6838 8 GB \u7b97\u9ad8\u914d\u4e86 \u7f51\u5361\u63a5\u5728 vmbr1 \u4e0a\uff08\u4e5f\u5c31\u662f\u7528\u6237\u5185\u7f51\uff09\uff0c\u4e0d\u7136\u540e\u9762\u8fd8\u6709\u9ebb\u70e6 \u6700\u540e\u7684\u786e\u8ba4\u9875\u9762\u5148 \u4e0d\u8981 \u52fe\u9009 Start after created\uff0c\u521b\u5efa\u5b8c\u6210\u540e\u53bb\u6dfb\u52a0\u4e00\u4e2a\u4e32\u53e3\u8bbe\u5907\uff08Serial 0\uff09\uff0c\u540e\u9762\u4f1a\u7528\u5230 \u548c\u4e00\u822c\u7684\u865a\u62df\u673a\u5b89\u88c5\u8fc7\u7a0b\u4e00\u6837\uff0c\u5c06 ISO \u6dfb\u52a0\u4e3a CD/DVD Drive\uff0c\u8ddf\u7740\u5b89\u88c5\u7a0b\u5e8f\u8d70\u5b8c\u6d41\u7a0b\u5373\u53ef\uff0c\u7248\u672c\u8bf7\u9009\u62e9\u6559\u80b2\u7248\u3002 \u7b2c\u4e00\u6b21\u91cd\u542f\u540e\u8fdb\u5165 Windows \u7684 OOBE\uff0c\u73b0\u5728\u53ef\u4ee5\u5728\u540e\u53f0\u628a\u5149\u9a71\u6362\u6210 VirtIO \u7684\u9a71\u52a8\u76d8\u4e86\u3002 Windows OOBE \u00b6 OOBE \u9636\u6bb5\u53ef\u4ee5\u81ea\u884c\u914d\u7f6e\uff0c\u4e0d\u8fc7\u65e2\u7136\u662f\u8981\u7528\u4f5c\u9762\u5411\u7528\u6237\u7684\u6a21\u677f\uff0c\u9009\u62e9\u4e00\u4e9b\u8bbe\u7f6e\u65f6\u7a0d\u5fae\u8003\u8651\u4e00\u4e0b\u3002 \u5730\u533a\u8bed\u8a00\u5f53\u7136\u662f\u4e2d\u6587\u4e86\uff0c\u952e\u76d8\u5fae\u8f6f\u62fc\u97f3\uff08\u8fd9\u662f\u9ed8\u8ba4\uff0c\u4e0b\u4e00\u6b65\uff09\uff0c\u7136\u540e\u4e00\u8def\u5230\u521b\u5efa\u8d26\u6237\u8fd9\u91cc\u4f1a\u6709\u4e2a\u9519\u8bef\u63d0\u793a\u7801 OOBEAADV10\uff0c\u5ffd\u7565\u6389\u5b83\u521b\u5efa\u4e00\u4e2a\u672c\u5730\u8d26\u6237\uff0c\u547d\u540d\u4e3a Vlab\uff0c\u5bc6\u7801\u7559\u7a7a\uff08\u4e0d\u7136\u540e\u9762\u8981\u4f60\u586b\u4e09\u4e2a\u5b89\u5168\u95ee\u9898\uff0cWTF?\uff09\u3002 \u9519\u8bef\u7801 OOBEAADV10 \u8fd9\u662f Windows \u5728\u5c1d\u8bd5\u8fde\u63a5\u5230 Azure Active Directory \u65f6\u62a5\u7684\u9519\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u65f6\u5019\u53ea\u6709 IPv6 \u7f51\u7edc\u662f\u901a\u7684\uff08\u6709 SLAAC\uff09\uff0c\u7528\u6237\u5185\u7f51\u6ca1\u6709 DHCP\u3002 \u4f4d\u7f6e\u670d\u52a1\u3001\u5e7f\u544a\u6807\u8bc6\u7b26\u8fd9\u4e2a\u9875\u9762\u5168\u90e8\u5173\u6389\uff0cCortana \u4e5f\u522b\u5f00\uff0c\u90fd\u662f\u4e9b\u6d6a\u8d39\u65f6\u95f4\u548c\u8d44\u6e90\u7684\u4e1c\u897f\u3002 \u5230\u8fd9\u91cc\u5c31\u5dee\u4e0d\u591a\u8fdb\u5165\u684c\u9762\u4e86\uff0c\u76ee\u524d\u4e3a\u6b62\u6ca1\u6709\u592a\u591a\u5751\uff0c\u9664\u4e86\u5bc6\u7801\u5fc5\u987b\u7559\u7a7a\u4e4b\u5916\uff08\u55ef\uff0c\u8fd9\u79cd\u5730\u65b9\u8981\u6c42\u586b\u5b89\u5168\u95ee\u9898\u662f\u4e2a\u5947\u602a\u7684\u8bbe\u5b9a\uff09\u3002 \u4e8c\u3001\u914d\u7f6e\u865a\u62df\u673a \u00b6 \u6682\u505c Windows \u66f4\u65b0 \u00b6 \u4e0d\u7136\u7f51\u7edc\u901a\u7545\u540e\u5f00\u59cb\u81ea\u52a8\u66f4\u65b0\u4e86\uff0c\u540e\u9762\u4f60\u5c31\u9ebb\u70e6\u4e86 \u8bbe\u7f6e\u7f51\u7edc \u00b6 \u53f3\u952e\u70b9\u51fb\u53f3\u4e0b\u89d2\u7684\u7f51\u7edc\u56fe\u6807\uff0c\u6253\u5f00\u201c\u7f51\u7edc\u548c Internet\u201d\u8bbe\u7f6e\uff0c\u5728\u4e0b\u9762\u9009\u62e9\u201c\u66f4\u6539\u9002\u914d\u5668\u9009\u9879\u201d\uff0c\u6253\u5f00\u201c\u4ee5\u592a\u7f51\u5b9e\u4f8b 0\u201d\u7684\u5c5e\u6027\uff0c\u518d\u9009\u4e2d Internet \u534f\u8bae\u7248\u672c 4\uff0c\u5728\u8fd9\u91cc\u6307\u5b9a\u4e00\u4e2a\u4e34\u65f6\u7684 IPv4 \u5730\u5740\uff08\u53c2\u8003 \u6253\u5305\u5bb9\u5668\u7684\u6d41\u7a0b \uff09\uff0c\u63a9\u7801\u662f 255.255.0.0 \uff0c\u7f51\u5173\u662f 172.31.0.1 \uff0cDNS \u670d\u52a1\u5668\u548c\u7f51\u5173\u4e00\u6837\uff0c\u786e\u5b9a\u5b8c\u6210\u540e\u5c31\u80fd\u4e0a\u7f51\u4e86\u3002 \u4e0d\u8981\u76f4\u63a5\u5728\u201c\u8bbe\u7f6e\u201d\u5e94\u7528\u91cc\u6539 \u201c\u8bbe\u7f6e\u201d\u91cc\u76f4\u63a5\u6539\u7684\u65f6\u5019\uff0c\u6307\u5b9a\u9759\u6001 IPv4 \u7684\u65f6\u5019\u5c31\u6ca1\u6709 IPv6 \u81ea\u52a8\u914d\u7f6e\u4e86\u3002 \u6fc0\u6d3b Windows \u00b6 \u53f3\u952e\u70b9\u51fb\u5de6\u4e0b\u89d2\u7684 Windows\uff0c\u6253\u5f00\u4e00\u4e2a\u6709\u7ba1\u7406\u5458\u6743\u9650\u7684 PowerShell \u7a97\u53e3\uff0c\u914d\u7f6e\u5b66\u6821\u7684 KMS \u6fc0\u6d3b\uff1a slmgr.vbs /skms kms.ustc.edu.cn \u73b0\u5728\u53ef\u4ee5\u8fdb\u8bbe\u7f6e\u5e94\u7528\u91cc\u67e5\u770b\u6fc0\u6d3b\u72b6\u6001\u4e86\u3002\u5982\u679c\u8fd8\u6ca1\u6fc0\u6d3b\u7684\u8bdd\uff0c\u70b9\u7591\u96be\u89e3\u7b54\uff0c\u7b49\u5b83\u8dd1\u5b8c\u5c31\u4f1a\u544a\u8bc9\u4f60\u5df2\u6fc0\u6d3b\u3002 \u5b89\u88c5 VirtIO \u9a71\u52a8 \u00b6 \u6253\u5f00\u5149\u9a71\u8fd0\u884c virtio-win-guest-tools.exe \uff0c\u4e00\u8def\u4e0b\u4e00\u6b65\u5b89\u88c5\u5373\u53ef\u3002 \u8fd9\u91cc\u552f\u4e00\u7684\u5751\u70b9\u662f\uff0c\u5982\u679c\u4f60\u5728\u521b\u5efa\u865a\u62df\u673a\u65f6\u6ca1\u6709\u591a\u4e00\u6b65\u6dfb\u52a0\u4e00\u4e2a\u4e32\u53e3\u8bbe\u5907\u7684\u8bdd\uff0c\u90a3\u4e48 VirtIO \u4e32\u53e3\u9a71\u52a8\u5c31\u4e0d\u4f1a\u5b89\u88c5\uff0c\u9700\u8981\u5173\u673a\u52a0\u597d\u8bbe\u5907\u540e\u518d\u91cd\u65b0\u5b89\u88c5\u3002 QEMU Guest Agent (Qemu GA) \u4ee5\u540e\u4f1a\u5f88\u6709\u7528\uff0c\u6211\u4eec\u4e5f\u628a\u5b83\u88c5\u4e0a\u5427\u3002 \u5176\u4ed6\u81ea\u5b9a\u4e49\u8bbe\u7f6e \u00b6 \u4efb\u52a1\u680f\u91cc\u90a3\u5757\u5de8\u5927\u7684\u80f6\u5e03\uff08\u641c\u7d22\u6846\uff09\u53ef\u4ee5\u9690\u85cf\u8d77\u6765\uff0cCortana \u56fe\u6807\u9690\u85cf\u8d77\u6765\uff0cTask View \u7684\u56fe\u6807\u4e5f\u53ef\u4ee5\u9690\u85cf\u8d77\u6765\uff0c\u8fd9\u51e0\u4e2a\u90fd\u662f\u53f3\u952e\u4efb\u52a1\u680f\u5c31\u53ef\u4ee5\u52fe\u9009\u7684\u9009\u9879\u3002 \u201c\u4efb\u52a1\u680f\u8bbe\u7f6e\u201d\u91cc\u7684\u201c\u4f7f\u7528\u2018\u901f\u89c8\u2019\u9884\u89c8\u684c\u9762\u201d\u51fa\u4e8e\u6027\u80fd\u8003\u8651\u5efa\u8bae\u4e0d\u8981\u5f00\uff0c\u5176\u4ed6\u968f\u610f\uff0c\u4f8b\u5982\u201c\u5408\u5e76\u4efb\u52a1\u680f\u6309\u94ae\u201d\u53ef\u4ee5\u6539\u6210\u201c\u4efb\u52a1\u680f\u5df2\u6ee1\u65f6\u201d\u7b49\u7b49\uff0c\u5176\u4ed6\u7684\u684c\u9762\u80cc\u666f\u3001\u989c\u8272\u3001\u5f00\u59cb\u83dc\u5355\u7b49\u90fd\u968f\u610f\u3002 Windows \u68c0\u6d4b\u7f51\u7edc\u8fde\u63a5\u7684\u529f\u80fd\u7ecf\u5e38\u574f\uff0c\u539f\u56e0\u5176\u5b9e\u5f88\u7b80\u5355\uff0cmsftconnecttest.com \u670d\u52a1\u5668\u5728\u56fd\u5916\uff0c\u5f88\u6162\u800c\u4e14\u4e0d\u7a33\u5b9a\uff0c\u53ef\u4ee5\u4fee\u6539\u6ce8\u518c\u8868\u5c06\u8fd9\u4e2a\u529f\u80fd\u66ff\u6362\u6210\u4f7f\u7528\u6821\u5185\u7684\u670d\u52a1\u3002 \u6ce8\u518c\u8868\u6587\u4ef6 Windows Registry Editor Version 5.00 [ HKEY_LOCAL_MACHINE \\SYSTEM\\CurrentControlSet\\Services\\NlaSvc\\Parameters\\Internet] \"ActiveDnsProbeContent\" = \"202.38.64.1\" \"ActiveDnsProbeContentV6\" = \"2001:da8:d800::1\" \"ActiveDnsProbeHost\" = \"ns.ustc.edu.cn\" \"ActiveDnsProbeHostV6\" = \"ns.ustc.edu.cn\" \"ActiveWebProbeContent\" = \"USTC Mirrors Connect Test\" \"ActiveWebProbeContentV6\" = \"USTC Mirrors Connect Test\" \"ActiveWebProbeHost\" = \"mirrors.ustc.edu.cn\" \"ActiveWebProbeHostV6\" = \"ipv6.mirrors.ustc.edu.cn\" \"ActiveWebProbePath\" = \"connecttest.txt\" \"ActiveWebProbePathV6\" = \"connecttest.txt\" \"EnableActiveProbing\" = dword : 00000001 \u4e09\u3001\u5b89\u88c5 Cloudbase-init \u00b6","title":"\u6253\u5305 Windows \u955c\u50cf"},{"location":"workflow/pack-windows-image/#windows","text":"\u8b66\u544a \u6253\u5305\u548c\u7ef4\u62a4 Windows \u955c\u50cf\u975e\u5e38\u9ebb\u70e6\u5e76\u4e14\u5f88\u96be debug\uff0c \u5feb\u8dd1\uff01\uff01\uff01 You have been warned. Run!!! \u7531\u4e8e Proxmox VE \u4e0a\u7684\u865a\u62df\u673a\u4f7f\u7528 cloud-init \u8fdb\u884c\u5b9a\u5236\uff0c\u5e76\u4e14 Windows \u548c Unix \u4e00\u5957\u4f53\u7cfb\u5b8c\u5168\u4e0d\u5728\u4e00\u4e2a\u9891\u9053\u4e0a\uff0c\u6240\u4ee5\u5236\u4f5c\u53ef\u4ee5\u7528 cloud-init \u5373\u4f7f\u53ea\u662f\u7b80\u5355\u5b9a\u5236\u7684 Windows \u955c\u50cf\u4e5f\u975e\u5e38\u6298\u817e\u3002 \u4e0b\u9762\u8ba9\u6211\u4eec\u4e00\u8d77\u6765\u53d7\u7f6a\u5427\uff01","title":"\u6253\u5305 Windows \u955c\u50cf"},{"location":"workflow/pack-windows-image/#_1","text":"","title":"\u4e00\u3001\u51c6\u5907\u865a\u62df\u673a"},{"location":"workflow/pack-windows-image/#_2","text":"\u5b66\u6821\u4e70\u4e86\u6b63\u7248\u7684 Windows 10\uff0c\u53ef\u4ee5\u5728 \u8f6f\u4ef6\u6b63\u7248\u5316 \u7f51\u7ad9\u4e0a\u4e0b\u8f7d\uff0c\u5efa\u8bae\u9009\u4e2d\u6587\u7248\uff08\u56e0\u4e3a\u662f\u9762\u5411\u7528\u6237\u7684\uff09\u3002\u65c1\u8fb9\u7684 KMS \u6ce8\u518c\u6587\u4ef6\u4e0d\u7528\u4e0b\u8f7d\uff0c\u5b9e\u9645\u53ea\u9700\u8981\u4e00\u884c\u547d\u4ee4\u5c31\u80fd\u89e3\u51b3\uff0c\u540e\u9762\u4f1a\u63d0\u5230\u3002 \u540c\u65f6\u4e5f\u8981\u4e0b\u8f7d VirtIO Windows \u9a71\u52a8 \uff0c\u9009 Stable ISO\u3002 \u521b\u5efa\u4e00\u4e2a\u865a\u62df\u673a\uff0c\u9009\u62e9\u4e00\u4e2a ID \u548c\u540d\u79f0 OS \u9875\u9762\u6ce8\u610f\u5728\u53f3\u8fb9\u7684 Guest OS \u6b63\u786e\u9009\u62e9 Windows 10 System \u9875\u9762\u52fe\u4e0a Qemu Agent\uff0c\u5c06 SCSI Controller \u6539\u4e3a Default \u786c\u76d8\u603b\u7ebf\u9009 SATA \uff0c\u5b58\u50a8\u548c\u5bb9\u91cf\u81ea\u5b9a\uff0c\u63a8\u8350 32 GB \u5c31\u591f\uff0c\u9664\u975e\u4f60\u8fd8\u8981\u989d\u5916\u5b89\u88c5\u8f6f\u4ef6\uff08\u5efa\u8bae\u522b\u81ea\u627e\u9ebb\u70e6\uff09 CPU \u5185\u5b58\u6309\u9700\u5206\u914d\uff0c4 \u6838 8 GB \u7b97\u9ad8\u914d\u4e86 \u7f51\u5361\u63a5\u5728 vmbr1 \u4e0a\uff08\u4e5f\u5c31\u662f\u7528\u6237\u5185\u7f51\uff09\uff0c\u4e0d\u7136\u540e\u9762\u8fd8\u6709\u9ebb\u70e6 \u6700\u540e\u7684\u786e\u8ba4\u9875\u9762\u5148 \u4e0d\u8981 \u52fe\u9009 Start after created\uff0c\u521b\u5efa\u5b8c\u6210\u540e\u53bb\u6dfb\u52a0\u4e00\u4e2a\u4e32\u53e3\u8bbe\u5907\uff08Serial 0\uff09\uff0c\u540e\u9762\u4f1a\u7528\u5230 \u548c\u4e00\u822c\u7684\u865a\u62df\u673a\u5b89\u88c5\u8fc7\u7a0b\u4e00\u6837\uff0c\u5c06 ISO \u6dfb\u52a0\u4e3a CD/DVD Drive\uff0c\u8ddf\u7740\u5b89\u88c5\u7a0b\u5e8f\u8d70\u5b8c\u6d41\u7a0b\u5373\u53ef\uff0c\u7248\u672c\u8bf7\u9009\u62e9\u6559\u80b2\u7248\u3002 \u7b2c\u4e00\u6b21\u91cd\u542f\u540e\u8fdb\u5165 Windows \u7684 OOBE\uff0c\u73b0\u5728\u53ef\u4ee5\u5728\u540e\u53f0\u628a\u5149\u9a71\u6362\u6210 VirtIO \u7684\u9a71\u52a8\u76d8\u4e86\u3002","title":"\u5b89\u88c5\u865a\u62df\u673a"},{"location":"workflow/pack-windows-image/#windows-oobe","text":"OOBE \u9636\u6bb5\u53ef\u4ee5\u81ea\u884c\u914d\u7f6e\uff0c\u4e0d\u8fc7\u65e2\u7136\u662f\u8981\u7528\u4f5c\u9762\u5411\u7528\u6237\u7684\u6a21\u677f\uff0c\u9009\u62e9\u4e00\u4e9b\u8bbe\u7f6e\u65f6\u7a0d\u5fae\u8003\u8651\u4e00\u4e0b\u3002 \u5730\u533a\u8bed\u8a00\u5f53\u7136\u662f\u4e2d\u6587\u4e86\uff0c\u952e\u76d8\u5fae\u8f6f\u62fc\u97f3\uff08\u8fd9\u662f\u9ed8\u8ba4\uff0c\u4e0b\u4e00\u6b65\uff09\uff0c\u7136\u540e\u4e00\u8def\u5230\u521b\u5efa\u8d26\u6237\u8fd9\u91cc\u4f1a\u6709\u4e2a\u9519\u8bef\u63d0\u793a\u7801 OOBEAADV10\uff0c\u5ffd\u7565\u6389\u5b83\u521b\u5efa\u4e00\u4e2a\u672c\u5730\u8d26\u6237\uff0c\u547d\u540d\u4e3a Vlab\uff0c\u5bc6\u7801\u7559\u7a7a\uff08\u4e0d\u7136\u540e\u9762\u8981\u4f60\u586b\u4e09\u4e2a\u5b89\u5168\u95ee\u9898\uff0cWTF?\uff09\u3002 \u9519\u8bef\u7801 OOBEAADV10 \u8fd9\u662f Windows \u5728\u5c1d\u8bd5\u8fde\u63a5\u5230 Azure Active Directory \u65f6\u62a5\u7684\u9519\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u65f6\u5019\u53ea\u6709 IPv6 \u7f51\u7edc\u662f\u901a\u7684\uff08\u6709 SLAAC\uff09\uff0c\u7528\u6237\u5185\u7f51\u6ca1\u6709 DHCP\u3002 \u4f4d\u7f6e\u670d\u52a1\u3001\u5e7f\u544a\u6807\u8bc6\u7b26\u8fd9\u4e2a\u9875\u9762\u5168\u90e8\u5173\u6389\uff0cCortana \u4e5f\u522b\u5f00\uff0c\u90fd\u662f\u4e9b\u6d6a\u8d39\u65f6\u95f4\u548c\u8d44\u6e90\u7684\u4e1c\u897f\u3002 \u5230\u8fd9\u91cc\u5c31\u5dee\u4e0d\u591a\u8fdb\u5165\u684c\u9762\u4e86\uff0c\u76ee\u524d\u4e3a\u6b62\u6ca1\u6709\u592a\u591a\u5751\uff0c\u9664\u4e86\u5bc6\u7801\u5fc5\u987b\u7559\u7a7a\u4e4b\u5916\uff08\u55ef\uff0c\u8fd9\u79cd\u5730\u65b9\u8981\u6c42\u586b\u5b89\u5168\u95ee\u9898\u662f\u4e2a\u5947\u602a\u7684\u8bbe\u5b9a\uff09\u3002","title":"Windows OOBE"},{"location":"workflow/pack-windows-image/#_3","text":"","title":"\u4e8c\u3001\u914d\u7f6e\u865a\u62df\u673a"},{"location":"workflow/pack-windows-image/#windows_1","text":"\u4e0d\u7136\u7f51\u7edc\u901a\u7545\u540e\u5f00\u59cb\u81ea\u52a8\u66f4\u65b0\u4e86\uff0c\u540e\u9762\u4f60\u5c31\u9ebb\u70e6\u4e86","title":"\u6682\u505c Windows \u66f4\u65b0"},{"location":"workflow/pack-windows-image/#_4","text":"\u53f3\u952e\u70b9\u51fb\u53f3\u4e0b\u89d2\u7684\u7f51\u7edc\u56fe\u6807\uff0c\u6253\u5f00\u201c\u7f51\u7edc\u548c Internet\u201d\u8bbe\u7f6e\uff0c\u5728\u4e0b\u9762\u9009\u62e9\u201c\u66f4\u6539\u9002\u914d\u5668\u9009\u9879\u201d\uff0c\u6253\u5f00\u201c\u4ee5\u592a\u7f51\u5b9e\u4f8b 0\u201d\u7684\u5c5e\u6027\uff0c\u518d\u9009\u4e2d Internet \u534f\u8bae\u7248\u672c 4\uff0c\u5728\u8fd9\u91cc\u6307\u5b9a\u4e00\u4e2a\u4e34\u65f6\u7684 IPv4 \u5730\u5740\uff08\u53c2\u8003 \u6253\u5305\u5bb9\u5668\u7684\u6d41\u7a0b \uff09\uff0c\u63a9\u7801\u662f 255.255.0.0 \uff0c\u7f51\u5173\u662f 172.31.0.1 \uff0cDNS \u670d\u52a1\u5668\u548c\u7f51\u5173\u4e00\u6837\uff0c\u786e\u5b9a\u5b8c\u6210\u540e\u5c31\u80fd\u4e0a\u7f51\u4e86\u3002 \u4e0d\u8981\u76f4\u63a5\u5728\u201c\u8bbe\u7f6e\u201d\u5e94\u7528\u91cc\u6539 \u201c\u8bbe\u7f6e\u201d\u91cc\u76f4\u63a5\u6539\u7684\u65f6\u5019\uff0c\u6307\u5b9a\u9759\u6001 IPv4 \u7684\u65f6\u5019\u5c31\u6ca1\u6709 IPv6 \u81ea\u52a8\u914d\u7f6e\u4e86\u3002","title":"\u8bbe\u7f6e\u7f51\u7edc"},{"location":"workflow/pack-windows-image/#windows_2","text":"\u53f3\u952e\u70b9\u51fb\u5de6\u4e0b\u89d2\u7684 Windows\uff0c\u6253\u5f00\u4e00\u4e2a\u6709\u7ba1\u7406\u5458\u6743\u9650\u7684 PowerShell \u7a97\u53e3\uff0c\u914d\u7f6e\u5b66\u6821\u7684 KMS \u6fc0\u6d3b\uff1a slmgr.vbs /skms kms.ustc.edu.cn \u73b0\u5728\u53ef\u4ee5\u8fdb\u8bbe\u7f6e\u5e94\u7528\u91cc\u67e5\u770b\u6fc0\u6d3b\u72b6\u6001\u4e86\u3002\u5982\u679c\u8fd8\u6ca1\u6fc0\u6d3b\u7684\u8bdd\uff0c\u70b9\u7591\u96be\u89e3\u7b54\uff0c\u7b49\u5b83\u8dd1\u5b8c\u5c31\u4f1a\u544a\u8bc9\u4f60\u5df2\u6fc0\u6d3b\u3002","title":"\u6fc0\u6d3b Windows"},{"location":"workflow/pack-windows-image/#virtio","text":"\u6253\u5f00\u5149\u9a71\u8fd0\u884c virtio-win-guest-tools.exe \uff0c\u4e00\u8def\u4e0b\u4e00\u6b65\u5b89\u88c5\u5373\u53ef\u3002 \u8fd9\u91cc\u552f\u4e00\u7684\u5751\u70b9\u662f\uff0c\u5982\u679c\u4f60\u5728\u521b\u5efa\u865a\u62df\u673a\u65f6\u6ca1\u6709\u591a\u4e00\u6b65\u6dfb\u52a0\u4e00\u4e2a\u4e32\u53e3\u8bbe\u5907\u7684\u8bdd\uff0c\u90a3\u4e48 VirtIO \u4e32\u53e3\u9a71\u52a8\u5c31\u4e0d\u4f1a\u5b89\u88c5\uff0c\u9700\u8981\u5173\u673a\u52a0\u597d\u8bbe\u5907\u540e\u518d\u91cd\u65b0\u5b89\u88c5\u3002 QEMU Guest Agent (Qemu GA) \u4ee5\u540e\u4f1a\u5f88\u6709\u7528\uff0c\u6211\u4eec\u4e5f\u628a\u5b83\u88c5\u4e0a\u5427\u3002","title":"\u5b89\u88c5 VirtIO \u9a71\u52a8"},{"location":"workflow/pack-windows-image/#_5","text":"\u4efb\u52a1\u680f\u91cc\u90a3\u5757\u5de8\u5927\u7684\u80f6\u5e03\uff08\u641c\u7d22\u6846\uff09\u53ef\u4ee5\u9690\u85cf\u8d77\u6765\uff0cCortana \u56fe\u6807\u9690\u85cf\u8d77\u6765\uff0cTask View \u7684\u56fe\u6807\u4e5f\u53ef\u4ee5\u9690\u85cf\u8d77\u6765\uff0c\u8fd9\u51e0\u4e2a\u90fd\u662f\u53f3\u952e\u4efb\u52a1\u680f\u5c31\u53ef\u4ee5\u52fe\u9009\u7684\u9009\u9879\u3002 \u201c\u4efb\u52a1\u680f\u8bbe\u7f6e\u201d\u91cc\u7684\u201c\u4f7f\u7528\u2018\u901f\u89c8\u2019\u9884\u89c8\u684c\u9762\u201d\u51fa\u4e8e\u6027\u80fd\u8003\u8651\u5efa\u8bae\u4e0d\u8981\u5f00\uff0c\u5176\u4ed6\u968f\u610f\uff0c\u4f8b\u5982\u201c\u5408\u5e76\u4efb\u52a1\u680f\u6309\u94ae\u201d\u53ef\u4ee5\u6539\u6210\u201c\u4efb\u52a1\u680f\u5df2\u6ee1\u65f6\u201d\u7b49\u7b49\uff0c\u5176\u4ed6\u7684\u684c\u9762\u80cc\u666f\u3001\u989c\u8272\u3001\u5f00\u59cb\u83dc\u5355\u7b49\u90fd\u968f\u610f\u3002 Windows \u68c0\u6d4b\u7f51\u7edc\u8fde\u63a5\u7684\u529f\u80fd\u7ecf\u5e38\u574f\uff0c\u539f\u56e0\u5176\u5b9e\u5f88\u7b80\u5355\uff0cmsftconnecttest.com \u670d\u52a1\u5668\u5728\u56fd\u5916\uff0c\u5f88\u6162\u800c\u4e14\u4e0d\u7a33\u5b9a\uff0c\u53ef\u4ee5\u4fee\u6539\u6ce8\u518c\u8868\u5c06\u8fd9\u4e2a\u529f\u80fd\u66ff\u6362\u6210\u4f7f\u7528\u6821\u5185\u7684\u670d\u52a1\u3002 \u6ce8\u518c\u8868\u6587\u4ef6 Windows Registry Editor Version 5.00 [ HKEY_LOCAL_MACHINE \\SYSTEM\\CurrentControlSet\\Services\\NlaSvc\\Parameters\\Internet] \"ActiveDnsProbeContent\" = \"202.38.64.1\" \"ActiveDnsProbeContentV6\" = \"2001:da8:d800::1\" \"ActiveDnsProbeHost\" = \"ns.ustc.edu.cn\" \"ActiveDnsProbeHostV6\" = \"ns.ustc.edu.cn\" \"ActiveWebProbeContent\" = \"USTC Mirrors Connect Test\" \"ActiveWebProbeContentV6\" = \"USTC Mirrors Connect Test\" \"ActiveWebProbeHost\" = \"mirrors.ustc.edu.cn\" \"ActiveWebProbeHostV6\" = \"ipv6.mirrors.ustc.edu.cn\" \"ActiveWebProbePath\" = \"connecttest.txt\" \"ActiveWebProbePathV6\" = \"connecttest.txt\" \"EnableActiveProbing\" = dword : 00000001","title":"\u5176\u4ed6\u81ea\u5b9a\u4e49\u8bbe\u7f6e"},{"location":"workflow/pack-windows-image/#cloudbase-init","text":"","title":"\u4e09\u3001\u5b89\u88c5 Cloudbase-init"}]}